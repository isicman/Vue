(window.webpackJsonp=window.webpackJsonp||[]).push([[181],{660:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"iptables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#iptables"}},[t._v("#")]),t._v(" Iptables")]),t._v(" "),a("h2",{attrs:{id:"常见几种类型防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见几种类型防火墙"}},[t._v("#")]),t._v(" 常见几种类型防火墙？")]),t._v(" "),a("ul",[a("li",[a("strong",[a("code",[t._v("包过滤防火墙")]),t._v("：包过滤是 IP 层实现，包过滤根据数据包的源 IP、目的 IP、协议类型 （TCP/UDP/ICMP）、源端口、目的端口等包头信息及数据包传输方向灯信息来判断是否允许数据包 通过。")])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("应用层防火墙")]),t._v("：也称为应用层代理防火墙，基于应用层协议的信息流检测，可以拦截某应用程序的 所有封包，提取包内容进行分析。有效防止 SQL 注入或者 XSS（跨站脚本攻击）之类的恶意代码。")])]),t._v(" "),a("li",[a("strong",[a("code",[t._v("状态检测防火墙")]),t._v("：结合包过滤和应用层防火墙优点，基于连接状态检测机制，将属于同一连接的所 有包作为一个整体的数据流看待，构成连接状态表（通信信息，应用程序信息等），通过规则表与 状态表共同配合，对表中的各个连接状态判断。")])])]),t._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" "),a("strong",[t._v("简介")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("iptables 是 Linux 下的配置防火墙的工具")]),t._v("，用于配置 Linux 内核集成的 IP 信息包过滤系统，使增 删改查信息包过滤表中的规则更加简单。 iptables 分为四表五链，表是链的容器，链是规则的容器，规则指定动作。")])]),t._v(" "),a("h2",{attrs:{id:"四表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四表"}},[t._v("#")]),t._v(" 四表")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("filter")]),t._v(" "),a("th",[t._v("用于包过滤")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("nat")])]),t._v(" "),a("td",[a("strong",[t._v("网络地址转发")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("mangle")])]),t._v(" "),a("td",[a("strong",[t._v("对特定数据包修改")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("raw")])]),t._v(" "),a("td",[a("strong",[t._v("不做数据包链接跟踪")])])])])]),t._v(" "),a("h2",{attrs:{id:"五链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五链"}},[t._v("#")]),t._v(" 五链")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("INPUT")])]),t._v(" "),a("th",[a("strong",[t._v("本机数据包入口")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("strong",[t._v("OUTPUT")])]),t._v(" "),a("td",[a("strong",[t._v("本机数据包出口")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("FORWARD")])]),t._v(" "),a("td",[a("strong",[t._v("经过本机转发的数据包")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("PREROUTING")])]),t._v(" "),a("td",[a("strong",[t._v("防火墙之前，修改目的地址（DNAT）")])])]),t._v(" "),a("tr",[a("td",[a("strong",[t._v("POSTROUTING")])]),t._v(" "),a("td",[a("strong",[t._v("防火墙之后，修改源地址（SNAT）")])])])])]),t._v(" "),a("h2",{attrs:{id:"表中的链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#表中的链"}},[t._v("#")]),t._v(" 表中的链")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec01582ab3f51d91284675.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"命令格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#命令格式"}},[t._v("#")]),t._v(" 命令格式")]),t._v(" "),a("p",[a("strong",[t._v("命令格式：iptables [-t table] 命令 [chain] 匹配条件 动作")])]),t._v(" "),a("p",[a("strong",[t._v("命令\t\t\t\t描述")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-A，append")]),t._v(" \t\t 追加一条规则")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-I，insert")]),t._v(" \t\t 插入一条规则，默认链头，后跟编号，指定第几条")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-D，delete")]),t._v(" \t\t 删除一条规则")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-F，flush")]),t._v(" \t\t  清空规则")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-L，list")]),t._v(" \t\t   列出规则")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-P，policy")]),t._v(" \t\t 设置链缺省规则")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-m，module")]),t._v(" \t\t 模块，比如 state、multiport")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-X")]),t._v("\t\t\t\t  删除指定表中用户自定义的规则链（delete-chain）")])]),t._v(" "),a("p",[a("strong",[a("code",[t._v("-Z")]),t._v(" \t\t\t\t 将所有表的所有链的字节和数据包计数器清零")])]),t._v(" "),a("h2",{attrs:{id:"匹配条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#匹配条件"}},[t._v("#")]),t._v(" 匹配条件")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec01582ab3f51d9128467c.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec01582ab3f51d91284683.png",alt:""}})]),t._v(" "),a("p",[a("img",{attrs:{src:"https://pic.imgdb.cn/item/61ec01582ab3f51d91284690.png",alt:""}})]),t._v(" "),a("h2",{attrs:{id:"常用的规则配置方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常用的规则配置方法"}},[t._v("#")]),t._v(" 常用的规则配置方法")]),t._v(" "),a("h4",{attrs:{id:"查看iptables的列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看iptables的列表"}},[t._v("#")]),t._v(" 查看Iptables的列表")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ iptables --list \n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("h4",{attrs:{id:"清空表规则"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#清空表规则"}},[t._v("#")]),t._v(" 清空表规则")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ iptables -F \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清空表规则，默认 filter 表")]),t._v("\n$ iptables -t nat -F \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清空 nat 表")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h4",{attrs:{id:"允许端口访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#允许端口访问"}},[t._v("#")]),t._v(" 允许端口访问")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ iptables -A INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(" -j ACCEPT \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许 TCP 的 22 端口访问")]),t._v("\n$ iptables -I INPUT -p udp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v(" -j ACCEPT \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许 UDP 的 53 端口访问，插入在第一条")]),t._v("\n$ iptables -A INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":25 -j ACCEPT \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许端口范围访问")]),t._v("\n$ iptables -D INPUT -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),t._v(":25 -j ACCEPT \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 删除这条规则")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h4",{attrs:{id:"允许范围"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#允许范围"}},[t._v("#")]),t._v(" 允许范围")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("$ iptables -A INPUT -p tcp -m multiport --dports "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("22,80")]),t._v(",8080 -j ACCEPT "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许多个TCP端口访问")]),t._v("\n$ iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.0/24 -j ACCEPT \t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许 192.168.1.0 段 IP 访问")]),t._v("\n$ iptables -A INPUT -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.10 -j DROP \t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对 1.10 数据包丢弃")]),t._v("\n$ iptables -A INPUT -i eth0 -p icmp -j DROP \t\t\t\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# eth0 网卡 ICMP 数据包丢弃，也就是禁 ping")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许来自 lo 接口，如果没有这条规则，将不能通过 127.0.0.1 访问本地服务")]),t._v("\n$ iptables -A INPUT -i lo -j ACCEPT\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制并发连接数，超过 30 个拒绝")]),t._v("\n$ iptables -I INPUT -p tcp --syn --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -m connlimit --connlimit-above "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(" -j REJECT\n$ iptables -A FORWARD -p tcp --syn -m limit --limit "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("/s -j ACCEPT\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h4",{attrs:{id:"其他"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他"}},[t._v("#")]),t._v(" 其他")]),t._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# iptables 服务器作为网关时，内网访问公网")]),t._v("\n$ iptables –t nat -A POSTROUTING -s "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("内网 IP 或网段"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -j SNAT --to "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("公网 IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问 iptables 公网 IP 端口，转发到内网服务器端口")]),t._v("\n$ iptables –t nat -A PREROUTING -d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("对外 IP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("对外端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -j DNAT --to "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("内网 IP:内网端口"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 本地 80 端口转发到本地 8080 端口")]),t._v("\n$ iptables -t nat -A PREROUTING -p tcp --dport "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v(" -j REDIRECT --to-ports "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8080")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许已建立及该链接相关联的数据包通过")]),t._v("\n$ iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ASDL 拨号上网")]),t._v("\n$ iptables -t nat -A POSTROUTING -s "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.0/24 -o pppo -j MASQUERADE\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置 INPUT 链缺省操作丢弃所有数据包，只要不符合规则的数据包都丢弃。注意要在最后设置，以免把自己关在外面！")]),t._v("\n$ iptables -P INPUT DROP\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])])])}),[],!1,null,null,null);s.default=e.exports}}]);