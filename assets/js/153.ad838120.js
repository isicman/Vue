(window.webpackJsonp=window.webpackJsonp||[]).push([[153],{633:function(s,a,t){"use strict";t.r(a);var e=t(19),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"helm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm"}},[s._v("#")]),s._v(" Helm")]),s._v(" "),t("p",[t("strong",[s._v("Kubernetes 包管理工具")])]),s._v(" "),t("p",[s._v("Helm 可以帮助我们管理 Kubernetes 应用程序 - Helm Charts 可以定义、安装和升级复杂的 Kubernetes 应用程序，Charts 包很容易创建、版本管理、分享和分布。Helm 对于 Kubernetes 来说就相当于 yum 对于 Centos 来说，如果没有 yum 的话，我们在 Centos 下面要安装一些应用程序是极度麻烦的，同样的，对于越来越复杂的 Kubernetes 应用程序来说，如果单纯依靠我们去手动维护应用程序的 YAML 资源清单文件来说，成本也是巨大的。接下来我们就来了解了 Helm 的使用方法。")]),s._v(" "),t("h2",{attrs:{id:"helm安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm安装"}},[s._v("#")]),s._v(" Helm安装")]),s._v(" "),t("p",[s._v("首先当然需要一个可用的 Kubernetes 集群，然后在我们使用 Helm 的节点上已经配置好可以通过 kubectl 访问集群，因为 Helm 其实就是读取的 kubeconfig 文件来访问集群的。")]),s._v(" "),t("p",[s._v("由于 Helm V2 版本必须在 Kubernetes 集群中安装一个 Tiller 服务进行通信，这样大大降低了其安全性和可用性，所以在 V3 版本中移除了服务端，采用了通用的 Kubernetes CRD 资源来进行管理，这样就只需要连接上 Kubernetes 即可，而且 V3 版本已经发布了稳定版，所以我们这里来安装最新的 v3.0.1 版本，软件包下载地址为：https://github.com/helm/helm/releases，我们可以根据自己的节点选择合适的包")]),s._v(" "),t("h3",{attrs:{id:"_1-拉取helm的安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-拉取helm的安装包"}},[s._v("#")]),s._v(" 1.拉取Helm的安装包")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://get.helm.sh/helm-v3.0.0-linux-amd64.tar.gz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-解压安装包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-解压安装包"}},[s._v("#")]),s._v(" 2.解压安装包")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf helm-v3.0.0-linux-amd64.tar.gz\nlinux-amd64/\nlinux-amd64/helm\nlinux-amd64/README.md\nlinux-amd64/LICENSE\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_3-复制path路径"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-复制path路径"}},[s._v("#")]),s._v(" 3.复制PATH路径")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" linux-amd64/helm /usr/local/bin/helm\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_4-查看helm版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-查看helm版本"}},[s._v("#")]),s._v(" 4.查看Helm版本")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm version\nversion.BuildInfo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Version:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"v3.0.0"')]),s._v(", GitCommit:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"e29ce2a54e96cd02ccfce88bee4f58bb6e2a28b6"')]),s._v(", GitTreeState:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clean"')]),s._v(", GoVersion:"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go1.13.4"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_5-添加一个-chart-仓库"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-添加一个-chart-仓库"}},[s._v("#")]),s._v(" 5.添加一个 chart 仓库")]),s._v(" "),t("p",[s._v("当然最常用的就是官方的 Helm stable charts 仓库，但是由于官方的 charts 仓库地址需要科学上网，我们可以使用微软的 charts 仓库代替：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm repo "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" stable http://mirror.azure.cn/kubernetes/charts/\n$ helm repo list\nNAME            URL\nstable          http://mirror.azure.cn/kubernetes/charts/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_6-验证使用chart包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-验证使用chart包"}},[s._v("#")]),s._v(" 6.验证使用chart包")]),s._v(" "),t("p",[s._v("安装完成后可以用 search 命令来搜索可以安装的 chart 包：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm search repo stable\nNAME                                    CHART VERSION   APP VERSION                     DESCRIPTION\nstable/acs-engine-autoscaler            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(".2           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".1                           DEPRECATED Scales worker nodes within agent pools\nstable/aerospike                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.3")]),s._v(".1           v4.5.0.5                        A Helm chart "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("Aerospike")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" Kubernetes\nstable/airflow                          "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),s._v(".1           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),s._v(".4                          Airflow is a platform to programmatically autho"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/ambassador                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.1")]),s._v(".0           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.85")]),s._v(".0                          A Helm chart "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Datawire Ambassador\nstable/anchore-engine                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(".7           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v(".2                           Anchore container analysis and policy evaluatio"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nstable/apm-server                       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".5           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.0")]),s._v(".0                           The server receives data from the Elastic APM a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h2",{attrs:{id:"helm安装mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm安装mysql"}},[s._v("#")]),s._v(" Helm安装mysql")]),s._v(" "),t("h3",{attrs:{id:"heml-install命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#heml-install命令"}},[s._v("#")]),s._v(" heml install命令")]),s._v(" "),t("p",[s._v("比如我们现在安装一个 "),t("code",[s._v("mysql")]),s._v(" 应用：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" stable/mysql --generate-name\nNAME: mysql-1575619811\nLAST DEPLOYED: Fri Dec  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":10:14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nNOTES:\nMySQL can be accessed via port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" on the following DNS name from within your cluster:\nmysql-1575619811.default.svc.cluster.local\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("我们可以看到 "),t("code",[s._v("stable/mysql")]),s._v(" 这个 chart 已经安装成功了，我们将安装成功的这个应用叫做一个 "),t("code",[s._v("release")]),s._v("，由于我们在安装的时候指定了"),t("code",[s._v("--generate-name")]),s._v(" 参数，所以生成的 release 名称是随机生成的，名为 "),t("code",[s._v("mysql-1575619811")]),s._v("。我们可以用下面的命令来查看 release 安装以后对应的 Kubernetes 资源的状态：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl get all -l "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-1575619811\nNAME                                    READY   STATUS    RESTARTS   AGE\npod/mysql-1575619811-8479b5b796-dgggz   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     Pending   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          27m\n\nNAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\nservice/mysql-1575619811   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.106")]),s._v(".141.228   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/TCP   27m\n\nNAME                               READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/mysql-1575619811   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("           27m\n\nNAME                                          DESIRED   CURRENT   READY   AGE\nreplicaset.apps/mysql-1575619811-8479b5b796   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       27m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"helm-show命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-show命令"}},[s._v("#")]),s._v(" helm show命令")]),s._v(" "),t("p",[s._v("我们也可以 "),t("code",[s._v("helm show chart")]),s._v(" 命令来了解 MySQL 这个 chart 包的一些特性：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm show chart stable/mysql\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("如果想要了解更多信息，可以用 "),t("code",[s._v("helm show all")]),s._v(" 命令：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm show all stable/mysql\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("需要注意的是无论什么时候安装 chart，都会创建一个新的 release，所以一个 chart 包是可以多次安装到同一个集群中的，每个都可以独立管理和升级。")]),s._v(" "),t("h3",{attrs:{id:"helm-ls命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-ls命令"}},[s._v("#")]),s._v(" helm ls命令")]),s._v(" "),t("p",[s._v("同样我们也可以用 Helm 很容易查看到已经安装的 release：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nNAME                NAMESPACE   REVISION    UPDATED                                 STATUS      CHART       APP VERSION\nmysql-1575619811    default     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-12-06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":10:14.682302 +0800 CST    deployed    mysql-1.5.0 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(".27\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"helm-uninstall命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-uninstall命令"}},[s._v("#")]),s._v(" helm uninstall命令")]),s._v(" "),t("p",[s._v("如果需要删除这个 release，也很简单，只需要使用 "),t("code",[s._v("helm uninstall")]),s._v(" 命令即可：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm uninstall mysql-1575619811\nrelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-1575619811"')]),s._v(" uninstalled\n$ kubectl get all -l "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-1575619811\nNo resources found.\n$ helm status mysql-1575619811\nError: release: not found\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("code",[s._v("uninstall")]),s._v(" 命令会从 Kubernetes 中删除 release，也会删除与 release 相关的所有 Kubernetes 资源以及 release 历史记录。也可以在删除的时候使用 "),t("code",[s._v("--keep-history")]),s._v(" 参数，则会保留 release 的历史记录，可以获取该 release 的状态就是 "),t("code",[s._v("UNINSTALLED")]),s._v("，而不是找不到 release了：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm uninstall mysql-1575619811 --keep-history\nrelease "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql-1575619811"')]),s._v(" uninstalled\n$ helm status mysql-1575619811\nhelm status mysql-1575619811\nNAME: mysql-1575619811\nLAST DEPLOYED: Fri Dec  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":47:14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: uninstalled\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -a\nNAME                NAMESPACE   REVISION    UPDATED                                 STATUS      CHART       APP VERSION\nmysql-1575619811    default     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("-12-06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":47:14.415214 +0800 CST    uninstalled mysql-1.5.0 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.7")]),s._v(".27\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("blockquote",[t("p",[s._v("因为 Helm 会在删除 release 后跟踪你的 release，所以你可以审查历史甚至取消删除 "),t("code",[s._v("release")]),s._v("（使用 "),t("code",[s._v("helm rollback")]),s._v(" 命令）。")])]),s._v(" "),t("h2",{attrs:{id:"定制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定制"}},[s._v("#")]),s._v(" 定制")]),s._v(" "),t("p",[s._v("上面我们都是直接使用的 "),t("code",[s._v("helm install")]),s._v(" 命令安装的 chart 包，这种情况下只会使用 chart 的默认配置选项，但是更多的时候，是各种各样的需求，索引我们希望根据自己的需求来定制 chart 包的配置参数。")]),s._v(" "),t("h3",{attrs:{id:"查看可选参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看可选参数"}},[s._v("#")]),s._v(" 查看可选参数")]),s._v(" "),t("p",[s._v("我们可以使用 "),t("code",[s._v("helm show values")]),s._v(" 命令来查看一个 chart 包的所有可配置的参数选项：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm show values stable/mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## mysql image version")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ref: https://hub.docker.com/r/library/mysql/tags/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\nimage: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"mysql"')]),s._v("\nimageTag: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5.7.14"')]),s._v("\n\nbusybox:\n  image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"busybox"')]),s._v("\n  tag: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.29.3"')]),s._v("\n\ntestFramework:\n  enabled: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  image: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dduportal/bats"')]),s._v("\n  tag: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.4.0"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Specify password for root user")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Default: random 10 character string")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqlRootPassword: testing")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Create a database user")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqlUser:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Default: random 10 character string")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqlPassword:")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Allow unauthenticated access, uncomment to enable")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqlAllowEmptyPassword: true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Create a database")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysqlDatabase:")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Specify an imagePullPolicy (Required)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## It's recommended to change this to 'Always' if the image tag is 'latest'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## ref: http://kubernetes.io/docs/user-guide/images/#updating-images")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##")]),s._v("\nimagePullPolicy: IfNotPresent\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("h3",{attrs:{id:"使用自定义参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义参数"}},[s._v("#")]),s._v(" 使用自定义参数")]),s._v(" "),t("p",[s._v("上面我们看到的所有参数都是可以用自己的数据来覆盖的，可以在安装的时候通过 YAML 格式的文件来传递这些参数：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("$ cat config.yaml\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysqlUser")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  user0\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysqlPassword")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user0pwd\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysqlDatabase")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" user0db\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistence")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"helm-install-f安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#helm-install-f安装"}},[s._v("#")]),s._v(" helm install -f安装")]),s._v(" "),t("p",[s._v("部署安装mysql使用本地自定义的参数")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -f config.yaml stable/mysql\nhelm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -f config.yaml mysql stable/mysql\nNAME: mysql\nLAST DEPLOYED: Fri Dec  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":46:56 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v("\nNAMESPACE: default\nSTATUS: deployed\nREVISION: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nNOTES:\nMySQL can be accessed via port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(" on the following DNS name from within your cluster:\nmysql.default.svc.cluster.local\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("release 安装成功后，可以查看对应的 Pod 信息：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ kubectl get pod -l "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("release")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql\nNAME                    READY   STATUS            RESTARTS   AGE\nmysql-ddd798f48-gnrzd   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/1     PodInitializing   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          119s\n$ kubectl describe pod  mysql-ddd798f48-gnrzd\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\nEnvironment:\n      MYSQL_ROOT_PASSWORD:  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("set to the key "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-root-password'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" secret "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  Optional: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      MYSQL_PASSWORD:       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("set to the key "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-password'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" secret "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("       Optional: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      MYSQL_USER:           user0\n      MYSQL_DATABASE:       user0db\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("可以看到环境变量 "),t("code",[s._v("MYSQL_USER=user0，MYSQL_DATABASE=user0db")]),s._v(" 的值和我们上面配置的值是一致的。在安装过程中，有两种方法可以传递配置数据：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("--values（或者 -f）")]),s._v("：指定一个 YAML 文件来覆盖 values 值，可以指定多个值，最后边的文件优先")]),s._v(" "),t("li",[t("code",[s._v("--set")]),s._v("：在命令行上指定覆盖的配置")])]),s._v(" "),t("blockquote",[t("p",[s._v("如果同时使用这两个值，"),t("code",[s._v("--set")]),s._v(" 将被合并到具有更高优先级的 "),t("code",[s._v("--values")]),s._v("，使用 "),t("code",[s._v("--set")]),s._v(" 指定的值将持久化在 ConfigMap 中，对于给定的 release，可以使用 "),t("code",[s._v("helm get values <release-name>")]),s._v(" 来查看已经设置的值，已设置的值也通过允许 "),t("code",[s._v("helm upgrade")]),s._v(" 并指定 "),t("code",[s._v("--reset")]),s._v(" 值来清除。")])]),s._v(" "),t("p",[t("code",[s._v("--set")]),s._v(" 选项接收零个或多个 name/value 对，最简单的用法就是 "),t("code",[s._v("--set name=value")]),s._v("，相当于 YAML 文件中的：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" value\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("多个值之间用字符串“,”隔开，用法就是 "),t("code",[s._v("--set a=b,c=d")]),s._v("，相当于 YAML 文件中的：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("a")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" b\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("c")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" d\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("也支持更加复杂的表达式，例如 "),t("code",[s._v("--set outer.inner=value")]),s._v("，对应 YAML：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("outer")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("inner")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" value\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("对于列表数组可以用 "),t("code",[s._v("{}")]),s._v(" 来包裹，比如 "),t("code",[s._v("--set name={a, b, c}")]),s._v("，对应 YAML：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" a\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" b\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" c\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("从 Helm 2.5.0 开始，就可以使用数组索引语法来访问列表中某个项，比如 "),t("code",[s._v("--set servers[0].port=80")]),s._v("，对应的 YAML 为：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("也可以这样设置多个值，比如 "),t("code",[s._v("--set servers[0].port=80,servers[0].host=example")]),s._v("，对应的 YAML 为：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v("servers\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("有时候你可能需要在 "),t("code",[s._v("--set")]),s._v(" 选项中使用特殊的字符，这个时候可以使用反斜杠来转义字符，比如 "),t("code",[s._v("--set name=value1\\,value2")]),s._v("，对应的 YAML 为：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value1,value2"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("类似的，你还可以转义"),t("code",[s._v(".")]),s._v("，当 chart 模板中使用 "),t("code",[s._v("toYaml")]),s._v(" 函数来解析 annotations、labels 以及 node selectors 之类的时候，这非常有用，比如 "),t("code",[s._v('--set nodeSelector."kubernetes\\.io/role"=master')]),s._v("，对应的 YAML 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubernetes.io/role")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("blockquote",[t("p",[s._v("深度嵌套的数据结构可能很难使用 "),t("code",[s._v("--set")]),s._v(" 来表示，所以一般推荐还是使用 YAML 文件来进行覆盖，当然在设计 chart 模板的时候也可以结合考虑到 "),t("code",[s._v("--set")]),s._v(" 这种用法，尽可能的提供更好的支持。")])]),s._v(" "),t("h1",{attrs:{id:"charts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#charts"}},[s._v("#")]),s._v(" Charts")]),s._v(" "),t("p",[s._v("Helm 使用一种名为 charts 的包格式，一个 chart 是描述一组相关的 Kubernetes 资源的文件集合，单个 chart 可能用于部署简单的应用，比如 memcached pod，或者复杂的应用，比如一个带有 HTTP 服务、数据库、缓存等等功能的完整 web 应用程序。")]),s._v(" "),t("p",[s._v("Charts 是创建在特定目录下面的文件集合，然后可以将它们打包到一个版本化的存档中来部署。接下来我们就来看看使用 Helm 构建 charts 的一些基本方法。")]),s._v(" "),t("h3",{attrs:{id:"文件结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件结构"}},[s._v("#")]),s._v(" 文件结构")]),s._v(" "),t("p",[s._v("chart 被组织为一个目录中的文件集合，目录名称就是 chart 的名称（不包含版本信息），下面是一个 WordPress 的 chart，会被存储在 "),t("code",[s._v("wordpress/")]),s._v(" 目录下面，基本结构如下所示：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("wordpress/\n  Chart.yaml          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含当前 chart 信息的 YAML 文件")]),s._v("\n  LICENSE             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选：包含 chart 的 license 的文本文件")]),s._v("\n  README.md           "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选：一个可读性高的 README 文件")]),s._v("\n  values.yaml         "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当前 chart 的默认配置 values")]),s._v("\n  values.schema.json  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选: 一个作用在 values.yaml 文件上的 JSON 模式")]),s._v("\n  charts/             "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 包含该 chart 依赖的所有 chart 的目录")]),s._v("\n  crds/               "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Custom Resource Definitions")]),s._v("\n  templates/          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 模板目录，与 values 结合使用时，将渲染生成 Kubernetes 资源清单文件")]),s._v("\n  templates/NOTES.txt "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可选: 包含简短使用使用的文本文件")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("blockquote",[t("p",[s._v("另外 Helm 会保留 "),t("code",[s._v("charts/")]),s._v("、"),t("code",[s._v("crds/")]),s._v(" 以及 "),t("code",[s._v("templates/")]),s._v(" 目录以及上面列出的文件名的使用。")])]),s._v(" "),t("h3",{attrs:{id:"chart-yaml-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-yaml-文件"}},[s._v("#")]),s._v(" Chart.yaml 文件")]),s._v(" "),t("p",[s._v("对于一个 chart 包来说 "),t("code",[s._v("Chart.yaml")]),s._v(" 文件是必须的，它包含下面的这些字段：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart API 版本 (必须)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart 名 (必须)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SemVer 2版本 (必须)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kubeVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 兼容的 Kubernetes 版本 (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 一句话描述 (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart 类型 (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("keywords")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 当前项目关键字集合 (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("home")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 当前项目的 URL (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 当前项目源码 URL (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chart 依赖列表 (可选)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart 名称 (nginx)\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' chart 版本 ("1.2.3")\n    '),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(' 仓库地址 ("https'),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v('//example.com/charts")\n'),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maintainers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# (可选)")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 维护者名字 (对每个 maintainer 是必须的)\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("email")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 维护者的 email (可选)\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 维护者 URL (可选)\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("icon")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart 的 SVG 或者 PNG 图标 URL (可选).\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("appVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 包含的应用程序版本 (可选). 不需要 SemVer 版本\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deprecated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" chart 是否已被弃用 (可选"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" boolean)\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("blockquote",[t("p",[s._v("其他字段默认会被忽略。")])]),s._v(" "),t("h4",{attrs:{id:"版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本"}},[s._v("#")]),s._v(" 版本")]),s._v(" "),t("p",[s._v("每个 chart 都必须有一个版本号，版本必须遵循 "),t("code",[s._v("SemVer2")]),s._v(" 标准，和 Helm Classic 不同，Kubernetes Helm 使用版本号作为 release 的标记，仓库中的软件包通过名称加上版本号来标识的。")]),s._v(" "),t("p",[s._v("例如，将一个 nginx 的 chart 包 version 字段设置为：1.2.3，则 chart 最终名称为：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("nginx-1.2.3.tgz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("还支持更复杂的 "),t("code",[s._v("SemVer2")]),s._v(" 名称，例如版本："),t("code",[s._v("1.2.3-alpha.1+ef365")]),s._v("，但是需要注意的是系统明确禁止使用非 "),t("code",[s._v("SemVer")]),s._v(" 的名称。")]),s._v(" "),t("blockquote",[t("p",[t("code",[s._v("Chart.yaml")]),s._v(" 中的 "),t("code",[s._v("version")]),s._v(" 字段被很多 Helm 工具使用，包括 CLI 工具，生成包的时候，命令 "),t("code",[s._v("helm package")]),s._v(" 将使用该字段作为包名称中的标记，系统是默认 Chart 包中的版本号与 "),t("code",[s._v("chart.yaml")]),s._v(" 中的版本号匹配的，所以如果不匹配的话就导致一系列错误。")])]),s._v(" "),t("h4",{attrs:{id:"apiversion-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#apiversion-字段"}},[s._v("#")]),s._v(" "),t("code",[s._v("apiVersion")]),s._v(" 字段")]),s._v(" "),t("p",[s._v("对于 Helm 3 以上的版本 "),t("code",[s._v("apiVersion")]),s._v(" 字段应该\b是 "),t("code",[s._v("v2")]),s._v("，之前版本的 Chart 应该设置为1，并且也可以有 Helm 3 进行安装。")]),s._v(" "),t("h4",{attrs:{id:"appversion-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#appversion-字段"}},[s._v("#")]),s._v(" "),t("code",[s._v("appVersion")]),s._v(" 字段")]),s._v(" "),t("p",[s._v("要注意 "),t("code",[s._v("appVersion")]),s._v(" 字段与 version 字段无关，这是一种指定应用程序版本的方法，比如 drupal 的 Chart 包可能有一个 "),t("code",[s._v("appVersion: 8.2.1")]),s._v(" 的字段，表示 Chart 中包含的 drupal 版本是 8.2.1，该字段仅供参考，对 Chart 版本的计算不会产生影响。")]),s._v(" "),t("h4",{attrs:{id:"弃用-charts"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#弃用-charts"}},[s._v("#")]),s._v(" 弃用 Charts")]),s._v(" "),t("p",[s._v("当在 Chart 仓库中管理 charts 的时候，有时候需要弃用一个 chart，"),t("code",[s._v("Chart.yaml")]),s._v(" 中的可选字段 "),t("code",[s._v("deprecated")]),s._v(" 可以用来标记一个 chart 为弃用状态。如果将仓库中最新版本的 chart 标记为弃用，则整个 chart 都会被当做弃用状态了。以后可以通过发布一个未被标记为弃用状态的新版本来重新使用该 chart。弃用 charts 的工作流程如下所示：")]),s._v(" "),t("ul",[t("li",[s._v("更新 chart 的 "),t("code",[s._v("Chart.yaml")]),s._v(" 来标记 chart 为弃用状态")]),s._v(" "),t("li",[s._v("发布该新版本到 Chart 仓库")]),s._v(" "),t("li",[s._v("从源码仓库（比如 git）中删除 chart")])]),s._v(" "),t("h4",{attrs:{id:"chart-类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#chart-类型"}},[s._v("#")]),s._v(" Chart 类型")]),s._v(" "),t("p",[t("code",[s._v("type")]),s._v(" 字段定义 chart 的类型，可以定义两种类型：应用程序（application）和库（library）。应用程序是默认的类型，它是一个可以完整操作的标准 chart，库或者辅助类 chart 为 chart 提供了一些实用的功能，library 不同于应用程序 chart，因为它没有资源对象，所以无法安装。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意：一个应用 chart 也可以当作库进行使用。通过将类型设置为 library，然后该 chart 就会渲染成一个库，可以在其中使用所有的实用性功能，chart 的所有资源对象都不会被渲染。")])]),s._v(" "),t("h4",{attrs:{id:"license-readme-和-notes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#license-readme-和-notes"}},[s._v("#")]),s._v(" LICENSE, README 和 NOTES")]),s._v(" "),t("p",[s._v("Chart 还可以包含用于描述 chart 的安装、配置、用法和许可证书的文件。")]),s._v(" "),t("p",[s._v("LICENSE 是一个纯文本文件，其中包含 chart 的许可证书。chart 可以包含一个许可证书，因为它可能在模板中具有编程逻辑，所以不只是配置，如果需要，chart 还可以为应用程序提供单独的 license(s)。")]),s._v(" "),t("p",[s._v("Chart 的 README 文件应该采用 Markdown（README.md）格式，并且通常应该包含如下的一些信息：")]),s._v(" "),t("ul",[t("li",[s._v("chart 提供的应用程序的描述信息")]),s._v(" "),t("li",[s._v("运行 chart 的任何先决条件或者要求")]),s._v(" "),t("li",[t("code",[s._v("values.yaml")]),s._v(" 和默认值中的一些选项说明")]),s._v(" "),t("li",[s._v("与 chart 的安装或配置有关的任何其他信息")])]),s._v(" "),t("blockquote",[t("p",[s._v("chart 还可以包含简短的纯文本模板或者 "),t("code",[s._v("NOTES.txt")]),s._v(" 文件，该文件将在安装后以及查看 release 状态的时候打印出来。该文件会被当成模板文件，并且可以用于显示使用说明，后续步骤或与 release 有关的任何其他信息。例如，可以提供用于连接到数据或访问 Web UI 的指令。由于在运行 "),t("code",[s._v("helm install")]),s._v(" 或者 "),t("code",[s._v("helm status")]),s._v(" 的时候该文件会打印到 "),t("code",[s._v("STDOUT")]),s._v(" 中，所以建议该文件内容保持内容简短然后可以指向 README 文件来获取更多详细信息。")])]),s._v(" "),t("h3",{attrs:{id:"依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#依赖"}},[s._v("#")]),s._v(" 依赖")]),s._v(" "),t("p",[s._v("在 Helm 中，一个 chart 包可能会依赖许多其他的 chart。这些依赖关系可以使用 "),t("code",[s._v("Chart.yaml")]),s._v(" 中的依赖关系字段动态链接，也可以引入到 "),t("code",[s._v("charts/")]),s._v(" 目录手动进行管理。")]),s._v(" "),t("h4",{attrs:{id:"使用-dependencies-字段管理依赖"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-dependencies-字段管理依赖"}},[s._v("#")]),s._v(" "),t("strong",[s._v("使用 "),t("code",[s._v("dependencies")]),s._v(" 字段管理依赖")])]),s._v(" "),t("p",[s._v("当前 chart 所需的依赖 chart 需要在 "),t("code",[s._v("dependencies")]),s._v(" 字段中进行定义，如下所示：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apache\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1.2.3\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//example.com/charts\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3.2.1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//another.example.com/charts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("ul",[t("li",[t("code",[s._v("name")]),s._v(" 字段是所依赖的 chart 的名称")]),s._v(" "),t("li",[t("code",[s._v("version")]),s._v(" 字段是依赖的 chart 版本")]),s._v(" "),t("li",[t("code",[s._v("repository")]),s._v(" 字段是 chart 仓库的完整 URL，不过需要注意，必须使用 "),t("code",[s._v("helm repo add")]),s._v(" 在本地添加该 repo")])]),s._v(" "),t("p",[s._v("定义了依赖项后，可以运行 "),t("code",[s._v("helm dependency update")]),s._v(" 来更新依赖项，它将根据你的依赖项文件把你所有指定的 chart 包下载到 "),t("code",[s._v("charts/")]),s._v(" 目录中：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm dependency update foochart\nHang tight "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" we grab the latest from your chart repositories"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),s._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"stable"')]),s._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example"')]),s._v(" chart repository\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".Successfully got an update from the "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"another"')]),s._v(" chart repository\nUpdate Complete. Happy Helming"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\nSaving "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" charts\nDownloading apache from repo https://example.com/charts\nDownloading mysql from repo https://another.example.com/charts\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("当执行 "),t("code",[s._v("helm dependency update")]),s._v(" 命令的时候会解析 chart 的依赖项，会将他们作为 chart 包文件下载存放到 "),t("code",[s._v("charts/")]),s._v(" 目录中，所以，对于上面的示例，我们可以在 charts 目录中看到如下的文件：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("charts/\n  apache-1.2.3.tgz\n  mysql-3.2.1.tgz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"alias-字段"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alias-字段"}},[s._v("#")]),s._v(" alias 字段")]),s._v(" "),t("p",[s._v("除了上面的几个字段之外，每个依赖项还可以包含一个可选的 "),t("code",[s._v("alias")]),s._v(" 别名字段。为依赖 chart 添加别名将使用别名作为依赖的名称。在需要访问其他名称的 chart 情况下，就可以使用别名，如下所示：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# parentchart/Chart.yaml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dependencies")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10191")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("subchart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10191")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.1.0\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alias")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("subchart"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" subchart\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("repository")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10191")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.1.0\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("p",[s._v("在上面示例中，我们将获得3个依赖项：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("subchart\nnew-subchart-1\nnew-subchart-2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("当然其实我们也可以手动来实现，将同一个 chart 以不同的名称多次复制/粘贴到 "),t("code",[s._v("charts/")]),s._v(" 目录中也是可以的。")]),s._v(" "),t("h3",{attrs:{id:"templates-和-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#templates-和-values"}},[s._v("#")]),s._v(" TEMPLATES 和 VALUES")]),s._v(" "),t("p",[s._v("Helm Chart 模板是用 "),t("a",{attrs:{href:"https://golang.org/pkg/text/template/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Go template 语言"),t("OutboundLink")],1),s._v(" 进行编写的，另外还额外增加了(【Sprig】](https://github.com/Masterminds/sprig)库中的50个左右的附加模板函数和一些其他"),t("a",{attrs:{href:"https://helm.sh/docs/howto/charts_tips_and_tricks/",target:"_blank",rel:"noopener noreferrer"}},[s._v("专用函数"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("p",[s._v("所有模板文件都存储在 chart 的 "),t("code",[s._v("templates/")]),s._v(" 目录下面，当 Helm 渲染 charts 的时候，它将通过模板引擎传递该目录中的每个文件。模板的 "),t("code",[s._v("Values")]),s._v(" 可以通过两种方式提供：")]),s._v(" "),t("ul",[t("li",[s._v("Chart 开发人员可以在 chart 内部提供一个名为 "),t("code",[s._v("values.yaml")]),s._v(" 的文件，该文件可以包含默认的 values 值内容。")]),s._v(" "),t("li",[s._v("Chart 用户可以提供包含 values 值的 YAML 文件，可以在命令行中通过 "),t("code",[s._v("helm install")]),s._v(" 来指定该文件。")])]),s._v(" "),t("blockquote",[t("p",[s._v("当用户提供自定义 values 值的时候，这些值将覆盖 chart 中 "),t("code",[s._v("values.yaml")]),s._v(" 文件中的相应的值。")])]),s._v(" "),t("h4",{attrs:{id:"模板文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模板文件"}},[s._v("#")]),s._v(" 模板文件")]),s._v(" "),t("p",[s._v("模板文件遵循编写 Go 模板的标准约定（可以查看 "),t("a",{attrs:{href:"https://golang.org/pkg/text/template/",target:"_blank",rel:"noopener noreferrer"}},[s._v("text/template 包文档"),t("OutboundLink")],1),s._v("查看详细信息），下面是一个模板文件示例：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ReplicationController\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/managed-by")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.imageRegistry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/postgres"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.dockerTag "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.pullPolicy "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DATABASE_STORAGE\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(' default "minio" .Values.storage '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[s._v("上面这个示例是 Kubernetes replication 控制器的一个模板，它可以使用以下4个模板值（通常在 "),t("code",[s._v("values.yaml")]),s._v(" 文件中定义的）：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("imageRegistry")]),s._v("：Docker 镜像仓库")]),s._v(" "),t("li",[t("code",[s._v("dockerTag")]),s._v("：Docker 镜像 tag")]),s._v(" "),t("li",[t("code",[s._v("pullPolicy")]),s._v("：镜像拉取策略")]),s._v(" "),t("li",[t("code",[s._v("storage")]),s._v("：存储后端，默认设置为 "),t("code",[s._v('"minio"')])])]),s._v(" "),t("p",[s._v("这些所有的 values 值都是有模板作者来定义的，Helm 不会也不需要规定这些参数。可以可以查看 "),t("a",{attrs:{href:"https://github.com/helm/charts",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubernetes Charts 项目"),t("OutboundLink")],1),s._v("去了解更多的 charts 项目的详细内容。")]),s._v(" "),t("h4",{attrs:{id:"预定义-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#预定义-values"}},[s._v("#")]),s._v(" 预定义 Values")]),s._v(" "),t("p",[s._v("在模板中用 "),t("code",[s._v(".Values")]),s._v(" 可以获取到 "),t("code",[s._v("values.yaml")]),s._v(" 文件（或者 "),t("code",[s._v("--set")]),s._v(" 参数）提供的 values 值，此外，还可以在模板中访问其他预定义的数据。下面是一些预定义的、可用于每个模板、并且不能被覆盖的 values 值，与所有 values 值一样，名称都是区分大小写的：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Release.Name")]),s._v("：release 的名称（不是 chart）")]),s._v(" "),t("li",[t("code",[s._v("Release.Namespace")]),s._v("：release 被安装到的命名空间")]),s._v(" "),t("li",[t("code",[s._v("Release.Service")]),s._v("：渲染当前模板的服务，在 Helm 上，实际上该值始终为 Helm")]),s._v(" "),t("li",[t("code",[s._v("Release.IsUpgrade")]),s._v("：如果当前操作是升级或回滚，则该值为 true")]),s._v(" "),t("li",[t("code",[s._v("Release.IsInstall")]),s._v("：如果当前操作是安装，则该值为 true")]),s._v(" "),t("li",[t("code",[s._v("Chart")]),s._v("："),t("code",[s._v("Chart.yaml")]),s._v(" 文件的内容，可以通过 "),t("code",[s._v("Chart.Version")]),s._v(" 来获得 Chart 的版本，通过 "),t("code",[s._v("Chart.Maintainers")]),s._v(" 可以获取维护者信息")]),s._v(" "),t("li",[t("code",[s._v("Files")]),s._v("： 一个包含 chart 中所有非特殊文件的 map 对象，这不会给你访问模板的权限，但是会给你访问存在的其他文件的权限")]),s._v(" "),t("li",[t("code",[s._v("Capabilities")]),s._v("：也是一个类 map 的对象")])]),s._v(" "),t("blockquote",[t("p",[s._v("注意: 任何未知的 "),t("code",[s._v("Chart.yaml")]),s._v(" 字段都会被删除，在 Chart 对象内部无法访问他们，所以，"),t("code",[s._v("Chart.yaml")]),s._v(" 不能用于将任意结构化的数据传递到模板中，但是可以使用 values 文件来传递。")])]),s._v(" "),t("h4",{attrs:{id:"values-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#values-文件"}},[s._v("#")]),s._v(" Values 文件")]),s._v(" "),t("p",[s._v("为模板提供一些必须的 values 值的 "),t("code",[s._v("values.yaml")]),s._v(" 文件如下所示：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageRegistry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quay.io/deis"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Always"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"s3"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("values 文件的格式是 YAML，一个 chart 包可能包含一个默认的 "),t("code",[s._v("values.yaml")]),s._v(" 文件，"),t("code",[s._v("helm install")]),s._v(" 命令允许用户通过提供其他的 YAML 值文件来覆盖默认的值：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --values"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("myvals.yaml wordpress\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("用这种方式来传递 values 值的时候，它们将合并到默认值文件中，比如有一个 "),t("code",[s._v("myvals.yaml")]),s._v(" 文件如下所示：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gcs"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("将其与 chart 的 "),t("code",[s._v("values.yaml")]),s._v(" 文件合并后，得到的结果为：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imageRegistry")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"quay.io/deis"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dockerTag")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"latest"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Always"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gcs"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("我们可以看到只有最后一个字段被覆盖了。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意: chart 内包含的默认 values 文件必须命名为 "),t("code",[s._v("values.yaml")]),s._v("，但是在命令行上指定的文件可以任意命名。 如果在 "),t("code",[s._v("helm install")]),s._v(" 或者 "),t("code",[s._v("helm upgrade")]),s._v(" 的时候使用 "),t("code",[s._v("--set")]),s._v(" 参数，则这些值将在客户端转换为 YAML 格式。 如果 values 文件存在任何必须的条目，则可以使用 "),t("code",[s._v("required")]),s._v(" 函数在 chart 模板中将它们声明为必须选项。")])]),s._v(" "),t("p",[s._v("然后我们就可以使用 "),t("code",[s._v(".Values")]),s._v(" 对象在模板中访问任意一个 values 值，类似于下面的模板文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ReplicationController\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/managed-by")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app.kubernetes.io/name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccount")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" deis"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("database\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.imageRegistry "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("/postgres"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.dockerTag "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" .Values.pullPolicy "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5432")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DATABASE_STORAGE\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(' default "minio" .Values.storage '),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("h4",{attrs:{id:"作用范围、依赖和-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#作用范围、依赖和-values"}},[s._v("#")]),s._v(" 作用范围、依赖和 Values")]),s._v(" "),t("p",[s._v("values 文件可以声明顶级的 chart 以及该 chart 的 "),t("code",[s._v("charts/")]),s._v(" 目录中包含的任何 chart 的值。或者，换句话说，values 文件可以为 chart 以及他的任何依赖项提供 values 值。例如，上面提到了 WordPress 这个 chart 同时依赖 mysql 和 apache 这两个依赖项，values 文件可以为所有这些组件提供 values 值：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"My WordPress Site"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 WordPress 模板")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 MySQL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 Apache")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("较高级别的 Charts 可以访问下面定义的所有变量，所以，WordPress 这个 chart 可以通过 "),t("code",[s._v(".Values.mysql.password")]),s._v(" 来访问 MySQL 的密码，但是较低级别的 chart 是无法访问父 chart 中的内容的，所有 MySQL 无法获取到 title 属性，当然同样也不能访问 "),t("code",[s._v("apache.port")]),s._v("。")]),s._v(" "),t("p",[s._v("Values 是有命名空间的，但是会对其进行调整，比如对于 WordPress 这个 chart 来说，它可以通过 "),t("code",[s._v(".Values.mysql.password")]),s._v(" 来进行访问，但是对于 MySQL 这个 chart 本身来说，values 的范围缩小了，命名空间前缀会被删除，所以它只需要通过 "),t("code",[s._v(".Values.password")]),s._v(" 就可以访问到。")]),s._v(" "),t("h4",{attrs:{id:"全局-values"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#全局-values"}},[s._v("#")]),s._v(" 全局 Values")]),s._v(" "),t("p",[s._v("从 "),t("code",[s._v("2.0.0-Alpha.2")]),s._v(" 版本开始，Helm 开始支持特殊的 "),t("code",[s._v("global")]),s._v(" 全局值，比如将上面的示例修改如下：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"My WordPress Site"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 WordPress 模板")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MyWordPress\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 MySQL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 Apache")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("上面我们添加了一个全局范围的 value 值："),t("code",[s._v("app: MyWordPress")]),s._v("，该值可以通过 "),t("code",[s._v(".Values.global.app")]),s._v(" 提供给所有 chart 使用。")]),s._v(" "),t("p",[s._v("例如，mysql 模板可以以 "),t("code",[s._v(".Values.global.app")]),s._v(" 来访问 app，apache chart 也可以，实际上，上面的 values 文件会这样重新生成：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("title")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"My WordPress Site"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 WordPress 模板")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MyWordPress\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MyWordPress\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max_connections")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 MySQL")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"secret"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MyWordPress\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递到 Apache")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("p",[s._v("这种方式提供了一种与所有子 chart 共享一个顶级变量的方式，这对于设置 meta 数据这种属性是非常有用的。如果子 chart 声明了全局变量，则该全局变量将向下（传递到子 chart 的子 chart 中）传递，而不会向上传递到父 chart，子 chart 无法影响 父 chart的值。同样，父 chart 的全局遍历优先与子 chart 中的全局变量。")]),s._v(" "),t("h4",{attrs:{id:"schema-文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#schema-文件"}},[s._v("#")]),s._v(" Schema 文件")]),s._v(" "),t("p",[s._v("有时候，chart 开发者可能希望在其 values 值上面定义一个结构，这种情况下可以通过在 "),t("code",[s._v("values.schema.json")]),s._v(" 文件中定义一个 schema 来完成，这里的 schema 就是一个 "),t("a",{attrs:{href:"https://json-schema.org/",target:"_blank",rel:"noopener noreferrer"}},[s._v("JSON Schema"),t("OutboundLink")],1),s._v(" 文件结构规范，如下所示：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"$schema"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://json-schema.org/draft-07/schema#"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"image"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Container Image"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"properties"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"repo"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"tag"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"object"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Service name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"port"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"minimum"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"integer"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"protocol"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"string"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"required"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"protocol"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"title"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Values"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"type"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"object"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("该 schema 会对 values 值进行校验，调用以下任何命令时，都会进行验证：")]),s._v(" "),t("ul",[t("li",[s._v("helm install")]),s._v(" "),t("li",[s._v("helm upgrade")]),s._v(" "),t("li",[s._v("helm lint")]),s._v(" "),t("li",[s._v("helm template")])]),s._v(" "),t("p",[s._v("比如下面的示例文件就可以满足上面的 schema 要求：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("需要注意的是该 schema 将应用于最终的 "),t("code",[s._v(".Values")]),s._v(" 对象，而不仅仅是应用于 "),t("code",[s._v("values.yaml")]),s._v(" 文件，所以下面的文件也是可以满足 schema 要求的：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" frontend\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("因为在安装的时候我们通过 "),t("code",[s._v("--set")]),s._v(" 选项传递了必须的 "),t("code",[s._v("port")]),s._v(" 属性：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ helm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --set "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此外，还会根据所有的子 chart schemas 来检查最终的 "),t("code",[s._v(".Values")]),s._v(" 对象，这意味着父 chart 无法规避对子 chart 的限制。同样的，如果子 chart 要求未满足子 chart 的 "),t("code",[s._v("values.yaml")]),s._v(" 文件，则父 chart 必须满足这些限制才能生效。 --\x3e")])])}),[],!1,null,null,null);a.default=n.exports}}]);