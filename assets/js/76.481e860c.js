(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{556:function(s,a,e){"use strict";e.r(a);var t=e(19),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[s._v("#")]),s._v(" Docker")]),s._v(" "),e("h2",{attrs:{id:"docker介绍"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker介绍"}},[s._v("#")]),s._v(" Docker介绍")]),s._v(" "),e("p",[e("strong",[s._v("Docker 是一个开源的应用容器引擎，让开发者可以打包他们的应用以及依赖包到一个可移植的镜像中，然后发布到任何流行的 Linux或Windows 机器上，也可以实现虚拟化。"),e("code",[s._v("容器是完全使用沙箱机制，相互之间不会有任何接口。")])])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf8fd2ab3f51d911f7336.png",alt:""}})]),s._v(" "),e("h2",{attrs:{id:"docker组成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker组成"}},[s._v("#")]),s._v(" Docker组成")]),s._v(" "),e("p",[e("strong",[s._v("一个完整的 Docker 有以下几个部分组成：")])]),s._v(" "),e("ul",[e("li",[e("code",[s._v("DockerClient 客户端")])]),s._v(" "),e("li",[e("code",[s._v("Docker Daemon 守护进程")])]),s._v(" "),e("li",[e("code",[s._v("Docker Image 镜像")])]),s._v(" "),e("li",[e("code",[s._v("DockerContainer 容器")])])]),s._v(" "),e("h2",{attrs:{id:"docker-的安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-的安装"}},[s._v("#")]),s._v(" Docker 的安装")]),s._v(" "),e("p",[s._v("在线安装和离线安装\nDocker 阿里镜像加速仓库在线安装")]),s._v(" "),e("h3",{attrs:{id:"安装步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装步骤"}},[s._v("#")]),s._v(" 安装步骤")]),s._v(" "),e("p",[e("strong",[s._v("1.官网中文安装参考手册")]),s._v("\nhttps://docs.docker-cn.com/engine/installation/linux/docker-ce/centos/")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("确定你是 CentOS7 及以上版本\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/redhat-release\n\nyum 安装 gcc 相关 \n$ yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc\n$ yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" gcc -c++\n\n卸载旧版本\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br")])]),e("p",[e("strong",[s._v("2.安装需要的软件包")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ yum "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y yum-utils device-mapper-persistent-data lvm2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("3.拉取docker镜像仓库")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("4.更新 yum 软件包索引")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ yum makecache fast\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("5.安装 DOCKER CE")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ yum -y "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n启动 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n$ systemctl start "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n测试\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" version\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run hello-world\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[e("strong",[s._v("6.配置镜像加速")]),s._v("\n阿里云镜像加速地址： https://ably8t50.mirror.aliyuncs.com")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[s._v("$ vim  /etc/docker/daemon.json\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"registry-mirrors"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://ably8t50.mirror.aliyuncs.com"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n加载配置重启服务\n$ systemctl daemon-reload\n$ systemctl restart docker\n\n卸载\n$ systemctl stop docker\n$ yum -y remove docker-ce\n$ rm -rf /var/lib/docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br")])]),e("h2",{attrs:{id:"docker-私有仓库离线安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-私有仓库离线安装"}},[s._v("#")]),s._v(" Docker 私有仓库离线安装")]),s._v(" "),e("p",[s._v("Docker 私有仓库\n"),e("code",[s._v("docker-registry (opens new window)是官方提供的工具，可以用于构建私有的镜像仓库。本文内 容基于 docker-registry (opens new window)v2.x 版本。")])]),s._v(" "),e("h3",{attrs:{id:"配置仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#配置仓库"}},[s._v("#")]),s._v(" 配置仓库")]),s._v(" "),e("p",[s._v("配置私有仓库的时候，json 文件如下格式：")]),s._v(" "),e("div",{staticClass:"language-json line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-json"}},[e("code",[s._v("$ cat >> /etc/docker/daemon.json << EOF\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("  \n\n"),e("span",{pre:!0,attrs:{class:"token property"}},[s._v('"insecure-registries"')]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.10:5000"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nEOF\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"安装运行-docker-registry"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装运行-docker-registry"}},[s._v("#")]),s._v(" 安装运行 docker-registry")]),s._v(" "),e("p",[s._v("使用官方 registry 镜像来运行:")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 --restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always --name registry registry\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("code",[s._v("默认情况下，仓库会被创建在容器的 /var/lib/registry 目录下。你可以通过 -v 参数来将镜像 文件存放在本地的指定路径。例如下面的例子将上传的镜像放到本地的 /opt/data/registry 目 录。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("    \n\t-p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v(":5000 "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--name registry "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t--restart"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\t-v /opt/data/registry:/var/lib/registry "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n\tregistry:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"仓库使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#仓库使用"}},[s._v("#")]),s._v(" 仓库使用")]),s._v(" "),e("p",[s._v("在私有仓库上传、搜索、下载镜像\n"),e("code",[s._v("创建好私有仓库之后，就可以使用 docker tag 来标记一个镜像，然后推送它到仓库。例如私有仓库地址为 127.0.0.1:5000。")])]),s._v(" "),e("p",[s._v("先在本机查看已有的镜像。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                    TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                        latest              ba5877dc9bec        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[s._v("使用 docker tag 将 ubuntu:latest 这个镜像标记为 127.0.0.1:5000/ubuntu:latest。\n"),e("code",[s._v("格式为docker tag IMAGE[:TAG] [REGISTRY_HOST[:REGISTRY_PORT]/]REPOSITORY[:TAG]。")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" tag ubuntu:latest "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                    TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\nubuntu                        latest              ba5877dc9bec        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest  latest              ba5877dc9bec        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[s._v("使用 docker push 上传标记的镜像。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" push "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nThe push refers to repository "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n373a30c24545: Pushed\na9148f5200b0: Pushed\ncdd3de0940ab: Pushed\nfc56279bbb33: Pushed\nb38367233d37: Pushed\n2aebd096e0e2: Pushed\nlatest: digest: sha256:fe4277621f10b5026266932ddf760f5a756d2facd505a94d2da12f4f52f71f5a size: "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1568")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("用 curl 查看仓库中的镜像。")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/v2/_catalog\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"repositories"')]),s._v(":"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ubuntu"')]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"下载镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像"}},[s._v("#")]),s._v(" 下载镜像")]),s._v(" "),e("p",[s._v('这里可以看到 {"repositories":["ubuntu"]}，表明镜像已经被成功上传了。\n先删除已有镜像，再尝试从私有仓库中下载这个镜像。')]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nPulling repository "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest\nba5877dc9bec: Download complete\n511136ea3c5a: Download complete\n9bad880da3d2: Download complete\n25f11f5fb0cb: Download complete\nebc34468f71d: Download complete\n2318d26665ef: Download complete\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" image "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\nREPOSITORY                         TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\n"),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:5000/ubuntu:latest       latest              ba5877dc9bec        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" weeks ago         "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.7")]),s._v(" MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"docker-的常用命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-的常用命令"}},[s._v("#")]),s._v(" Docker 的常用命令")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("docker info")]),s._v("  信息描述")]),s._v(" "),e("li",[e("code",[s._v("docker version")]),s._v(" 版本信息")]),s._v(" "),e("li",[e("code",[s._v("docker --help")]),s._v("   帮助命令")])]),s._v(" "),e("h3",{attrs:{id:"镜像命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#镜像命令"}},[s._v("#")]),s._v(" 镜像命令")]),s._v(" "),e("p",[e("strong",[s._v("docker images 列出本地主机上的镜像")])]),s._v(" "),e("p",[e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf91b2ab3f51d911f96e3.png",alt:""}})]),s._v(" "),e("p",[e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9a02ab3f51d9120224d.png",alt:""}})]),s._v(" "),e("p",[e("strong",[s._v("docker search 某个 xx 镜像的名字")]),s._v(" "),e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9b42ab3f51d91203831.png",alt:""}})]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search nginx \nNAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nnginx                             Official build of Nginx.                        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("15928")]),s._v("     "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   \njwilder/nginx-proxy               Automated Nginx reverse proxy "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" con…   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2101")]),s._v("      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nricharvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("820")]),s._v("       "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("OK"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\njc21/nginx-proxy-manager          Docker container "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" managing Nginx proxy ho…   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("288")]),s._v("             \nlinuxserver/nginx                 An Nginx container, brought to you by LinuxS…   "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("160")]),s._v("             \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"下载镜像-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#下载镜像-2"}},[s._v("#")]),s._v(" 下载镜像")]),s._v(" "),e("p",[s._v("$ docker pull 镜像名字[：TAG]")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx 等价于 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull nginx:latest （latest 最新版）\n删除某个 xx 镜像的名字 ID\n删除镜像 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi 镜像 ID （要先删除容器才能删）\n删除单个 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi -f 镜像 ID （-f 强制删除）\n删除多个 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi -f 镜像名 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":TAG 镜像名 "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(":TAG\n删除全部 "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" rmi -f "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images -qa"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("h3",{attrs:{id:"导出镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#导出镜像"}},[s._v("#")]),s._v(" 导出镜像")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker01 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker image list")]),s._v("\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\ncentos              latest              ff426288ea90        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weeks ago         207MB\nnginx               latest              3f8a4339aadd        "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" weeks ago         108MB\n\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'导出'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker01 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker image save centos > docker-centos.tar.gz")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'导入镜像'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker01 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker image load -i docker-centos.tar.gz  ")]),s._v("\ne15afa4858b6: Loading layer  "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("215")]),s._v(".8MB/215.8MB\nLoaded image: centos:latest\n\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@docker01 ~"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker image list")]),s._v("\nREPOSITORY    TAG         IMAGE ID        CREATED         SIZE\ncentos        latest      ff426288ea90    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" weeks ago     207MB\nnginx         latest      3f8a4339aadd    "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" weeks ago     108MB\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("h3",{attrs:{id:"容器命令"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#容器命令"}},[s._v("#")]),s._v(" 容器命令")]),s._v(" "),e("p",[s._v("启动容器\n"),e("code",[s._v("docker run [OPTIONS] IMAGE [COMMAND][ARG...]")]),s._v(" "),e("a",{attrs:{href:"https://pic.imgdb.cn/item/61ebf92d2ab3f51d911faaab.png",target:"_blank",rel:"noopener noreferrer"}},[e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf92d2ab3f51d911faaab",alt:""}}),e("OutboundLink")],1)]),s._v(" "),e("p",[s._v("启动交互式容器\n"),e("code",[s._v("列出当前所有正在运行的容器")]),s._v(" "),e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9e82ab3f51d9120713b.png",alt:""}})]),s._v(" "),e("p",[e("code",[s._v("ps 列出当前所有正在运行的容器")]),s._v(" "),e("img",{attrs:{src:"https://pic.imgdb.cn/item/61ebf9fb2ab3f51d91208cc8.png",alt:""}})]),s._v(" "),e("h3",{attrs:{id:"退出容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#退出容器"}},[s._v("#")]),s._v(" 退出容器")]),s._v(" "),e("p",[e("strong",[s._v("两种退出方式")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v(" \t\t容器停止退出\nctrl+P+Q \t容器不停止退出 \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"启动容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动容器"}},[s._v("#")]),s._v(" 启动容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" start 容器 ID 或者容器名字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"重启容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启容器"}},[s._v("#")]),s._v(" 重启容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" restart 容器 ID 或者容器名字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"停止容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#停止容器"}},[s._v("#")]),s._v(" 停止容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stop 容器 ID 或者容器名字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"强制停止容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#强制停止容器"}},[s._v("#")]),s._v(" 强制停止容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("kill")]),s._v(" 容器 ID 或者容器名字\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"删除已停止的容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#删除已停止的容器"}},[s._v("#")]),s._v(" 删除已停止的容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 容器 ID\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h3",{attrs:{id:"一次性删除多个容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一次性删除多个容器"}},[s._v("#")]),s._v(" 一次性删除多个容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q"),e("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a -q "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("xargs")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" 重要\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"启动守护式容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动守护式容器"}},[s._v("#")]),s._v(" 启动守护式容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d 容器名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("使用镜像 centos:latest 以后台模式启动一个容器")]),s._v("\ndocker run -d centos\n问题:然后 docker ps -a 进行查看,会发现容器已经退出 很重要的要说明的一点:"),e("code",[s._v("Docker 容器后台运行,就必须有一个前台进程. 容器运行的命令如果不是那些一直挂起的命令(比如运行 top，tail)，就是会自 动退出的。")]),s._v("这个是 docker 的机制问题,比如你的 web 容器，我们以 nginx 为例，正常情况 下，我们配置启动服务只需要启动响应的 service 即可。"),e("code",[s._v("例如 service nginx start 但是,这样做,nginx 为后台进程模式运行,就导致 docker 前台没有运行的应用, 这样的容器后台启动后，会立即自杀因为他觉得他没事可做了. 所以，最佳的解决方案是,将你要运行的程序以前台进程的形式运行")])]),s._v(" "),e("p",[s._v("查看容器日志")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs -f -t --tail 容器 ID\n-t 是加入时间戳\n-f 跟随最新的日志打印\n--tail 数字 显示最后多少条\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("查看容器内运行的进程")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" 容器 ID\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看容器内部细节")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect 容器 ID\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("进入正在运行的容器并以命令行交互")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 容器 ID bashshell\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("重新进入 docker attach 容器 ID")]),s._v(" "),e("p",[s._v("上述两个区别")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("attach 直接进入容器启动命令的终端，不会启动新的进程\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" 是在容器中打开新的终端，并且可以启动新的进程\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"docker-容器数据卷"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-容器数据卷"}},[s._v("#")]),s._v(" Docker 容器数据卷")]),s._v(" "),e("h3",{attrs:{id:"_1-是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-是什么"}},[s._v("#")]),s._v(" 1.是什么")]),s._v(" "),e("p",[s._v("先来看看 Docker 的理念: "),e("code",[s._v("将运用与运行的环境打包形成容器运行，运行可以伴随着容器，但是我们 对数 据的要求希望是持久化的 容器之间希望有可能共享数据Docker 容器产生的数据，如果不通过 docker commit 生成新的镜像，使得数据做 为镜像的一部分保存下来， 那么当容器删除后，数据自然也就没有了。")]),s._v(" 为了能保存数据在 docker 中我们使用卷。")]),s._v(" "),e("h3",{attrs:{id:"_2-能干嘛"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-能干嘛"}},[s._v("#")]),s._v(" 2.能干嘛")]),s._v(" "),e("ul",[e("li",[s._v("卷就是目录或文件，存在于一个或多个容器中，由 docker 挂载到容器，但不属 于联合文件系统，因此能够绕过 Union File System 提供一些用于持续存储或共 "),e("code",[s._v("享数据的特性")]),s._v(":")]),s._v(" "),e("li",[s._v("卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此 Docker 不 会在容器删除时删除其挂载的数据卷")])]),s._v(" "),e("h3",{attrs:{id:"特点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特点"}},[s._v("#")]),s._v(" 特点:")]),s._v(" "),e("p",[s._v("1:"),e("code",[s._v("数据卷可在容器之间共享或重用数据")]),s._v("\n2:"),e("code",[s._v("卷中的更改可以直接生效")]),s._v("\n3:"),e("code",[s._v("数据卷中的更改不会包含在镜像的更新中")]),s._v("\n4:"),e("code",[s._v("数据卷的生命周期一直持续到没有容器使用它为止 容器的持久化 容器间继承+共享数据")])]),s._v(" "),e("h3",{attrs:{id:"数据卷"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据卷"}},[s._v("#")]),s._v(" 数据卷")]),s._v(" "),e("p",[s._v("容器内添加数据卷\n直接命令添加")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -v /宿主机绝对路径目录:/容器内目录 镜像名\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看数据卷是否挂载成功")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect 容器 ID\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("容器和宿主机之间的数据共享 主机创建文件，容器可以同步 容器停止退出后，主机修改后数据是否同步 同步")]),s._v(" "),e("h3",{attrs:{id:"命令-容器只读权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#命令-容器只读权限"}},[s._v("#")]),s._v(" 命令（容器只读权限）")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名                  \n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("实例：")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 -v /opt/data:/usr/share/nginx/html  --name nginx nginx:latest \n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":80 -v /opt/data:/usr/share/nginx/html:rw  --name nginx nginx:latest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h3",{attrs:{id:"dockerfile-添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-添加"}},[s._v("#")]),s._v(" Dockerfile 添加")]),s._v(" "),e("p",[s._v("根目录下新建 mydocker 文件夹并进入 ，可在 Dockerfile 中使用 VOLUME 指令来给镜像添加一个或多个数据卷\n"),e("code",[s._v('VOLUME [\'/dataVolumeContainer\',"/dataVolumeContainer2","/dataVolumeCont ainer3"]')]),s._v("\n说明:")]),s._v(" "),e("ul",[e("li",[s._v("出于可移植和分享的考虑，用-v 主机目录:容器目录这种方法不能够直接在 Dockerfile 中实现。")]),s._v(" "),e("li",[s._v("由于宿主机目录是依赖于特定宿主机的，并不能够保证在所有的宿主机上都存在 这样的特定目录。")])]),s._v(" "),e("p",[e("strong",[s._v("Dockerfile 构建")])]),s._v(" "),e("div",{staticClass:"language-dockerfile line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[e("code",[e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" centos ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("VOLUME")]),s._v(" ["),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dataVolumeContainer1"')]),s._v(","),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/dataVolumeContainer2"')]),s._v("] ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" echo "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"finished-----success1"')]),s._v(" ")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token instruction"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CMD")]),s._v(" /bin/bash")]),s._v("\n构建镜像\n\n$ docker build -f /mydocker/dockerfile2 -t zzyy/centos .\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"run-容器"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#run-容器"}},[s._v("#")]),s._v(" run 容器")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it zzyy/centos\n\n通过上述步骤，容器内的卷目录地址已经知道，对应的主机目录地址哪??\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" inspect 容器 ID 可以查看主机对应默认地址口\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("p",[s._v("备注")]),s._v(" "),e("ul",[e("li",[s._v("Docker 挂载主机目录 Docker 访问出现 cannot open directory .: Permission deniedy")]),s._v(" "),e("li",[s._v("解决办法:在挂载目录后多加一个--privileged=true 参数即可")])]),s._v(" "),e("h2",{attrs:{id:"docker-镜像"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像"}},[s._v("#")]),s._v(" Docker 镜像")]),s._v(" "),e("p",[e("strong",[s._v("是什么?")]),s._v(" "),e("code",[s._v("镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环 境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、 环境变量和配置文件。")])]),s._v(" "),e("p",[e("strong",[s._v("UnionFS (联合文件系统)")])]),s._v(" "),e("ul",[e("li",[s._v("UnionFS (联合文件系统) : "),e("code",[s._v("Union 文件 系统(UnionFS) 是一种分层、轻量级并 且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加， 同时可以将不同目录挂载到同一个虚拟文件")]),s._v("系统下(unite several directories into a single virtual filesystem)。Union 文件系统是 Docker 镜像的基础。 镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)，可以制作各种具体 的应用镜像。")]),s._v(" "),e("li",[s._v("特性: "),e("code",[s._v("一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统， 联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文 件和目录")])])]),s._v(" "),e("h3",{attrs:{id:"docker-镜像加载原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-镜像加载原理"}},[s._v("#")]),s._v(" Docker 镜像加载原理")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("Docker 镜像加载原理:")]),s._v(" docker 的镜像实际上由一层一层的文件 系统组成，这种层级的文件系统 UnionFS.")]),s._v(" "),e("li",[e("code",[s._v("botfs(boot fle system)")]),s._v("主要包含 bootloader 和 kernel, botoader 主要是引导 加载 kernel,Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层 是 botfs。这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和 内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 boofs.")]),s._v(" "),e("li",[e("code",[s._v("roots (root file system)")]),s._v("，在 botfs 之上。 包含的就是典型 Linux 系统中的 /dev, /proc, /bin, /etc 等标准目录和文件。rootfs就 是各种不同的操作系 统发行版，比如 Ubuntu， Centos 等等。")]),s._v(" "),e("li",[e("code",[s._v("为什么 Docker 镜像要采用这种分层结构呢最大的一个好处就是一共享资源")]),s._v(" 比如:有多个镜像都从相同的 base 镜像构建而来，那么宿主机只需在磁盘上保存 一份 base 镜像， 同时内存中也只需加载-份 base 镜像，就可以为所有容器服务了。而且镜像的每 一层都可以被共享。")])]),s._v(" "),e("h3",{attrs:{id:"特点-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特点-2"}},[s._v("#")]),s._v(" 特点")]),s._v(" "),e("p",[e("code",[s._v('Docker 镜像都是只读的 当容器启动时，一个新的可写层被加载到镜像的项部。 这一层通常被称作"容器层","容器层"之下的都叫"镜像层”。')])]),s._v(" "),e("p",[s._v("docker镜像 commit 操作补充\n"),e("code",[s._v("dockercommit 提交容器副本使之成为--个新的镜像 docker commit -m=“提交的描述信息”-a=”作者”容器 ID 要创建的目标镜像 名:[标签名]")])]),s._v(" "),e("h3",{attrs:{id:"案例演示"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#案例演示"}},[s._v("#")]),s._v(" 案例演示")]),s._v(" "),e("p",[e("strong",[s._v("1. 从 Hub 上下载 tomcat 镜像到本地并成功运行")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -it -p "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(":8080 tomcat\n-p 主机端口:docker 容器端口\n-P 随机分配端口\n-i 交互\n-t 终端\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("2.故意删除上一步镜像生产 tomcat 容器的文档")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it 容器名 /bin/bash\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" webapps\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf docs\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("p",[e("strong",[s._v("3. 也即当前的 tomcat 运行实例是一- 个没有文档内容的容器，以它为模板 commit 一个没有 doc 的 tomcat 新镜像 atguigu/tomcat02")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" commit -a"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("“zzyy”-m"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"del tomcat docs"')]),s._v(" 容器 ID atguigu/tomcat02:1.2\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("strong",[s._v("4.启动我们的新镜像并和原来的对比")])]),s._v(" "),e("ul",[e("li",[s._v("启动 atguigu/tomcat02，它没有 docs")]),s._v(" "),e("li",[s._v("新启动原来的 tomcat，它有 docs")])])])}),[],!1,null,null,null);a.default=n.exports}}]);