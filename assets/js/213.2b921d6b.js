(window.webpackJsonp=window.webpackJsonp||[]).push([[213],{693:function(s,e,a){"use strict";a.r(e);var t=a(19),r=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"trove"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trove"}},[s._v("#")]),s._v(" Trove")]),s._v(" "),a("h2",{attrs:{id:"trove简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trove简介"}},[s._v("#")]),s._v(" Trove简介")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://so.csdn.net/so/search?q=Openstack&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("Openstack"),a("OutboundLink")],1),s._v(" Trove是openstack为用户提供的数据库即服务(DBaaS)。所谓DBaaS，即trove既具有数据库管理的功能，又具有云计算的优势。使用trove，用户可以：")]),s._v(" "),a("ul",[a("li",[s._v('"按需"获得数据库服务器')]),s._v(" "),a("li",[s._v("配置所获得的数据库服务器或者数据库服务器集群")]),s._v(" "),a("li",[s._v("对数据库服务器或者数据库服务器集群进行自动化管理")]),s._v(" "),a("li",[s._v("根据数据库的负载让数据库服务器集群动态伸缩")])]),s._v(" "),a("p",[s._v("与openstack的其他组件一样，trove也提供"),a("a",{attrs:{href:"https://so.csdn.net/so/search?q=RESTful&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("RESTful"),a("OutboundLink")],1),s._v(" API，并通过RESTful API和其他组件进行交互。")]),s._v(" "),a("h2",{attrs:{id:"trove架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trove架构"}},[s._v("#")]),s._v(" Trove架构")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/isicman/image/main/img/202205112059028.png",alt:"img"}})]),s._v(" "),a("p",[a("strong",[a("code",[s._v("架构解析：")])])]),s._v(" "),a("p",[s._v("Trove "),a("a",{attrs:{href:"https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020",target:"_blank",rel:"noopener noreferrer"}},[s._v("API"),a("OutboundLink")],1),s._v("和用户进行交互，当Trove API接收到用户请求时，trove API首先会调用Keystone的API来对用户进行认证，认证通过后才会去执行相应的操作。Trove API会同步处理操作简单的一些请求，复杂的请求则会通过Message Queue (RabbitMQ)交给Task Manager来处理。Task Manager会监听RabbitMQ的一个topic，收到请求后就会进行处理。这些请求通常是分配数据库实例、管理数据库实例的生命周期、操作数据库等。和openstack的其他组件一样，Trove也有一个Infrastructure Database来存储自己本身的数据，如数据库实例的信息等。Trove conductor的主要功能是接收来自guest agent的状态更新信息，这些信息会被存储在Infrastructure database里面或者作为调用结果返回给其他服务。通常这些状态更新信息包括：guest agent心跳包，数据库备份状态等。Guest Agent运营于数据库服务器中(虚拟机)，给trove其他组件提供了一套内部使用的API，trove的其他组件通过Message Queue来调用这些API，guest agent收到API调用请求后，执行相应的数据库操作。")]),s._v(" "),a("h2",{attrs:{id:"trove的基本概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trove的基本概念"}},[s._v("#")]),s._v(" Trove的基本概念")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("数据库实例（Instance）")])]),s._v("：包含数据库程序的openstack虚拟机，如果用户创建了一个数据库实例，那么他其实就创建了一台openstack虚拟机，并在该虚拟机上启动了数据库服务。")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("Datastore")])]),s._v("：用来表示和存储数据库的类型、版本、虚拟机镜像等信息。当用户创建一个数据库实例时需要指定Datastore.")]),s._v(" "),a("li",[a("strong",[a("code",[s._v("配置组(Configuration Group)")])]),s._v("：数据库参数组成的集合。用户可以将配置组应用到一个或多个数据库实例上，因而避免了大量的重复操作。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/isicman/image/main/img/202205112100128.png",alt:"img"}})]),s._v(" "),a("h2",{attrs:{id:"trove的用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trove的用法"}},[s._v("#")]),s._v(" Trove的用法")]),s._v(" "),a("h3",{attrs:{id:"_1-添加datastore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加datastore"}},[s._v("#")]),s._v(" 1.添加Datastore")]),s._v(" "),a("p",[s._v("在创建数据库实例时，需要指定Datastore来告诉trove需要用到的镜像、数据库类型及版本信息。所以在创建数据库实例之前需要在系统中创建Datastore.")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# glance image-create --name "mysql-5.6" --disk-format qcow2  --container-format bare --progress --file Mysql-5.6.qcow2')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# glance image-list")]),s._v("\n+--------------------------------------+--------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ID                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name                     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+--------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" c4c9a58f-bbe6-4640-8488-0c05b52028df "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql-5.6                "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+--------------------------+\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openstack network list ")]),s._v("\n+--------------------------------------+---------+--------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ID                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Subnets                              "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+---------+--------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 76642f3f-84a5-441f-aa89-fa4ca3149137 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Network "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 3c791298-acfa-445f-916d-d5a71843ecf2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+---------+--------------------------------------+\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openstack database instance create mysql-1 2  --nic net-id=76642f3f-84a5-441f-aa89-fa4ca3149137  --size 1 --databases myDB --users user:password --datastore_version mysql-5.6 --datastore mysql")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"_2-基本的数据库实例操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-基本的数据库实例操作"}},[s._v("#")]),s._v(" 2.基本的数据库实例操作")]),s._v(" "),a("p",[s._v("列出所有的数据库实例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建一个数据库实例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove create vm1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" --size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" --datastore mysql\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("重启一个数据库实例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove restart vm1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除一个数据库实例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove delete vm1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("强制删除一个数据库实例")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove force-delete vm1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("调整一个数据库实例的规格")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove resize-volume vm1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n$ trove resize-instance vm1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-管理数据库用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-管理数据库用户"}},[s._v("#")]),s._v(" 2.管理数据库用户")]),s._v(" "),a("p",[s._v("列出所有的数据库用户")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("创建一个用户")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-create\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除一个用户")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-delete\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("给一个用户授权访问某个数据库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-grant-acces\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("吊销用户对于某一个数据库的访问权限")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-revoke-access\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("显示用户信息")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-show\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("显示用户的权限")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove user-show-access\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"_4-数据库管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-数据库管理"}},[s._v("#")]),s._v(" 4.数据库管理")]),s._v(" "),a("p",[s._v("在一个数据库实例中创建一个数据库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove database-create\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("列出一个数据库实例中的所有数据库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove database-list\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("删除一个数据库实例中的某个数据库")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ trove database-delete\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/isicman/image/main/img/202205101044035.webp",alt:"img"}})])])}),[],!1,null,null,null);e.default=r.exports}}]);