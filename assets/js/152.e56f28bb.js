(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{632:function(s,e,a){"use strict";a.r(e);var t=a(19),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes故障排查"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes故障排查"}},[s._v("#")]),s._v(" Kubernetes故障排查")]),s._v(" "),a("h2",{attrs:{id:"kubernetes故障排查-应用部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes故障排查-应用部署"}},[s._v("#")]),s._v(" Kubernetes故障排查：应用部署")]),s._v(" "),a("h4",{attrs:{id:"查看资源类型的详细"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看资源类型的详细"}},[s._v("#")]),s._v(" 查看资源类型的详细：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get deployments.apps ")]),s._v("\nNAME   READY   UP-TO-DATE   AVAILABLE   AGE\nweb    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           15h\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl describe deployments.apps web ")]),s._v("\nName:                   web\nNamespace:              default\nCreationTimestamp:      Mon, 08 Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":04:33 +0000\nLabels:                 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web\nAnnotations:            deployment.kubernetes.io/revision: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nSelector:               "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web\nReplicas:               "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" desired "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" updated "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" total "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" available "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" unavailable\nStrategyType:           RollingUpdate\nMinReadySeconds:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nRollingUpdateStrategy:  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("% max unavailable, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("% max surge\nPod Template:\n  Labels:  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("web\n  Containers:\n   nginx:\n    Image:        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".253.4/library/nginx\n    Port:         "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    Host Port:    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    Environment:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n    Mounts:       "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  Volumes:        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nConditions:\n  Type           Status  Reason\n  ----           ------  ------\n  Available      True    MinimumReplicasAvailable\n  Progressing    True    NewReplicaSetAvailable\nOldReplicaSets:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\nNewReplicaSet:   web-df4986867 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1 replicas created"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEvents:          "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br")])]),a("h4",{attrs:{id:"查看资源类型的日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看资源类型的日志"}},[s._v("#")]),s._v(" 查看资源类型的日志：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs web ")]),s._v("\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" shell scripts "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-listen-on-ipv6-by-default.sh: Getting the checksum of /etc/nginx/conf.d/default.conf\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-listen-on-ipv6-by-default.sh: Enabled listen on IPv6 "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Configuration complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ready "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" start up\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"进入容器查看"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#进入容器查看"}},[s._v("#")]),s._v(" 进入容器查看：")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it web web-df4986867-qct9h  -- bash")]),s._v("\nroot@web:~"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/share/nginx/html/")]),s._v("\nroot@web:/usr/share/nginx/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\n50x.html  index.html\nroot@web:/usr/share/nginx/html"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h2",{attrs:{id:"kubernetes故障排查-组件不能正常工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes故障排查-组件不能正常工作"}},[s._v("#")]),s._v(" Kubernetes故障排查：组件不能正常工作")]),s._v(" "),a("ul",[a("li",[a("h4",{attrs:{id:"管理节点组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#管理节点组件"}},[s._v("#")]),s._v(" 管理节点组件：")]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("kube-apiserver")])])]),s._v(" "),a("li",[a("strong",[a("code",[s._v("kube-controller-manager")])])]),s._v(" "),a("li",[a("strong",[a("code",[s._v("kube-scheduler")])])])])]),s._v(" "),a("li",[a("h4",{attrs:{id:"工作节点组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#工作节点组件"}},[s._v("#")]),s._v(" "),a("strong",[s._v("工作节点组件：")])]),s._v(" "),a("ul",[a("li",[a("strong",[a("code",[s._v("kubelet")])])]),s._v(" "),a("li",[a("strong",[a("code",[s._v("kube-proxy")])])])])])]),s._v(" "),a("h4",{attrs:{id:"判断kube-system的资源"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#判断kube-system的资源"}},[s._v("#")]),s._v(" 判断kube-system的资源")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("查看kube-system的所有Pod是否都正常运行，如果正常运行说明集群没问题。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n kube-system ")]),s._v("\nNAME                                       READY   STATUS    RESTARTS   AGE\ncoredns-9c47b455-2gf7n                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\ncoredns-9c47b455-rrqnw                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\netcd-master.novalocal                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-apiserver-master.novalocal            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-controller-manager-master.novalocal   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-flannel-ds-d5tdl                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-flannel-ds-nq7qg                      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-proxy-2nrkb                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-proxy-fpjcm                           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\nkube-scheduler-master.novalocal            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          16h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])])])]),s._v(" "),a("h4",{attrs:{id:"controller-manager的作用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#controller-manager的作用"}},[s._v("#")]),s._v(" controller-manager的作用")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("创建一个deployment，结果没有创建Pod，这是什么原因？")])]),s._v(" "),a("li",[a("p",[s._v("因为当你创建deployment的时候，controller-manager的组件会干预进来，根据deployment的yaml调用rs创建多少个Pod，进行调度，如果没有创建Pod就是Controller-manager的问题。还有一种原因是apiserver配置不当，插件有问题，请求提交成功了，但是被拒绝了。")])])]),s._v(" "),a("h2",{attrs:{id:"kubernetes故障排查-service访问异常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes故障排查-service访问异常"}},[s._v("#")]),s._v(" Kubernetes故障排查：Service访问异常")]),s._v(" "),a("p",[s._v("Service一般是访问不通的，有以下可能性：")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("Service是否关联Pod？")])]),s._v(" "),a("li",[a("code",[s._v("Service指定target-port端口是否正常？")])]),s._v(" "),a("li",[a("code",[s._v("Pod正常工作吗？")])]),s._v(" "),a("li",[a("code",[s._v("Service是否通过DNS工作？")])]),s._v(" "),a("li",[a("code",[s._v("kube-proxy正常工作吗？")])]),s._v(" "),a("li",[a("code",[s._v("kube-proxy是否正常写iptables规则？")])]),s._v(" "),a("li",[a("code",[s._v("cni网络插件是否正常工作？")])])]),s._v(" "),a("h2",{attrs:{id:"k8s-1-20x版本nfs动态存储报错"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-1-20x版本nfs动态存储报错"}},[s._v("#")]),s._v(" K8s 1.20x版本nfs动态存储报错")]),s._v(" "),a("p",[a("code",[s._v('persistentvolume-controller waiting for a volume to be created, either by external provisioner "qgg-nfs-storage" or manually created by system administrator')]),s._v(" "),a("code",[s._v('waiting for a volume to be created, either by external provisioner "storage.')])]),s._v(" "),a("h4",{attrs:{id:"修改apiserver的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#修改apiserver的配置"}},[s._v("#")]),s._v(" 修改apiserver的配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/kubernetes/manifests/kube-apiserver.yaml\napiVersion: v1\n···\n    - --tls-private-key-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/etc/kubernetes/pki/apiserver.key\n    - --feature-gates"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("RemoveSelfLink"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加这个配置")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"重启apiserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重启apiserver"}},[s._v("#")]),s._v(" 重启apiserver")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ systemctl  restart kubelet \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);e.default=n.exports}}]);