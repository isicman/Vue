(window.webpackJsonp=window.webpackJsonp||[]).push([[212],{692:function(s,t,a){"use strict";a.r(t);var e=a(19),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"cephå¯¹æ¥opensstack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cephå¯¹æ¥opensstack"}},[s._v("#")]),s._v(" Cephå¯¹æ¥OpensStack")]),s._v(" "),a("h3",{attrs:{id:"ç®€è¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç®€è¦"}},[s._v("#")]),s._v(" ç®€è¦")]),s._v(" "),a("p",[s._v("Openstackç¯å¢ƒä¸­ï¼Œæ•°æ®å­˜å‚¨å¯åˆ†ä¸ºä¸´æ—¶æ€§å­˜å‚¨ä¸æ°¸ä¹…æ€§å­˜å‚¨ã€‚")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("ä¸´æ—¶æ€§å­˜å‚¨ï¼š")]),s._v("  ä¸»è¦ç”±æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæä¾›ï¼Œå¹¶ä¸»è¦ç”¨äºnovaè™šæ‹Ÿæœºçš„æœ¬åœ°ç³»ç»Ÿä¸ä¸´æ—¶æ•°æ®ç›˜ï¼Œä»¥åŠå­˜å‚¨glanceä¸Šä¼ çš„ç³»ç»Ÿé•œåƒï¼›")]),s._v(" "),a("li",[a("strong",[s._v("æ°¸ä¹…æ€§å­˜å‚¨ï¼š")]),s._v("  ä¸»è¦ç”±cinderæä¾›çš„å—å­˜å‚¨ä¸swiftæä¾›çš„å¯¹è±¡å­˜å‚¨æ„æˆï¼Œä»¥cinderæä¾›çš„å—å­˜å‚¨åº”ç”¨æœ€ä¸ºå¹¿æ³›ï¼Œå—å­˜å‚¨é€šå¸¸ä»¥äº‘ç›˜çš„å½¢å¼æŒ‚è½½åˆ°è™šæ‹Ÿæœºä¸­ä½¿ç”¨ã€‚")])]),s._v(" "),a("p",[s._v("Openstackä¸­éœ€è¦è¿›è¡Œæ•°æ®å­˜å‚¨çš„ä¸‰å¤§é¡¹ç›®ä¸»è¦æ˜¯novaé¡¹ç›®ï¼ˆè™šæ‹Ÿæœºé•œåƒæ–‡ä»¶ï¼‰ï¼Œglanceé¡¹ç›®ï¼ˆå…±ç”¨æ¨¡ç‰ˆé•œåƒï¼‰ä¸cinderé¡¹ç›®ï¼ˆå—å­˜å‚¨ï¼‰ã€‚")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("ä¸‹å›¾ä¸º "),a("strong",[s._v("cinderï¼Œglanceä¸novaè®¿é—®ceph")]),s._v(" é›†ç¾¤çš„é€»è¾‘å›¾ï¼š")])]),s._v(" "),a("li",[a("p",[s._v("cephä¸openstacké›†æˆä¸»è¦ç”¨åˆ°cephçš„rbdæœåŠ¡ï¼Œcephåº•å±‚ä¸ºradoså­˜å‚¨é›†ç¾¤ï¼Œcephé€šè¿‡libradosåº“å®ç°å¯¹åº•å±‚radosçš„è®¿é—®ï¼›")])]),s._v(" "),a("li",[a("p",[s._v("openstackå„é¡¹ç›®å®¢æˆ·ç«¯è°ƒç”¨librbdï¼Œå†ç”±librbdè°ƒç”¨libradosè®¿é—®åº•å±‚radosï¼›\nå®é™…ä½¿ç”¨ä¸­ï¼Œnovaéœ€è¦ä½¿ç”¨libvirtdriveré©±åŠ¨ä»¥é€šè¿‡libvirtä¸qemuè°ƒç”¨librbdï¼›cinderä¸glanceå¯ç›´æ¥è°ƒç”¨librbdï¼›")])]),s._v(" "),a("li",[a("p",[s._v("å†™å…¥cephé›†ç¾¤çš„æ•°æ®è¢«æ¡å¸¦åˆ‡åˆ†æˆå¤šä¸ªobjectï¼Œobjecté€šè¿‡hashå‡½æ•°æ˜ å°„åˆ°pgï¼ˆæ„æˆpgå®¹å™¨æ± poolï¼‰ï¼Œç„¶åpgé€šè¿‡å‡ åœˆcrushç®—æ³•è¿‘ä¼¼å‡åŒ€åœ°æ˜ å°„åˆ°ç‰©ç†å­˜å‚¨è®¾å¤‡osdï¼ˆosdæ˜¯åŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ç‰©ç†å­˜å‚¨è®¾å¤‡ï¼Œå¦‚xfsï¼Œext4ç­‰ï¼‰ã€‚")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108433.webp",alt:"img"}})]),s._v(" "),a("h3",{attrs:{id:"èŠ‚ç‚¹è§„åˆ’"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#èŠ‚ç‚¹è§„åˆ’"}},[s._v("#")]),s._v(" èŠ‚ç‚¹è§„åˆ’")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("æ“ä½œç³»ç»Ÿ")]),s._v(" "),a("th",[s._v("IPåœ°å€")]),s._v(" "),a("th",[s._v("ä¸»æœºåç§°")]),s._v(" "),a("th",[s._v("èŠ‚ç‚¹")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("CentOS-7.9")]),s._v(" "),a("td",[s._v("172.25.254.128")]),s._v(" "),a("td",[s._v("controller")]),s._v(" "),a("td",[s._v("æ§åˆ¶èŠ‚ç‚¹+è®¡ç®—èŠ‚ç‚¹")])]),s._v(" "),a("tr",[a("td",[s._v("CentOS-7.9")]),s._v(" "),a("td",[s._v("172.25.254.129")]),s._v(" "),a("td",[s._v("compute")]),s._v(" "),a("td",[s._v("è®¡ç®—èŠ‚ç‚¹")])]),s._v(" "),a("tr",[a("td",[s._v("CentOS-7.9")]),s._v(" "),a("td",[s._v("172.25.254.130")]),s._v(" "),a("td",[s._v("ceph01      500GX3 ç¡¬ç›˜")]),s._v(" "),a("td",[s._v("OSD/MON/Prometheus+GrafanaèŠ‚ç‚¹")])]),s._v(" "),a("tr",[a("td",[s._v("CentOS-7.9")]),s._v(" "),a("td",[s._v("172.25.254.131")]),s._v(" "),a("td",[s._v("ceph02      500GX3 ç¡¬ç›˜")]),s._v(" "),a("td",[s._v("OSDèŠ‚ç‚¹")])]),s._v(" "),a("tr",[a("td",[s._v("CentOS-7.9")]),s._v(" "),a("td",[s._v("172.25.254.132")]),s._v(" "),a("td",[s._v("ceph03      500GX3 ç¡¬ç›˜")]),s._v(" "),a("td",[s._v("OSDèŠ‚ç‚¹")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("ä½¿ç”¨æ­å»ºå¥½çš„åŒèŠ‚ç‚¹ "),a("strong",[s._v("OpenStack-T")]),s._v(" ç‰ˆæœ¬äº‘å¹³å°ã€‚")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108785.png",alt:"image-20220305200205759"}})]),s._v(" "),a("h3",{attrs:{id:"éƒ¨ç½²cephé›†ç¾¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²cephé›†ç¾¤"}},[s._v("#")]),s._v(" éƒ¨ç½²Cephé›†ç¾¤")]),s._v(" "),a("p",[s._v("è¿™é‡Œä½¿ç”¨Ceph-Deployçš„æ–¹å¼éƒ¨ç½²é›†ç¾¤ï¼Œç”Ÿäº§ç¯å¢ƒä¸­ä¸æ¨èä½¿ç”¨è¯¥æ–¹å¼ã€‚å¯ä»¥é€šè¿‡Ansibleçš„æˆ–ç­‰æ–¹å¼éƒ¨ç½²ã€‚")]),s._v(" "),a("p",[s._v("éœ€è¦é…ç½®hostsã€å…³é—­é˜²ç«å¢™ä»¥åŠselinuxçš„è®¾ç½®ã€ä¼˜åŒ–å†…æ ¸å‚æ•°ã€ä½¿ç”¨åˆ¶ä½œå¥½çš„Ceph-14.2.22çš„ç¦»çº¿æºã€‚  "),a("strong",[s._v("ï¼ˆä»¥ä¸Šæ“ä½œåœ¨æ‰€æœ‰èŠ‚ç‚¹è¿›è¡Œï¼‰")])]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®æœ¬åœ°çš„host"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®æœ¬åœ°çš„host"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®æœ¬åœ°çš„host")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4\n::1         localhost localhost.localdomain localhost6 localhost6.localdomain6 \n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.130 ceph01 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.131 ceph02 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.132 ceph03 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.128 controller \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.129 compute \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸å…³é—­é˜²ç«å¢™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å…³é—­é˜²ç«å¢™"}},[s._v("#")]),s._v(" ğŸ·ï¸å…³é—­é˜²ç«å¢™")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop firewalld ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's/enforcing/disabled/' /etc/selinux/config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# setenforce 0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸ä¼˜åŒ–å†…æ ¸å‚æ•°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸ä¼˜åŒ–å†…æ ¸å‚æ•°"}},[s._v("#")]),s._v(" ğŸ·ï¸ä¼˜åŒ–å†…æ ¸å‚æ•°")]),s._v(" "),a("p",[s._v("å†…æ ¸å‚æ•°ä¼˜åŒ–ã€read_ahead,é€šè¿‡æ•°æ®é¢„è¯»å¹¶ä¸”è®°è½½åˆ°éšæœºè®¿é—®å†…å­˜æ–¹å¼æé«˜ç£ç›˜è¯»æ“ä½œã€‚")]),s._v(" "),a("p",[s._v("è®¾ç½®I/O Schedulerï¼ŒSSDè¦ç”¨noopï¼ŒSATA/SASä½¿ç”¨deadlineã€‚")]),s._v(" "),a("p",[s._v("è®¾ç½® /etc/security/limits.confå’Œè®¾ç½® /etc/security/limits.d/20-nproc.confã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat >> /etc/sysctl.conf << EOF")]),s._v("\nkernel.pid_max "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4194303")]),s._v("\nvm.swappiness "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nEOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -p")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "8192" > /sys/block/sda/queue/read_ahead_kb')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "deadline" >/sys/block/sd[x]/queue/scheduler')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "noop" >/sys/block/sd[x]/queue/scheduler')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/security/limits.conf ")]),s._v("\nEnd of "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n*\thard nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n*\tsoft nofile "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n*\thard nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n*\tsoft nproc "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n*\tsoft core "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n*\thard core "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("655360")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /etc/security/limits.d/20-nproc.conf")]),s._v("\n*\tsoft nproc unlimitedroot soft nproc unlimited\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®æœ¬åœ°ç¦»çº¿æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®æœ¬åœ°ç¦»çº¿æº"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®æœ¬åœ°ç¦»çº¿æº")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/yum.repos.d/local.repo ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("baseurl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://172.25.254.133/file/repo/ceph-n/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gpgcheck")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸å¯¹æ‰€æœ‰èŠ‚ç‚¹é…ç½®å…å¯†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å¯¹æ‰€æœ‰èŠ‚ç‚¹é…ç½®å…å¯†"}},[s._v("#")]),s._v(" ğŸ·ï¸å¯¹æ‰€æœ‰èŠ‚ç‚¹é…ç½®å…å¯†")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id ceph01")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id ceph02")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id ceph03")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id controller")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh-copy-id compute")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸å®‰è£…cephè½¯ä»¶åŒ…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å®‰è£…cephè½¯ä»¶åŒ…"}},[s._v("#")]),s._v(" ğŸ·ï¸å®‰è£…Cephè½¯ä»¶åŒ…")]),s._v(" "),a("p",[s._v("é›†æˆè¿‡ç¨‹ä¸­ï¼Œéœ€è¦åœ¨ OpenStack çš„ controller èŠ‚ç‚¹å’Œ compute èŠ‚ç‚¹å®‰è£… Ceph è½¯ä»¶åŒ…ï¼Œä½œä¸º Ceph å®¢æˆ·ç«¯ã€‚")]),s._v(" "),a("p",[a("strong",[s._v("åœ¨ceph01èŠ‚ç‚¹ä¸Šå®‰è£…è½¯ä»¶åŒ…")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y ceph-deploy ceph ceph-mds ceph-radosgw ceph-mgr-dashboard")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("strong",[s._v("åœ¨ceph02ã€ceph03èŠ‚ç‚¹ä¸Šå®‰è£…è½¯ä»¶åŒ…")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph02 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install ceph ceph-mds ceph-radosgw ceph-mgr-dashboard")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph03 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum -y install ceph ceph-mds ceph-radosgw ceph-mgr-dashboard")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("strong",[s._v("åœ¨controllerã€computeå®‰è£…cephè½¯ä»¶åŒ…")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y  ceph ceph-radosgw ceph-common ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸åˆå§‹åŒ–é…ç½®mon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸åˆå§‹åŒ–é…ç½®mon"}},[s._v("#")]),s._v(" ğŸ·ï¸åˆå§‹åŒ–é…ç½®mon")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨Ceph01æ§åˆ¶èŠ‚ç‚¹æ“ä½œ")])])]),s._v(" "),a("p",[s._v("åˆå§‹åŒ–Cephé›†ç¾¤ä¸‰ä¸ªèŠ‚ç‚¹ã€‚")]),s._v(" "),a("p",[s._v("ä¿®æ”¹/etc/ceph-cluster/ceph.confï¼Œæ·»åŠ é…ç½®æ–‡ä»¶ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/ceph/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy new ceph01 ceph02 ceph03 --cluster-network 172.25.254.0/24 --public-network 172.25.254.0/24")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ceph.conf ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nfsid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 52dc97f5-e311-43e9-b307-0e94c83dfd87\npublic_network "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.0/24\ncluster_network "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.0/24\nmon_initial_members "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ceph01, ceph02, ceph03\nmon_host "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.130,172.25.254.131,172.25.254.132\nauth_cluster_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_service_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_client_required "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cephx\nauth_allow_insecure_global_id_reclaim "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("  \nmon_clock_drift_allowed "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mon.ceph01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph01 \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mon_addr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.130 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mon.ceph02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph02\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mon_addr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.131\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mon.ceph03"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ceph03\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("mon_addr")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.25")]),s._v(".254.132 \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸åˆå§‹åŒ–monèŠ‚ç‚¹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸åˆå§‹åŒ–monèŠ‚ç‚¹"}},[s._v("#")]),s._v(" ğŸ·ï¸åˆå§‹åŒ–monèŠ‚ç‚¹")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨Ceph01æ§åˆ¶èŠ‚ç‚¹æ“ä½œ")])])]),s._v(" "),a("p",[s._v("å°† keyring åŒæ­¥åˆ°å„èŠ‚ç‚¹ï¼Œä»¥ä¾¿å…¶å®ƒèŠ‚ç‚¹å¯ä»¥æ‰§è¡Œ ceph é›†ç¾¤ç®¡ç†å‘½ä»¤ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy mon create-initial ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy --overwrite-conf admin ceph01 ceph02 ceph03 controller compute")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸åˆå§‹åŒ–é…ç½®mgr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸åˆå§‹åŒ–é…ç½®mgr"}},[s._v("#")]),s._v(" ğŸ·ï¸åˆå§‹åŒ–é…ç½®mgr")]),s._v(" "),a("p",[s._v("ceph-mgr è¿›ç¨‹æ˜¯ä¸»å¤‡æ¨¡å¼ï¼ŒåŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹å·¥ä½œï¼Œå…¶ä»–èŠ‚ç‚¹å¤„äº standbyã€‚")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨Ceph01æ§åˆ¶èŠ‚ç‚¹æ“ä½œ")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph-deploy mgr create ceph01 ceph02 ceph03")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s ")]),s._v("\n  cluster:\n    id:     6fa8bcf8-bb73-48ff-b96d-621298b3be0f\n    health: HEALTH_OK\n \n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum ceph01,ceph02,ceph03 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 60m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: ceph01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 51m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", standbys: ceph02, ceph03\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 55m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 55m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" MiB\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" GiB used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" TiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" TiB avail\n    pgs:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" active+clean\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸åˆå§‹åŒ–é…ç½®osd"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸åˆå§‹åŒ–é…ç½®osd"}},[s._v("#")]),s._v(" ğŸ·ï¸åˆå§‹åŒ–é…ç½®osd")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨Ceph01æ§åˆ¶èŠ‚ç‚¹æ“ä½œ")])])]),s._v(" "),a("p",[s._v("æŒ‰ç…§è§„åˆ’æ¯ä¸ªèŠ‚ç‚¹æœ‰ 3 ä¸ª OSDã€‚ä¸€å…±å¯ä»¥åˆ’åˆ†9ä¸ªOSDã€‚")]),s._v(" "),a("p",[s._v("æ“¦é™¤é›†ç¾¤èŠ‚ç‚¹ä¸Šç”¨æ¥ç”¨ä½œOSDè®¾å¤‡çš„ç£ç›˜(disk zap)ï¼Œç”Ÿäº§ç¯å¢ƒä¸‹å¯ä»¥å•ç‹¬æŒ‡å®šblock-dbå’Œblock-walè®¾å¤‡ä»¥ä¼˜åŒ–æ€§èƒ½ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for dev in /dev/sdb /dev/sdc /dev/sdd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph01 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph01 --bluestore --data "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph02 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph02 --bluestore --data "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy disk zap ceph03 "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" ceph-deploy osd create ceph0 --bluestore --data "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$dev")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" \n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lsblk  ")]),s._v("\nNAME                                                                                                  MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda                                                                                                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nâ””â”€sda1                                                                                                  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":1    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" part /\nsdb                                                                                                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":16   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nâ””â”€ceph--1914cd94--70ca--4c2e--beef--5745262bdef5-osd--block--073aabcf--fbfc--4c95--b8e5--e038ef01b6de "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":0    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  \nsdc                                                                                                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":32   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nâ””â”€ceph--b9ae593e--bf08--400e--b832--09bac1a60b2e-osd--block--17c3c65e--15aa--4f90--8eed--65194a1e79bf "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":1    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  \nsdd                                                                                                     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(":48   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" disk \nâ””â”€ceph--44b0586e--820e--4c51--8301--4b63b6f4b228-osd--block--d8500bfb--2383--4caf--97fb--f39695b1de7d "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("253")]),s._v(":2    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  500G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" lvm  \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸å¼€å¯dashboard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å¼€å¯dashboard"}},[s._v("#")]),s._v(" ğŸ·ï¸å¼€å¯Dashboard")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨Ceph01æ§åˆ¶èŠ‚ç‚¹æ“ä½œ")])])]),s._v(" "),a("p",[s._v("æŸ¥çœ‹Cephç‰ˆæœ¬ï¼Œnautilusç‰ˆåŠä»¥åéœ€è¦åœ¨æ‰€æœ‰è¿è¡Œmgrçš„èŠ‚ç‚¹å®‰è£…ceph-mgr-dashboardã€‚")]),s._v(" "),a("p",[s._v("å¯ç”¨æˆ–ç¦ç”¨MGR dashboardæ¨¡å—ã€‚")]),s._v(" "),a("p",[s._v("åˆ›å»ºè‡ªç­¾åè¯ä¹¦æˆ–è€…ç¦ç”¨sslã€‚")]),s._v(" "),a("p",[s._v("è®¾ç½®MGR dashboardæ¨¡å—çš„ipå’Œport(å¯é€‰)ã€‚")]),s._v(" "),a("p",[s._v("è®¾ç½®ç™»å½•è®¤è¯ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr versions")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module enable dashboard")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module disable dashboard")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard create-self-signed-cert")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/ssl false")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/server_addr 0.0.0.0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph config set mgr mgr/dashboard/server_port 8443")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "000000" > password.txt')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard ac-user-create admin -i password.txt administrator")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph dashboard ac-user-show admin")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart ceph-mgr.target")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ—å‡ºMGRæ¨¡å—æä¾›çš„æœåŠ¡ç«¯ç‚¹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr services")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"dashboard"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://ceph01:8443/"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108555.png",alt:"image-20220306084356040"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108008.png",alt:"image-20220306002122345"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108315.png",alt:"image-20220305215422613"}})]),s._v(" "),a("h3",{attrs:{id:"é›†æˆopenstack"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é›†æˆopenstack"}},[s._v("#")]),s._v(" é›†æˆOpenStack")]),s._v(" "),a("p",[s._v("åœ¨ä¹‹å‰å·²ç»å®‰è£…äº†cephçš„å®¢æˆ·ç«¯ï¼Œä¹Ÿè¦†ç›–ä¼ é€äº†é…ç½®æ–‡ä»¶ï¼Œæ‰€ä»¥å¯ä»¥æŸ¥çœ‹å½“å‰çš„cephé›†ç¾¤çŠ¶æ€ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph -s ")]),s._v("\n  cluster:\n    id:     6fa8bcf8-bb73-48ff-b96d-621298b3be0f\n    health: HEALTH_OK\n \n  services:\n    mon: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" daemons, quorum ceph01,ceph02,ceph03 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("age 60m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    mgr: ceph01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("active, since 51m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", standbys: ceph02, ceph03\n    osd: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" osds: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" up "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 55m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("since 55m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n \n  data:\n    pools:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" pools, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("352")]),s._v(" pgs\n    objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" objects, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" MiB\n    usage:   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.2")]),s._v(" GiB used, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" TiB / "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.4")]),s._v(" TiB avail\n    pgs:     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("352")]),s._v(" active+clean\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸åˆ›å»ºå­˜å‚¨æ± "}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸åˆ›å»ºå­˜å‚¨æ± "}},[s._v("#")]),s._v(" ğŸ·ï¸åˆ›å»ºå­˜å‚¨æ± ")]),s._v(" "),a("p",[s._v("åœ¨ceph01ä¸Šåˆ›å»ºæ‰€éœ€çš„å­˜å‚¨æ± ï¼Œæ ¹æ®å®é™…OSDæ•°é‡ä¿®æ”¹PGæ•°ç›®ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ceph osd pool create volumes 128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ceph osd pool create images 32")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ceph osd pool create backups 32")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  ceph osd pool create vms 128")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph osd pool ls ")]),s._v("\nvolumes\nimages\nbackups\nvms\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸cephåˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸cephåˆ›å»ºç”¨æˆ·å¹¶æˆæƒ"}},[s._v("#")]),s._v(" ğŸ·ï¸cephåˆ›å»ºç”¨æˆ·å¹¶æˆæƒ")]),s._v(" "),a("ol",[a("li",[s._v("åœ¨ceph01ä¸Šä¸ºcinderã€glanceã€cinder-backupç”¨æˆ·åˆ›å»ºå¯†é’¥ï¼Œå…è®¸å…¶è®¿é—®Cephå­˜å‚¨æ± åˆ›å»ºç”¨æˆ·client.cinderï¼Œå¯¹volumeså­˜å‚¨æ± æœ‰rwxæƒé™ï¼Œå¯¹vmså­˜å‚¨æ± æœ‰rwxæƒé™ï¼Œå¯¹imagesæ± æœ‰rxæƒé™ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rwx pool=vms, allow rx pool=images'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("åˆ›å»ºç”¨æˆ· client.glanceï¼Œå¯¹imageså­˜å‚¨æ± æœ‰rwxæƒé™ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.glance mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=images'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("åˆ›å»ºç”¨æˆ·client.cinder-backupï¼Œå¯¹backupså­˜å‚¨æ± æœ‰rwxæƒé™ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder-backup mon 'profile rbd' osd 'profile rbd pool=backups'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("å°†glanceçš„keyring ä¿å­˜åˆ° "),a("strong",[s._v("controller")]),s._v("ï¼ˆglanceæœåŠ¡æ‰€åœ¨èŠ‚ç‚¹ï¼‰ä¸Šã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.glance | ssh controller tee /etc/ceph/ceph.client.glance.keyring")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh controller chown glance:glance /etc/ceph/ceph.client.glance.keyring")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("å°†cinderçš„keyringä¿å­˜åˆ°**ï¼ˆæ§åˆ¶èŠ‚ç‚¹ã€è®¡ç®—èŠ‚ç‚¹ã€å­˜å‚¨èŠ‚ç‚¹æœåŠ¡æ‰€åœ¨èŠ‚ç‚¹ï¼‰**ä¸Šã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder | ssh controller tee /etc/ceph/ceph.client.cinder.keyring ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh controller chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder | ssh compute tee /etc/ceph/ceph.client.cinder.keyring ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh compute chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("å°†cinder-backupçš„keyringä¿å­˜åˆ°ï¼ˆcinder-backupæœåŠ¡æ‰€åœ¨èŠ‚ç‚¹ï¼Œæ­¤å¤„æ˜¯"),a("strong",[s._v("controller/compute")]),s._v("rï¼‰ä¸Šã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder-backup | ssh controller tee /etc/ceph/ceph.client.cinder-backup.keyring ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh controller chown cinder:cinder /etc/ceph/ceph.client.cinder-backup.keyring ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph auth get-or-create client.cinder-backup | ssh compute tee /etc/ceph/ceph.client.cinder-backup.keyring ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ssh compute chown cinder:cinder /etc/ceph/ceph.client.cinder-backup.keyring ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸æ·»åŠ å¯†é’¥åˆ°libvirt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸æ·»åŠ å¯†é’¥åˆ°libvirt"}},[s._v("#")]),s._v(" ğŸ·ï¸æ·»åŠ å¯†é’¥åˆ°libvirt")]),s._v(" "),a("p",[s._v("åœ¨è®¡ç®—èŠ‚ç‚¹**ï¼ˆcomputeï¼‰**ä¸Šå‘ libvirt æ·»åŠ ç§˜é’¥ï¼Œå…ˆåœ¨è®¡ç®—èŠ‚ç‚¹ "),a("strong",[s._v("compute")]),s._v("ä¸Šæ“ä½œï¼Œç”Ÿæˆå¯†é’¥ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  UUID=$(uuidgen)")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cd /etc/ceph")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  cat > secret.xml <<EOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("secret "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ephemeral")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'no'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("private")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'no'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${UUID}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("usage "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("client.cinder secret"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/usage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/secret"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \nEOF\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat secret.xml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("secret "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ephemeral")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'no'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("private")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'no'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("8fc81390-ad91-4814-a35a-e5bf716f053"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v("<")]),s._v("/uuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("usage "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("client.cinder secret"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/usage"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/secret"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("æ·»åŠ å¯†é’¥åˆ° libvirtã€‚")]),s._v(" "),a("blockquote",[a("p",[s._v("è¯´æ˜ï¼šä¿å­˜æ­¤å¤„ç”Ÿæˆçš„ UUID çš„å€¼ï¼Œåé¢ Cinder ä»¥åŠ Nova çš„é…ç½®ä¸­éœ€è¦ç”¨åˆ°ï¼ŒUUID ä¸ºï¼š8fc81390-ad91-4814-a35a-e5bf716f0533 å¦‚æœæ·»åŠ é”™è¯¯ï¼Œéœ€è¦åˆ é™¤ï¼Œåˆ™æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤")]),s._v(" "),a("p",[a("code",[s._v("# virsh secret-undefine 8fc81390-ad91-4814-a35a-e5bf716f0533")]),s._v(" å¦‚æœæ§åˆ¶èŠ‚ç‚¹ä¹Ÿå½“è®¡ç®—ç‚¹ç”¨ï¼Œåˆ™ä¹Ÿè¦æ·»åŠ å¯†é’¥ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh secret-define --file secret.xml")]),s._v("\nSecret 8fc81390-ad91-4814-a35a-e5bf716f0533 created\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh secret-set-value --secret 8fc81390-ad91-4814-a35a-e5bf716f0533  --base64 $(cat /etc/ceph/ceph.client.cinder.keyring | grep key | awk -F ' ' '{ print $3 }')")]),s._v("\nSecret value "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æŸ¥çœ‹æ·»åŠ åçš„å¯†é’¥")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh secret-list ")]),s._v("\n UUID                                  Usage\n--------------------------------------------------------------------------------\n 8fc81390-ad91-4814-a35a-e5bf716f0533  ceph client.cinder secret\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("å†å°†secret.xmlæ‹·è´åˆ°controllerã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp secret.xml controller:/etc/ceph/")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/ceph/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# UUID=8fc81390-ad91-4814-a35a-e5bf716f0533 ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  virsh secret-set-value --secret 8fc81390-ad91-4814-a35a-e5bf716f0533 --base64 $(cat /etc/ceph/ceph.client.cinder.keyring | grep key | awk -F ' ' '{ print $3 }')")]),s._v("\nSecret value "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virsh secret-list ")]),s._v("\n UUID                                  Usage\n--------------------------------------------------------------------------------\n 8fc81390-ad91-4814-a35a-e5bf716f0533  ceph client.cinder secret\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®glanceé›†æˆceph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®glanceé›†æˆceph"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®Glanceé›†æˆCeph")]),s._v(" "),a("p",[s._v("åœ¨æ§åˆ¶èŠ‚ç‚¹**ï¼ˆcontrollerï¼‰**ä¸Šä¿®æ”¹ Glance çš„é…ç½®æ–‡ä»¶ã€‚")]),s._v(" "),a("p",[s._v("é•œåƒå­˜å‚¨åœ¨ ceph ä¸­ä¼šè¢«åˆ†å‰²æˆå¤šä¸ªå¯¹è±¡ï¼Œå•ä¸ªå¯¹è±¡å¤§å°ï¼Œå•ä½æ˜¯ MBï¼Œè¯¥å€¼æœ€å¥½æ˜¯ 2 çš„å¹‚æ¬¡æ–¹ï¼Œé»˜è®¤æ˜¯ 8ï¼Œchunk_size ä¸èƒ½å¤ªå¤§ï¼Œå½“é•œåƒå°äº chunk_size æ—¶ä¼šä¸Šä¼ å¤±è´¥ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/glance/glance-api.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨[DEFAULT]éƒ¨åˆ†æ·»åŠ å¦‚ä¸‹å†…å®¹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nshow_image_direct_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" True\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("glance_store"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#stores = file,http")]),s._v("\ndemo_store "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\nfilesystem_store_datadir "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /var/lib/glance/images/\nstores "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rbd,file,http\ndefault_store "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rbd\nrbd_store_pool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" images\nrbd_store_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" glance\nrbd_store_ceph_conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/ceph.conf\nrbd_store_chunk_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#åœ¨[paste_deploy]éƒ¨åˆ†æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œé¿å… images ç¼“å­˜åˆ°/var/lib/glance/image-cache ç›®å½•ä¸‹")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("paste_deploy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \nflavor "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" keystone\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("åœ¨æ§åˆ¶èŠ‚ç‚¹**ï¼ˆcontrollerï¼‰**é‡å¯ glance-api æœåŠ¡ã€‚")]),s._v(" "),a("p",[s._v("éªŒè¯æ˜¯å¦ä¸Šä¼ æˆåŠŸã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart openstack-glance-api.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openstack image create  cirros --disk-format qcow2 --container-format bare --file cirros-0.3.4-x86_64-disk.img ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openstack image list ")]),s._v("\n+--------------------------------------+-----------+--------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" ID                                   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Name      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Status "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+-----------+--------+\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" 529f252c-f626-4896-a5b2-31b2fec4d335 "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cirros    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" active "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+--------------------------------------+-----------+--------+\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd ls images ")]),s._v("\n529f252c-f626-4896-a5b2-31b2fec4d335\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd info images/529f252c-f626-4896-a5b2-31b2fec4d335")]),s._v("\nrbd image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'529f252c-f626-4896-a5b2-31b2fec4d335'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" MiB "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" objects\n        order "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" MiB objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        id: 5f20a89f374c\n        block_name_prefix: rbd_data.5f20a89f374c\n        format: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten\n        op_features: \n        flags: \n        create_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 00:18:59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        access_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 00:54:17 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        modify_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 00:18:59 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®cinderé›†æˆceph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®cinderé›†æˆceph"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®Cinderé›†æˆCeph")]),s._v(" "),a("p",[s._v("åœ¨ Cinder æ§åˆ¶èŠ‚ç‚¹**ï¼ˆcontrollerï¼‰**ä¸Šï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶/etc/cinder/cinder.conf åœ¨[DEFAULT]éƒ¨åˆ†ï¼Œå°†é»˜è®¤ volume è®¾ç½®ä¸º cephã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/cinder/cinder.conf ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#default_volume_type = hdd ")]),s._v("\ndefault_volume_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ceph\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("ä¿®æ”¹ default_volume_typeä¼šé‡æ–°å¾€ cinder åº“ä¸­ volume_types è¡¨ä¸­å¢åŠ ä¸€æ¡åä¸º ceph çš„è®°å½•åœ¨æ§åˆ¶èŠ‚ç‚¹é‡å¯ cinder-api å’Œ cinder-scheduler æœåŠ¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart openstack-cinder-api.service openstack-cinder-scheduler.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("åœ¨ Cinder å­˜å‚¨èŠ‚ç‚¹**ï¼ˆcomputeï¼‰**ä¸Šï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶/etc/cinder/cinder.confã€‚")]),s._v(" "),a("blockquote",[a("p",[s._v("è¯´æ˜ï¼šæ­¤å¤„ rbd_secret_uuid çš„å€¼å³ä¸ºé…ç½® Ceph ç¯å¢ƒä¿å­˜çš„ UUID å€¼")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/cinder/cinder.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨[DEFAULT]éƒ¨åˆ†ï¼Œæ³¨é‡Šå·²ç»æœ‰çš„ enabled_backends")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#enabled_backends = lvm ")]),s._v("\nenabled_backends "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ceph,lvm\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ–‡ä»¶æœ«å°¾æ·»åŠ [ceph]éƒ¨åˆ†")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ceph"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nvolume_driver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cinder.volume.drivers.rbd.RBDDriver\nvolume_backend_name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ceph\nrbd_pool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" volumes\nrbd_ceph_conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/ceph.conf\nrbd_flatten_volume_from_snapshot "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nrbd_max_clone_depth "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\nrbd_store_chunk_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\nrados_connect_timeout "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" -1\nglance_api_version "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\nrbd_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cinder\nrbd_secret_uuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 8fc81390-ad91-4814-a35a-e5bf716f0533\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart openstack-cinder-volume.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("p",[s._v("éªŒè¯æµ‹è¯•ã€‚ é€šè¿‡åˆ›å»ºå·ç±»å‹ï¼Œæ‰‹åŠ¨æ›´æ–°å…ƒæ•°æ®ï¼Œé»˜è®¤åˆ›å»ºå·å°±æ˜¯Cephç±»å‹ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108217.png",alt:"image-20220305213837675"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108404.png",alt:"image-20220305213945870"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108596.png",alt:"image-20220305214028228"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108606.png",alt:"image-20220305214047958"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111108165.png",alt:"image-20220305214210760"}})]),s._v(" "),a("p",[s._v("é€šè¿‡rbdæŸ¥çœ‹volumesæ˜¯å¦è¢«ä½¿ç”¨ï¼Œå½“ç„¶ï¼Œvolumeåˆ›å»ºå·²ç»é»˜è®¤æ˜¯cephçš„å­˜å‚¨æ± äº†ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd ls volumes")]),s._v("\nvolume-2273953c-9f4d-450b-b8ee-6aeaac473923\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd info volumes/volume-2273953c-9f4d-450b-b8ee-6aeaac473923")]),s._v("\nrbd image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'volume-2273953c-9f4d-450b-b8ee-6aeaac473923'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" GiB "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v(" objects\n        order "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MiB objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        id: 5b34e5750378\n        block_name_prefix: rbd_data.5b34e5750378\n        format: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten\n        op_features: \n        flags: \n        create_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 05:41:55 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        access_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 05:41:55 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        modify_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 05:41:55 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®cinder-backupé›†æˆceph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®cinder-backupé›†æˆceph"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®Cinder_backupé›†æˆCeph")]),s._v(" "),a("p",[s._v("cinder-backup ç”¨äºå°†å·ï¼ˆvolumeï¼‰å¤‡ä»½åˆ°å…¶ä»–å­˜å‚¨ç³»ç»Ÿä¸Šï¼Œç›®å‰æ”¯æŒçš„å¤‡ä»½å­˜å‚¨ç³»ç»Ÿæœ‰ swiftã€ceph ä»¥åŠ IBM Tivoli Storage Manager(TSM)ï¼Œé»˜è®¤ä¸º Swiftï¼Œä½†éœ€è¦é…ç½® swift ç»„ä»¶ã€‚")]),s._v(" "),a("p",[s._v("åœ¨å­˜å‚¨èŠ‚ç‚¹(compute01ã€compute02ï¼‰ä¸Šä¿®æ”¹é…ç½®æ–‡ä»¶/etc/cinder/cinder.conf")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/cinder/cinder.conf   ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨[DEFAULT]éƒ¨åˆ†ï¼Œå¢åŠ å¦‚ä¸‹å†…å®¹")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbackup_driver "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cinder.backup.drivers.ceph.CephBackupDriver \nbackup_ceph_conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/ceph.conf \nbackup_ceph_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cinder-backup \nbackup_ceph_chunk_size "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4194304")]),s._v(" \nbackup_ceph_pool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" backups \nbackup_ceph_stripe_unit "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" \nbackup_ceph_stripe_count "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nrestore_discard_excess_bytes "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("åœ¨ré…ç½®å‚æ•°back_driveræ—¶éœ€è¦æ³¨é‡Šæ‰å…¶ä»– backup_driver çš„é…ç½®ã€‚å¦å¤–ï¼Œåœ¨controllerçš„dashboard é…ç½®ï¼ˆ/etc/openstack-dashboard/local_settingsï¼‰ä¸­çš„ OPENSTACK_CINDER_FEATURES ä¸­å¢åŠ å¦‚ä¸‹é…ç½®ã€‚")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# vi /etc/openstack-dashboard/local_settings \nOPENSTACK_CINDER_FEATURES = "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n'enable_backup'"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" True"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("é‡å¯Cinder backupå’ŒhttpdæœåŠ¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable openstack-cinder-backup.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@compute ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart openstack-cinder-backup.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart httpd ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®novaé›†æˆceph"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®novaé›†æˆceph"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®Novaé›†æˆCeph")]),s._v(" "),a("p",[s._v("åœ¨ Nova è®¡ç®—èŠ‚ç‚¹ï¼ˆcontroller/computeï¼‰ä¸Šï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶/etc/nova/nova.conf vim /etc/nova/nova.confã€‚")]),s._v(" "),a("blockquote",[a("p",[s._v("è¯´æ˜ï¼šnova é›†æˆ cephï¼Œå…è®¸ä» ceph å·ä¸Šå¯åŠ¨å®ä¾‹ã€‚å½“ cinder æŒ‚è½½æˆ–è€…å¸è½½å—è®¾å¤‡æ—¶ï¼Œlibvirt è¿›ç¨‹éœ€è¦æœ‰è®¿é—® ceph é›†ç¾¤çš„æƒé™ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/nova/nova.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("DEFAULT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ”¯æŒçƒ­è¿ç§»")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("live_migration_flag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_PERSIST_DEST,VIR_MIGRA TE_TUNNELLED"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ”¯æŒè‡ªåŠ¨ä¼¸ç¼©")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("resize_confirm_window")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allow_resize_to_same_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("allow_migrate_to_same_host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("libvirt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# virt_type = qemu ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("inject_partition")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-2 \nvirt_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" kvm \nimages_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" rbd \nimages_rbd_pool "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" vms \nimages_rbd_ceph_conf "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" /etc/ceph/ceph.conf \n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("disk_cachemodes")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"network=writeback"')]),s._v(" \nrbd_user "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" cinder\nrbd_secret_uuid "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" 8fc81390-ad91-4814-a35a-e5bf716f0533\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("p",[s._v("åœ¨ Nova è®¡ç®—èŠ‚ç‚¹ï¼ˆcontroller/computerï¼‰ä¸Šï¼Œé‡å¯ nova-compute æœåŠ¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart openstack-nova-compute.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("éªŒè¯æµ‹è¯•ï¼Œé€šè¿‡åˆ›å»ºäº‘ä¸»æœºæŸ¥çœ‹vmsæ˜¯å¦æœ‰èµ„æºã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rbd ls vms")]),s._v("\n f6c5f9d2-0853-4cf9-8141-6ae80ed73513_disk\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@controller ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  rbd info vms/f6c5f9d2-0853-4cf9-8141-6ae80ed73513_disk")]),s._v("\nrbd image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'f6c5f9d2-0853-4cf9-8141-6ae80ed73513_disk'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n        size "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" GiB "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10240")]),s._v(" objects\n        order "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MiB objects"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        snapshot_count: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        id: 45cf504b77fd\n        block_name_prefix: rbd_data.45cf504b77fd\n        format: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n        features: layering, exclusive-lock, object-map, fast-diff, deep-flatten\n        op_features: \n        flags: \n        create_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 03:30:21 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        access_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 05:21:14 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n        modify_timestamp: Sun Mar  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" 05:22:26 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("å½“å‰çš„Cephé›†ç¾¤è¯»å†™ç¨³å®šã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109238.png",alt:"image-20220305215703048"}})]),s._v(" "),a("h3",{attrs:{id:"prometheusç›‘æ§cephé›†ç¾¤"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheusç›‘æ§cephé›†ç¾¤"}},[s._v("#")]),s._v(" Prometheusç›‘æ§Cephé›†ç¾¤")]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸å®‰è£…grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å®‰è£…grafana"}},[s._v("#")]),s._v(" ğŸ·ï¸å®‰è£…grafana")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y grafana ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y  ntp ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntpdate ntp.aliyun.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start  grafana-server ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable   grafana-server      ")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/grafana-server.service to /usr/lib/systemd/system/grafana-server.service.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[s._v("è®¿é—®http://172.25.254.130:3000   (é»˜è®¤ç”¨æˆ·adminå¯†ç admin)")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109752.png",alt:"image-20220306094104974"}})]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸å®‰è£…prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸å®‰è£…prometheus"}},[s._v("#")]),s._v(" ğŸ·ï¸å®‰è£…prometheus")]),s._v(" "),a("p",[s._v("ä½¿ç”¨Prometheusç¦»çº¿åŒ…ï¼Œé…ç½®systemdæœåŠ¡å¯åŠ¨ã€‚")]),s._v(" "),a("p",[s._v("å¯åŠ¨æœåŠ¡å’Œæ·»åŠ å¼€æœºè‡ªå¯åŠ¨ã€‚")]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("--config.file")]),s._v(" \t\t\t\t\t   -- æŒ‡æ˜prometheusçš„é…ç½®æ–‡ä»¶è·¯å¾„")]),s._v(" "),a("p",[a("code",[s._v("--web.enable-lifecycle")]),s._v("      -- æŒ‡æ˜prometheusé…ç½®æ›´æ”¹åå¯ä»¥è¿›è¡Œçƒ­åŠ è½½")]),s._v(" "),a("p",[a("code",[s._v("--storage.tsdb.path")]),s._v("           -- æŒ‡æ˜ç›‘æ§æ•°æ®å­˜å‚¨è·¯å¾„")]),s._v(" "),a("p",[a("code",[s._v("--storage.tsdb.retention")]),s._v("   --æŒ‡æ˜æ•°æ®ä¿ç•™æ—¶é—´")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar zxvf prometheus-2.29.1.linux-amd64.tar.gz ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv prometheus-2.29.1.linux-amd64 /opt/prometheus")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /opt/prometheus/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./prometheus --version ")]),s._v("\nprometheus, version "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.29")]),s._v(".1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("branch: HEAD, revision: dcb07e8eac34b5ea37cd229545000b857f1c1637"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  build user:       root@364730518a4e\n  build date:       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20210811")]),s._v("-14:48:27\n  go version:       go1.16.7\n  platform:         linux/amd64\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/prometheus.service ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Prometheus\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Prometheus\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/prometheus/prometheus "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --config.file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/prometheus/prometheus.yml "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":9090\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start prometheus   ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable prometheus      ")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/prometheus.service to /usr/lib/systemd/system/prometheus.service.\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("p",[s._v("é€šè¿‡http://172.25.254.130:9090å¯ä»¥è®¿é—®ã€‚")]),s._v(" "),a("p",[s._v("é€šè¿‡è®¿é—®Statusä¸‹é¢çš„Targetå¯ä»¥çœ‹åˆ°å½“å‰çš„æ ‡ç­¾ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109229.png",alt:"image-20220306110437873"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109917.png",alt:"image-20220306095400831"}})]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸cephå¼€å¯prometheusæ’ä»¶é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸cephå¼€å¯prometheusæ’ä»¶é…ç½®"}},[s._v("#")]),s._v(" ğŸ·ï¸cephå¼€å¯prometheusæ’ä»¶é…ç½®")]),s._v(" "),a("blockquote",[a("p",[a("strong",[s._v("åœ¨cephnode01ä¸Šé…ç½®")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ceph mgr module enable prometheus ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntpl | grep 9283")]),s._v("\nLISTEN     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":9283                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":*                   users:"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("((")]),s._v('"ceph'),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v('mgr"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("pid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5243")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("fd"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("ä»¥ä¸‹éƒ½æ˜¯å±äºCephé›†ç¾¤çš„ç›‘æ§æŒ‡æ ‡ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109480.png",alt:"image-20220306095631900"}})]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®prometheus"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®prometheus")]),s._v(" "),a("p",[s._v("åœ¨ scrape_configs: é…ç½®é¡¹ä¸‹æ·»åŠ ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("scrape_configs:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n      \n      \n----------------------------------------------------\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åœ¨è¿™æœ«å°¾æ·»åŠ å¦‚ä¸‹é…ç½®,æ¯ä¸ªJobå¿…é¡»è¦åˆ†å¼€å†™ã€‚ ")]),s._v("\n\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ceph_cluster'")]),s._v("        \n    honor_labels: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    scrape_interval: 5s\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'172.25.254.130:9283'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        labels:\n          instance: ceph       \n          \n          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ceph01 prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart prometheus")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("å›å»æŸ¥çœ‹å½“å‰çš„Targetå·²ç»åˆ·æ–°äº†ï¼ŒCephé›†ç¾¤çš„ç›‘æ§æŒ‡æ ‡å·²ç»æ”¶é›†å®Œæˆã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109526.png",alt:"image-20220306100007678"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109744.png",alt:"image-20220306110412319"}})]),s._v(" "),a("h5",{attrs:{id:"ğŸ·ï¸é…ç½®grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ğŸ·ï¸é…ç½®grafana"}},[s._v("#")]),s._v(" ğŸ·ï¸é…ç½®grafana")]),s._v(" "),a("p",[s._v("æµè§ˆå™¨ç™»å½• grafana ç®¡ç†ç•Œé¢ï¼Œhttp://172.25.254.130:3000/")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109931.png",alt:"image-20220306100335172"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109290.png",alt:"image-20220306100420445"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111112536.png",alt:"image-20220306100505907"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109791.png",alt:"image-20220306101005324"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109104.png",alt:"image-20220306101207836"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111109978.png",alt:"image-20220306110621651"}})])])}),[],!1,null,null,null);t.default=n.exports}}]);