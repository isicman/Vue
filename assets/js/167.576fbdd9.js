(window.webpackJsonp=window.webpackJsonp||[]).push([[167],{647:function(s,t,a){"use strict";a.r(t);var n=a(19),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´"}},[s._v("#")]),s._v(" æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´")]),s._v(" "),a("h3",{attrs:{id:"ä¸»è¦å†…å®¹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»è¦å†…å®¹"}},[s._v("#")]),s._v(" ä¸»è¦å†…å®¹")]),s._v(" "),a("p",[s._v("â– Podå®‰å…¨ä¸Šä¸‹æ–‡")]),s._v(" "),a("p",[s._v("â– Podå®‰å…¨ç­–ç•¥")]),s._v(" "),a("p",[s._v("â– Secretå­˜å‚¨æ•æ„Ÿæ•°æ®")]),s._v(" "),a("p",[s._v("â– å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨")]),s._v(" "),a("h3",{attrs:{id:"podå®‰å…¨ä¸Šä¸‹æ–‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ä¸Šä¸‹æ–‡"}},[s._v("#")]),s._v(" Podå®‰å…¨ä¸Šä¸‹æ–‡")]),s._v(" "),a("p",[a("code",[s._v("å®‰å…¨ä¸Šä¸‹æ–‡ï¼ˆSecurity Contextï¼‰")]),s._v("ï¼šK8så¯¹Podå’Œå®¹å™¨æä¾›çš„å®‰å…¨æœºåˆ¶ï¼Œå¯ä»¥è®¾ç½®Podç‰¹æƒå’Œè®¿é—®æ§åˆ¶ã€‚")]),s._v(" "),a("p",[a("strong",[s._v("å®‰å…¨ä¸Šä¸‹æ–‡é™åˆ¶ç»´åº¦ï¼š")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("è‡ªä¸»è®¿é—®æ§åˆ¶ï¼ˆDiscretionary Access Controlï¼‰")]),s._v("ï¼šåŸºäºç”¨æˆ·IDï¼ˆUIDï¼‰å’Œç»„IDï¼ˆGIDï¼‰ï¼Œæ¥åˆ¤å®šå¯¹å¯¹è±¡ï¼ˆä¾‹å¦‚æ–‡ä»¶ï¼‰ çš„è®¿é—®æƒé™ã€‚")]),s._v(" "),a("li",[a("code",[s._v("å®‰å…¨æ€§å¢å¼ºçš„ Linuxï¼ˆSELinuxï¼‰")]),s._v("ï¼š ä¸ºå¯¹è±¡èµ‹äºˆå®‰å…¨æ€§æ ‡ç­¾ã€‚")]),s._v(" "),a("li",[s._v("ä»¥"),a("code",[s._v("ç‰¹æƒæ¨¡å¼")]),s._v("æˆ–è€…éç‰¹æƒæ¨¡å¼è¿è¡Œã€‚")]),s._v(" "),a("li",[a("code",[s._v("Linux Capabilities")]),s._v(": ä¸ºè¿›ç¨‹èµ‹äºˆ root ç”¨æˆ·çš„éƒ¨åˆ†ç‰¹æƒè€Œéå…¨éƒ¨ç‰¹æƒã€‚")]),s._v(" "),a("li",[a("code",[s._v("AppArmor")]),s._v("ï¼šå®šä¹‰Podä½¿ç”¨AppArmoré™åˆ¶å®¹å™¨å¯¹èµ„æºè®¿é—®é™åˆ¶")]),s._v(" "),a("li",[a("code",[s._v("Seccomp")]),s._v("ï¼šå®šä¹‰Podä½¿ç”¨Seccompé™åˆ¶å®¹å™¨è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨")]),s._v(" "),a("li",[a("code",[s._v("AllowPrivilegeEscalation")]),s._v("ï¼š ç¦æ­¢å®¹å™¨ä¸­è¿›ç¨‹ï¼ˆé€šè¿‡ SetUID æˆ– SetGID æ–‡ä»¶æ¨¡å¼ï¼‰è·å¾—ç‰¹æƒæå‡ã€‚å½“å®¹å™¨ä»¥ç‰¹æƒæ¨¡å¼ è¿è¡Œæˆ–è€…å…·æœ‰CAP_SYS_ADMINèƒ½åŠ›æ—¶ï¼ŒAllowPrivilegeEscalationæ€»ä¸ºTrueã€‚")]),s._v(" "),a("li",[a("code",[s._v("readOnlyRootFilesystem")]),s._v("ï¼šä»¥åªè¯»æ–¹å¼åŠ è½½å®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚")])]),s._v(" "),a("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å®æ–½")]),s._v(" "),a("h5",{attrs:{id:"æ¡ˆä¾‹1-è®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹1-è®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ"}},[s._v("#")]),s._v(" æ¡ˆä¾‹1ï¼šè®¾ç½®å®¹å™¨ä»¥æ™®é€šç”¨æˆ·è¿è¡Œ")]),s._v(" "),a("p",[s._v("èƒŒæ™¯ï¼šå®¹å™¨ä¸­çš„åº”ç”¨ç¨‹åºé»˜è®¤ä»¥rootè´¦å·è¿è¡Œçš„ï¼Œè¿™ä¸ªrootä¸å®¿ä¸»æœºrootè´¦å·æ˜¯ç›¸åŒçš„ï¼Œ æ‹¥æœ‰å¤§éƒ¨åˆ†å¯¹Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨æƒé™ï¼Œè¿™æ ·æ˜¯ä¸å®‰å…¨çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åº”è¯¥å°†å®¹å™¨ä»¥æ™® é€šç”¨æˆ·è¿è¡Œï¼Œå‡å°‘åº”ç”¨ç¨‹åºå¯¹æƒé™çš„ä½¿ç”¨ã€‚")]),s._v(" "),a("p",[s._v("å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹æ³•è®¾ç½®æ™®é€šç”¨æˆ·ï¼š")]),s._v(" "),a("ol",[a("li",[s._v("Dockerfileé‡Œä½¿ç”¨USERæŒ‡å®šè¿è¡Œç”¨æˆ·")]),s._v(" "),a("li",[s._v("K8sé‡ŒæŒ‡å®šspec.securityContext.runAsUserï¼ŒæŒ‡å®šå®¹å™¨é»˜è®¤ç”¨æˆ·UID")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runAsUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" \t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# é•œåƒé‡Œå¿…é¡»æœ‰è¿™ä¸ªç”¨æˆ·UID")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v(" \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ•°æ®å·æŒ‚è½½åçš„ç›®å½•å±ç»„è®¾ç½®ä¸ºè¯¥ç»„")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lizhenliang/flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowPrivilegeEscalation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸å…è®¸ææƒ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("åˆ›å»ºPodä½¿ç”¨å®‰å…¨ä¸Šä¸‹æ–‡æµ‹è¯•æ˜¯å¦æ”¹ä¸ºuuidè¿è¡Œå®¹å™¨:")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat pod-test.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runAsUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lizhenliang/flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("root\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allowPrivilegeEscalation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("æ‰§è¡Œyamlä¹‹åè¿›å…¥å®¹å™¨æŸ¥çœ‹å½“å‰çš„uuidï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it test -- bash")]),s._v("\npython@test:/data/www$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("gid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("groups")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("python"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"æ¡ˆä¾‹2-é¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹2-é¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨"}},[s._v("#")]),s._v(" æ¡ˆä¾‹2ï¼šé¿å…ä½¿ç”¨ç‰¹æƒå®¹å™¨")]),s._v(" "),a("p",[s._v("èƒŒæ™¯ï¼šå®¹å™¨ä¸­æœ‰äº›åº”ç”¨ç¨‹åºå¯èƒ½éœ€è¦è®¿é—®å®¿ä¸»æœºè®¾å¤‡ã€ä¿®æ”¹å†…æ ¸ç­‰éœ€æ±‚ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ å®¹å™¨æ²¡è¿™ä¸ªæœ‰è¿™ä¸ªèƒ½åŠ›ï¼Œå› æ­¤è¿™æ—¶ä¼šè€ƒè™‘ç»™å®¹å™¨è®¾ç½®ç‰¹æƒæ¨¡å¼ã€‚")]),s._v(" "),a("p",[s._v("å¯ç”¨ç‰¹æƒæ¨¡å¼ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lizhenliang/flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("demo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("root\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" web\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" true / false \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("å¯ç”¨ç‰¹æƒæ¨¡å¼å°±æ„å‘³ç€ï¼Œä½ è¦ä¸ºå®¹å™¨æä¾›äº†è®¿é—®Linuxå†…æ ¸çš„æ‰€æœ‰èƒ½åŠ›ï¼Œè¿™æ˜¯å¾ˆå±é™©çš„ï¼Œ ä¸ºäº†å‡å°‘ç³»ç»Ÿè°ƒç”¨çš„ä¾›ç»™ï¼Œå¯ä»¥ä½¿ç”¨Capabilitiesä¸ºå®¹å™¨èµ‹äºˆä»…æ‰€éœ€çš„èƒ½åŠ›ã€‚")])]),s._v(" "),a("p",[a("code",[s._v("Linux Capabilitiesï¼šCapabilities æ˜¯ä¸€ä¸ªå†…æ ¸çº§åˆ«çš„æƒé™")]),s._v("ï¼Œå®ƒå…è®¸å¯¹å†…æ ¸è°ƒç”¨æƒ é™è¿›è¡Œæ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè€Œä¸æ˜¯ç®€å•åœ°ä»¥ root èº«ä»½èƒ½åŠ›æˆæƒã€‚ Capabilities åŒ…æ‹¬æ›´æ”¹æ–‡ä»¶æƒé™ã€æ§åˆ¶ç½‘ç»œå­ç³»ç»Ÿå’Œæ‰§è¡Œç³»ç»Ÿç®¡ç†ç­‰åŠŸèƒ½ã€‚åœ¨ securityContext ä¸­ï¼Œå¯ä»¥æ·»åŠ æˆ–åˆ é™¤ Capabilitiesï¼Œåšåˆ°å®¹å™¨ç²¾ç»†åŒ–æƒé™æ§åˆ¶ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141224069.png",alt:"image-20220413084355164"}})]),s._v(" "),a("h5",{attrs:{id:"æ¡ˆä¾‹3-å–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹3-å–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ"}},[s._v("#")]),s._v(" æ¡ˆä¾‹3ï¼šå–æ¶ˆæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿ")]),s._v(" "),a("p",[s._v("å®¹å™¨é»˜è®¤æ²¡æœ‰æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿèƒ½åŠ›ï¼Œæ·»åŠ SYS_ADMINå¢åŠ è¿™ä¸ªèƒ½åŠ›")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox \n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sleep\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 24h\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capabilities")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SYS_ADMIN"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[s._v("åˆ›å»ºè¿›å…¥å®¹å™¨æµ‹è¯•æŒ‚è½½æƒé™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it  busybox -- sh")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount /data/ /tmp/")]),s._v("\nmount: mounting /data/ on /tmp/ failed: Permission denied\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h5",{attrs:{id:"æ¡ˆä¾‹4-åªè¯»æŒ‚è½½æƒé™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹4-åªè¯»æŒ‚è½½æƒé™"}},[s._v("#")]),s._v(" æ¡ˆä¾‹4ï¼šåªè¯»æŒ‚è½½æƒé™")]),s._v(" "),a("p",[s._v("åªè¯»æŒ‚è½½å®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼Œé˜²æ­¢æ¶æ„äºŒè¿›åˆ¶æ–‡ä»¶åˆ›å»º")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" busybox\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" sleep\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 24h\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("readOnlyRootFilesystem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("åˆ›å»ºè¿›å…¥å®¹å™¨æµ‹è¯•æ–‡ä»¶æƒé™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it  busybox  -- sh")]),s._v("\n/ "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir a")]),s._v("\nmkdir: can"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'t create directory '")]),s._v("a': Read-only "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" system\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h3",{attrs:{id:"podå®‰å…¨ç­–ç•¥-psp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ç­–ç•¥-psp"}},[s._v("#")]),s._v(" Podå®‰å…¨ç­–ç•¥ï¼ˆPSPï¼‰")]),s._v(" "),a("p",[a("code",[s._v("PodSecurityPolicyï¼ˆç®€ç§°PSPï¼‰")]),s._v("ï¼šKubernetesä¸­Podéƒ¨ç½²æ—¶é‡è¦çš„å®‰å…¨æ ¡éªŒæ‰‹æ®µï¼Œèƒ½å¤Ÿ æœ‰æ•ˆåœ°çº¦æŸåº”ç”¨è¿è¡Œæ—¶è¡Œä¸ºå®‰å…¨ã€‚ ä½¿ç”¨PSPå¯¹è±¡å®šä¹‰ä¸€ç»„Podåœ¨è¿è¡Œæ—¶å¿…é¡»éµå¾ªçš„æ¡ä»¶åŠç›¸å…³å­—æ®µçš„é»˜è®¤å€¼ï¼Œåªæœ‰Podæ»¡è¶³è¿™ äº›æ¡ä»¶æ‰ä¼šè¢«K8sæ¥å—ã€‚")]),s._v(" "),a("h4",{attrs:{id:"podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦"}},[s._v("#")]),s._v(" Podå®‰å…¨ç­–ç•¥é™åˆ¶ç»´åº¦")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141224517.png",alt:"image-20220413100840633"}})]),s._v(" "),a("h4",{attrs:{id:"å¯ç”¨å‡†å…¥æ§åˆ¶å™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯ç”¨å‡†å…¥æ§åˆ¶å™¨"}},[s._v("#")]),s._v(" å¯ç”¨å‡†å…¥æ§åˆ¶å™¨")]),s._v(" "),a("p",[s._v("Podå®‰å…¨ç­–ç•¥å®ç°ä¸ºä¸€ä¸ªå‡†å…¥æ§åˆ¶å™¨ï¼Œé»˜è®¤æ²¡æœ‰å¯ç”¨ï¼Œå½“å¯ç”¨åä¼šå¼ºåˆ¶å®æ–½ Podå®‰å…¨ç­–ç•¥ï¼Œæ²¡æœ‰æ»¡è¶³çš„Podå°†æ— æ³•åˆ›å»ºã€‚å› æ­¤ï¼Œå»ºè®®åœ¨å¯ç”¨PSPä¹‹å‰å…ˆæ·»åŠ  ç­–ç•¥å¹¶å¯¹å…¶æˆæƒã€‚")]),s._v(" "),a("p",[s._v("å¯ç”¨Podå®‰å…¨ç­–ç•¥ï¼š")]),s._v(" "),a("blockquote",[a("p",[s._v("vi /etc/kubernetes/manifests/kube-apiserver.yaml\n...\n--enable-admission-plugins=NodeRestriction,PodSecurityPolicy\n...\nsystemctl restart kubelet")])]),s._v(" "),a("h4",{attrs:{id:"å¦‚ä½•ä½¿ç”¨pspèµ„æº"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¦‚ä½•ä½¿ç”¨pspèµ„æº"}},[s._v("#")]),s._v(" å¦‚ä½•ä½¿ç”¨PSPèµ„æº")]),s._v(" "),a("p",[s._v("ç”¨æˆ·ä½¿ç”¨SA ï¼ˆServiceAccountï¼‰åˆ›å»ºäº†ä¸€ä¸ªPodï¼Œ"),a("code",[s._v("K8sä¼šå…ˆéªŒè¯è¿™ä¸ªSAæ˜¯å¦ å¯ä»¥è®¿é—®PSPèµ„æºæƒé™")]),s._v("ï¼Œå¦‚æœå¯ä»¥è¿›ä¸€æ­¥éªŒè¯Podé…ç½®æ˜¯å¦æ»¡è¶³PSPè§„åˆ™ï¼Œä»» æ„ä¸€æ­¥ä¸æ»¡è¶³éƒ½ä¼šæ‹’ç»éƒ¨ç½²ã€‚")]),s._v(" "),a("p",[s._v("å› æ­¤ï¼Œéœ€è¦å®æ–½éœ€è¦æœ‰è¿™å‡ ç‚¹ï¼š")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºSAæœåŠ¡è´¦å·")]),s._v(" "),a("li",[s._v("è¯¥SAéœ€è¦å…·å¤‡åˆ›å»ºå¯¹åº”èµ„æºæƒé™ï¼Œä¾‹å¦‚åˆ›å»ºPodã€Deployment")]),s._v(" "),a("li",[s._v("SAä½¿ç”¨PSPèµ„æºæƒé™ï¼šåˆ›å»ºRoleï¼Œä½¿ç”¨PSPèµ„æºæƒé™ï¼Œå†å°†SAç»‘å®šRole")])]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141224319.png",alt:"image-20220413102111236"}}),s._v(" "),a("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-2"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å®æ–½")]),s._v(" "),a("h5",{attrs:{id:"ç¤ºä¾‹1-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹1-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„pod"}},[s._v("#")]),s._v(" ç¤ºä¾‹1ï¼šç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼çš„Pod")]),s._v(" "),a("p",[s._v("åˆ›å»ºPodå®‰å…¨ç­–ç•¥èµ„æºå¦‚ä¸‹ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("ä¸å…è®¸ç‰¹æƒPod")]),s._v(" "),a("li",[s._v("è¿è¡ŒseLinuxçš„è§„åˆ™")]),s._v(" "),a("li",[s._v("æŒ‡å®šå®¹å™¨å¯åŠ¨çš„ç”¨æˆ·IDå’Œä¸»ç»„IDä½ä»»ä½•äººæˆ–è€…ç¦æ­¢æ²¡æŒ‡å®šæ™®é€šç”¨æˆ·è¿è¡Œçš„å®¹å™¨ï¼ˆrunAsUserï¼‰")]),s._v(" "),a("li",[s._v("å…è®¸ä½¿ç”¨æŒ‚è½½ç±»å‹æ•°æ®å·")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat psp.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" policy/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PodSecurityPolicy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" psp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("example\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸å…è®¸ç‰¹æƒPod")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¸‹é¢æ˜¯ä¸€äº›å¿…è¦çš„å­—æ®µ")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("seLinux")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("supplementalGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runAsUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny   /  MustRunAsNonRoot\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fsGroup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RunAsAny\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'*'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("æ‰§è¡Œä¹‹åæŸ¥çœ‹å½“å‰çš„PSPèµ„æºæƒ…å†µï¼š")]),s._v(" "),a("p",[s._v("åœ¨åç»­çš„1.25ä¹‹åçš„ç‰ˆæœ¬é‡Œé¢ï¼Œå°†ä¼šå®Œå…¨åºŸå¼ƒPodå®‰å…¨ç­–ç•¥ï¼Œé‡‡ç”¨å®‰å…¨ä¸Šä¸‹æ–‡ çš„æ–¹å¼ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f psp.yaml")]),s._v("\nWarning: policy/v1beta1 PodSecurityPolicy is deprecated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.21+, unavailable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.25+\npodsecuritypolicy.policy/psp-example created\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get psp")]),s._v("\nWarning: policy/v1beta1 PodSecurityPolicy is deprecated "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.21+, unavailable "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" v1.25+\nNAME          PRIV    CAPS   SELINUX    RUNASUSER   FSGROUP    SUPGROUP   READONLYROOTFS   VOLUMES\npsp-example   "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("          RunAsAny   RunAsAny    RunAsAny   RunAsAny   "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("            *\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h5",{attrs:{id:"ç¤ºä¾‹2-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹2-ç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹"}},[s._v("#")]),s._v(" ç¤ºä¾‹2ï¼šç¦æ­¢åˆ›å»ºç‰¹æƒæ¨¡å¼æµç¨‹")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºSA")]),s._v("\n$ kubectl create serviceaccount aliang\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å°†SAç»‘å®šåˆ°ç³»ç»Ÿå†…ç½®Role")]),s._v("\n$ kubectl create rolebinding aliang --clusterrole"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("edit --serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default:aliang\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºä½¿ç”¨PSPæƒé™çš„Role")]),s._v("\n$ kubectl create role psp:unprivileged --verb"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("use --resource"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("podsecuritypolicy --resource-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("psp-example\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å°†SAç»‘å®šåˆ°Role")]),s._v("\n$ kubectl create rolebinding aliang:psp:unprivileged --role"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("psp:unprivileged --serviceaccount"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("default:aliang\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åˆ›å»ºpodæµ‹è¯•")]),s._v("\n$ kubectl --as"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("system:serviceaccount:default:psp-sa run nginx --image"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"opa-gatekeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opa-gatekeeper"}},[s._v("#")]),s._v(" OPA Gatekeeper")]),s._v(" "),a("h4",{attrs:{id:"opaä»‹ç»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opaä»‹ç»"}},[s._v("#")]),s._v(" OPAä»‹ç»")]),s._v(" "),a("p",[s._v("PSPä¸è¶³ä¸çŠ¶å†µï¼š")]),s._v(" "),a("ul",[a("li",[s._v("å°†å†1.21ç‰ˆæœ¬å¼ƒç”¨PSPï¼Œåœ¨1.25ç‰ˆæœ¬åˆ é™¤PSP")]),s._v(" "),a("li",[s._v("ä»…æ”¯æŒPodç­–ç•¥")]),s._v(" "),a("li",[s._v("ä½¿ç”¨å¤æ‚ï¼Œæƒé™æ¨¡å‹å­˜åœ¨ç¼ºé™·ï¼Œæ§åˆ¶ä¸æ˜ç¡®")])]),s._v(" "),a("p",[s._v("ğŸ·ï¸"),a("a",{attrs:{href:"https://kubernetes.io/blog/2021/04/06/podsecuritypolicy-deprecation-past-present-and-future/",target:"_blank",rel:"noopener noreferrer"}},[s._v("å¼ƒç”¨æ–‡ç« "),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("ğŸ·ï¸"),a("a",{attrs:{href:"https://github.com/kubernetes/enhancements/issues/2579",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ›¿ä»£ææ¡ˆ"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("code",[s._v("OPAï¼ˆOpen Policy Agentï¼‰")]),s._v("ï¼šæ˜¯ä¸€ä¸ªå¼€æºçš„ã€é€šç”¨ç­–ç•¥å¼•æ“ï¼Œå¯ä»¥å°†ç­–ç•¥ç¼–å†™ä¸ºä»£ç ã€‚æä¾› ä¸€ä¸ªç§é«˜çº§å£°æ˜æ€§è¯­è¨€-Regoæ¥ç¼–å†™ç­–ç•¥ï¼Œå¹¶æŠŠå†³ç­–è¿™ä¸€æ­¥éª¤ä»å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ä¸­è§£è€¦å‡ºæ¥ã€‚")]),s._v(" "),a("p",[s._v("OPAå¯ä»¥ç”¨æ¥åšä»€ä¹ˆï¼Ÿ")]),s._v(" "),a("ol",[a("li",[s._v("æ‹’ç»ä¸ç¬¦åˆæ¡ä»¶çš„YAMLéƒ¨ç½²")]),s._v(" "),a("li",[s._v("å…è®¸ä½¿ç”¨å“ªäº›ä»“åº“ä¸­çš„é•œåƒ")]),s._v(" "),a("li",[s._v("å…è®¸åœ¨å“ªä¸ªæ—¶é—´æ®µè®¿é—®ç³»ç»Ÿ")]),s._v(" "),a("li",[s._v("ç­‰...")])]),s._v(" "),a("h4",{attrs:{id:"opaå·¥ä½œæµç¨‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opaå·¥ä½œæµç¨‹"}},[s._v("#")]),s._v(" OPAå·¥ä½œæµç¨‹")]),s._v(" "),a("p",[s._v("Gatekeeper æ˜¯åŸºäº OPAçš„ä¸€ä¸ª Kubernetes ç­–ç•¥è§£å†³æ–¹æ¡ˆï¼Œå¯æ›¿ä»£PSPæˆ–è€…éƒ¨åˆ†RBACåŠŸèƒ½ã€‚")]),s._v(" "),a("p",[s._v("å½“åœ¨é›†ç¾¤ä¸­éƒ¨ç½²äº†Gatekeeperç»„ä»¶ï¼ŒAPIServeræ‰€æœ‰çš„åˆ›å»ºã€æ›´æ–°æˆ–è€…åˆ é™¤æ“ä½œéƒ½ä¼šè§¦å‘ Gatekeeperæ¥å¤„ç†ï¼Œå¦‚æœä¸æ»¡è¶³ç­–ç•¥åˆ™æ‹’ç»ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141223253.png",alt:"image-20220413133253793"}})]),s._v(" "),a("h4",{attrs:{id:"éƒ¨ç½²opa-gatekeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²opa-gatekeeper"}},[s._v("#")]),s._v(" éƒ¨ç½²OPA Gatekeeper")]),s._v(" "),a("p",[s._v("Gatekeeperçš„ç­–ç•¥ç”±ä¸¤ä¸ªèµ„æºå¯¹è±¡ç»„æˆï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Template")]),s._v("ï¼šç­–ç•¥é€»è¾‘å®ç°çš„åœ°æ–¹ï¼Œä½¿ç”¨regoè¯­è¨€")]),s._v(" "),a("li",[a("code",[s._v("Contsraint")]),s._v("ï¼šè´Ÿè´£Kubernetesèµ„æºå¯¹è±¡çš„è¿‡æ»¤æˆ–è€…ä¸ºTemplateæä¾›è¾“å…¥å‚æ•°")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f https://raw.githubusercontent.com/open-policy-agent/gatekeeper/release-3.7/deploy/gatekeeper.yaml")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n gatekeeper-system")]),s._v("\nNAME                                             READY   STATUS    RESTARTS   AGE\ngatekeeper-controller-manager-66f474f785-kn5fl   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          32s\ngatekeeper-controller-manager-66f474f785-xgz7s   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          32s\ngatekeeper-controller-manager-66f474f785-xxwdm   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          32s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-3"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å®æ–½")]),s._v(" "),a("h5",{attrs:{id:"æ¡ˆä¾‹1-ç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹1-ç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ"}},[s._v("#")]),s._v(" æ¡ˆä¾‹1ï¼šç¦æ­¢å®¹å™¨å¯ç”¨ç‰¹æƒ")]),s._v(" "),a("ul",[a("li",[s._v("éœ€è¦åˆ›å»º"),a("code",[s._v("ConstraintTemplate")]),s._v("çš„èµ„æº")]),s._v(" "),a("li",[s._v("ä½¿ç”¨"),a("code",[s._v("rego")]),s._v("çš„è¯­è¨€ç¼–å†™å¯¹å¯ç”¨ç‰¹æƒçš„èµ„æºå‘å‡ºè­¦å‘Š")]),s._v(" "),a("li",[s._v("éœ€è¦æŒ‡å®šç±»å‹ä¸º"),a("code",[s._v("privileged")]),s._v("æ¨¡å¼")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat privileged_tpl.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" templates.gatekeeper.sh/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConstraintTemplate\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" privileged\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("crd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" privileged\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admission.k8s.gatekeeper.sh\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rego")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n        package admission\n        violation[{"msg": msg}] {  # å¦‚æœviolationä¸ºtrueè¯´æ˜è¿åçº¦æŸ\n          containers = input.review.object.spec.template.spec.containers\n          c_name := containers[0].name\n          containers[0].securityContext.privileged # å¦‚æœè¿”å›falseæˆ–è€…æ²¡è·å–åˆ°å€¼è¯´æ˜é€šè¿‡\n          msg := sprintf("æç¤ºï¼š\'%v\'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼",[c_name])\n        }')]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get ConstraintTemplate")]),s._v("\nNAME         AGE\nprivileged   32m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("åˆ›å»ºçº¦æŸã€å¦‚ä¸‹æ˜¯çº¦æŸèµ„æºç±»å‹ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("Deployment")]),s._v(" "),a("li",[s._v("DaemonSet")]),s._v(" "),a("li",[s._v("StatefulSet")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat privileged_constraints.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" constraints.gatekeeper.sh/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" privileged\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" privileged\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# åŒ¹é…çš„èµ„æº")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kinds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apps"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kinds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Deployment"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DaemonSet"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StatefulSet"')]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get constraints")]),s._v("\nNAME         AGE\nprivileged   31m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("åˆ›å»ºDeploymentå¼€å¯ç‰¹æƒæ¨¡å¼å†æ‰§è¡Œåˆ›å»ºä¼šå‘å‡ºè­¦å‘Šã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("securityContext")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privileged")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f deployment.yaml")]),s._v("\nError from server ("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("privileged"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" æç¤ºï¼š'nginx'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼)"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('error when creating "dp.yaml"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v('admission webhook "validation.gatekeeper.sh" denied the request')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("privileged"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" æç¤ºï¼š'nginx'å®¹å™¨ç¦æ­¢å¯ç”¨ç‰¹æƒï¼\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("h5",{attrs:{id:"æ¡ˆä¾‹2-åªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹2-åªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“"}},[s._v("#")]),s._v(" æ¡ˆä¾‹2ï¼šåªå…è®¸ä½¿ç”¨ç‰¹å®šçš„é•œåƒä»“åº“")]),s._v(" "),a("ul",[a("li",[s._v("éœ€è¦åˆ›å»º"),a("code",[s._v("ConstraintTemplate")]),s._v("çš„èµ„æº")]),s._v(" "),a("li",[s._v("ä½¿ç”¨"),a("code",[s._v("rego")]),s._v("çš„è¯­è¨€ç¼–å†™å¯¹é•œåƒä»“åº“çš„ä¿¡ä»»")]),s._v(" "),a("li",[s._v("éœ€è¦æŒ‡å®šç±»å‹ä¸º"),a("code",[s._v("image-check")]),s._v("æ¨¡å¼")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat   image-check_tpl.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" templates.gatekeeper.sh/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ConstraintTemplate\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("crd")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("validation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# éœ€è¦æ»¡è¶³æ¡ä»¶çš„å‚æ•°")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("target")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" admission.k8s.gatekeeper.sh\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rego")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token scalar string"}},[s._v('\n        package image\n        violation[{"msg": msg}] {\n          containers = input.review.object.spec.template.spec.containers\n          image := containers[0].image\n          not startswith(image, input.parameters.prefix)\n          msg := sprintf("æç¤ºï¼š\'%v\'é•œåƒåœ°å€ä¸åœ¨å¯ä¿¡ä»»ä»“åº“ï¼", [image])\n        }')]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get constrainttemplate")]),s._v("\nNAME          AGE\nimage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check   77s\nprivileged    35m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[s._v('è¿™é‡Œéœ€è¦é…ç½®ä¼ é€’OPAçš„å‚æ•°ä¸ºï¼š "lizhenliang/"')]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat image-check_constraints.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" constraints.gatekeeper.sh/v1beta1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kinds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"apps"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kinds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Deployment"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"DaemonSet"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"StatefulSet"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¼ é€’ç»™opaçš„å‚æ•°")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lizhenliang/"')]),s._v("\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get constraints")]),s._v("\nNAME                                                AGE\nimage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check.constraints.gatekeeper.sh/image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("check   77s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("æ‰§è¡Œæµ‹è¯•æ—¶ä½¿ç”¨dockerå®˜æ–¹çš„é•œåƒä»“åº“ï¼š")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("ç”±äºæˆ‘ä»¬å¼€å¯äº†é•œåƒä»“åº“çš„ä¿¡ä»» æ‰€ä»¥å¯¹dockerä»“åº“ä¸æ”¯æŒ")])]),s._v(" "),a("li",[a("code",[s._v("åªèƒ½ä»lizhenliangè¯¥ä»“åº“è¿›è¡Œæ‹‰å–é•œåƒ")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~/cks/opa"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment test --image=nginx")]),s._v("\nerror: failed to create deployment: admission webhook "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"validation.gatekeeper.sh"')]),s._v(" denied the request: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("image-check"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" æç¤ºï¼š"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'nginx'")]),s._v("é•œåƒåœ°å€ä¸åœ¨å¯ä¿¡ä»»ä»“åº“ï¼\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"secretå­˜å‚¨æ•æ„Ÿæ•°æ®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secretå­˜å‚¨æ•æ„Ÿæ•°æ®"}},[s._v("#")]),s._v(" Secretå­˜å‚¨æ•æ„Ÿæ•°æ®")]),s._v(" "),a("p",[s._v("Secretæ˜¯ä¸€ä¸ªç”¨äºå­˜å‚¨æ•æ„Ÿæ•°æ®çš„èµ„æºï¼Œæ‰€æœ‰çš„æ•°æ®è¦ç»è¿‡base64ç¼–ç ï¼Œæ•°æ®å®é™…ä¼šå­˜å‚¨åœ¨K8sä¸­Etcdï¼Œ ç„¶åé€šè¿‡åˆ›å»ºPodæ—¶å¼•ç”¨è¯¥æ•°æ®ã€‚")]),s._v(" "),a("p",[s._v("åº”ç”¨åœºæ™¯ï¼šå‡­æ®")]),s._v(" "),a("p",[s._v("Podä½¿ç”¨secretæ•°æ®æœ‰ä¸¤ç§æ–¹å¼ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("å˜é‡æ³¨å…¥")])]),s._v(" "),a("li",[a("code",[s._v("æ•°æ®å·æŒ‚è½½")])])]),s._v(" "),a("h4",{attrs:{id:"secretçš„ç±»å‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secretçš„ç±»å‹"}},[s._v("#")]),s._v(" secretçš„ç±»å‹")]),s._v(" "),a("p",[s._v("kubectl create secret æ”¯æŒä¸‰ç§æ•°æ®ç±»å‹ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("docker-registryï¼šå­˜å‚¨é•œåƒä»“åº“è®¤è¯ä¿¡æ¯")]),s._v(" "),a("li",[s._v("genericï¼šä»æ–‡ä»¶ã€ç›®å½•æˆ–è€…å­—ç¬¦ä¸²åˆ›å»ºï¼Œä¾‹å¦‚å­˜å‚¨ç”¨æˆ·åå¯†ç ")]),s._v(" "),a("li",[s._v("tlsï¼šå­˜å‚¨è¯ä¹¦ï¼Œä¾‹å¦‚HTTPSè¯ä¹¦")])]),s._v(" "),a("h4",{attrs:{id:"secretçš„ä½¿ç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#secretçš„ä½¿ç”¨"}},[s._v("#")]),s._v(" secretçš„ä½¿ç”¨")]),s._v(" "),a("p",[s._v("ä¸€ä¸ª Secret å¯ä»¥åŒ…å« Pod è®¿é—®æ•°æ®åº“æ‰€éœ€çš„ç”¨æˆ·å‡­è¯ã€‚ ä¾‹å¦‚ï¼Œç”±ç”¨æˆ·åå’Œå¯†ç ç»„æˆçš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚ ä½  å¯ä»¥åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šï¼Œå°†ç”¨æˆ·åå­˜å‚¨åœ¨æ–‡ä»¶ "),a("code",[s._v("./username.txt")]),s._v(" ä¸­ï¼Œå°†å¯†ç å­˜å‚¨åœ¨æ–‡ä»¶ "),a("code",[s._v("./password.txt")]),s._v(" ä¸­ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo -n 'admin' > username.txt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo -n '1a2b3c4d' > password.txt")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("åœ¨è¿™äº›å‘½ä»¤ä¸­ï¼Œ -n æ ‡å¿—ç¡®ä¿ç”Ÿæˆçš„æ–‡ä»¶åœ¨æ–‡æœ¬æœ«å°¾ä¸åŒ…å«é¢å¤–çš„æ¢è¡Œç¬¦ã€‚ è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºå½“ kubectl è¯» å–æ–‡ä»¶å¹¶å°†å†…å®¹ç¼–ç ä¸º base64 å­—ç¬¦ä¸²æ—¶ï¼Œå¤šä½™çš„æ¢è¡Œç¬¦ä¹Ÿä¼šè¢«ç¼–ç ã€‚")]),s._v(" "),a("p",[s._v("kubectl create secret å‘½ä»¤å°†è¿™äº›æ–‡ä»¶æ‰“åŒ…æˆä¸€ä¸ª Secret å¹¶åœ¨ API æœåŠ¡å™¨ä¸Šåˆ›å»ºå¯¹è±¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create secret generic db-user-pass --from-file=username.txt --from-file=password.txt")]),s._v("\nsecret/db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pass created\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get secrets db-user-pass -o yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("password.txt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MWEyYjNjNGQ=\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("username.txt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" YWRtaW4=\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-04-13T06:43:03Z"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pass\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100098"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 440fa829"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0135"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4ef2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b8dc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("9f06f5a2f2a3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Opaque\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"è§£ç -secret"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è§£ç -secret"}},[s._v("#")]),s._v(" è§£ç  Secret")]),s._v(" "),a("p",[s._v("è¦æŸ¥çœ‹åˆ›å»ºçš„ Secret çš„å†…å®¹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get secrets db-user-pass -o jsonpath='{.data}'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"password.txt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"MWEyYjNjNGQ="')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"username.txt"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"YWRtaW4="')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'MWEyYjNjNGQ=' | base64 -d")]),s._v("\n1a2b3c4d\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo 'YWRtaW4=' | base64 -d")]),s._v("\nadmin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-4"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å®æ–½")]),s._v(" "),a("h5",{attrs:{id:"ç¤ºä¾‹-å°†mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°secretä¸­å­˜å‚¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹-å°†mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°secretä¸­å­˜å‚¨"}},[s._v("#")]),s._v(" ç¤ºä¾‹ï¼šå°†Mysqlç”¨æˆ·å¯†ç ä¿å­˜åˆ°Secretä¸­å­˜å‚¨")]),s._v(" "),a("p",[s._v("åˆ›å»ºsecretï¼Œmysql-root-passwordçš„é”®å€¼æ˜¯1a2a3a4a")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create secret generic mysql --from-literal=mysql-root-password=1a2a3a4a")]),s._v("\nsecret/mysql created\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get secrets mysql -o yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql-root-password")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MWEyYTNhNGE=\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Secret\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-04-13T07:06:21Z"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"102066"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3104256b"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("5b46"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("43a4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("85ed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("acc66be7ccba\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Opaque\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("åˆ›å»ºPodæµ‹è¯•ï¼Œä½¿ç”¨envä»secretä¸­å¼•ç”¨å˜é‡")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat pod.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" master01\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.6")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MYSQL_ROOT_PASSWORD\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("valueFrom")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("secretKeyRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("password\n          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token null important"}},[s._v("~")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME    READY   STATUS    RESTARTS   AGE\nmysql   1/1     Running   0          21s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("h3",{attrs:{id:"å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨"}},[s._v("#")]),s._v(" å®‰å…¨æ²™ç®±è¿è¡Œå®¹å™¨")]),s._v(" "),a("h4",{attrs:{id:"gvisorä»‹ç»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä»‹ç»"}},[s._v("#")]),s._v(" gVisorä»‹ç»")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141224780.png",alt:"image-20220413152858652"}}),s._v(" "),a("p",[s._v("æ‰€çŸ¥ï¼Œå®¹å™¨çš„åº”ç”¨ç¨‹åºå¯ä»¥ç›´æ¥è®¿é—®Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå®¹å™¨åœ¨å®‰å…¨éš”ç¦»ä¸Šè¿˜æ˜¯æ¯”è¾ƒå¼±ï¼Œè™½ç„¶ å†…æ ¸åœ¨ä¸æ–­åœ°å¢å¼ºè‡ªèº«çš„å®‰å…¨ç‰¹æ€§ï¼Œä½†ç”±äºå†…æ ¸è‡ªèº«ä»£ç æç«¯å¤æ‚ï¼ŒCVE æ¼æ´å±‚å‡ºä¸ç©·ã€‚ æ‰€ä»¥è¦æƒ³å‡å°‘è¿™æ–¹é¢å®‰å…¨é£é™©ï¼Œå°±æ˜¯åšå¥½å®‰å…¨éš”ç¦»ï¼Œé˜»æ–­å®¹å™¨å†…ç¨‹åºå¯¹ç‰©ç†æœºå†…æ ¸çš„ä¾èµ–ã€‚ Googleå¼€æºçš„ä¸€ç§gVisorå®¹å™¨æ²™ç®±æŠ€æœ¯å°±æ˜¯é‡‡ç”¨è¿™ç§æ€è·¯ï¼ŒgVisoréš”ç¦»å®¹å™¨å†…åº”ç”¨å’Œå†…æ ¸ä¹‹é—´è®¿ é—®ï¼Œæä¾›äº†å¤§éƒ¨åˆ†Linuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå·§å¦™çš„å°†å®¹å™¨å†…è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨è½¬åŒ–ä¸ºå¯¹gVisorçš„è®¿é—®ã€‚")]),s._v(" "),a("p",[s._v("gVisorå…¼å®¹OCIï¼Œä¸Dockerå’ŒK8sæ— ç¼é›†æˆï¼Œå¾ˆæ–¹é¢ä½¿ç”¨ã€‚")]),s._v(" "),a("p",[s._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/google/gvisor")]),s._v(" "),a("h4",{attrs:{id:"gvisorå†…æ ¸äº¤äº’"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisorå†…æ ¸äº¤äº’"}},[s._v("#")]),s._v(" gVisorå†…æ ¸äº¤äº’")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204131554215.png",alt:"image-20220413152923179"}})]),s._v(" "),a("h4",{attrs:{id:"gvisoræ¶æ„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisoræ¶æ„"}},[s._v("#")]),s._v(" gVisoræ¶æ„")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204131554075.png",alt:"image-20220413153011389"}})]),s._v(" "),a("h4",{attrs:{id:"gvisorä¸dockeré›†æˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä¸dockeré›†æˆ"}},[s._v("#")]),s._v(" gVisorä¸Dockeré›†æˆ")]),s._v(" "),a("p",[s._v("gVisorå†…æ ¸è¦æ±‚ï¼š")]),s._v(" "),a("p",[s._v("Linux 3.17+ å¦‚æœç”¨çš„æ˜¯CentOS7åˆ™éœ€è¦å‡çº§å†…æ ¸ï¼ŒUbuntuä¸éœ€è¦ã€‚")]),s._v(" "),a("p",[s._v("CentOS7å†…æ ¸å‡çº§æ­¥éª¤ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum --enablerepo=elrepo-kernel install kernel-ml-devel kernel-ml â€“y")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# grub2-set-default 0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# reboot")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# uname -r")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 5.17.2-1.el7.elrepo.x86_64")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("gVisoré›†æˆDockeré…ç½®")]),s._v(" "),a("p",[s._v("å‚è€ƒæ–‡æ¡£ï¼šhttps://gvisor.dev/docs/user_guide/install/")]),s._v(" "),a("p",[s._v("å·²ç»æµ‹è¯•è¿‡çš„åº”ç”¨å’Œå·¥å…·ï¼šhttps://gvisor.dev/docs/user_guide/compatibility/")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("ã€å‡†å¤‡gVisoräºŒè¿›åˆ¶æ–‡ä»¶\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sha512sum -c runsc.sha512")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rm -f *.sha512")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod a+x runsc ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod a+x containerd-shim-runsc-v1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv runsc containerd-shim-runsc-v1 /usr/local/bin")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("ã€Dockeré…ç½®ä½¿ç”¨gVisor\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runsc install # æŸ¥çœ‹åŠ çš„é…ç½®/etc/docker/daemon.json")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart docker")]),s._v("\n\n\nä½¿ç”¨runscè¿è¡Œå®¹å™¨ï¼š\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d --runtime=runsc nginx")]),s._v("\nä½¿ç”¨dmesgéªŒè¯ï¼š\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run --runtime=runsc -it nginx dmesg")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"gvisorä¸containerdé›†æˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gvisorä¸containerdé›†æˆ"}},[s._v("#")]),s._v(" gVisorä¸Containerdé›†æˆ")]),s._v(" "),a("p",[s._v("å¦‚æœè¿™é‡Œæ˜¯Dockerçš„ç¯å¢ƒï¼Œéœ€è¦åˆ‡æ¢åˆ°Containerdå®¹å™¨å¼•æ“ã€‚")]),s._v(" "),a("p",[s._v("ä»ç„¶éœ€è¦å°†runsc ã€containerd-shim-runsc-v1å·¥å…·ç§»åˆ°/usr/local/binä¸‹é¢")]),s._v(" "),a("p",[a("strong",[s._v("1.å‡†å¤‡é…ç½®")])]),s._v(" "),a("p",[s._v("å¼€å¯ipv4è·¯ç”±è½¬å‘é…ç½®ï¼Œé‡æ–°ç”Ÿæ•ˆç³»ç»Ÿé…ç½®")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/sysctl.d/99-kubernetes-cri.conf << EOF")]),s._v("\nnet.bridge.bridge-nf-call-iptables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.ipv4.ip_forward "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnet.bridge.bridge-nf-call-ip6tables "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nEOF\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sysctl -system")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("2ã€å®‰è£…Containerd")])]),s._v(" "),a("p",[s._v("å¦‚æœé»˜è®¤å®‰è£…äº†docker-ceä¼šè‡ªåŠ¨å®‰è£…containerdçš„ä¾èµ–ï¼Œæ²¡æœ‰åˆ™éœ€è¦å®‰è£…containerdã€‚")]),s._v(" "),a("p",[s._v("ubuntuæ·»åŠ docker-ceçš„repoæºä¹‹åapt-get installçš„æ–¹å¼å®‰è£…")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/yum.repos.d")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y containerd.io")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("strong",[s._v("3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶")])]),s._v(" "),a("ol",[a("li",[s._v("pauseé•œåƒåœ°å€")]),s._v(" "),a("li",[s._v("Cgroupé©±åŠ¨æ”¹ä¸ºsystemd")]),s._v(" "),a("li",[s._v("å¢åŠ runscå®¹å™¨è¿è¡Œæ—¶")]),s._v(" "),a("li",[s._v("é…ç½®dockeré•œåƒåŠ é€Ÿå™¨")])]),s._v(" "),a("p",[s._v("ä¿®æ”¹é…ç½®æ–‡ä»¶é»˜è®¤çš„containerdçš„é…ç½®æ–‡ä»¶æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç”Ÿæˆä¸€ä¸ªå®Œæ•´çš„é…ç½®æ–‡ä»¶ã€‚")]),s._v(" "),a("p",[s._v("containerdçš„ç›®å½•æ˜¯åœ¨ "),a("code",[s._v("/etc/containerd")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc/containerd/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 containerd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# containerd config  default > config.toml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 containerd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim config.toml")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n \t\tÂ·Â·Â·Â·\n \t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¿®æ”¹é•œåƒä¸ºå›½å†…çš„é•œåƒ")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("     sandbox_image "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"registry.aliyuncs.com/google_containers/pause:3.2"')]),s._v("   \n \t\tÂ·Â·Â·Â· \n \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ ä¸€ä¸ªrunsc,æŒ‡å®šç±»å‹ä¸ºrunscï¼Œè¿™é‡Œæ˜¯è·ŸruncåŒçº§")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".containerd.runtimes.runsc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v("           runtime_type "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.runsc.v1"')]),s._v("   \t\t\t\t  \n\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ä¿®æ”¹systemdé©±åŠ¨ä¸ºtrue")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".containerd.runtimes.runc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("103")]),s._v("          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".containerd.runtimes.runc.options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\t\t\tÂ·Â·Â·\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114")]),s._v("            SystemdCgroup "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\t\n \t\t\n \t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# æ·»åŠ dockerä»“åº“çš„é•œåƒæºï¼Œé…ç½®é˜¿é‡Œé•œåƒåŠ é€Ÿ")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("139")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.mirrors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("140")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("plugins."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io.containerd.grpc.v1.cri"')]),s._v(".registry.mirrors."),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker.io"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  \n "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("141")]),s._v("          endpoint "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://b9pmyelo.mirror.aliyuncs.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[a("strong",[s._v("é…ç½®kubeletä½¿ç”¨containerd")])]),s._v(" "),a("p",[s._v("é…ç½®å®Œä¹‹åå…ˆé‡å¯containerdï¼Œå†é‡å¯kubeletï¼Œæœ€åå¦‚æœpodå‡ºç°æŠ¥é”™ï¼Œé‡å¯dockerã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/sysconfig/kubelet ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("KUBELET_EXTRA_ARGS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("--container-runtime"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("remote --container-runtime-endpoint"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("unix:///run/containerd/containerd.sock --cgroup-driver"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("systemd\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart containerd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart kubelet")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart docker")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("p",[a("strong",[s._v("éªŒè¯å½“å‰çš„Kuberneteså®¹å™¨åŸºå±‚")])]),s._v(" "),a("ol",[a("li",[a("code",[s._v("ä»¥ä¸Šçš„æ­¥éª¤éœ€è¦åœ¨æ‰€æœ‰é›†ç¾¤é…ç½®")])]),s._v(" "),a("li",[a("code",[s._v("åŒ…æ‹¬crictlè¿æ¥containerdçš„é…ç½®ä¹Ÿè¦åœ¨æ‰€æœ‰é›†ç¾¤è¿è¡Œ")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get  node -o wide | awk  '{print $1,$2,$5,$NF}' | column -t")]),s._v("\nNAME      STATUS  VERSION  CONTAINER-RUNTIME\nmaster01  Ready   v1.22.1  containerd://1.5.11\nmaster02  Ready   v1.22.1  containerd://1.5.11\nmaster03  Ready   v1.22.1  containerd://1.5.11\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[a("strong",[s._v("crictlè¿æ¥containerd")])]),s._v(" "),a("p",[s._v("containerdä¹Ÿæœ‰ ctr ç®¡ç†å·¥å…·ï¼Œä½†åŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œä¸€èˆ¬ä½¿ç”¨crictlå·¥å…·æ£€æŸ¥å’Œè°ƒè¯•å®¹å™¨ã€‚")]),s._v(" "),a("p",[s._v("é¡¹ç›®åœ°å€ï¼šhttps://github.com/kubernetes-sigs/cri-tools/")]),s._v(" "),a("p",[s._v("å‡†å¤‡crictlè¿æ¥containerdé…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /etc/crictl.yaml << EOF")]),s._v("\nruntime-endpoint: unix:///run/containerd/containerd.sock\nEOF\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart  containerd ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("ä¸‹é¢æ˜¯dockerä¸crictlå‘½ä»¤å¯¹ç…§è¡¨ï¼š")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204141224352.png",alt:"image-20220414115021436"}})]),s._v(" "),a("h3",{attrs:{id:"æ¡ˆä¾‹å®æ–½-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¡ˆä¾‹å®æ–½-5"}},[s._v("#")]),s._v(" æ¡ˆä¾‹å®æ–½")]),s._v(" "),a("h5",{attrs:{id:"ç¤ºä¾‹-k8sä½¿ç”¨gvisorè¿è¡Œå®¹å™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¤ºä¾‹-k8sä½¿ç”¨gvisorè¿è¡Œå®¹å™¨"}},[s._v("#")]),s._v(" ç¤ºä¾‹ï¼š K8sä½¿ç”¨gVisorè¿è¡Œå®¹å™¨")]),s._v(" "),a("ul",[a("li",[s._v("åˆ›å»ºRuntimeClass")]),s._v(" "),a("li",[s._v("ç»‘å®šRuntimeClass")])]),s._v(" "),a("p",[s._v("RuntimeClass æ˜¯ä¸€ä¸ªç”¨äºé€‰æ‹©å®¹å™¨è¿è¡Œæ—¶é…ç½®çš„ç‰¹æ€§ï¼Œå®¹å™¨è¿è¡Œæ—¶é…ç½®ç”¨ äºè¿è¡Œ Pod ä¸­çš„å®¹å™¨ã€‚")]),s._v(" "),a("p",[s._v("åˆ›å»ºRuntimeClassï¼š")]),s._v(" "),a("ul",[a("li",[s._v("è¿™é‡Œåˆ›å»ºä¸€ä¸ªåç§°ä¸º"),a("code",[s._v("gvisor")]),s._v("çš„runtimeclassèµ„æº")]),s._v(" "),a("li",[s._v("å¯ä»¥åˆ›å»ºå¤šä¸ª"),a("code",[s._v("runtimeclass")]),s._v("èµ„æºï¼Œèµ·åˆ°éš”ç¦»çš„æ•ˆæœ")]),s._v(" "),a("li",[s._v("handlerä¸€å®šæ˜¯"),a("code",[s._v("runsc")]),s._v("ï¼Œå¯¹åº”CSIçš„é…ç½®åç§°")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat runtime.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" node.k8s.io/v1 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# RuntimeClass å®šä¹‰äº node.k8s.io API ç»„")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RuntimeClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gvisor "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç”¨æ¥å¼•ç”¨ RuntimeClass çš„åå­—")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" runsc "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# å¯¹åº”çš„ CRI é…ç½®çš„åç§°")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get runtimeclasses")]),s._v("\nNAME     HANDLER   AGE\ngvisor   runsc     72m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("åˆ›å»ºPodæµ‹è¯•gVisorï¼š")]),s._v(" "),a("p",[s._v("è¿™é‡Œä½¿ç”¨"),a("code",[s._v("runtimeClassName")]),s._v("ç»‘å®š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat pod.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("run")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodeName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"master01"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("runtimeClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gvisor\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod\n    \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master01 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME   READY   STATUS    RESTARTS   AGE\npod    1/1     Running   0          72m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);