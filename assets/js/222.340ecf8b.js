(window.webpackJsonp=window.webpackJsonp||[]).push([[222],{702:function(s,a,t){"use strict";t.r(a);var n=t(19),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"kubernetes-crd详解"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-crd详解"}},[s._v("#")]),s._v(" Kubernetes CRD详解")]),s._v(" "),t("h2",{attrs:{id:"crd基本概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crd基本概念"}},[s._v("#")]),s._v(" CRD基本概念")]),s._v(" "),t("h3",{attrs:{id:"定制资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定制资源"}},[s._v("#")]),s._v(" 定制资源")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("资源（Resource） 是 Kubernetes API 中的一个端点")]),s._v("， 其中存储的是某个类别的 API 对象 的一个集合。 例 如内置的 pods 资源包含一组 Pod 对象。")]),s._v(" "),t("li",[t("code",[s._v("定制资源（Custom Resource） 是对 Kubernetes API 的扩展")]),s._v("，不一定在默认的 Kubernetes 安装中就可 用。定制资源所代表的是对特定 Kubernetes 安装的一种定制。 不过，很多 Kubernetes 核心功能现在都用定 制资源来实现，这使得 Kubernetes 更加模块化。")]),s._v(" "),t("li",[t("code",[s._v("定制资源可以通过动态注册的方式在运行中的集群内或出现或消失")]),s._v("，集群管理员可以独立于集群 更新定制资源。一旦 某定制资源被安装，用户可以使用 kubectl 来创建和访问其中的对象，就像他们为 pods 这种内置资源所做的一 样。")])]),s._v(" "),t("h3",{attrs:{id:"定制控制器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#定制控制器"}},[s._v("#")]),s._v(" 定制控制器")]),s._v(" "),t("ul",[t("li",[s._v("就定制资源本身而言，它只能用来存取结构化的数据。 当你将定制资源与 定制控制器（Custom Controller） 相结合时，定制资源就能够 提供真正的 声明式 API（Declarative API）。")]),s._v(" "),t("li",[s._v("使用声明式 API， 你可以 声明 或者设定你的资源的期望状态，并尝试让 Kubernetes 对象的当前状态 同步到 其期望状态。控制器负责将结构化的数据解释为用户所期望状态的记录，并 持续地维护该状态。")]),s._v(" "),t("li",[s._v("你可以在一个运行中的集群上部署和更新定制控制器，这类操作与集群的生命周期无关。 定制控制器可以用于任何类 别的资源，不过它们与定制资源结合起来时最为有效。 Operator 模式就是将定制资源 与定制控制器相结合的。你 可以使用定制控制器来将特定于某应用的领域知识组织 起来，以编码的形式构造对 Kubernetes API 的扩展。")])]),s._v(" "),t("h3",{attrs:{id:"声明式-apis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#声明式-apis"}},[s._v("#")]),s._v(" 声明式 APIs")]),s._v(" "),t("p",[t("strong",[s._v("典型地，在声明式 API 中：")])]),s._v(" "),t("ol",[t("li",[s._v("你的 API 包含相对而言为数不多的、尺寸较小的对象（资源）。")]),s._v(" "),t("li",[s._v("对象定义了应用或者基础设施的配置信息。")]),s._v(" "),t("li",[s._v("对象更新操作频率较低。")]),s._v(" "),t("li",[s._v("通常需要人来读取或写入对象。")]),s._v(" "),t("li",[s._v("对象的主要操作是 CRUD 风格的（创建、读取、更新和删除）。")]),s._v(" "),t("li",[s._v("不需要跨对象的事务支持：API 对象代表的是期望状态而非确切实际状态。")])]),s._v(" "),t("p",[t("strong",[s._v("命令式 API（Imperative API）与声明式有所不同。 以下迹象表明你的 API 可能不是声明式的：")])]),s._v(" "),t("ol",[t("li",[s._v("客户端发出“做这个操作”的指令，之后在该操作结束时获得同步响应。")]),s._v(" "),t("li",[s._v("客户端发出“做这个操作”的指令，并获得一个操作 ID，之后需要检查一个 Operation（操作） 对象来判断 请求是否成功完成。")]),s._v(" "),t("li",[s._v("你会将你的 API 类比为远程过程调用（Remote Procedure Call，RPCs）。")]),s._v(" "),t("li",[s._v("直接存储大量数据；例如每个对象几 kB，或者存储上千个对象。")]),s._v(" "),t("li",[s._v("需要较高的访问带宽（长期保持每秒数十个请求）。")]),s._v(" "),t("li",[s._v("存储有应用来处理的最终用户数据（如图片、个人标识信息（PII）等）或者其他大规模数据。")]),s._v(" "),t("li",[s._v("在对象上执行的常规操作并非 CRUD 风格。")]),s._v(" "),t("li",[s._v("API 不太容易用对象来建模。")]),s._v(" "),t("li",[s._v("你决定使用操作 ID 或者操作对象来表现悬决的操作。")])]),s._v(" "),t("h3",{attrs:{id:"添加定制资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加定制资源"}},[s._v("#")]),s._v(" 添加定制资源")]),s._v(" "),t("p",[s._v("Kubernetes 提供了两种方式供你向集群中添加定制资源：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("CRD 相对简单，创建 CRD 可以不必编程。")])]),s._v(" "),t("li",[t("p",[s._v("API 聚合 需要编程，但支持对 API 行为进行更多的控制，例如数据如何存储以及在不同 API 版本间如何转 换等。")])])]),s._v(" "),t("p",[t("code",[s._v("聚合 API 指的是一些下位的 API 服务器，运行在主 API 服务器后面")]),s._v("；主 API 服务器以代理的方式工作。这种 组织形式称作 API 聚合（API Aggregation，AA） 。 对用户而言，看起来仅仅是 Kubernetes API 被扩展 了。")]),s._v(" "),t("p",[t("code",[s._v("CRD 允许用户创建新的资源类别同时又不必添加新的 API 服务器")]),s._v("。 使用 CRD 时，你并不需要理解 API 聚合。")]),s._v(" "),t("h3",{attrs:{id:"customresourcedefinitions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#customresourcedefinitions"}},[s._v("#")]),s._v(" CustomResourceDefinitions")]),s._v(" "),t("p",[t("code",[s._v("CustomResourceDefinition API 资源允许你定义定制资源。")]),s._v(" 定义 CRD 对象的操作会使用你所设定的名字和 模式定义"),t("code",[s._v("（Schema）")]),s._v("创建一个新的定制资源， Kubernetes API 负责为你的定制资源提供存储和访问服务。 CRD 对象的名称必须是合法的 DNS 子域名。")]),s._v(" "),t("p",[s._v("CRD 使得你不必编写自己的 API 服务器来处理定制资源，不过其背后实现的通用性也意味着 你所获得的灵活性要 比 API 服务器聚合少很多。")]),s._v(" "),t("h3",{attrs:{id:"比较易用性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#比较易用性"}},[s._v("#")]),s._v(" 比较易用性")]),s._v(" "),t("p",[s._v("CRD 比聚合 API 更容易创建")]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("CRDs")]),s._v(" "),t("th",[s._v("聚合 API")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("无需编程。用户可选择任何语言来实现 CRD 控制器。")]),s._v(" "),t("td",[s._v("需要使用 Go 来编程，并构建可执行文件和 镜像。")])]),s._v(" "),t("tr",[t("td",[s._v("无需额外运行服务；CRD 由 API 服务器处理。")]),s._v(" "),t("td",[s._v("需要额外创建服务，且该服务可能失效。")])]),s._v(" "),t("tr",[t("td",[s._v("一旦 CRD 被创建，不需要持续提供支持。Kubernetes 主控 节点升级过程中自动会带入缺陷修复。")]),s._v(" "),t("td",[s._v("可能需要周期性地从上游提取缺陷修复并更新 聚合 API 服务器。")])]),s._v(" "),t("tr",[t("td",[s._v("无需处理 API 的多个版本；例如，当你控制资源的客户端 时，你可以更新它使之与 API 同步。")]),s._v(" "),t("td",[s._v("你需要处理 API 的多个版本；例如，在开发 打算与很多人共享的扩展时。")])])])]),s._v(" "),t("h2",{attrs:{id:"crd基本使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crd基本使用"}},[s._v("#")]),s._v(" CRD基本使用")]),s._v(" "),t("h3",{attrs:{id:"如何使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何使用"}},[s._v("#")]),s._v(" 如何使用")]),s._v(" "),t("p",[s._v("在K8S系统扩展点中，开发者可以通过CRD（CustomResourceDefinition）来扩展K8S API，其功能主要由APIExtensionServer负责。使用CRD扩展资源分为三步：")]),s._v(" "),t("ul",[t("li",[t("strong",[s._v("注册自定义资源")]),s._v("：开发者需要通过K8S提供的方式注册自定义资源，即通过CRD进行注册，注册之后，K8S就知道我们自定义资源的存在了，然后我们就可以像使用K8S内置资源一样使用自定义资源（CR）")]),s._v(" "),t("li",[t("strong",[s._v("使用自定义资源")]),s._v("：像内置资源比如Pod一样声明资源，使用CR声明我们的资源信息")]),s._v(" "),t("li",[t("strong",[s._v("删除自定义资源")]),s._v("：当我们不再需要时，可以删除自定义资源")])]),s._v(" "),t("h3",{attrs:{id:"创建自定义资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建自定义资源"}},[s._v("#")]),s._v(" 创建自定义资源")]),s._v(" "),t("p",[s._v("当你创建新的 CustomResourceDefinition（CRD）时，Kubernetes API 服务器会为你所 指定的每一个版本 生成一个 RESTful 的 资源路径。CRD 可以是名字空间作用域的，也可以 是集群作用域的，取决于 CRD 的 "),t("code",[s._v("scope")]),s._v(" 字段设置。和其他现有的内置对象一样，删除 一个名字空间时，该名字空间下的所有定制对象也会被删 除。CustomResourceDefinition 本身是不受名字空间限制的，对所有名字空间可用。")]),s._v(" "),t("p",[s._v("将下面的 CustomResourceDefinition 保存到 "),t("code",[s._v("resourcedefinition.yaml")]),s._v(" 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名字必需与下面的 spec 字段匹配，并且格式为 '<名称的复数形式>.<组名>'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组名称，用于 REST API: /apis/<组>/<版本>")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列举此 CustomResourceDefinition 所支持的版本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个版本都可以通过 served 标志来独立启用或禁止")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中一个且只有一个版本必需被标记为存储版本")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以是 Namespaced 或 Cluster")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名称的复数形式，用于 URL：/apis/<组>/<版本>/<名称的复数形式>")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kind 通常是单数形式的驼峰编码（CamelCased）形式。你的资源清单会使用这一形式。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shortNames 允许你在命令行使用较短的字符串来匹配资源")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("创建CRD资源，查看当前的新增加的自定义资源")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f resourcedefinition.yaml  ")]),s._v("\ncustomresourcedefinition.apiextensions.k8s.io/crontabs.stable.example.com created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crd")]),s._v("\nNAME                               CREATED AT\ncrontabs.stable.example.com        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-05-03T00:35:58Z\nkuboardaddonresources.kuboard.cn   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-05-02T23:38:10Z\nkuboardaddons.kuboard.cn           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-05-02T23:38:10Z\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("这样一个新的受名字空间约束的 RESTful API 端点会被创建在：")]),s._v(" "),t("blockquote",[t("p",[s._v("注意： 此端点 URL 自此可以用来创建和管理定制对象。对象的 kind 将是来自你上面创建时 所用的 spec 中指定的 CronTab 。")])]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("/apis/stable.example.com/v1/namespaces"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*/crontabs/...\n")])])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"使用自定义资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用自定义资源"}},[s._v("#")]),s._v(" 使用自定义资源")]),s._v(" "),t("p",[s._v("在创建了 CustomResourceDefinition 对象之后，你可以创建定制对象（Custom Objects）。定制对象可以 包含定制字段。这些字段可以包含任意的 JSON 数据。 在下面的例子中，在类别为 "),t("code",[s._v("CrontTab")]),s._v(" 的定制对象中，设 置了 "),t("code",[s._v("cronSpec")]),s._v(" 和 "),t("code",[s._v("image")]),s._v(" 定制字段。类别 "),t("code",[s._v("CronTab")]),s._v(" 来自你在上面所创建的 CRD 的规约。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("image\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("执行创建资源后，查看详细的信息")]),s._v(" "),t("p",[s._v("你可以看到输出中包含了你创建定制对象时在 YAML 文件中指定的定制字段 cronSpec 和 image ：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f my-crontab.yaml  ")]),s._v("\ncrontab.stable.example.com/my-new-cron-object created\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontabs.stable.example.com ")]),s._v("\nNAME                 AGE\nmy-new-cron-object   11s\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),s._v("\napiVersion: stable.example.com/v1\nkind: CronTab\nmetadata:\n  creationTimestamp: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03T00:43:18Z"')]),s._v("\n  generation: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  name: my-new-cron-object\n  namespace: default\n  resourceVersion: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"6570"')]),s._v("\n  uid: 20b3d16b-5b44-4ec2-ac95-e5f5a9183b77\nspec:\n  cronSpec: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'* * * * */5'")]),s._v("\n  image: my-awesome-cron-image\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("h3",{attrs:{id:"牛刀小试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#牛刀小试"}},[s._v("#")]),s._v(" 牛刀小试")]),s._v(" "),t("p",[s._v("创建一个自定义API资源exam，API资源类型为Scaling，作用域为命名空间。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" exam.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" exam\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" exam \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Scaling \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v("查看创建的结果:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl api-resources | grep -w exam ")]),s._v("\nexam                                           stable.example.com/v1                  "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("         Scaling\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"设置结构化的模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置结构化的模式"}},[s._v("#")]),s._v(" 设置结构化的模式")]),s._v(" "),t("p",[s._v("CustomResource 对象在定制字段中保存结构化的数据，这些字段和内置的字段 "),t("code",[s._v("apiVersion")]),s._v(" 、 "),t("code",[s._v("kind")]),s._v(" 和 "),t("code",[s._v("metadata")]),s._v(" 等一起存储，不过内置的字段都会被 API 服务器隐式完成合法性检查。有了 OpenAPI v3.0 检查 能 力之后，你可以设置一个模式（Schema），在创建和更新定制对象时，这一模式会被用来 对对象内容进行合法性检 查。参阅下文了解这类模式的细节和局限性。")]),s._v(" "),t("p",[s._v("在 "),t("code",[s._v("apiextensions.k8s.io/v1")]),s._v(" 版本中，CustomResourceDefinition 的这一结构化模式 定义是必需的。 在 CustomResourceDefinition 的 beta 版本中，结构化模式定义是可选的。")]),s._v(" "),t("p",[s._v("结构化模式本身是一个 OpenAPI v3.0 验证模式，其中：")]),s._v(" "),t("ol",[t("li",[s._v("为对象根（root）设置一个非空的 type 值（藉由 OpenAPI 中的 "),t("code",[s._v("type")]),s._v(" ），对每个 object 节点的每个 字段（藉由 OpenAPI 中的 "),t("code",[s._v("properties")]),s._v(" 或 "),t("code",[s._v("additionalProperties")]),s._v(" ）以及 array 节点的每个条目（藉由 OpenAPI 中的 "),t("code",[s._v("items")]),s._v(" ）也要设置非空的 type 值， 除非：\n"),t("ul",[t("li",[s._v("节点包含属性 "),t("code",[s._v("x-kubernetes-int-or-string: true")])]),s._v(" "),t("li",[s._v("节点包含属性 "),t("code",[s._v("x-kubernetes-preserve-unknown-fields: true")])])])]),s._v(" "),t("li",[s._v("对于 object 的每个字段或 array 中的每个条目，如果其定义中包含 "),t("code",[s._v("allOf")]),s._v(" 、 "),t("code",[s._v("anyOf")]),s._v(" 、 "),t("code",[s._v("oneOf")]),s._v(" 或 "),t("code",[s._v("not")]),s._v(" ，则模式也要指定这些逻辑组合之外的字段或条目（试比较例 1 和例 2)。")]),s._v(" "),t("li",[s._v("在 "),t("code",[s._v("allOf")]),s._v(" 、 "),t("code",[s._v("anyOf")]),s._v(" 、 "),t("code",[s._v("oneOf")]),s._v(" 或 "),t("code",[s._v("not")]),s._v(" 上下文内不设置 "),t("code",[s._v("description")]),s._v(" 、 "),t("code",[s._v("type")]),s._v(" 、 "),t("code",[s._v("default")]),s._v(" 、 "),t("code",[s._v("additionalProperties")]),s._v(" 或者 "),t("code",[s._v("nullable")]),s._v(" 。此规则的例外是 x-kubernetes-int-or-string 的两种模式（见下 文）。")]),s._v(" "),t("li",[s._v("如果 "),t("code",[s._v("metadata")]),s._v(" 被设置，则只允许对 "),t("code",[s._v("metadata.name")]),s._v(" 和 "),t("code",[s._v("metadata.generateName")]),s._v(" 设置约束。")])]),s._v(" "),t("p",[s._v("非结构化的例 1：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("违反了第 2 条规则。下面的是正确的：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  \n "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n     "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("非结构化的例 2：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("items")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("违反了第 2 条规则。下面的是正确的：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("items")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("allOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("items")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("非结构化的例 3：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^a"')]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("finalizers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" array \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("items")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-finalizer"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("anyOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("required")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo bar object"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("不是一个结构化的模式，因为其中存在以下违例：")]),s._v(" "),t("ul",[t("li",[s._v("根节点缺失 type 设置（规则 1）")]),s._v(" "),t("li",[t("code",[s._v("foo")]),s._v(" 的 type 缺失（规则 1）")]),s._v(" "),t("li",[t("code",[s._v("anyOf")]),s._v(" 中的 "),t("code",[s._v("bar")]),s._v(" 未在外部指定（规则 2）")]),s._v(" "),t("li",[t("code",[s._v("bar")]),s._v(" 的 "),t("code",[s._v("type")]),s._v(" 位于 "),t("code",[s._v("anyOf")]),s._v(" 中（规则 3）")]),s._v(" "),t("li",[t("code",[s._v("anyOf")]),s._v(" 中设置了 "),t("code",[s._v("description")]),s._v(" （规则 3）")]),s._v(" "),t("li",[t("code",[s._v("metadata.finalizers")]),s._v(" 不可以被限制 (规则 4）")])]),s._v(" "),t("p",[s._v("作为对比，下面的 YAML 所对应的模式则是结构化的：")]),s._v(" "),t("blockquote",[t("p",[s._v("注意： 如果违反了结构化模式规则，CustomResourceDefinition 的 NonStructural 状况中 会包含报告信息。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo bar object"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"abc"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^a"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("anyOf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("required")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bar"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"字段剪裁"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#字段剪裁"}},[s._v("#")]),s._v(" 字段剪裁")]),s._v(" "),t("p",[s._v("CustomResourceDefinition 在集群的持久性存储 etcd 中保存经过合法性检查的资源数据。 就像原生的 Kubernetes 资源，例如 ConfigMap， 如果你指定了 API 服务器所无法识别的字段，则该未知字段会在保存资 源之前 被 剪裁（Pruned） 掉（删除）。")]),s._v(" "),t("p",[s._v("将下面的 YAML 保存到 my-crontab.yaml 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat my-crontab.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("someRandomFied")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("并创建之：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f my-crontab.yaml --validate=false ")]),s._v("\ncrontab.stable.example.com/my-new-cron-object created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("查看crontab的详细信息：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03T01:26:00Z"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("generation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"9919"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 81f709aa"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4b78"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4f55"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("bf11"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f51b4efab576\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'* * * * */5'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("blockquote",[t("p",[s._v("注意： 其中的字段 someRandomField 已经被剪裁掉。")])]),s._v(" "),t("p",[s._v("通过 "),t("code",[s._v("--validate=false")]),s._v(" 命令行选项 关闭了客户端的合法性检查以展示 API 服务器的行为， 因为 OpenAPI 合法性检查模式也会发布到 客户端， "),t("code",[s._v("kubectl")]),s._v(" 也会检查未知的字段并在对象被发送到 API 服务器之前 就拒绝它们。")]),s._v(" "),t("h2",{attrs:{id:"crd进阶"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crd进阶"}},[s._v("#")]),s._v(" CRD进阶")]),s._v(" "),t("h3",{attrs:{id:"finalizers"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#finalizers"}},[s._v("#")]),s._v(" Finalizers")]),s._v(" "),t("p",[t("code",[s._v("Finalizer 能够让控制器实现异步的删除前（Pre-delete）回调。")]),s._v(" 与内置对象类似，定制对象也支持 Finalizer。")]),s._v(" "),t("p",[t("strong",[s._v("Finalizers的作用：")])]),s._v(" "),t("ol",[t("li",[t("code",[s._v("自定义 Finalizer 的标识符包含一个域名、一个正向斜线和 finalizer 的名称。")]),s._v(" 任何控制器都可以在任何对象 的 finalizer 列表中添加新的 finalizer。")]),s._v(" "),t("li",[s._v("对带有 Finalizer 的对象的第一个删除请求会为其 metadata.deletionTimestamp 设置一个值，但不会真的删除对 象。一旦此值被设置， finalizers 列表中的表项 只能被移除。在列表中仍然包含 finalizer 时，无法强制删除 对应的对象。")]),s._v(" "),t("li",[s._v("当 metadata.deletionTimestamp 字段被设置时，监视该对象的各个控制器会 执行它们所能处理的 finalizer，并 在完成处理之后将其从列表中移除。 每个控制器负责将其 finalizer 从列表中删除。")]),s._v(" "),t("li",[s._v("metadata.deletionGracePeriodSeconds 的取值控制对更新的轮询周期。 一旦 finalizers 列表为空时，就意味着所有 finalizer 都被执行过， Kubernetes 会最终删除该资源。")])]),s._v(" "),t("p",[s._v("你可以像下面一样为定制对象添加 Finalizer：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("finalizers")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" stable.example.com/finalizer\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"合法性检查"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#合法性检查"}},[s._v("#")]),s._v(" 合法性检查")]),s._v(" "),t("p",[s._v("定制资源是通过 OpenAPI v3 模式定义 来执行合法性检查的， 你可以通过使用准入控制 Webhook 来添加额外的合法性检查 。")]),s._v(" "),t("p",[s._v("此外，对模式定义存在以下限制：")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("以下字段不可设置：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("definitions")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("dependencies")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("deprecated")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("discriminator")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("id")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("patternProperties")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("readOnly")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("writeOnly")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("xml")])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("$ref")])])])])]),s._v(" "),t("li",[t("p",[s._v("字段 "),t("code",[s._v("uniqueItems")]),s._v(" 不可设置为 "),t("code",[s._v("true")])])]),s._v(" "),t("li",[t("p",[s._v("字段 "),t("code",[s._v("additionalProperties")]),s._v(" 不可设置为 "),t("code",[s._v("false")])])]),s._v(" "),t("li",[t("p",[s._v("字段 "),t("code",[s._v("additionalProperties")]),s._v(" 与 "),t("code",[s._v("properties")]),s._v(" 互斥，不可同时使用")])])]),s._v(" "),t("p",[s._v("当设置默认值特性被启用时，可以设置字段 "),t("code",[s._v("default")]),s._v(" 。 就 "),t("code",[s._v("apiextensions.k8s.io/v1")]),s._v(" 组的 CustomResourceDefinitions，这一条件是满足的。 设置默认值的功能特性从 1.17 开始正式发布。该特性在 1.16 版本中处于 Beta 状态，要求 "),t("code",[s._v("CustomResourceDefaulting")]),s._v(" 特性门控 被启用。对于大多数集群而言，Beta 状态的特性门控默认都是自动启用的。")]),s._v(" "),t("p",[s._v("模式定义是在 CustomResourceDefinition 中设置的。在下面的例子中， CustomResourceDefinition 对 定制对象执行以下合法性检查：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("spec.cronSpec")]),s._v(" 必须是一个字符串，必须是正则表达式所描述的形式；")]),s._v(" "),t("li",[t("code",[s._v("spec.replicas")]),s._v(" 必须是一个整数，且其最小值为 1、最大值为 10。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名字必需与下面的 spec 字段匹配，并且格式为 '<名称的复数形式>.<组名>'")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组名称，用于 REST API: /apis/<组>/<版本>")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列举此 CustomResourceDefinition 所支持的版本")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个版本都可以通过 served 标志来独立启用或禁止")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 其中一个且只有一个版本必需被标记为存储版本")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加正则表达式")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n                  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  设置副本数为的最小值和最大值")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maximum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以是 Namespaced 或 Cluster")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名称的复数形式，用于 URL：/apis/<组>/<版本>/<名称的复数形式>")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kind 通常是单数形式的驼峰编码（CamelCased）形式。你的资源清单会使用这一形式。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shortNames 允许你在命令行使用较短的字符串来匹配资源")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br")])]),t("p",[s._v("并创建 CustomResourceDefinition：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f resourcedefinition.yaml")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("对于一个创建 CronTab 类别对象的定制对象的请求而言，如果其字段中包含非法值，则 该请求会被拒绝。 在下面 的例子中，定制对象中包含带非法值的字段：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("spec.cronSpec")]),s._v(" 与正则表达式不匹配")]),s._v(" "),t("li",[t("code",[s._v("spec.replicas")]),s._v(" 数值大于 10。")])]),s._v(" "),t("p",[s._v("如果你将下面的 YAML 保存到 my-crontab.yaml ：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * *"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("尝试创建对象，则会报如下错误：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f  my-crontab.yaml ")]),s._v("\nThe CronTab "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-new-cron-object"')]),s._v(" is invalid: \n* spec.replicas: Invalid value: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(": spec.replicas "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" body should be "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" than or equal to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n* spec.cronSpec: Invalid value: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * *"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" spec.cronSpec "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" body should match "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("如果所有字段都包含合法值，则对象创建的请求会被接受。")]),s._v(" "),t("p",[s._v("将下面的 YAML 保存到 my-crontab.yaml 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("并创建定制对象：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f my-crontab.yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("crontab")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-new-cron-object"')]),s._v(" created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"设置默认值"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#设置默认值"}},[s._v("#")]),s._v(" 设置默认值")]),s._v(" "),t("blockquote",[t("p",[s._v("说明： 要使用设置默认值功能，你的 CustomResourceDefinition 必须使用 API 版本 apiextensions.k8s.io/v1 。")])]),s._v(" "),t("p",[s._v("设置默认值的功能允许在 OpenAPI v3 合法性检查模式定义中设置默认值：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5 0 * * *"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maximum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br")])]),t("p",[s._v("使用此 CRD 定义时， cronSpec 和 replicas 都会被设置默认值：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("会生成：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontabs.stable.example.com my-new-cron-object -o yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03T16:41:05Z"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("generation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"81618"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5127b8d6"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("46c1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("48c3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("8b92"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("7cce6c7d3929\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里默认设置了参数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5 0 * * *\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这里也默认设置了参数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("默认值设定的行为发生在定制对象上：")]),s._v(" "),t("ul",[t("li",[s._v("在向 API 服务器发送的请求中，基于请求版本的设定设置默认值；")]),s._v(" "),t("li",[s._v("在从 etcd 读取对象时，使用存储版本来设置默认值；")]),s._v(" "),t("li",[s._v("在 Mutating 准入控制插件执行非空的补丁操作时，基于准入 Webhook 对象 版本设置默认值。")])]),s._v(" "),t("h3",{attrs:{id:"nullable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nullable"}},[s._v("#")]),s._v(" Nullable")]),s._v(" "),t("p",[s._v("设置默认值和字段是否可为空（Nullable）")]),s._v(" "),t("p",[s._v("1.20 版本新增: 对于未设置其 nullable 标志的字段或者将该标志设置为 "),t("code",[s._v("false")]),s._v(" 的字段，其空值（Null）会 在设置默认值之前被剪裁掉。如果对应字段 存在默认值，则默认值会被赋予该字段。当 "),t("code",[s._v("nullable")]),s._v(" 被设置为 "),t("code",[s._v("true")]),s._v(" 时， 字段的空值会被保留，且不会在设置默认值时被覆盖。")]),s._v(" "),t("p",[s._v("例如，给定下面的 OpenAPI 模式定义：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置nullable的可选参数选项")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nullable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nullable")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v(" \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baz")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5 0 * * *"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maximum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n···\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br")])]),t("p",[s._v("像下面这样创建一个为 foo 、 bar 和 baz 设置空值的对象时：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae  \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baz")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("其返回的结果将会是这样的：")]),s._v(" "),t("blockquote",[t("p",[s._v("其中的 foo 字段被剪裁掉并重新设置默认值，因为该字段是不可为空的。 "),t("code",[s._v("bar")]),s._v(" 字段的 "),t("code",[s._v("nullable: true")]),s._v(" 使 得其能够保有其空值。 "),t("code",[s._v("baz 字段则被完全剪裁掉")]),s._v("，因为该字段是不可为空的，并且没有默认值设置。")])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontab my-new-cron-object -o yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("creationTimestamp")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2022-05-03T17:14:31Z"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("generation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resourceVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"84245"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uid")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 73f5fe25"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0aac"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("4631"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("b33a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("a2ed3acebb8b\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("bar")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token null important"}},[s._v("null")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5 0 * * *\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("foo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("h3",{attrs:{id:"openapi-v2-形式发布合法性检查模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#openapi-v2-形式发布合法性检查模式"}},[s._v("#")]),s._v(" OpenAPI v2 形式发布合法性检查模式")]),s._v(" "),t("p",[s._v("CustomResourceDefinition 的结构化的、 启用了剪裁的 OpenAPI v3 合法性检查模式 会在 Kubernetes API 服务器上作为 OpenAPI v2 规约 的一部分发布出来。")]),s._v(" "),t("p",[s._v("kubectl 命令行工具会基于所发布的模式定义来执行 客户端的合法性检查（ "),t("code",[s._v("kubectl create")]),s._v(" 和 "),t("code",[s._v("kubectl apply")]),s._v(" ），为定制资源的模式定义 提供解释（ "),t("code",[s._v("kubectl explain")]),s._v(" ）。 所发布的模式还可被用于其他目的，例如生成 客户端或者生成文档。")]),s._v(" "),t("p",[s._v("OpenAPI v3 合法性检查模式定义会被转换为 OpenAPI v2 模式定义，并出现在 OpenAPI v2 规范 的 definitions 和 paths 字段中。")]),s._v(" "),t("p",[s._v("在转换过程中会发生以下修改，目的是保持与 1.13 版本以前的 kubectl 工具兼容。 这些修改可以避免 kubectl 过于严格，以至于拒绝它无法理解的 OpenAPI 模式定义。 转换过程不会更改 CRD 中定义的合法性检查 模式定义，因此不会影响到 API 服务器中 的合法性检查。")]),s._v(" "),t("ol",[t("li",[s._v("以下字段会被移除，因为它们在 OpenAPI v2 中不支持（在将来版本中将使用 OpenAPI v3， 因而不会有 这些限制） 字段 "),t("code",[s._v("allOf")]),s._v(" 、 "),t("code",[s._v("anyOf")]),s._v(" 、 "),t("code",[s._v("oneOf")]),s._v(" 和 "),t("code",[s._v("not")]),s._v(" 会被删除")]),s._v(" "),t("li",[s._v("如果设置了 "),t("code",[s._v("nullable: true")]),s._v(" ，我们会丢弃 "),t("code",[s._v("type")]),s._v(" 、 "),t("code",[s._v("nullable")]),s._v(" 、 "),t("code",[s._v("items")]),s._v(" 和 "),t("code",[s._v("properties")]),s._v(" OpenAPI v2 无法 表达 Nullable。为了避免 kubectl 拒绝正常的对象，这一转换是必要的。")])]),s._v(" "),t("h3",{attrs:{id:"额外的打印列"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#额外的打印列"}},[s._v("#")]),s._v(" 额外的打印列")]),s._v(" "),t("p",[t("code",[s._v("kubectl")]),s._v(" 工具依赖服务器端的输出格式化。你的集群的 API 服务器决定 "),t("code",[s._v("kubectl get")]),s._v(" 命令要显示的列有哪 些。 你可以为 CustomResourceDefinition 定制这些要打印的列。 下面的例子添加了 "),t("code",[s._v("Spec")]),s._v(" 、 "),t("code",[s._v("Replicas")]),s._v(" 和 "),t("code",[s._v("Age")]),s._v(" 列：")]),s._v(" "),t("p",[s._v("将此 CustomResourceDefinition 保存到 resourcedefinition.yaml 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1 \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pattern")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'^(\\d+|\\*)(/\\d+)?(\\s+(\\d+|\\*)(/\\d+)?){4}$'")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5 0 * * *"')]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("minimum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maximum")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("default")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加额外的打印")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("additionalPrinterColumns")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Spec\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" The cron spec defining the interval a CronJob is run\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jsonPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .spec.cronSpec\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Replicas\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" The number of jobs launched by the CronJob\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jsonPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .spec.replicas\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Age\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" date\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("jsonPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .metadata.creationTimestamp    \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br")])]),t("p",[s._v("创建 CustomResourceDefinition：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f resourcedefinition.yaml")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("使用创建好的crontab实例，查看当前的状态。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意输出中的 NAME 、 SPEC 、 REPLICAS 和 AGE 列：")]),s._v(" "),t("p",[t("strong",[s._v("说明")]),s._v("： NAME 列是隐含的，不需要在 CustomResourceDefinition 中定义。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontabs my-new-cron-object ")]),s._v("\nNAME                 SPEC        REPLICAS   AGE\nmy-new-cron-object   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" * * *   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          38m\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#优先级"}},[s._v("#")]),s._v(" 优先级")]),s._v(" "),t("p",[s._v("每个列都包含一个 "),t("code",[s._v("priority")]),s._v(" （优先级）字段。当前，优先级用来区分标准视图（Standard View）和宽视图 （Wide View）（使用 "),t("code",[s._v("-o wide")]),s._v(" 标志）中显示的列：")]),s._v(" "),t("ul",[t("li",[s._v("优先级为 "),t("code",[s._v("0")]),s._v(" 的列会在标准视图中显示。")]),s._v(" "),t("li",[s._v("优先级大于 "),t("code",[s._v("0")]),s._v(" 的列只会在宽视图中显示。")])]),s._v(" "),t("h3",{attrs:{id:"类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[s._v("#")]),s._v(" 类型")]),s._v(" "),t("p",[s._v("列的 type 字段可以是以下值之一 （比较 OpenAPI v3 数据类型）：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("integer")]),s._v(" – 非浮点数字")]),s._v(" "),t("li",[t("code",[s._v("number")]),s._v(" – 浮点数字")]),s._v(" "),t("li",[t("code",[s._v("string")]),s._v(" – 字符串")]),s._v(" "),t("li",[t("code",[s._v("boolean")]),s._v(" – "),t("code",[s._v("true")]),s._v(" 或 "),t("code",[s._v("false")])]),s._v(" "),t("li",[t("code",[s._v("date")]),s._v(" – 显示为以自此时间戳以来经过的时长")])]),s._v(" "),t("h3",{attrs:{id:"格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#格式"}},[s._v("#")]),s._v(" 格式")]),s._v(" "),t("p",[s._v("列的 format 字段可以是以下值之一：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("int32")])]),s._v(" "),t("li",[t("code",[s._v("int64")])]),s._v(" "),t("li",[t("code",[s._v("float")])]),s._v(" "),t("li",[t("code",[s._v("double")])]),s._v(" "),t("li",[t("code",[s._v("byte")])]),s._v(" "),t("li",[t("code",[s._v("date")])]),s._v(" "),t("li",[t("code",[s._v("date-time")])]),s._v(" "),t("li",[t("code",[s._v("password")])])]),s._v(" "),t("p",[s._v("列的 format 字段控制 kubectl 打印对应取值时采用的风格。")]),s._v(" "),t("h3",{attrs:{id:"子资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#子资源"}},[s._v("#")]),s._v(" 子资源")]),s._v(" "),t("p",[s._v("定制资源支持 "),t("code",[s._v("/status")]),s._v(" 和 "),t("code",[s._v("/scale")]),s._v(" 子资源。 通过在 CustomResourceDefinition 中定义 "),t("code",[s._v("status")]),s._v(" 和 "),t("code",[s._v("scale")]),s._v(" ， 可以有选择地启用这些子资源。")]),s._v(" "),t("h3",{attrs:{id:"status-子资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#status-子资源"}},[s._v("#")]),s._v(" Status 子资源")]),s._v(" "),t("p",[s._v("当启用了 status 子资源时，对应定制资源的 "),t("code",[s._v("/status")]),s._v(" 子资源会被暴露出来。")]),s._v(" "),t("ol",[t("li",[s._v("status 和 spec 内容分别用定制资源内的 "),t("code",[s._v(".status")]),s._v(" 和 "),t("code",[s._v(".spec JSON")]),s._v(" 路径来表达；")]),s._v(" "),t("li",[s._v("对 "),t("code",[s._v("/status")]),s._v(" 子资源的 "),t("code",[s._v("PUT")]),s._v(" 请求要求使用定制资源对象作为其输入，但会忽略 status 之外的所有内容。")]),s._v(" "),t("li",[s._v("对 "),t("code",[s._v("/status")]),s._v(" 子资源的 "),t("code",[s._v("PUT")]),s._v(" 请求仅对定制资源的 status 内容进行合法性检查。")]),s._v(" "),t("li",[s._v("对定制资源的 "),t("code",[s._v("PUT")]),s._v(" 、 "),t("code",[s._v("POST")]),s._v(" 、 "),t("code",[s._v("PATCH")]),s._v(" 请求会忽略 status 内容的改变。")]),s._v(" "),t("li",[s._v("对所有变更请求，除非改变是针对 "),t("code",[s._v(".metadata")]),s._v(" 或 "),t("code",[s._v(".status")]),s._v(" ， "),t("code",[s._v(".metadata.generation")]),s._v(" 的取值都会增加。 在 CRD")])]),s._v(" "),t("p",[s._v("OpenAPI 合法性检查模式定义的根节点，只允许存在以下结构：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("description")])]),s._v(" "),t("li",[t("code",[s._v("example")])]),s._v(" "),t("li",[t("code",[s._v("exclusiveMaximum")])]),s._v(" "),t("li",[t("code",[s._v("exclusiveMinimum")])]),s._v(" "),t("li",[t("code",[s._v("externalDocs format")])]),s._v(" "),t("li",[t("code",[s._v("items")])]),s._v(" "),t("li",[t("code",[s._v("maximum")])]),s._v(" "),t("li",[t("code",[s._v("maxItems")])]),s._v(" "),t("li",[t("code",[s._v("maxLength")])]),s._v(" "),t("li",[t("code",[s._v("minimum")])]),s._v(" "),t("li",[t("code",[s._v("minItems")])]),s._v(" "),t("li",[t("code",[s._v("minLength")])]),s._v(" "),t("li",[t("code",[s._v("multipleOf")])]),s._v(" "),t("li",[t("code",[s._v("pattern")])]),s._v(" "),t("li",[t("code",[s._v("properties")])]),s._v(" "),t("li",[t("code",[s._v("required")])]),s._v(" "),t("li",[t("code",[s._v("title")])]),s._v(" "),t("li",[t("code",[s._v("type")])]),s._v(" "),t("li",[t("code",[s._v("uniqueItems")])])]),s._v(" "),t("h3",{attrs:{id:"scale-子资源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#scale-子资源"}},[s._v("#")]),s._v(" Scale 子资源")]),s._v(" "),t("p",[s._v("当启用了 scale 子资源时，定制资源的 "),t("code",[s._v("/scale")]),s._v(" 子资源就被暴露出来。 针对 "),t("code",[s._v("/scale")]),s._v(" 所发送的对象是 "),t("code",[s._v("autoscaling/v1.Scale")]),s._v("。")]),s._v(" "),t("p",[s._v("为了启用 scale 子资源，CustomResourceDefinition 定义了以下字段：")]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("specReplicasPath")]),s._v(" 指定定制资源内与 "),t("code",[s._v("scale.spec.replicas")]),s._v(" 对应的 JSON 路径。")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("此字段为必需值。")])]),s._v(" "),t("li",[t("p",[s._v("只可以使用 "),t("code",[s._v(".spec")]),s._v(" 下的 JSON 路径，只可使用带句点的路径。")])]),s._v(" "),t("li",[t("p",[s._v("如果定制资源的 "),t("code",[s._v("specReplicasPath")]),s._v(" 下没有取值，则针对 "),t("code",[s._v("/scale")]),s._v(" 子资源执行 GET 操作时会返回错 误。")])])])]),s._v(" "),t("li",[t("p",[t("code",[s._v("statusReplicasPath")]),s._v(" 指定定制资源内与 "),t("code",[s._v("scale.status.replicas")]),s._v(" 对应的 JSON 路径。")])]),s._v(" "),t("li",[t("p",[s._v("此字段为必需值。")])]),s._v(" "),t("li",[t("p",[s._v("只可以使用 "),t("code",[s._v(".status")]),s._v(" 下的 JSON 路径，只可使用带句点的路径。")])]),s._v(" "),t("li",[t("p",[s._v("如果定制资源的 "),t("code",[s._v("statusReplicasPath")]),s._v(" 下没有取值，则针对 "),t("code",[s._v("/scale")]),s._v(" 子资源的 副本个数状态值默认为 0。")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("labelSelectorPath")]),s._v(" 指定定制资源内与 "),t("code",[s._v("scale.status.selector")]),s._v(" 对应的 JSON 路径。")]),s._v(" "),t("ul",[t("li",[s._v("此字段为可选值。")]),s._v(" "),t("li",[s._v("此字段必须设置才能使用 "),t("code",[s._v("HPA")]),s._v("。")]),s._v(" "),t("li",[s._v("只可以使用 "),t("code",[s._v(".status")]),s._v(" 或 "),t("code",[s._v(".spec")]),s._v(" 下的 JSON 路径，只可使用带句点的路径。")]),s._v(" "),t("li",[s._v("如果定制资源的 "),t("code",[s._v("labelSelectorPath")]),s._v(" 下没有取值，则针对 "),t("code",[s._v("/scale")]),s._v(" 子资源的 选择算符状态值默认为空 字符串。")]),s._v(" "),t("li",[s._v("此 JSON 路径所指向的字段必须是一个字符串字段（而不是复合的选择算符结构）， 其中包含标签选择 算符串行化的字符串形式。")])])])]),s._v(" "),t("p",[s._v("在下面的例子中， "),t("code",[s._v("status")]),s._v(" 和 "),t("code",[s._v("scale")]),s._v(" 子资源都被启用。")]),s._v(" "),t("p",[s._v("将此 CustomResourceDefinition 保存到 "),t("code",[s._v("resourcedefinition.yaml")]),s._v(" 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1 \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  subresources 描述定制资源的子资源")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subresources")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# status 启用 status 子资源")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scale 启用 scale 子资源")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scale")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# specReplicasPath 定义定制资源中对应的 scale.spec.replicas 的 JSON 路径")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("specReplicasPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .spec.replicas\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# statusReplicasPath 定义定制资源中对应的 scale.status.replicas 的 JSON 路径")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("statusReplicasPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .status.replicas \n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# labelSelectorPath 定义定制资源中对应 scale.status.selector 的 JSON 路径")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelectorPath")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" .status.labelSelector \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br")])]),t("p",[s._v("CustomResourceDefinition 对象创建完毕之后，你可以创建定制对象。")]),s._v(" "),t("p",[s._v("如果你将下面的 YAML 保存到 my-crontab.yaml 文件：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat  my-crontab.yaml  ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com/v1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("new"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("object \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("awesome"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cron"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("imagae   \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("定制资源可以使用 kubectl scale 命令来扩缩其规模。 例如下面的命令将前面创建的定制资源的 .spec.replicas 设置为 5：")]),s._v(" "),t("blockquote",[t("p",[s._v("注意： 你可以使用 PodDisruptionBudget 来保护启用了 scale 子资源的定制资源。")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f my-crontab.yaml  ")]),s._v("\ncrontab.stable.example.com/my-new-cron-object created\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl scale  --replicas=5 crontabs.stable.example.com my-new-cron-object ")]),s._v("\ncrontab.stable.example.com/my-new-cron-object scaled\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get  crontabs.stable.example.com my-new-cron-object -o jsonpath='{.spec.replicas}'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h3",{attrs:{id:"分类"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#分类"}},[s._v("#")]),s._v(" 分类")]),s._v(" "),t("p",[s._v("分类（Categories）是定制资源所归属的分组资源列表（例如， "),t("code",[s._v("all")]),s._v(" ）。 你可以使用 "),t("code",[s._v("kubectl get <分类名称>")]),s._v(" 来列举属于某分类的所有资源。")]),s._v(" "),t("p",[s._v("下面的示例在 CustomResourceDefinition 中将 "),t("code",[s._v("all")]),s._v(" 添加到分类列表中， 并展示了如何使用 "),t("code",[s._v("kubectl get all")]),s._v(" 来输出定制资源：")]),s._v(" "),t("p",[s._v("将下面的 CustomResourceDefinition 保存到 "),t("code",[s._v("resourcedefinition.yaml")]),s._v(" 文件中：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1 \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cronSpec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("status")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" integer \n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labelSelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n                  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct  \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一个分类归属")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("categories")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" crontab"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("all \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br")])]),t("p",[s._v("创建了 CustomResourceDefinition 对象之后，你可以创建定制对象。")]),s._v(" "),t("p",[s._v("将下面的 YAML 保存到 "),t("code",[s._v("my-crontab.yaml")]),s._v(" 中：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat my-crontab.yaml ")]),s._v("\napiVersion: stable.example.com/v1 \nkind: CronTab \nmetadata: \n  name: my-new-cron-object \nspec: \n  image: my-awesome-cron-imagae   \n  cronSpec: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"* * * * */5"')]),s._v("\n  replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" \n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f my-crontab.yaml ")]),s._v("\ncrontab.stable.example.com/my-new-cron-object unchanged\n\n"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'你可以在使用 kubectl get 时指定分类：'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get crontab-all ")]),s._v("\nNAME                 AGE\nmy-new-cron-object   2m3s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("h2",{attrs:{id:"crd的版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#crd的版本"}},[s._v("#")]),s._v(" CRD的版本")]),s._v(" "),t("h3",{attrs:{id:"概览"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概览"}},[s._v("#")]),s._v(" 概览")]),s._v(" "),t("p",[s._v("CustomResourceDefinition API 提供了用于引入和升级的工作流程到 CustomResourceDefinition 的新 版本。")]),s._v(" "),t("p",[s._v("创建 CustomResourceDefinition 时，会在 CustomResourceDefinition spec.versions 列表设置适当 的稳定级别和版本号。例如， v1beta1 表示第一个版本尚未稳定。 所有定制资源对象将首先用这个版本保存。")]),s._v(" "),t("p",[s._v("创建 CustomResourceDefinition 后，客户端可以开始使用 v1beta1 API,稍后可能需要添加新版本，例如 v1 。")]),s._v(" "),t("p",[t("strong",[s._v("添加新版本：")])]),s._v(" "),t("ol",[t("li",[s._v("选择一种转化策略。由于定制资源对象需要能够两种版本都可用， 这意味着它们有时会以与存储版本不同的版 本来提供服务。为了能够做到这一点， 有时必须在它们存储的版本和提供的版本之间进行转换。如果转换涉及 模式变更， 并且需要自定义逻辑，则应该使用 Webhook 来完成。如果没有模式变更， 则可使用默认的 "),t("code",[s._v("None")]),s._v(" 转换策略，为不同版本提供服务时只有 "),t("code",[s._v("apiVersion")]),s._v(" 字段 会被改变。")]),s._v(" "),t("li",[s._v("如果使用转换 Webhook，请创建并部署转换 Webhook。更多详细信息请参见 Webhook conversion。")]),s._v(" "),t("li",[s._v("更新 CustomResourceDefinition，将新版本设置为 "),t("code",[s._v("served：true")]),s._v(" ，加入到 "),t("code",[s._v("spec.versions")]),s._v(" 列表。另 外，还要设置 "),t("code",[s._v("spec.conversion")]),s._v(" 字段 为所选的转换策略。如果使用转换 Webhook，请配置 "),t("code",[s._v("spec.conversion.webhookClientConfig")]),s._v(" 来调用 Webhook。")])]),s._v(" "),t("p",[s._v("对于客户来说，在将对象升级到新的存储版本之前、期间和之后使用旧版本和新版本都是安全的。")]),s._v(" "),t("p",[t("strong",[s._v("删除旧版本：")])]),s._v(" "),t("ol",[t("li",[s._v("确保所有客户端都已完全迁移到新版本。 可以查看 kube-apiserver 的日志以识别仍通过旧版本进行访问 的所有客户端。")]),s._v(" "),t("li",[s._v("在 "),t("code",[s._v("spec.versions")]),s._v(" 列表中将旧版本的 "),t("code",[s._v("served")]),s._v(" 设置为 "),t("code",[s._v("false")]),s._v(" 。 如果仍有客户端意外地使用旧版本，他们 可能开始会报告采用旧版本尝试访 定制资源的错误消息。 如果发生这种情况，请将旧版本的 "),t("code",[s._v("served：true")]),s._v(" 恢 复，然后迁移余下的客户端 使用新版本，然后重复此步骤。")]),s._v(" "),t("li",[s._v("确保已完成将现有对象升级到新存储版本 的步骤。\n"),t("ul",[t("li",[s._v("CustomResourceDefinition 的 "),t("code",[s._v("spec.versions")]),s._v(" 列表中，确认新版本的 "),t("code",[s._v("stored")]),s._v(" 已被设置为 "),t("code",[s._v("true")]),s._v(" 。")]),s._v(" "),t("li",[s._v("确认旧版本不在 CustomResourceDefinition "),t("code",[s._v("status.storedVersions")]),s._v(" 中。")])])]),s._v(" "),t("li",[s._v("从 CustomResourceDefinition "),t("code",[s._v("spec.versions")]),s._v(" 列表中删除旧版本。")]),s._v(" "),t("li",[s._v("在转换 Webhooks 中放弃对旧版本的转换支持。")])]),s._v(" "),t("h3",{attrs:{id:"指定多个版本"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#指定多个版本"}},[s._v("#")]),s._v(" 指定多个版本")]),s._v(" "),t("p",[s._v("CustomResourceDefinition API 的 "),t("code",[s._v("versions")]),s._v(" 字段可用于支持你所开发的 定制资源的多个版本。版本可以 具有不同的模式，并且转换 Webhooks 可以在多个版本之间转换定制资源。 在适当的情况下，Webhook 转换应遵 循 Kubernetes API 约定。 尤其是，请查阅 API 变更文档 以了解一些有用的常见错误和建议。")]),s._v(" "),t("blockquote",[t("p",[s._v("说明： 在 apiextensions.k8s.io/v1beta1 版本中曾经有一个 version 字段， 名字不叫做 versions 。该 version 字 段已经被废弃，成为可选项。 不过如果该字段不是空，则必须与 versions 字段中的第一个条目匹配。")])]),s._v(" "),t("p",[s._v("下面的示例显示了两个版本的 CustomResourceDefinition。 第一个例子中假设所有的版本使用相同的模式而它 们之间没有转换。 YAML 中的注释提供了更多背景信息。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("apiextensions.k8s.io/v1")])]),s._v(" "),t("li",[t("code",[s._v("apiextensions.k8s.io/v1beta1")])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# name 必须匹配后面 spec 中的字段，且使用格式 <plural>.<group>")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.stable.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 组名，用于 REST API: /apis/<group>/<version>")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" stable.example.com\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此 CustomResourceDefinition 所支持的版本列表")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1beta1 \n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 每个 version 可以通过 served 标志启用或禁止")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 有且只能有一个 version 必须被标记为存储版本")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# schema 是必需字段")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# openAPIV3Schema 是用来检查定制对象的模式定义 ")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1 \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n              "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# conversion 节是 Kubernetes 1.13+ 版本引入的，其默认值为无转换，即")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# strategy 子字段设置为 None。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("conversion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# None 转换假定所有版本采用相同的模式定义，仅仅将定制资源的 apiVersion")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置为合适的值.")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategy")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" None \n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以是 Namespaced 或 Cluster")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名称的复数形式，用于 URL: /apis/<group>/<version>/<plural>")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 名称的单数形式，用于在命令行接口和显示时作为其别名")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kind 通常是驼峰编码（CamelCased）的单数形式，用于资源清单中")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# shortNames 允许你在命令行接口中使用更短的字符串来匹配你的资源")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("shortNames")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ct \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("blockquote",[t("p",[s._v("注意： 在创建之后，API 服务器开始在 HTTP REST 端点上为每个已启用的版本提供服务。 在上面的示例中，API 版本 可以在 /apis/example.com/v1beta1 和 /apis/example.com/v1 处获得。")])]),s._v(" "),t("h3",{attrs:{id:"版本优先级"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本优先级"}},[s._v("#")]),s._v(" 版本优先级")]),s._v(" "),t("p",[s._v("不考虑 CustomResourceDefinition 中版本被定义的顺序，kubectl 使用 具有最高优先级的版本作为访问对 象的默认版本。 通过解析 name 字段确定优先级来决定版本号，稳定性（GA、Beta 或 Alpha） 级别及该稳定性 级别内的序列。")]),s._v(" "),t("p",[s._v("用于对版本进行排序的算法在设计上与 Kubernetes 项目对 Kubernetes 版本进行排序的方式相同。 版本以 "),t("code",[s._v("v")]),s._v(" 开头跟一个数字，一个可选的 "),t("code",[s._v("beta")]),s._v(" 或者 "),t("code",[s._v("alpha")]),s._v(" 和一个可选的附加数字 作为版本信息。 从广义上讲， 版本字符串可能看起来像 "),t("code",[s._v("v2")]),s._v(" 或者 "),t("code",[s._v("v2beta1")]),s._v(" 。 使用以下算法对版本进行排序：")]),s._v(" "),t("ul",[t("li",[s._v("遵循 Kubernetes 版本模式的条目在不符合条件的条目之前进行排序。")]),s._v(" "),t("li",[s._v("对于遵循 Kubernetes 版本模式的条目，版本字符串的数字部分从最大到最小排序。")]),s._v(" "),t("li",[s._v("如果第一个数字后面有字符串 "),t("code",[s._v("beta")]),s._v(" 或 "),t("code",[s._v("alpha")]),s._v(" ，它们首先按去掉 "),t("code",[s._v("beta")]),s._v(" 或 "),t("code",[s._v("alpha")]),s._v(" 之后的版本号排序 （相当于 GA 版本），之后按 "),t("code",[s._v("beta")]),s._v(" 先、 "),t("code",[s._v("alpha")]),s._v(" 后的顺序排序， 版本优先级 CustomResourceDefinition 的版本")]),s._v(" "),t("li",[s._v("如果 "),t("code",[s._v("beta")]),s._v(" 或 "),t("code",[s._v("alpha")]),s._v(" 之后还有另一个数字，那么也会针对这些数字 从大到小排序。")]),s._v(" "),t("li",[s._v("不符合上述格式的字符串按字母顺序排序，数字部分不经过特殊处理。 请注意，在下面的示例中， foo1 排在 foo10 之前。 这与遵循 Kubernetes 版本模式的条目的数字部分排序不同。")])]),s._v(" "),t("p",[s._v("如果查看以下版本排序列表，这些规则就容易懂了：")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v10\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v2\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v1\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v11beta2\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v10beta3\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v3beta1\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v12alpha1\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" v11alpha2\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" foo1\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" foo10\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"版本废弃"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#版本废弃"}},[s._v("#")]),s._v(" 版本废弃")]),s._v(" "),t("p",[s._v("从 v1.19 开始，CustomResourceDefinition 可用来标明所定义的资源的特定版本 被废弃。当发起对已废弃的 版本的 API 请求时，会在 API 响应中以 HTTP 头部 的形式返回警告消息。 如果需要，可以对资源的每个废弃版 本定制该警告消息。")]),s._v(" "),t("p",[s._v("定制的警告消息应该标明废弃的 API 组、版本和类别（kind），并且应该标明 应该使用（如果有的话）哪个 API 组、版本和类别作为替代。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("apiextensions.k8s.io/v1")])]),s._v(" "),t("li",[t("code",[s._v("apiextensions.k8s.io/v1beta1")])])]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apiextensions.k8s.io/v1\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CustomResourceDefinition\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs.example.com\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("group")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example.com\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("names")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("plural")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontabs\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("singular")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" crontab\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scope")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Namespaced\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("versions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1alpha1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("false")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此属性标明此定制资源的 v1alpha1 版本已被弃用。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发给此版本的 API 请求会在服务器响应中收到警告消息头。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deprecated")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 此属性设置用来覆盖返回给发送 v1alpha1 API 请求的客户端的默认警告信息。")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("deprecationWarning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"example.com/v1alpha1 CronTab is deprecated; Please Update !!!"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("txt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("served")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("openAPIV3Schema")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" object\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("properties")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("txt")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" string\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br")])]),t("p",[s._v("通过创建"),t("code",[s._v("v1alpha1")]),s._v("版本的资源，触发告警。")]),s._v(" "),t("div",{staticClass:"language-yaml line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat test-crontab.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example.com/v1alpha1 \n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" CronTab\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tes\n  \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f test-crontab.yaml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("Warning")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" example.com/v1alpha1 CronTab is deprecated; Please Update "),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),t("span",{pre:!0,attrs:{class:"token tag"}},[s._v("!")]),s._v(" \ncrontab.example.com/test created\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);