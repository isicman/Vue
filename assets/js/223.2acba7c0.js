(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{704:function(s,t,a){"use strict";a.r(t);var e=a(19),r=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"prometheus-grafana监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-grafana监控"}},[s._v("#")]),s._v(" Prometheus + Grafana监控")]),s._v(" "),a("h2",{attrs:{id:"prometheus-入门"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-入门"}},[s._v("#")]),s._v(" Prometheus 入门")]),s._v(" "),a("ul",[a("li",[s._v("Prometheus 受启发于 Google 的 Brogmon 监控系统"),a("code",[s._v("（相似的 Kubernetes 是从 Google的 Brog 系统演变而来）")]),s._v("，从 2012 年开始由前 Google 工程师在 Soundcloud 以开源软件的形式进行研发，并且于 2015 年早期对外发布早期版本。")]),s._v(" "),a("li",[s._v("2016 年 5 月继 Kubernetes 之后成为第二个正式加入 CNCF 基金会的项目，同年 6 月正式发布 1.0 版本。"),a("code",[s._v("2017 年底发布了基于全新存储层的 2.0 版本，能更好地与容器平台、云平台配合。")])]),s._v(" "),a("li",[a("code",[s._v("Prometheus")]),s._v("作为新一代的云原生监控系统，目前已经有超过 650+位贡献者参与到"),a("code",[s._v("Prometheus")]),s._v("的研发工作上，并且超过 120+项的第三方集成。")])]),s._v(" "),a("h2",{attrs:{id:"prometheus-的特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-的特点"}},[s._v("#")]),s._v(" Prometheus 的特点")]),s._v(" "),a("p",[s._v("Prometheus 是一个开源的完整监控解决方案，其对传统监控系统的测试和告警模型进行了彻底的颠覆，"),a("code",[s._v("形成了基于中央化的规则计算、统一分析和告警的新模型。")]),s._v(" 相比于传统监控系统，Prometheus 具有以下优点：")]),s._v(" "),a("h3",{attrs:{id:"易于管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#易于管理"}},[s._v("#")]),s._v(" 易于管理")]),s._v(" "),a("p",[s._v("➢ Prometheus 核心部分只有一个单独的"),a("code",[s._v("二进制文件")]),s._v("，不存在任何的第三方依赖(数据库，缓存等等)。唯一需要的就是"),a("code",[s._v("本地磁盘")]),s._v("，因此不会有潜在级联故障的风险。\n➢ Prometheus 基于 "),a("code",[s._v("Pull 模型")]),s._v("的架构方式，可以在任何地方（本地电脑，开发环境，测试环境）搭建我们的监控系统。\n➢ 对于一些复杂的情况，还可以使用 Prometheus "),a("code",[s._v("服务发现(Service Discovery)")]),s._v("的能力动态管理监控目标。")]),s._v(" "),a("h3",{attrs:{id:"监控服务的内部运行状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#监控服务的内部运行状态"}},[s._v("#")]),s._v(" 监控服务的内部运行状态")]),s._v(" "),a("p",[s._v("Pometheus 鼓励用户监控服务的内部状态，基于 Prometheus 丰富的 Client 库，用户可以轻松的在应用程序中添加对 Prometheus 的支持，从而让用户可以获取服务和应用内部真正的运行状态。\n"),a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111234266.png",alt:"image-20211209142129953"}})]),s._v(" "),a("h3",{attrs:{id:"强大的数据模型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强大的数据模型"}},[s._v("#")]),s._v(" 强大的数据模型")]),s._v(" "),a("p",[s._v("所有采集的监控数据均以指标(metric)的形式保存在"),a("code",[s._v("内置的时间序列数据库")]),s._v("当中"),a("code",[s._v("(TSDB)")]),s._v("。所有的样本除了基本的指标名称以外，还包含一组用于描述该样本特征的标签。\n如下所示：")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[s._v("http_request_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("code='"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("content_path='/api/path'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("environment='produment'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" => \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("value1@timestamp1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("value2@timestamp2..."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("每一条时间序列由指标名称(Metrics Name)以及一组标签(Labels)唯一标识。每条时\n间序列按照时间的先后顺序存储一系列的样本值。\n➢ http_request_status："),a("code",[s._v("指标名称(Metrics Name)")]),s._v("\n➢ {code='200',content_path='/api/path',environment='produment'}："),a("code",[s._v("表示维度的标签")]),s._v("，基于这些 Labels 我们可以方便地对监控数据进行聚合，过滤，裁剪。\n➢ [value1@timestamp1,value2@timestamp2...]："),a("code",[s._v("按照时间的先后顺序 存储的样本值。")])]),s._v(" "),a("h3",{attrs:{id:"强大的查询语言-promql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#强大的查询语言-promql"}},[s._v("#")]),s._v(" 强大的查询语言 PromQL")]),s._v(" "),a("p",[s._v("Prometheus 内置了一个强大的数据查询语言 PromQL。 通过 PromQL 可以实现对监控数据的查询、聚合。同时 PromQL 也被应用于数据可视化(如 Grafana)以及告警当中。\n通过 PromQL 可以轻松回答类似于以下问题：\n➢ "),a("code",[s._v("在过去一段时间中 95%应用延迟时间的分布范围？")]),s._v("\n➢ "),a("code",[s._v("预测在 4 小时后，磁盘空间占用大致会是什么情况？")]),s._v("\n➢ "),a("code",[s._v("CPU 占用率前 5 位的服务有哪些？(过滤)")])]),s._v(" "),a("h3",{attrs:{id:"高效"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高效"}},[s._v("#")]),s._v(" 高效")]),s._v(" "),a("p",[s._v("对于监控系统而言，大量的监控任务必然导致有大量的数据产生。而 Prometheus 可\n以高效地处理这些数据，对于单一 "),a("code",[s._v("Prometheus Server")]),s._v(" 实例而言它可以处理：\n➢ "),a("code",[s._v("数以百万的监控指标")]),s._v("\n➢ "),a("code",[s._v("每秒处理数十万的数据点")])]),s._v(" "),a("h3",{attrs:{id:"可扩展"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可扩展"}},[s._v("#")]),s._v(" 可扩展")]),s._v(" "),a("p",[s._v("可以在每个数据中心、"),a("code",[s._v("每个团队运行独立的 Prometheus Sevrer")]),s._v("。Prometheus 对于联邦集群的支持，可以让多个 Prometheus 实例产生一个逻辑集群，当单"),a("code",[s._v("实例 Prometheus Server 处理的任务量过大时，通过使用功能分区(sharding)+联邦集群(federation)可以对其进行扩展")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"易于集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#易于集成"}},[s._v("#")]),s._v(" 易于集成")]),s._v(" "),a("ul",[a("li",[s._v("使用 Prometheus 可以快速搭建监控服务，并且可以非常方便地在应用程序中进行集成。"),a("code",[s._v("目前支持：Java，JMX，Python，Go，Ruby，.Net，Node.js")]),s._v("等等语言的客户端 SDK，基于这些 SDK 可以快速让应用程序纳入到 Prometheus 的监控当中，或者开发自己的监控数据收集程序。")]),s._v(" "),a("li",[s._v("同时这些客户端收集的监控数据，不仅仅支持 Prometheus，"),a("code",[s._v("还能支持 Graphite 这些其他的监控工具")]),s._v("。")]),s._v(" "),a("li",[s._v("同时 Prometheus 还支持与其他的监控系统进行集成：Graphite，Statsd，Collected，Scollector， muini， Nagios 等。 Prometheus 社区还"),a("code",[s._v("提供了大量第三方实现的监控数据采集支持")]),s._v("：JMX，CloudWatch，EC2，MySQL，PostgresSQL，Haskell，Bash，SNMP，Consul，Haproxy，Mesos，Bind，CouchDB，Django，Memcached，RabbitMQ，Redis，RethinkDB，Rsyslog 等等。")])]),s._v(" "),a("h3",{attrs:{id:"可视化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#可视化"}},[s._v("#")]),s._v(" 可视化")]),s._v(" "),a("p",[s._v("➢ Prometheus Server 中自带的 Prometheus UI，可以方便地直接对数据进行查询，并且支持直接以图形化的形式展示数据。同时 Prometheus 还提供了一个独立的基于Ruby On Rails 的 Dashboard 解决方案 Promdash。\n➢ 最新的"),a("code",[s._v("Grafana")]),s._v("可视化工具也已经提供了完整的 Prometheus 支持，"),a("code",[s._v("基于 Grafana 可以创建更加精美的监控图标")]),s._v("。\n➢ 基于 Prometheus "),a("code",[s._v("提供的 API 还可以实现自己的监控可视化 UI")]),s._v("。")]),s._v(" "),a("h3",{attrs:{id:"开放性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开放性"}},[s._v("#")]),s._v(" 开放性")]),s._v(" "),a("p",[s._v("通常来说当我们需要监控一个应用程序时，一般需要该应用程序提供对相应监控系统协议的支持，因此应用程序会与所选择的监控系统进行绑定。为了减少这种绑定所带来的限制，对于决策者而言要么你就直接在应用中集成该监控系统的支持，要么就在外部创建单独的服务来适配不同的监控系统。")]),s._v(" "),a("p",[s._v("而对于 Prometheus 来说，使用 Prometheus 的 client library 的输出格式不止支持Prometheus 的格式化数据，也可以输出支持其它监控系统的格式化数据，比如 Graphite。因此你甚至可以在不使用 Prometheus 的情况下，采用 Prometheus 的 client library 来让你的应用程序支持监控数据采集。")]),s._v(" "),a("h2",{attrs:{id:"prometheus-的架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-的架构"}},[s._v("#")]),s._v(" Prometheus 的架构")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111234816.png",alt:"image-20211209143648266"}}),s._v(" "),a("h2",{attrs:{id:"prometheus-生态圈组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-生态圈组件"}},[s._v("#")]),s._v(" Prometheus 生态圈组件")]),s._v(" "),a("p",[s._v("➢ "),a("code",[s._v("Prometheus Server")]),s._v("：主服务器，负责收集和存储时间序列数据\n➢ "),a("code",[s._v("client libraies")]),s._v("：应用程序代码插桩，将监控指标嵌入到被监控应用程序中\n➢ "),a("code",[s._v("Pushgateway")]),s._v("：推送网关，为支持 short-lived 作业提供一个推送网关\n➢ "),a("code",[s._v("exporter")]),s._v("：专门为一些应用开发的数据摄取组件—exporter，例如：HAProxy、StatsD、Graphite 等等。\n➢ "),a("code",[s._v("Alertmanager")]),s._v("：专门用于处理 alert 的组件")]),s._v(" "),a("h3",{attrs:{id:"架构理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#架构理解"}},[s._v("#")]),s._v(" 架构理解")]),s._v(" "),a("p",[a("strong",[s._v("Prometheus 既然设计为一个维度存储模型，可以把它理解为一个 OLAP 系统。")])]),s._v(" "),a("h3",{attrs:{id:"存储计算层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储计算层"}},[s._v("#")]),s._v(" 存储计算层")]),s._v(" "),a("p",[s._v("➢ "),a("code",[s._v("Prometheus Server")]),s._v("，里面包含了存储引擎和计算引擎。\n➢ "),a("code",[s._v("Retrieval")]),s._v(" 组件为取数组件，它会主动从 Pushgateway 或者 Exporter 拉取指标数据。\n➢ "),a("code",[s._v("Service discovery")]),s._v("，可以动态发现要监控的目标。\n➢ "),a("code",[s._v("TSDB")]),s._v("，数据核心存储与查询。\n➢ "),a("code",[s._v("HTTP server")]),s._v("，对外提供 HTTP 服务。")]),s._v(" "),a("h3",{attrs:{id:"采集层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#采集层"}},[s._v("#")]),s._v(" 采集层")]),s._v(" "),a("p",[s._v("采集层分为两类，一类是生命周期较短的作业，还有一类是生命周期较长的作业。\n➢ "),a("code",[s._v("短作业")]),s._v("：直接通过 API，在退出时间指标推送给 Pushgateway。\n➢ "),a("code",[s._v("长作业")]),s._v("：Retrieval 组件直接从 Job 或者 Exporter 拉取数据。")]),s._v(" "),a("h3",{attrs:{id:"应用层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用层"}},[s._v("#")]),s._v(" 应用层")]),s._v(" "),a("p",[s._v("应用层主要分为两种，一种是 AlertManager，另一种是数据可视化。\n➢ "),a("code",[s._v("AlertManager")]),s._v("\n对接 Pagerduty，是一套付费的监控报警系统。可实现短信报警、5 分钟无人 ack 打\n电话通知、仍然无人 ack，通知值班人员 Manager...\nEmial，发送邮件\n... ...\n➢ 数据可视化\nPrometheus build-in WebUI\n"),a("code",[s._v("Grafana")]),s._v("\n其他基于 API 开发的客户端")]),s._v(" "),a("h2",{attrs:{id:"prometheus-的安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-的安装"}},[s._v("#")]),s._v(" Prometheus 的安装")]),s._v(" "),a("h3",{attrs:{id:"安装prometheus-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装prometheus-server"}},[s._v("#")]),s._v(" 安装Prometheus Server")]),s._v(" "),a("p",[s._v("Prometheus 基于 Golang 编写，编译后的软件包，不依赖于任何的第三方依赖。只需 要下载对应平台的二进制包，解压并且添加基本的配置即可正常启动 Prometheus Server。")]),s._v(" "),a("h3",{attrs:{id:"上传安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传安装包"}},[s._v("#")]),s._v(" 上传安装包")]),s._v(" "),a("p",[s._v("上传 prometheus-2.29.1.linux-amd64.tar.gz 到虚拟机的/opt/software 目录")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172860")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25115445")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:47 alertmanager-0.23.0.linux-amd64.tar.gz\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("71283")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:47 flink-dashboard_rev3.json\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60454974")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:48 grafana-enterprise-8.1.2.linux-amd64.tar.gz\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8898481")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:47 node_exporter-1.2.2.linux-amd64.tar.gz\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105600")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:47 node-exporter-for-prometheus-dashboard-cn-v20201010_rev24.json\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("73156341")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:48 prometheus-2.29.1.linux-amd64.tar.gz\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9193207")]),s._v(" Sep "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" 07:47 pushgateway-1.4.1.linux-amd64.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("h3",{attrs:{id:"解压安装包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压安装包"}},[s._v("#")]),s._v(" 解压安装包")]),s._v(" "),a("p",[s._v("解压到/opt/module 目录下")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf prometheus-2.29.1.linux-amd64.tar.gz  -C /opt/module/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("修改文件的目录名")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mv prometheus-2.29.1.linux-amd64 prometheus-2.29.1")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"prometheus配置语法校验"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus配置语法校验"}},[s._v("#")]),s._v(" Prometheus配置语法校验")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./promtool check config prometheus.yml")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"启动prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动prometheus"}},[s._v("#")]),s._v(" 启动Prometheus")]),s._v(" "),a("p",[s._v("此时采用默认"),a("code",[s._v("配置启动")]),s._v(" prometheus server 看下界面, 稍后介绍如何监控Linux 服务器")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./prometheus --config.file=prometheus.yml")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h3",{attrs:{id:"通过浏览器访问prometheus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#通过浏览器访问prometheus"}},[s._v("#")]),s._v(" 通过浏览器访问Prometheus")]),s._v(" "),a("p",[s._v("默认的端口是9090，所以直接访问http://ip:9090")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111234177.png",alt:"image-20211209144834090"}}),s._v(" "),a("p",[s._v("发现target 中只有 prometheus server, 因为我们还没有加入其他监控。")]),s._v(" "),a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111234953.png",alt:"image-20211209144908019"}}),s._v(" "),a("p",[s._v("以下是"),a("code",[s._v("prometheus默认的配置文件")]),s._v("，如果需要监控某一个服务或者集群状态需要在后面添加。")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat prometheus.yml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("evaluation_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alerting")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("alertmanagers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rule_files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("scrape_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("static_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file_sd_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/module/prometheus-2.29.1/sd_cfg/Linux.yml'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refresh_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("h3",{attrs:{id:"prometheus开机自启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prometheus开机自启"}},[s._v("#")]),s._v(" Prometheus开机自启")]),s._v(" "),a("p",[s._v("需要设置system的service服务自启动，添加一个服务自启动项。需要创建一个Prometheus的service。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# touch /usr/lib/systemd/system/prometheus.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /usr/lib/systemd/system/prometheus.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("将如下配置写入prometheus.servie.")]),s._v(" "),a("p",[a("strong",[a("code",[s._v("Prometheus启动参数说明：")])])]),s._v(" "),a("blockquote",[a("ul",[a("li",[s._v("--config.file \t\t\t-- 指明prometheus的配置文件路径")]),s._v(" "),a("li",[s._v("--web.enable-lifecycle    -- 指明prometheus配置更改后可以进行热加载")]),s._v(" "),a("li",[s._v("--storage.tsdb.path       -- 指明监控数据存储路径")]),s._v(" "),a("li",[s._v("--storage.tsdb.retention  --指明数据保留时间")])])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /usr/lib/systemd/system/prometheus.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Prometheus\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://prometheus.io/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simple\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/prometheus-2.29.1/prometheus --config.file"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/prometheus-2.29.1/prometheus.yml --web.enable-lifecycle  --storage.tsdb.path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/opt/module/prometheus-2.29.1/data --storage.tsdb.retention"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("60d\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h3",{attrs:{id:"设置开机启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#设置开机启动"}},[s._v("#")]),s._v(" 设置开机启动")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable prometheus.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status prometheus.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus-2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart prometheus.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("说明: prometheus在2.0之后默认的热加载配置没有开启, 配置修改后, 需要重启prometheus server才能生效, 这对于生产环境的监控是不可容忍的, 所以我们需要开启prometheus server的配置热加载功能.")]),s._v(" "),a("p",[a("code",[s._v("在启动prometheus时加上参数 web.enable-lifecycle , 可以启用配置的热加载, 配置修改后, 热加载配置")]),s._v(":")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X POST  http://localhost:9090/-/reload\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("h2",{attrs:{id:"node-exporter安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter安装配置"}},[s._v("#")]),s._v(" node_exporter安装配置")]),s._v(" "),a("h3",{attrs:{id:"解压软件包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压软件包"}},[s._v("#")]),s._v(" 解压软件包")]),s._v(" "),a("p",[s._v("解压软件包到/usr/local/下面，然后创建一个软连接。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar -zxvf node_exporter-1.2.2.linux-amd64.tar.gz -C /usr/local/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ln -sv /usr/local/node_exporter-0.18.1.linux-amd64 /usr/local/node_exporter ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"node-exporter开机自启"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node-exporter开机自启"}},[s._v("#")]),s._v(" node_exporter开机自启")]),s._v(" "),a("p",[s._v("node_exporter的系统服务配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# touch /usr/lib/systemd/system/node_exporter.service ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /usr/lib/systemd/system/node_exporter.service")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("node_exporter\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Type")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("simple\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("User")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("root\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/node_exporter/node_exporter\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Restart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("on-failure\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"开启服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开启服务"}},[s._v("#")]),s._v(" 开启服务")]),s._v(" "),a("p",[s._v("然后再更新配置文件，生效之后开启服务，然后设置开机自启状态。")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable node_exporter.service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start node_exporter.service")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("node_exporter启动成功后, 你就可以通过如下api看到你的监控数据了，使用http://ip:9100/metrics访问")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235088.png",alt:"image-20211209150910351"}})]),s._v(" "),a("h3",{attrs:{id:"服务配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务配置"}},[s._v("#")]),s._v(" 服务配置")]),s._v(" "),a("p",[s._v("将这个api 配置到 prometheus server中, 并通过grafana进行展示")]),s._v(" "),a("p",[s._v("将 node_exporter 加入 prometheus.yml配置中：")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost prometheus"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("2.29.1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat prometheus.yml")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("job_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Linux'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("file_sd_configs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("files")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/opt/module/prometheus-2.29.1/sd_cfg/Linux.yml'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("refresh_interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("并在文件/opt/module/prometheus-2.29.1/sd_cfg/Linux.yml中写入如下内容")]),s._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sd_cfg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("# cat Linux.yml\n- targets"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v("."),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.105")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9100")]),s._v("'"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  #这里填写要监控的IP\n  labels"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n    name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Linux-node1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("blockquote",[a("p",[s._v("如果你的服务器少, 要监控的组件少的话, 你也可以将配置都写入prometheus的主配置文件prometheus.yml中。")])]),s._v(" "),a("h3",{attrs:{id:"重载prometheus配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重载prometheus配置"}},[s._v("#")]),s._v(" 重载prometheus配置")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sofaware"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST  http://localhost:9090/-/reload")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235751.png",alt:"image-20211209151512276"}}),s._v(" "),a("h2",{attrs:{id:"数据展示grafana安装配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据展示grafana安装配置"}},[s._v("#")]),s._v(" 数据展示Grafana安装配置")]),s._v(" "),a("h3",{attrs:{id:"安装grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装grafana"}},[s._v("#")]),s._v(" 安装Grafana")]),s._v(" "),a("p",[s._v("下载地址: https://grafana.com/grafana/download")]),s._v(" "),a("p",[s._v("拉取Centos7的Grafana的安装包，然后使用yum安装grafana")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://dl.grafana.com/enterprise/release/grafana-enterprise-8.3.1-1.x86_64.rpm")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install grafana-enterprise-8.3.1-1.x86_64.rpm")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"登录grafana"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录grafana"}},[s._v("#")]),s._v(" 登录Grafana")]),s._v(" "),a("p",[s._v("granafa默认端口为"),a("code",[s._v("3000")]),s._v("，可以在浏览器中输入http://localhost:3000/\ngranafa首次登录账户名和密码"),a("code",[s._v("admin/admin")]),s._v("，可以修改")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235785.png",alt:"image-20211209151921554"}})]),s._v(" "),a("h3",{attrs:{id:"配置grafana监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置grafana监控"}},[s._v("#")]),s._v(" 配置Grafana监控")]),s._v(" "),a("ol",[a("li",[a("strong",[s._v("配置数据源"),a("code",[s._v("Data sources")]),s._v("->"),a("code",[s._v("Add data source")]),s._v(" -> "),a("code",[s._v("Prometheus")]),s._v("，输入prometheus数据源的信息，主要是输入name和url")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235688.png",alt:"image-20211209152047101"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235537.png",alt:"image-20211209152115282"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235472.png",alt:"image-20211209152200680"}})]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[s._v("点击+号添加"),a("code",[s._v("Import")]),s._v(" -> 输入"),a("code",[s._v("11074")]),s._v("，导入Linux监控模板. 并配置数据源为Prometheus，即上一步中的name")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235081.png",alt:"image-20211209152435140"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235928.png",alt:"image-20211209152749388"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235952.png",alt:"image-20211209152656461"}})]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[s._v("查看监控的dashboard")])])]),s._v(" "),a("p",[a("strong",[s._v("配置完保存后即可看到逼格非常高的系统主机节点监控信息，包括系统运行时间, 内存和CPU的配置, CPU、内存、磁盘、网络流量等信息, 以及磁盘IO、CPU温度等信息。")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235353.png",alt:"image-20211209152836200"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202204111235200.png",alt:"image-20211209152849200"}})])])}),[],!1,null,null,null);t.default=r.exports}}]);