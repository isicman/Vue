(window.webpackJsonp=window.webpackJsonp||[]).push([[102],{585:function(s,t,a){"use strict";a.r(t);var n=a(19),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"istioç”±æµ…å…¥æ·±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istioç”±æµ…å…¥æ·±"}},[s._v("#")]),s._v(" Istioç”±æµ…å…¥æ·±")]),s._v(" "),a("h2",{attrs:{id:"istioç®€ä»‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istioç®€ä»‹"}},[s._v("#")]),s._v(" Istioç®€ä»‹")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯istio"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯Istio?")]),s._v(" "),a("p",[s._v("åœ¨ä¼ä¸šæ™®ééƒ½åšäº‘å¹³å°çš„æ—¶ä»£èƒŒæ™¯ä¸‹ï¼Œäº‘å¹³å°æ¶æ„å¸¦æ¥çš„è¯¸å¤šå¥½å¤„ï¼Œä½†æ˜¯ï¼Œä¸å¯å¦è®¤çš„æ˜¯ï¼Œé‡‡ç”¨äº‘æŠ€æœ¯æ¶æ„ä¼šå¯¹DevOpså›¢é˜Ÿé€ æˆå¾ˆå¤§çš„å‹åŠ›ã€‚ å¼€å‘äººå‘˜ä¹Ÿå¿…é¡»ä½¿ç”¨å¾®æœåŠ¡æ¥æ„å»ºå¯ç§»æ¤æ€§ï¼ŒåŒæ—¶å„å¤§è¿è¥å•†æ­£åœ¨ç®¡ç†è¶…å¤§å‹æ··åˆå’Œå¤šäº‘éƒ¨ç½²ã€‚è€ŒIstioä½¿å¾—æ‚¨å¯ä»¥è¿æ¥ï¼Œå®‰å…¨ï¼Œæ§åˆ¶å’Œç›‘æ§è¿™äº›æœåŠ¡ã€‚")]),s._v(" "),a("p",[s._v("ä»æ›´é«˜çš„ç»´åº¦æ¥çœ‹ï¼ŒIstioæœ‰åŠ©äºé™ä½éƒ¨ç½²çš„å¤æ‚æ€§ï¼Œå‡è½»å¼€å‘å›¢é˜Ÿçš„è´Ÿæ‹…ã€‚"),a("code",[s._v("Istioæ˜¯ä¸€ä¸ªå®Œå…¨å¼€æºçš„æœåŠ¡ç½‘æ ¼ï¼ˆservice meshï¼‰ï¼Œå¯ä»¥é€æ˜åœ°åˆ†å±‚åˆ°ç°æœ‰çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸Šã€‚åŒæ—¶ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¹³å°ï¼Œé€šè¿‡å…¶æä¾›çš„APIï¼Œå¯å°†å…¶é›†æˆåˆ°ä»»ä½•æ—¥å¿—å¹³å°ï¼Œtelemetryæˆ–ç­–ç•¥ç³»ç»Ÿä¸­ã€‚")])]),s._v(" "),a("p",[s._v("Istioçš„å¤šæ ·åŒ–åŠŸèƒ½é›†ä½¿æ‚¨èƒ½å¤Ÿé«˜æ•ˆåœ°è¿è¡Œåˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„ï¼Œå¹¶æä¾›ç»Ÿä¸€çš„æ–¹å¼æ¥ä¿æŠ¤ï¼Œè¿æ¥å’Œç›‘è§†å¾®æœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼-serivce-mesh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼-serivce-mesh"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘æ ¼ï¼ˆserivce meshï¼‰ï¼Ÿ")]),s._v(" "),a("p",[s._v("å½“æ•´ä½“åº”ç”¨ç¨‹åºå‘åˆ†å¸ƒå¼å¾®æœåŠ¡æ¶æ„è¿‡æ¸¡æ—¶ï¼ŒIstioè§£å†³äº†å¼€å‘äººå‘˜å’Œè¿è¥å•†é¢ä¸´çš„æŒ‘æˆ˜ã€‚")]),s._v(" "),a("p",[a("code",[s._v("æœåŠ¡ç½‘æ ¼")]),s._v("æœ¯è¯­ç”¨äºæè¿°ç»„æˆæ­¤ç±»åº”ç”¨ç¨‹åºçš„å¾®æœåŠ¡ç½‘ç»œåŠå…¶ä¹‹é—´çš„äº¤äº’ã€‚éšç€æœåŠ¡ç½‘æ ¼çš„å¤§å°å’Œå¤æ‚æ€§çš„å¢é•¿ï¼Œå®ƒå˜å¾—è¶Šæ¥è¶Šéš¾ä»¥ç†è§£å’Œç®¡ç†ã€‚å®ƒçš„è¦æ±‚å¯ä»¥åŒ…æ‹¬å‘ç°ï¼Œè´Ÿè½½å¹³è¡¡ï¼Œæ•…éšœæ¢å¤ï¼ŒæŒ‡æ ‡å’Œç›‘æ§ã€‚æœåŠ¡ç½‘æ ¼é€šå¸¸è¿˜å…·æœ‰æ›´å¤æ‚çš„æ“ä½œè¦æ±‚ï¼Œä¾‹å¦‚A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€ï¼Œç½‘é€Ÿé™åˆ¶ï¼Œè®¿é—®æ§åˆ¶å’Œç«¯åˆ°ç«¯çš„èº«ä»½éªŒè¯ã€‚")]),s._v(" "),a("p",[s._v("Istioæä¾›äº†æ•´ä¸ªæœåŠ¡ç½‘æ ¼ä¸Šçš„è¡Œä¸ºæ´å¯ŸåŠ›å’Œæ“ä½œæ§åˆ¶ï¼Œä»è€Œæä¾›äº†å®Œæ•´çš„è§£å†³æ–¹æ¡ˆæ¥æ»¡è¶³å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„å„ç§éœ€æ±‚ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ä¸ºä»€ä¹ˆä½¿ç”¨istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆä½¿ç”¨istio"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆä½¿ç”¨Istioï¼Ÿ")]),s._v(" "),a("p",[s._v("Istioå¯ä»¥è½»æ¾åœ¨å·²éƒ¨ç½²æœåŠ¡ç½‘ç»œä¸Šåˆ›å»ºå¸¦æœ‰è´Ÿè½½å¹³è¡¡ï¼ŒæœåŠ¡åˆ°æœåŠ¡çš„èº«ä»½éªŒè¯ï¼Œç›‘æ§ç­‰åŠŸèƒ½ï¼Œå¹¶ä¸”æœåŠ¡ä»£ç ä¸­çš„ä»£ç æ— éœ€å˜åŠ¨ï¼ˆæˆ–å˜åŠ¨å¾ˆå°‘ï¼‰ã€‚é€šè¿‡åœ¨æ•´ä¸ªç¯å¢ƒä¸­éƒ¨ç½²ä¸€ä¸ªç‰¹æ®Šçš„sidecarä»£ç†æ¥æ‹¦æˆªå¾®æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ï¼Œç„¶åä½¿ç”¨å…¶å¹³å°æ§åˆ¶åŠŸèƒ½é…ç½®å’Œç®¡ç†Istioï¼ŒåŒ…æ‹¬ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("è‡ªåŠ¨ä¸ºHTTPï¼ŒgRPCï¼ŒWebSocketå’ŒTCPæµé‡è´Ÿè½½å¹³è¡¡ã€‚")]),s._v(" "),a("li",[s._v("é€šè¿‡ä¸°å¯Œçš„è·¯ç”±è§„åˆ™ï¼Œé‡è¯•ï¼Œæ•…éšœè½¬ç§»å’Œæ•…éšœæ³¨å…¥å¯¹æµé‡è¡Œä¸ºè¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚")]),s._v(" "),a("li",[s._v("å¯æ’æ‹”çš„ç­–ç•¥å±‚å’Œé…ç½®APIï¼Œæ”¯æŒè®¿é—®æ§åˆ¶ï¼Œé€Ÿç‡é™åˆ¶å’Œé…é¢ã€‚")]),s._v(" "),a("li",[s._v("é›†ç¾¤å†…æ‰€æœ‰æµé‡çš„è‡ªåŠ¨åº¦é‡ï¼Œæ—¥å¿—å’Œè·Ÿè¸ªï¼ŒåŒ…æ‹¬é›†ç¾¤çš„å…¥å£å’Œå‡ºå£ã€‚")]),s._v(" "),a("li",[s._v("é€šè¿‡å¼ºå¤§çš„åŸºäºèº«ä»½çš„èº«ä»½éªŒè¯å’Œæˆæƒï¼Œåœ¨é›†ç¾¤ä¸­è¿›è¡Œå®‰å…¨çš„æœåŠ¡ä¹‹é—´é€šä¿¡ã€‚")])]),s._v(" "),a("p",[s._v("Istioä¸“ä¸ºå¯æ‰©å±•æ€§è€Œè®¾è®¡ï¼Œå¯æ»¡è¶³å¤šç§éƒ¨ç½²éœ€æ±‚ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æ ¸å¿ƒåŠŸèƒ½"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ ¸å¿ƒåŠŸèƒ½"}},[s._v("#")]),s._v(" æ ¸å¿ƒåŠŸèƒ½")]),s._v(" "),a("p",[s._v("Istioåœ¨æœåŠ¡ç½‘ç»œä¸­ç»Ÿä¸€æä¾›äº†è®¸å¤šå…³é”®åŠŸèƒ½ï¼š")]),s._v(" "),a("h4",{attrs:{id:"æµé‡ç®¡ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡ç®¡ç†"}},[s._v("#")]),s._v(" æµé‡ç®¡ç†")]),s._v(" "),a("p",[s._v("Istioè§„åˆ™é…ç½®å’Œæµé‡è·¯ç”±ä½¿æ‚¨å¯ä»¥å¾ˆå®¹æ˜“çš„æ§åˆ¶æœåŠ¡ä¹‹é—´çš„æµé‡å’ŒAPIè°ƒç”¨çš„æµé‡ã€‚Istioç®€åŒ–äº†è¯¸å¦‚æ–­è·¯å™¨ï¼Œè¶…æ—¶å’Œé‡è¯•ä¹‹ç±»çš„æœåŠ¡çº§åˆ«å±æ€§çš„é…ç½®ï¼Œå¹¶ä½¿å…¶è½»è€Œæ˜“ä¸¾åœ°è®¾ç½®é‡è¦ä»»åŠ¡ï¼Œå¦‚A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€éƒ¨ç½²å’ŒåŸºäºç™¾åˆ†æ¯”çš„æµé‡æ‹†åˆ†ã€‚")]),s._v(" "),a("p",[s._v("å€ŸåŠ©å¯¹æµé‡çš„æ›´å¥½å¯è§æ€§å’Œå¼€ç®±å³ç”¨çš„æ•…éšœæ¢å¤åŠŸèƒ½ï¼Œæ— è®ºé‡åˆ°ä»€ä¹ˆæƒ…å†µï¼Œæ‚¨éƒ½å¯ä»¥åœ¨é—®é¢˜å¼•èµ·æ•…éšœä¹‹å‰åŠæ—¶å‘ç°é—®é¢˜ï¼Œä½¿å¾—è°ƒç”¨æ›´åŠ å¯é ï¼Œç½‘ç»œä¹Ÿæ›´åŠ å¼ºå¤§ã€‚")]),s._v(" "),a("h4",{attrs:{id:"å®‰å…¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨"}},[s._v("#")]),s._v(" å®‰å…¨")]),s._v(" "),a("p",[s._v("Istioçš„å®‰å…¨åŠŸèƒ½ä½¿å¼€å‘äººå‘˜å¯ä»¥å°†ç²¾åŠ›é›†ä¸­åœ¨åº”ç”¨ç¨‹åºçº§åˆ«ã€‚Istioæä¾›åŸºç¡€å®‰å…¨é€šä¿¡é€šé“ï¼Œå¹¶å¤§è§„æ¨¡ç®¡ç†æœåŠ¡é€šä¿¡çš„èº«ä»½éªŒè¯ï¼Œæˆæƒå’ŒåŠ å¯†ã€‚ å€ŸåŠ©Istioï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥ä¿æŠ¤æœåŠ¡é€šä¿¡çš„å®‰å…¨ï¼Œä»è€Œä½¿æ‚¨èƒ½å¤Ÿåœ¨å„ç§åè®®å’Œè¿è¡Œæ—¶ä¹‹é—´ä¸€è‡´åœ°æ‰§è¡Œç­–ç•¥ - æ‰€æœ‰è¿™äº›æ“ä½œå‡ ä¹ä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºã€‚")]),s._v(" "),a("p",[s._v("è™½ç„¶Istioæ˜¯ç‹¬ç«‹äºå¹³å°çš„ï¼Œä½†å°†å…¶ä¸Kubernetesï¼ˆæˆ–åŸºç¡€æ¶æ„ï¼‰ç½‘ç»œç­–ç•¥é…åˆä½¿ç”¨ï¼Œåˆ™å¥½å¤„æ›´å¤§ï¼ŒåŒ…æ‹¬èƒ½å¤Ÿåœ¨ç½‘ç»œå’Œåº”ç”¨ç¨‹åºå±‚ä¿æŠ¤Podåˆ°Podæˆ–æœåŠ¡åˆ°æœåŠ¡çš„é€šä¿¡çš„èƒ½åŠ›ã€‚")]),s._v(" "),a("h4",{attrs:{id:"å¯è§‚å¯Ÿæ€§-observability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯è§‚å¯Ÿæ€§-observability"}},[s._v("#")]),s._v(" å¯è§‚å¯Ÿæ€§(Observability)")]),s._v(" "),a("p",[s._v("Istioå¼ºå¤§çš„è·Ÿè¸ªï¼Œç›‘æ§å’Œæ—¥å¿—è®°å½•åŠŸèƒ½ä½¿æ‚¨å¯ä»¥æ·±å…¥äº†è§£æœåŠ¡ç½‘æ ¼éƒ¨ç½²ã€‚å€ŸåŠ©Istioçš„ç›‘è§†åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥çœŸæ­£äº†è§£æœåŠ¡æ€§èƒ½å¦‚ä½•å½±å“ä¸Šæ¸¸å’Œä¸‹æ¸¸äº‹ç‰©ï¼Œè€Œå…¶è‡ªå®šä¹‰dashboardsï¼ˆä»ªè¡¨ç›˜ï¼‰åˆ™å¯ä»¥æä¾›å¯¹æ‰€æœ‰æœåŠ¡æ€§èƒ½çš„å¯è§†æ€§ï¼Œå¹¶è®©æ‚¨äº†è§£è¯¥æ€§èƒ½å¦‚ä½•å½±å“æ‚¨çš„å…¶ä»–çš„ç¨‹åºçš„ã€‚")]),s._v(" "),a("p",[s._v("Istioçš„Mixerç»„ä»¶è´Ÿè´£ç­–ç•¥æ§åˆ¶å’Œé¥æµ‹(telemetry)é‡‡é›†ã€‚å®ƒæä¾›äº†åç«¯æŠ½è±¡å’Œä¸­ä»‹ï¼Œä½¿Istioçš„å…¶ä½™éƒ¨åˆ†ä¸å„ä¸ªåŸºç¡€æ¶æ„åç«¯çš„å®ç°ç»†èŠ‚éš”ç¦»å¼€æ¥ï¼Œå¹¶ä¸ºæ“ä½œå‘˜æä¾›äº†å¯¹ç½‘æ ¼å’ŒåŸºç¡€æ¶æ„åç«¯ä¹‹é—´æ‰€æœ‰äº¤äº’çš„ç²¾ç»†æ§åˆ¶ã€‚")]),s._v(" "),a("p",[s._v("æ‰€æœ‰è¿™äº›åŠŸèƒ½ä½¿æ‚¨å¯ä»¥æ›´æœ‰æ•ˆåœ°è®¾ç½®ï¼Œç›‘æ§å’Œæ‰§è¡ŒæœåŠ¡ä¸Šçš„SLOã€‚å½“ç„¶ï¼Œæœ€é‡è¦çš„æ˜¯æ‚¨å¯ä»¥å¿«é€Ÿæœ‰æ•ˆåœ°æ£€æµ‹å’Œä¿®å¤æ•…éšœã€‚")]),s._v(" "),a("h4",{attrs:{id:"å¹³å°æ”¯æŒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¹³å°æ”¯æŒ"}},[s._v("#")]),s._v(" å¹³å°æ”¯æŒ")]),s._v(" "),a("p",[s._v("Istioæ˜¯ç‹¬ç«‹äºå¹³å°çš„ï¼Œæ—¨åœ¨åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ŒåŒ…æ‹¬è·¨Cloudï¼Œæœ¬åœ°ï¼ŒKubernetesï¼ŒMesosç­‰çš„ç¯å¢ƒã€‚æ‚¨å¯ä»¥åœ¨Kubernetesæˆ–Consulçš„Nomadä¸Šéƒ¨ç½²Istioã€‚Istioå½“å‰æ”¯æŒï¼š")]),s._v(" "),a("ul",[a("li",[s._v("Kubernetesä¸Šéƒ¨ç½²Service")]),s._v(" "),a("li",[s._v("å‘Consulæ³¨å†ŒServices")]),s._v(" "),a("li",[s._v("åœ¨å•ä¸ªè™šæ‹Ÿæœºä¸Šè¿è¡ŒServices")])]),s._v(" "),a("h4",{attrs:{id:"é›†æˆå’Œè‡ªå®šä¹‰"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é›†æˆå’Œè‡ªå®šä¹‰"}},[s._v("#")]),s._v(" é›†æˆå’Œè‡ªå®šä¹‰")]),s._v(" "),a("p",[s._v("Istioçš„ç­–ç•¥æ‰§è¡Œç»„ä»¶å¯ä»¥æ‰©å±•å’Œè‡ªå®šä¹‰ï¼Œä»¥ä¸ç°æœ‰çš„ACLï¼Œæ—¥å¿—è®°å½•ï¼Œç›‘è§†ï¼Œé…é¢ï¼Œå®¡æ ¸ç­‰é›†æˆã€‚")]),s._v(" "),a("h4",{attrs:{id:"æ¶æ„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¶æ„"}},[s._v("#")]),s._v(" æ¶æ„")]),s._v(" "),a("p",[s._v("IstioæœåŠ¡ç½‘æ ¼åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºæ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢ã€‚")]),s._v(" "),a("ul",[a("li",[s._v("æ•°æ®planeç”±éƒ¨ç½²ä¸ºsidecarçš„ä¸€ç»„æ™ºèƒ½ä»£ç†ï¼ˆEnvoyï¼‰ç»„æˆã€‚è¿™äº›ä»£ç†ä¸­ä»‹å’Œæ§åˆ¶å¾®æœåŠ¡ä¸Mixerã€é€šç”¨ç­–ç•¥å’Œé¥æµ‹é›†çº¿å™¨ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œé€šä¿¡ã€‚")]),s._v(" "),a("li",[s._v("æ§åˆ¶å¹³é¢ç®¡ç†å¹¶å°†ä»£ç†é…ç½®ä¸ºè·¯ç”±æµé‡ã€‚å¦å¤–ï¼Œæ§åˆ¶å¹³é¢é…ç½®Mixersæ¥æ‰§è¡Œç­–ç•¥å’Œé‡‡é›†é¥æµ‹æ•°æ®ã€‚")])]),s._v(" "),a("p",[s._v("ä¸‹å›¾æ˜¾ç¤ºäº†ç»„æˆæ¯ä¸ªå¹³é¢çš„ä¸åŒç»„ä»¶:")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062326606.jpeg",alt:"screenshot"}})]),s._v(" "),a("h4",{attrs:{id:"envoy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#envoy"}},[s._v("#")]),s._v(" Envoy")]),s._v(" "),a("p",[s._v("Istioä½¿ç”¨Envoyä»£ç†çš„æ‰©å±•ç‰ˆæœ¬ã€‚Envoyæ˜¯ä½¿ç”¨"),a("code",[s._v("C++")]),s._v("å¼€å‘çš„é«˜æ€§èƒ½ä»£ç†ï¼Œå¯ä¸ºæœåŠ¡ç½‘æ ¼ä¸­çš„æ‰€æœ‰æœåŠ¡è°ƒè§£æ‰€æœ‰å…¥ç«™å’Œå‡ºç«™æµé‡ã€‚Istioåˆ©ç”¨Envoyçš„è®¸å¤šå†…ç½®åŠŸèƒ½ï¼Œå¦‚ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("åŠ¨æ€æœåŠ¡å‘ç°")]),s._v(" "),a("li",[s._v("è´Ÿè½½å‡è¡¡")]),s._v(" "),a("li",[s._v("TLS termination")]),s._v(" "),a("li",[s._v("HTTP/2å’ŒgRPCä»£ç†")]),s._v(" "),a("li",[s._v("ç†”æ–­ï¼ˆCircuit breakersï¼‰")]),s._v(" "),a("li",[s._v("å¥åº·æ£€æŸ¥")]),s._v(" "),a("li",[s._v("åˆ†é˜¶æ®µæ¨å‡ºï¼ŒæŒ‰ç™¾åˆ†æ¯”åˆ†é…æµé‡")]),s._v(" "),a("li",[s._v("æ•…éšœæ³¨å…¥")]),s._v(" "),a("li",[s._v("ä¸°å¯Œçš„æŒ‡æ ‡")])]),s._v(" "),a("p",[s._v("Sidecarä»£ç†æ¨¡å‹è¿˜å…è®¸ä½ å°†IstioåŠŸèƒ½æ·»åŠ åˆ°ç°æœ‰éƒ¨ç½²ä¸­ï¼Œè€Œæ— éœ€é‡æ–°æ„é€ æˆ–é‡å†™ä»£ç ã€‚ä½ å¯ä»¥é˜…è¯»æ›´å¤šå…³äºä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨è®¾è®¡ç›®æ ‡ä¸­é€‰æ‹©è¿™ç§æ–¹æ³•çš„ä¿¡æ¯ã€‚")]),s._v(" "),a("h4",{attrs:{id:"mixer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mixer"}},[s._v("#")]),s._v(" Mixer")]),s._v(" "),a("p",[s._v("Mixeræ˜¯ä¸€ä¸ªä¸å¹³å°æ— å…³çš„ç»„ä»¶ã€‚Mixerè·¨æœåŠ¡ç½‘æ ¼å®æ–½è®¿é—®æ§åˆ¶å’Œä½¿ç”¨ç­–ç•¥ï¼Œå¹¶ä»Envoyä»£ç†å’Œå…¶ä»–æœåŠ¡æ”¶é›†é¥æµ‹æ•°æ®ã€‚ ä»£ç†æå–è¯·æ±‚çº§åˆ«å±æ€§ï¼Œå¹¶å°†å…¶å‘é€åˆ°Mixerè¿›è¡Œè¯„ä¼°ã€‚æ‚¨å¯ä»¥åœ¨æˆ‘ä»¬çš„â€œMixeré…ç½®â€æ–‡æ¡£ä¸­æ‰¾åˆ°æœ‰å…³æ­¤å±æ€§æå–å’Œç­–ç•¥è¯„ä¼°çš„æ›´å¤šä¿¡æ¯ã€‚")]),s._v(" "),a("p",[s._v("MixeråŒ…å«ä¸€ä¸ªçµæ´»çš„æ’ä»¶æ¨¡å‹ã€‚è¯¥æ¨¡å‹ä½¿Istioå¯ä»¥ä¸å„ç§ä¸»æœºç¯å¢ƒå’ŒåŸºç¡€æ¶æ„åç«¯äº¤äº’ã€‚å› æ­¤ï¼ŒIstioä»è¿™äº›ç»†èŠ‚ä¸­æŠ½è±¡äº†Envoyä»£ç†å’ŒIstioç®¡ç†çš„æœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"pilot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pilot"}},[s._v("#")]),s._v(" Pilot")]),s._v(" "),a("p",[s._v("Pilotæä¾›äº†Envoy sidecarçš„æœåŠ¡å‘ç°ï¼Œæ™ºèƒ½è·¯ç”±çš„æµé‡ç®¡ç†åŠŸèƒ½ï¼ˆä¾‹å¦‚ A/Bæµ‹è¯•ï¼Œé‡‘ä¸é›€ç­‰ï¼‰å’Œå¼¹æ€§ï¼ˆè¶…æ—¶ï¼Œé‡è¯•ï¼Œæ–­è·¯å™¨ç­‰ï¼‰ã€‚")]),s._v(" "),a("p",[s._v("Pilotå°†æ§åˆ¶æµé‡è¡Œä¸ºçš„é«˜çº§è·¯ç”±è§„åˆ™è½¬æ¢ä¸ºEnvoyç‰¹å®šçš„é…ç½®ï¼Œå¹¶åœ¨è¿è¡Œæ—¶å°†å…¶ä¼ é€åˆ°sidecarã€‚Pilotæå–äº†ç‰¹å®šäºå¹³å°çš„æœåŠ¡å‘ç°æœºåˆ¶ï¼Œå¹¶å°†å®ƒä»¬åˆæˆä¸ºæ ‡å‡†æ ¼å¼ï¼Œä»»ä½•ç¬¦åˆEnvoyæ•°æ®å¹³é¢APIçš„Sidecaréƒ½å¯ä»¥ä½¿ç”¨ã€‚è¿™ç§æ¾æ•£çš„è€¦åˆä½¿å¾—Istioå¯ä»¥åœ¨Kubernetesï¼ŒConsulæˆ–Nomadç­‰å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ŒåŒæ—¶ä¸ºæµé‡ç®¡ç†ä¿ç•™ç›¸åŒçš„æ“ä½œå‘˜ç•Œé¢ã€‚")]),s._v(" "),a("h4",{attrs:{id:"citadel"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#citadel"}},[s._v("#")]),s._v(" Citadel")]),s._v(" "),a("p",[s._v("Citadelé€šè¿‡å†…ç½®çš„èº«ä»½å’Œå‡­æ®ç®¡ç†å®ç°äº†å¼ºå¤§çš„æœåŠ¡åˆ°æœåŠ¡å’Œç»ˆç«¯ç”¨æˆ·çš„èº«ä»½éªŒè¯ã€‚å¯ä»¥ä½¿ç”¨Citadelæ¥å‡çº§æœåŠ¡ç½‘æ ¼ä¸­çš„æœªåŠ å¯†æµé‡ã€‚ä½¿ç”¨Citadelï¼Œè¿è¥å•†å¯ä»¥åŸºäºæœåŠ¡èº«ä»½è€Œä¸æ˜¯ç›¸å¯¹ä¸ç¨³å®šçš„3å±‚æˆ–4å±‚ç½‘ç»œè¯†åˆ«ç æ¥å®æ–½ç­–ç•¥ã€‚ä»ç‰ˆæœ¬0.5å¼€å§‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨Istioçš„æˆæƒåŠŸèƒ½æ¥æ§åˆ¶è°å¯ä»¥è®¿é—®æ‚¨çš„æœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"galley"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#galley"}},[s._v("#")]),s._v(" Galley")]),s._v(" "),a("p",[s._v("Galleyæ˜¯Istioçš„é…ç½®éªŒè¯ï¼Œæå–ï¼Œå¤„ç†å’Œåˆ†å‘ç»„ä»¶ã€‚å®ƒè´Ÿè´£å°†å…¶ä½™Istioç»„ä»¶ä¸ä»åº•å±‚å¹³å°ï¼ˆä¾‹å¦‚Kubernetesï¼‰è·å–ç”¨æˆ·é…ç½®çš„ç»†èŠ‚éš”ç¦»å¼€æ¥ã€‚")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("æœ€å¤§åŒ–é€æ˜åº¦")]),s._v("ï¼šè¦é‡‡ç”¨Istioï¼Œè¦æ±‚æ“ä½œå‘˜æˆ–å¼€å‘äººå‘˜è¿›è¡Œå°½å¯èƒ½å°‘çš„å·¥ä½œï¼Œä»¥ä»ç³»ç»Ÿä¸­è·å¾—çœŸæ­£çš„ä»·å€¼ã€‚ä¸ºæ­¤ï¼ŒIstioå¯ä»¥è‡ªåŠ¨å°†å…¶è‡ªèº«æ’å…¥æœåŠ¡ä¹‹é—´çš„æ‰€æœ‰ç½‘ç»œè·¯å¾„ä¸­ã€‚Istioä½¿ç”¨Sidecarä»£ç†æ¥æ•è·æµé‡ï¼Œå¹¶åœ¨å¯èƒ½çš„æƒ…å†µä¸‹è‡ªåŠ¨å¯¹ç½‘ç»œå±‚è¿›è¡Œç¼–ç¨‹ï¼Œä»¥é€šè¿‡è¿™äº›ä»£ç†è·¯ç”±æµé‡ï¼Œè€Œæ— éœ€æ›´æ”¹å·²éƒ¨ç½²çš„åº”ç”¨ç¨‹åºä»£ç ã€‚ åœ¨Kubernetesä¸­ï¼Œä»£ç†è¢«æ³¨å…¥åˆ°Podä¸­ï¼Œå¹¶é€šè¿‡å¯¹iptablesè§„åˆ™è¿›è¡Œç¼–ç¨‹æ¥æ•è·æµé‡ã€‚ ä¸€æ—¦æ³¨å…¥äº†sidecarä»£ç†å¹¶ä¸”å¯¹æµé‡è·¯ç”±è¿›è¡Œäº†ç¼–ç¨‹ï¼ŒIstioå°±å¯ä»¥è°ƒè§£æ‰€æœ‰æµé‡ã€‚æ­¤åŸåˆ™ä¹Ÿé€‚ç”¨äºæ€§èƒ½ã€‚å°†Istioåº”ç”¨äºéƒ¨ç½²æ—¶ï¼Œè¿è¥å•†ä¼šå‘ç°æ‰€æä¾›åŠŸèƒ½çš„èµ„æºæˆæœ¬å¢åŠ æœ€å°ã€‚ç»„ä»¶å’ŒAPIå¿…é¡»åœ¨è®¾è®¡æ—¶å……åˆ†è€ƒè™‘æ€§èƒ½å’Œè§„æ¨¡ã€‚")]),s._v(" "),a("li",[a("code",[s._v("å¯æ‰©å±•æ€§")]),s._v("ï¼šéšç€è¿è¥å•†å’Œå¼€å‘äººå‘˜è¶Šæ¥è¶Šä¾èµ–Istioæä¾›çš„åŠŸèƒ½ï¼Œç³»ç»Ÿä¹Ÿå¿…é¡»éšç€ä»–ä»¬çš„éœ€æ±‚è€Œå¢é•¿ã€‚åœ¨æˆ‘ä»¬ç»§ç»­æ·»åŠ æ–°åŠŸèƒ½çš„åŒæ—¶ï¼Œæœ€å¤§çš„éœ€æ±‚æ˜¯æ‰©å±•ç­–ç•¥ç³»ç»Ÿï¼Œä¸å…¶ä»–ç­–ç•¥å’Œæ§åˆ¶æºé›†æˆä»¥åŠå°†æœ‰å…³ç½‘æ ¼è¡Œä¸ºçš„ä¿¡å·ä¼ é€åˆ°çš„å…¶ä»–ç³»ç»Ÿä»¥è¿›è¡Œåˆ†æã€‚ç­–ç•¥è¿è¡Œæ—¶æ”¯æŒæ’å…¥å…¶ä»–æœåŠ¡çš„æ ‡å‡†æ‰©å±•æœºåˆ¶ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸æ‰©å±•å…¶è¯æ±‡è¡¨ï¼Œä»è€Œå¯ä»¥æ ¹æ®ç½‘æ ¼ç”Ÿæˆçš„æ–°ä¿¡å·æ¥å®æ–½ç­–ç•¥ã€‚")]),s._v(" "),a("li",[a("code",[s._v("å¯ç§»æ¤æ€§")]),s._v("ï¼šä½¿ç”¨Istioçš„ç”Ÿæ€ç³»ç»Ÿåœ¨è®¸å¤šæ–¹é¢éƒ½ä¸åŒã€‚Istioå¿…é¡»èƒ½åœ¨ä»»ä½•äº‘ç«¯æˆ–æœ¬åœ°ç¯å¢ƒä¸­è¿è¡Œï¼Œåªéœ€æœ€å°‘çš„åŠªåŠ›ã€‚å°†åŸºäºIstioçš„æœåŠ¡ç§»æ¤åˆ°æ–°ç¯å¢ƒçš„ä»»åŠ¡å¿…é¡»å¾ˆç®€å•ã€‚ä½¿ç”¨Istioï¼Œæ‚¨å¯ä»¥æ“ä½œéƒ¨ç½²åˆ°å¤šä¸ªç¯å¢ƒä¸­çš„å•ä¸ªæœåŠ¡ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨å¤šä¸ªäº‘ä¸Šéƒ¨ç½²ä»¥å®ç°å†—ä½™ã€‚")]),s._v(" "),a("li",[a("code",[s._v("ç­–ç•¥ç»Ÿä¸€æ€§")]),s._v("ï¼šå°†ç­–ç•¥åº”ç”¨äºæœåŠ¡ä¹‹é—´çš„APIè°ƒç”¨æä¾›äº†å¯¹ç½‘æ ¼è¡Œä¸ºçš„å¤§é‡æ§åˆ¶ã€‚ä½†æ˜¯ï¼Œå°†ç­–ç•¥åº”ç”¨äºä¸ä¸€å®šåœ¨APIçº§åˆ«è¡¨è¾¾çš„èµ„æºä¹ŸåŒæ ·é‡è¦ã€‚ä¾‹å¦‚ï¼Œå¯¹MLè®­ç»ƒä»»åŠ¡æ¶ˆè€—çš„CPUæ•°é‡åº”ç”¨quotaæ¯”å¯¹å¯åŠ¨wrokçš„è°ƒç”¨åº”ç”¨quotaæ›´æœ‰ç”¨ã€‚ä¸ºæ­¤ï¼ŒIstioå°†ç­–ç•¥ç³»ç»Ÿä½œä¸ºå…·æœ‰å…¶è‡ªå·±çš„APIçš„ç‹¬ç‰¹æœåŠ¡æ¥ç»´æŠ¤ï¼Œè€Œä¸æ˜¯å°†ç­–ç•¥ç³»ç»Ÿçƒ˜ç„™åˆ°ä»£ç†Sidecarä¸­ï¼Œä»è€Œä½¿å¾—æœåŠ¡æ ¹æ®éœ€è¦ç›´æ¥ä¸å…¶é›†æˆã€‚")])]),s._v(" "),a("h2",{attrs:{id:"istioçš„å®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#istioçš„å®‰è£…"}},[s._v("#")]),s._v(" Istioçš„å®‰è£…")]),s._v(" "),a("h3",{attrs:{id:"ä½¿ç”¨-istioctl-å®‰è£…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨-istioctl-å®‰è£…"}},[s._v("#")]),s._v(" ä½¿ç”¨ Istioctl å®‰è£…")]),s._v(" "),a("h4",{attrs:{id:"_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-æ‹‰å–istioçš„å®‰è£…åŒ…"}},[s._v("#")]),s._v(" 1.æ‹‰å–Istioçš„å®‰è£…åŒ…")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O http://192.168.1.110/file/istio-1.9.5-linux-amd64.tar.gz\n\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" \nistio-1.9.5-linux-amd64.tar.gz\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -zxvf istio-1.9.5-linux-amd64.tar.gz\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_2-å¤åˆ¶istioctlå·¥å…·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-å¤åˆ¶istioctlå·¥å…·"}},[s._v("#")]),s._v(" 2.å¤åˆ¶istioctlå·¥å…·")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" istio-1.9.5/\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" bin/istioctl  /usr/local/bin/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£…-istio"}},[s._v("#")]),s._v(" 3.ä½¿ç”¨é»˜è®¤é…ç½®æ–‡ä»¶å®‰è£… Istio")]),s._v(" "),a("p",[s._v("æœ€ç®€å•çš„é€‰æ‹©æ˜¯ ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…"),a("code",[s._v("default")]),s._v("Istio "),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[s._v("é…ç½®æ–‡ä»¶"),a("OutboundLink")],1),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ istioctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶"}},[s._v("#")]),s._v(" 4.å®‰è£…ä¸åŒçš„é…ç½®æ–‡ä»¶")]),s._v(" "),a("p",[s._v("é€šè¿‡åœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’é…ç½®æ–‡ä»¶åç§°ï¼Œå¯ä»¥å°†å…¶ä»– Istio é…ç½®æ–‡ä»¶å®‰è£…åˆ°é›†ç¾¤ä¸­ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å¯ç”¨äºå®‰è£…"),a("code",[s._v("demo")]),s._v("é…ç½®æ–‡ä»¶ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl  create  ns istio-system\n$ istioctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" --set "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("profile")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("demo -y\nâœ” Istio core installed                                                   \nâœ” Istiod installed                                                  \nâœ” Egress gateways installed                                                        \nâœ” Ingress gateways installed                                                        \nâœ” Installation complete     \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h4",{attrs:{id:"_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ"}},[s._v("#")]),s._v(" 5.æ£€æŸ¥å®‰è£…äº†ä»€ä¹ˆ")]),s._v(" "),a("p",[s._v("è¯¥"),a("code",[s._v("istioctl")]),s._v("å‘½ä»¤å°†"),a("code",[s._v("IstioOperator")]),s._v("ç”¨äºå®‰è£… Istioçš„CRä¿å­˜åœ¨åä¸º"),a("code",[s._v("installed-state")]),s._v(". è€Œä¸æ˜¯æ£€æŸ¥ Istio å®‰è£…çš„éƒ¨ç½²ã€podã€æœåŠ¡å’Œå…¶ä»–èµ„æºï¼Œä¾‹å¦‚ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl -n istio-system get deploy\nNAME                   READY   UP-TO-DATE   AVAILABLE   AGE\nistio-egressgateway    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           25s\nistio-ingressgateway   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           24s\nistiod                 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("           20s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-æ³¨å…¥é»˜è®¤å˜é‡"}},[s._v("#")]),s._v(" 6.æ³¨å…¥é»˜è®¤å˜é‡")]),s._v(" "),a("p",[s._v("å°†ç›®å½•æ›´æ”¹ä¸º Istio å®‰è£…çš„æ ¹ç›®å½•ã€‚")]),s._v(" "),a("p",[s._v("é»˜è®¤çš„ Istio å®‰è£…ä½¿ç”¨"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ã€‚æ ‡è®°å°†æ‰˜ç®¡åº”ç”¨ç¨‹åºçš„å‘½åç©ºé—´"),a("code",[s._v("istio-injection=enabled")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl label namespace default istio-injection"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enabled \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"_7-å¸è½½-istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-å¸è½½-istio"}},[s._v("#")]),s._v(" 7.å¸è½½ Istio")]),s._v(" "),a("p",[s._v("è¦ä»é›†ç¾¤ä¸­å®Œå…¨å¸è½½ Istioï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ istioctl x uninstall --purge\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¯é€‰"),a("code",[s._v("--purge")]),s._v("æ ‡å¿—å°†åˆ é™¤æ‰€æœ‰ Istio èµ„æºï¼ŒåŒ…æ‹¬å¯èƒ½ä¸å…¶ä»– Istio æ§åˆ¶å¹³é¢å…±äº«çš„é›†ç¾¤èŒƒå›´çš„èµ„æºã€‚")]),s._v(" "),a("h3",{attrs:{id:"æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•ä¸€ä¸ªå®ä¾‹"}},[s._v("#")]),s._v(" æµ‹è¯•ä¸€ä¸ªå®ä¾‹")]),s._v(" "),a("h4",{attrs:{id:"bookinfo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bookinfo"}},[s._v("#")]),s._v(" Bookinfo")]),s._v(" "),a("p",[a("strong",[s._v("Bookinfo åº”ç”¨ç¨‹åºåˆ†ä¸ºå››ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼š")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("productpage")]),s._v(". è¯¥"),a("code",[s._v("productpage")]),s._v("å¾®æœåŠ¡è°ƒç”¨"),a("code",[s._v("details")]),s._v("å’Œ"),a("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡æ¥å¡«å……é¡µé¢ã€‚")]),s._v(" "),a("li",[a("code",[s._v("details")]),s._v(". è¯¥"),a("code",[s._v("details")]),s._v("å¾®æœåŠ¡åŒ…å«å›¾ä¹¦ä¿¡æ¯ã€‚")]),s._v(" "),a("li",[a("code",[s._v("reviews")]),s._v(". è¯¥"),a("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡åŒ…å«äº†ä¹¦è¯„ã€‚å®ƒè¿˜è°ƒç”¨"),a("code",[s._v("ratings")]),s._v("å¾®æœåŠ¡ã€‚")]),s._v(" "),a("li",[a("code",[s._v("ratings")]),s._v(". è¯¥"),a("code",[s._v("ratings")]),s._v("å¾®æœåŠ¡åŒ…å«é¢„å®šä¼´éšä¹¦è¯„æ’åä¿¡æ¯ã€‚")])]),s._v(" "),a("p",[a("strong",[a("code",[s._v("reviews")]),s._v("å¾®æœåŠ¡æœ‰ 3 ä¸ªç‰ˆæœ¬ï¼š")])]),s._v(" "),a("ul",[a("li",[s._v("ç‰ˆæœ¬ v1 ä¸è°ƒç”¨è¯¥"),a("code",[s._v("ratings")]),s._v("æœåŠ¡ã€‚")]),s._v(" "),a("li",[s._v("ç‰ˆæœ¬ v2 è°ƒç”¨è¯¥"),a("code",[s._v("ratings")]),s._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—é»‘æ˜Ÿã€‚")]),s._v(" "),a("li",[s._v("ç‰ˆæœ¬ v3 è°ƒç”¨è¯¥"),a("code",[s._v("ratings")]),s._v("æœåŠ¡ï¼Œå¹¶å°†æ¯ä¸ªè¯„çº§æ˜¾ç¤ºä¸º 1 åˆ° 5 é¢—çº¢æ˜Ÿã€‚")])]),s._v(" "),a("p",[s._v("è¯¥åº”ç”¨ç¨‹åºçš„ç«¯åˆ°ç«¯æ¶æ„å¦‚ä¸‹æ‰€ç¤ºã€‚")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062326474.png",alt:"image-20211214154321190"}}),s._v(" "),a("h4",{attrs:{id:"ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€"}},[s._v("#")]),s._v(" ä½¿ç”¨Istioéƒ¨ç½²åº”ç”¨ç¨‹åºğŸš€")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ Istio è¿è¡Œç¤ºä¾‹ä¸éœ€è¦æ›´æ”¹åº”ç”¨ç¨‹åºæœ¬èº«ã€‚ç›¸åï¼Œæ‚¨åªéœ€è¦åœ¨æ”¯æŒ Istio çš„ç¯å¢ƒä¸­é…ç½®å’Œè¿è¡ŒæœåŠ¡ï¼Œå¹¶åœ¨æ¯ä¸ªæœåŠ¡æ—è¾¹æ³¨å…¥ Envoy sidecarã€‚ç”Ÿæˆçš„éƒ¨ç½²å°†å¦‚ä¸‹æ‰€ç¤ºï¼š")]),s._v(" "),a("img",{staticStyle:{zoom:"80%"},attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062326222.png",alt:"image-20211214154410424"}}),s._v(" "),a("h4",{attrs:{id:"å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€"}},[s._v("#")]),s._v(" å¯åŠ¨åº”ç”¨æœåŠ¡ğŸš€")]),s._v(" "),a("p",[s._v("ä½¿ç”¨ä»¥ä¸‹"),a("code",[s._v("kubectl")]),s._v("å‘½ä»¤éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åºï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/platform/kube/bookinfo.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€"}},[s._v("#")]),s._v(" æŸ¥çœ‹æ‰€æœ‰æœåŠ¡ğŸš€")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc ")]),s._v("\nNAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    AGE\ndetails       ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".17.202    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nkubernetes    ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP    41m\nproductpage   ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.110")]),s._v(".235.179   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nratings       ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".53.51     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\nreviews       ClusterIP   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.101")]),s._v(".21.63     "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9080")]),s._v("/TCP   21m\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods ")]),s._v("\nNAME                              READY   STATUS    RESTARTS   AGE\ndetails-v1-79f774bdb9-gwhkf       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nproductpage-v1-6b746f74dc-6dtg8   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nratings-v1-b6994bb9-9h2wn         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v1-545db77b95-6cmmv       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v2-7bf8c9648f-m2k9d       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\nreviews-v3-84779c7bbc-vd86b       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          21m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("h4",{attrs:{id:"é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é€šè¿‡curlè¯·æ±‚æµ‹è¯•ğŸš€"}},[s._v("#")]),s._v(" é€šè¿‡Curlè¯·æ±‚æµ‹è¯•ğŸš€")]),s._v(" "),a("p",[s._v("è¦ç¡®è®¤ Bookinfo åº”ç”¨ç¨‹åºæ­£åœ¨è¿è¡Œï¼Œè¯·é€šè¿‡"),a("code",[s._v("curl")]),s._v("æ¥è‡ªæŸä¸ª podçš„å‘½ä»¤å‘å…¶å‘é€è¯·æ±‚ï¼Œä¾‹å¦‚æ¥è‡ª"),a("code",[s._v("ratings")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "$(kubectl get pod -l app=ratings -o jsonpath=\'{.items[0].metadata.name}\')" -c ratings -- curl -sS productpage:9080/productpage | grep -o "<title>.*</title>"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("Simple Bookstore App"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/title"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¡®å®šå…¥å£ipå’Œç«¯å£ğŸš€"}},[s._v("#")]),s._v(" ç¡®å®šå…¥å£IPå’Œç«¯å£ğŸš€")]),s._v(" "),a("p",[s._v("ç°åœ¨ Bookinfo æœåŠ¡å·²å¯åŠ¨å¹¶è¿è¡Œï¼Œæ‚¨éœ€è¦ä½¿åº”ç”¨ç¨‹åºå¯ä» Kubernetes é›†ç¾¤å¤–éƒ¨è®¿é—®ï¼Œä¾‹å¦‚ä»æµè§ˆå™¨è®¿é—®ã€‚ä¸€ä¸ª"),a("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#gateways",target:"_blank",rel:"noopener noreferrer"}},[s._v("Istioç½‘å…³"),a("OutboundLink")],1),s._v(" ç”¨äºæ­¤ç›®çš„ã€‚")]),s._v(" "),a("ol",[a("li",[a("strong",[a("code",[s._v("ä¸ºåº”ç”¨å®šä¹‰å…¥å£ç½‘å…³")])])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml ")]),s._v("\ngateway.networking.istio.io/bookinfo-gateway created\nvirtualservice.networking.istio.io/bookinfo created\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("strong",[a("code",[s._v("ç¡®è®¤ç½‘å…³å·²åˆ›å»º")])])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get gateway ")]),s._v("\nNAME               AGE\nbookinfo-gateway   61s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("strong",[a("code",[s._v("æ”¹ä¸ºNodePort")])])])]),s._v(" "),a("p",[s._v("æ­¤å¤„æˆ‘ä»¬å¹¶æ²¡æœ‰å¤–éƒ¨è´Ÿè½½ï¼Œæ‰€ä»¥è¦å°†svcä¿®æ”¹æˆNodePortçš„æ–¹å¼ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system ")]),s._v("\nNAME                   TYPE         CLUSTER-IP      EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                      AGE\nistio-egressgateway    ClusterIP    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.102")]),s._v(".197.30   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("/TCP,443/TCP,15443/TCP                                                     89m\nistio-ingressgateway   LoadBalancer "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.109")]),s._v(".71.35    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v(":31964/TCP,80:31467/TCP,443:31845/TCP,31400:31077/TCP,15443:30757/TCP   89m\nistiod                 ClusterIP    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.111")]),s._v(".156.86   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15010")]),s._v("/TCP,15012/TCP,443/TCP,15014/TCP                                        90m\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#è®¿é—®masterIP+80ç«¯å£å¯¹åº”æš´éœ²çš„31962")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("blockquote",[a("p",[a("code",[s._v("æ³¨æ„ï¼š å¦‚æœ EXTERNAL-IP è®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™è¦æ±‚æ‚¨çš„ç¯å¢ƒå…·æœ‰å¯ç”¨äº Ingress ç½‘å…³çš„å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å¦‚æœ EXTERNAL-IP å€¼æ˜¯ <none>ï¼ˆæˆ–ä¸€ç›´æ˜¯ <pending> ï¼‰ï¼Œåˆ™è¯´æ˜å¯èƒ½æ‚¨çš„ç¯å¢ƒä¸æ”¯æŒä¸º ingress ç½‘å…³æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„åŠŸèƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Service çš„ node port æ–¹å¼è®¿é—®ç½‘å…³ã€‚")])])]),s._v(" "),a("p",[s._v("ä½¿ç”¨ kubectl patch æ›´æ–° istio-ingressgateway æœåŠ¡ç½‘å…³ç±»å‹")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl patch service istio-ingressgateway -n istio-system -p \'{"spec":{"type":"NodePort"}}\'')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("è®¾ç½®å…¥å£ç«¯å£")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SECURE_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TCP_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è·å–ingress ipåœ°å€")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get po -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ingressgateway -n istio-system -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.items[0].status.hostIP}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327570.png",alt:"image-20211214170233622"}}),s._v(" "),a("h4",{attrs:{id:"åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€"}},[s._v("#")]),s._v(" åº”ç”¨é»˜è®¤ç›®æ ‡è§„åˆ™ğŸš€")]),s._v(" "),a("p",[s._v("åœ¨ä½¿ç”¨ Istio æ§åˆ¶ Bookinfo ç‰ˆæœ¬è·¯ç”±ä¹‹å‰ï¼Œæ‚¨éœ€è¦åœ¨"),a("a",{attrs:{href:"https://istio.io/latest/docs/concepts/traffic-management/#destination-rules",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›®æ ‡è§„åˆ™ä¸­"),a("OutboundLink")],1),s._v("å®šä¹‰å¯ç”¨ç‰ˆæœ¬ï¼Œç§°ä¸ºå­é›†ã€‚")]),s._v(" "),a("p",[s._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸º Bookinfo æœåŠ¡åˆ›å»ºé»˜è®¤ç›®æ ‡è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/destination-rule-all.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("blockquote",[a("p",[s._v("åœ¨"),a("code",[s._v("default")]),s._v("ä¸"),a("code",[s._v("demo")]),s._v(" "),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/config-profiles/",target:"_blank",rel:"noopener noreferrer"}},[s._v("é…ç½®è½®å»“"),a("OutboundLink")],1),s._v("å…·æœ‰"),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/security/authentication/authn-policy/#auto-mutual-tls",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨ç›¸äº’TLS"),a("OutboundLink")],1),s._v("å¯ç”¨é»˜è®¤æƒ…å†µä¸‹ã€‚è¦å¼ºåˆ¶å®æ–½åŒå‘ TLSï¼Œè¯·ä½¿ç”¨"),a("code",[s._v("samples/bookinfo/networking/destination-rule-all-mtls.yaml")]),s._v(".")])]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†ğŸš€"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†ğŸš€"}},[s._v("#")]),s._v(" æ¸…ç†ğŸš€")]),s._v(" "),a("p",[s._v("å½“æ‚¨å®Œæˆ Bookinfo ç¤ºä¾‹çš„è¯•éªŒåï¼Œè¯·æŒ‰ç…§ä»¥ä¸‹è¯´æ˜å¸è½½å¹¶æ¸…ç†å®ƒï¼š")]),s._v(" "),a("p",[s._v("åˆ é™¤è·¯ç”±è§„åˆ™å¹¶ç»ˆæ­¢åº”ç”¨ç¨‹åº Pod")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ samples/bookinfo/platform/kube/cleanup.sh\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("ç¡®è®¤å…³æœº")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get virtualservices   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no virtual services")]),s._v("\n$ kubectl get destinationrules  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no destination rules")]),s._v("\n$ kubectl get gateway           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- there should be no gateway")]),s._v("\n$ kubectl get pods              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#-- the Bookinfo pods should be deleted")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"ä»‹ç»istioæµé‡ç®¡ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»‹ç»istioæµé‡ç®¡ç†"}},[s._v("#")]),s._v(" ä»‹ç»Istioæµé‡ç®¡ç†")]),s._v(" "),a("h4",{attrs:{id:"é¦–å…ˆæ˜¯istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é¦–å…ˆæ˜¯istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„"}},[s._v("#")]),s._v(" é¦–å…ˆæ˜¯Istioå¦‚ä½•åœ¨ç½‘æ ¼ç§å¼•å¯¼æµé‡çš„ï¼Ÿ")]),s._v(" "),a("ol",[a("li",[s._v("é¦–å…ˆè¦çŸ¥é“æ‰€åœ¨çš„ç«¯ç‚¹åœ¨å“ªé‡Œï¼Ÿ")]),s._v(" "),a("li",[s._v("ä»¥åŠå®ƒä»¬å±äºå“ªäº›æœåŠ¡ï¼Ÿ")]),s._v(" "),a("li",[s._v("å¡«å……è‡ªå·±çš„æœåŠ¡æ³¨å†Œï¼ˆå°±æ˜¯å†…éƒ¨çš„æ³¨å†Œè¡¨ï¼Œç”¨æ¥ç”Ÿæˆä¸€äº›Envoyé…ç½®ï¼‰è¿æ¥åˆ°æœåŠ¡å‘ç°ç³»ç»Ÿã€‚")]),s._v(" "),a("li",[s._v("åœ¨Kubernetesä¸­å®‰è£…Istioï¼Œé‚£ä¹ˆIstioä¼šè‡ªåŠ¨æ£€æµ‹é›†ç¾¤ä¸­çš„æœåŠ¡å’Œç«¯ç‚¹ã€‚")])]),s._v(" "),a("h4",{attrs:{id:"åœ¨kubernetesä¸­å¦‚ä½•ä½¿ç”¨istio"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨kubernetesä¸­å¦‚ä½•ä½¿ç”¨istio"}},[s._v("#")]),s._v(" åœ¨Kubernetesä¸­å¦‚ä½•ä½¿ç”¨istioï¼Ÿ")]),s._v(" "),a("p",[s._v("1.é€šè¿‡Kuberneteså®‰è£…istioä¹‹åå¯¹"),a("code",[s._v("K8Sä½¿ç”¨CRDæ‰©å±•ï¼Œ ä¹Ÿå°±æ˜¯Kubernetesçš„ APIæ‰©å±•")]),s._v("ï¼Œistioä¹Ÿèƒ½åƒå…¶ä»– çš„resoucesä¸€æ ·ä½¿ç”¨ã€‚\n2.é€šè¿‡ä½¿ç”¨Kubrenetes APIçš„æ‰©å±•ï¼Œå¯ä»¥ä½¿ç”¨èµ„æºæœ‰ è™šæ‹ŸæœåŠ¡ã€ç›®çš„è§„åˆ™ã€ç½‘å…³ã€æœåŠ¡æ¡ç›®ã€è¾¹è½¦ã€‚")]),s._v(" "),a("h4",{attrs:{id:"åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆ"}},[s._v("#")]),s._v(" åœ¨istioä¸­èƒ½å­¦åˆ°ä»€ä¹ˆï¼Ÿ")]),s._v(" "),a("p",[s._v("1.å¯ä»¥å­¦ä¹ åˆ°æµé‡çš„ç®¡ç†ã€å…¥å£å‡ºå£æµé‡ç®¡ç†ã€‚")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("è¯·æ±‚è·¯ç”±")])]),s._v(" "),a("li",[a("code",[s._v("æ•…éšœæ³¨å…¥")])]),s._v(" "),a("li",[a("code",[s._v("äº¤é€šè½¬ç§»")])]),s._v(" "),a("li",[a("code",[s._v("TCPæµé‡è½¬ç§»")])]),s._v(" "),a("li",[a("code",[s._v("è¯·æ±‚è¶…æ—¶")])]),s._v(" "),a("li",[a("code",[s._v("ç†”æ–­")])]),s._v(" "),a("li",[a("code",[s._v("é•œåƒ")])]),s._v(" "),a("li",[a("code",[s._v("å±€éƒ¨è´Ÿè½½å‡è¡¡")])]),s._v(" "),a("li",[a("code",[s._v("å…¥å£çš„ç½‘å…³")])]),s._v(" "),a("li",[a("code",[s._v("å‡ºå£çš„è®¿é—®å¤–éƒ¨æœåŠ¡")])])]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯è™šæ‹ŸæœåŠ¡ï¼Ÿ")]),s._v(" "),a("p",[s._v("è™šæ‹ŸæœåŠ¡ä»¥åŠç›®æ ‡è§„åˆ™æ˜¯Istioæµé‡è·¯ç”±åŠŸèƒ½çš„å…³é”®æ„å»ºå—ã€‚è™šæ‹ŸæœåŠ¡å…è®¸æ‚¨é…ç½®å¦‚ä½•å°†è¯·æ±‚çš„è·¯ç”±åˆ°Istioçš„æœåŠ¡ç½‘æ ¼ä¸­çš„æœåŠ¡ã€‚ å»ºç«‹åœ¨Istioå’Œæ‚¨çš„å¹³å°æä¾›åŸºæœ¬çš„è¿æ¥å’Œå‘ç°ä¹‹ä¸Šã€‚æ¯ä¸€ä¸ªè™šæ‹ŸæœåŠ¡éƒ½åŒ…å«äº†ä¸€ç»„æŒ‰é¡ºåºè¯„ä¼°çš„è·¯ç”±è§„åˆ™ï¼Œè®©Istioå°†æ¯ä¸€ä¸ªç»™å®šçš„è™šæ‹ŸæœåŠ¡è¯·æ±‚åŒ¹é…åˆ°ç½‘æ ¼ä¸­ç‰¹å®šçœŸå®çš„ç›®çš„åœ°ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡"}},[s._v("#")]),s._v(" ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è™šæ‹ŸæœåŠ¡ï¼Ÿ")]),s._v(" "),a("p",[s._v("1.é€šè¿‡å°†å®¢æˆ·ç«¯ä»å®é™…å®ç°å®ƒä»¬çš„ç›®æ ‡å·¥ä½œè´Ÿè½½å‘é€è¯·æ±‚çš„ä½ç½®å¼ºè§£è€¦æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚è™šæ‹ŸæœåŠ¡è¿˜æä¾›ä¸€ç§ä¸°å¯Œçš„æ–¹å¼æ¥æŒ‡å®šä¸åŒçš„æµé‡è·¯ç”±è§„åˆ™ï¼Œä»¥å°†æµé‡å‘é€åˆ°è¿™äº›å·¥ä½œè´Ÿè½½ã€‚")]),s._v(" "),a("p",[s._v("2.ä¸ºä»€ä¹ˆè¯´è¿™å¾ˆæœ‰ç”¨ï¼Ÿ Envoyåœ¨æ‰€æœ‰æœåŠ¡å®ä¾‹ä¹‹é—´ä½¿ç”¨å¾ªç¯è´Ÿè½½å¹³è¡¡æ¥åˆ†é…æµé‡ï¼Œå¯¹æ­¤è¿›è¡Œäº†æ”¹è¿›ï¼Œå¯ä»¥é’ˆå¯¹ç™¾åˆ†æ¯”è¿›è¡Œç‰¹å®šçš„æµé‡å¼•å¯¼ã€‚")]),s._v(" "),a("p",[s._v("3.å¯ä»¥ä¸€ä¸ªæˆ–è€…å¤šä¸ªæŒ‡å®šä¸»æœºåæŒ‡å®šæµé‡è¡Œä¸ºã€‚ åœ¨è™šæ‹ŸæœåŠ¡ä¸­ï¼Œä½¿ç”¨è·¯ç”±è§„åˆ™æ¥å‘Šè¯‰Envoyå¦‚ä½•å°†è™šæ‹ŸæœåŠ¡çš„æµé‡å‘é€åˆ°åˆé€‚çš„åœ°æ–¹ã€‚")]),s._v(" "),a("p",[s._v("4.è¿˜å¯ä»¥å°†å•ä¸ªè™šæ‹ŸæœåŠ¡å¤„ç†å¤šä¸ªåº”ç”¨ç¨‹åºã€‚ ç»“åˆç½‘å…³çš„æµé‡è§„åˆ™ï¼Œæ§åˆ¶æµé‡è¿›å‡ºã€‚")]),s._v(" "),a("h4",{attrs:{id:"è™šæ‹ŸæœåŠ¡å®ä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è™šæ‹ŸæœåŠ¡å®ä¾‹"}},[s._v("#")]),s._v(" è™šæ‹ŸæœåŠ¡å®ä¾‹")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹çš„è™šæ‹ŸæœåŠ¡æ ¹æ®è¯·æ±‚æ˜¯å¦æ¥è‡ªç‰¹å®šçš„ç”¨æˆ·ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°ä¸åŒç‰ˆæœ¬çš„æœåŠ¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end-user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jason\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h4",{attrs:{id:"ä¸»æœºå­—æ®µ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸»æœºå­—æ®µ"}},[s._v("#")]),s._v(" ä¸»æœºå­—æ®µ")]),s._v(" "),a("p",[s._v("1."),a("code",[s._v("hostså­—æ®µ")]),s._v("åˆ—å‡ºäº†è™šæ‹ŸæœåŠ¡çš„ä¸»æœºï¼Œè¿™äº›è·¯ç”±è§„åˆ™é€‚ç”¨çš„ç”¨æˆ·å¯ä»¥å¯»å€ç›®çš„æˆ–ç›®çš„åœ°ã€‚è¿™æ˜¯å®¢æˆ·ç«¯åœ¨å‘ æœåŠ¡å‘é€è¯·æ±‚æ—¶ä½¿ç”¨çš„åœ°å€ã€‚\n2.ä¸»æœºåå¯ä»¥æ˜¯"),a("code",[s._v("IPåœ°å€")]),s._v("ï¼Œä¹Ÿå¯ä»¥æ˜¯"),a("code",[s._v("DNSåç§°")]),s._v("ä»¥åŠè§£æçš„ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"è·¯ç”±è§„åˆ™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è·¯ç”±è§„åˆ™"}},[s._v("#")]),s._v(" è·¯ç”±è§„åˆ™")]),s._v(" "),a("p",[s._v("1.è¯¥httpéƒ¨åˆ†åŒ…å«è™šæ‹ŸæœåŠ¡çš„è·¯ç”±è§„åˆ™ï¼Œæè¿°äº†å°†"),a("code",[s._v("HTTP/1.1 HTTP2å’ŒgRPCæµé‡")]),s._v("è·¯ç”±åˆ°hostså­—æ®µä¸­æŒ‡å®šçš„ ç›®æ ‡çš„åŒ¹é…æ¡ä»¶å’Œæ“ä½œã€‚\n2.åŒ¹é…æ¡ä»¶ï¼ˆç¤ºä¾‹ä¸­çš„ç¬¬ä¸€ä¸ªè·¯ç”±æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œå› æ­¤ä»¥matchå­—æ®µå¼€å¤´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›æ­¤è·¯ç”±é€‚ ç”¨äºæ¥è‡ªç”¨æˆ·â€˜jasonâ€™çš„æ‰€æœ‰è¯·æ±‚ï¼Œå› æ­¤æ‚¨ä½¿ç”¨headersã€end-userå’Œexactå­—æ®µæ¥é€‰æ‹©é€‚å½“çš„è¯·æ±‚ã€‚ï¼‰")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n       "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end-user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n         "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jason\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"ç›®çš„åœ°"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›®çš„åœ°"}},[s._v("#")]),s._v(" ç›®çš„åœ°")]),s._v(" "),a("p",[s._v("è·¯ç”±éƒ¨åˆ†"),a("code",[s._v("destinationå­—æ®µ")]),s._v("æŒ‡å®šç¬¦åˆæ¡ä»¶çš„æµé‡å®é™…ç›®çš„åœ°ã€‚ ä¸è™šæ‹Ÿä¸»æœºä¸åŒï¼Œç›®æ ‡ä¸»æœºå¿…é¡»å­˜åœ¨äºistioæœåŠ¡æ³¨å†Œè¡¨ä¸­çœŸå®ç›®æ ‡ï¼Œå¦åˆ™Envoyå°†ä¸çŸ¥é“å°†æµé‡å‘é€åˆ°ä½•å¤„ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("routeï¼š\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destintion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§"}},[s._v("#")]),s._v(" è·¯ç”±è§„åˆ™ä¼˜å…ˆçº§")]),s._v(" "),a("p",[s._v("è·¯ç”±è§„åˆ™æŒ‰ç…§ä¸Šåˆ°ä¸‹çš„é¡ºåºè¿›è¡Œè¯„ä¼°ï¼Œ"),a("code",[s._v("è™šæ‹ŸæœåŠ¡å®šä¹‰ä¸­çš„ç¬¬ä¸€ä¸ªè§„åˆ™è¢«èµ‹äºˆæœ€é«˜ä¼˜å…ˆçº§ã€‚")]),s._v(" åœ¨è¿™ç§æƒ…å†µä¸‹ ï¼Œæ‚¨å¸Œæœ›ä»»ä½•ç¬¬ä¸€æ¡è·¯ç”±è§„åˆ™ä¸åŒ¹é…çš„ä¸œè¥¿éƒ½è½¬åˆ°ç¬¬äºŒæ¡è§„åˆ™ä¸­æŒ‡å®šé»˜è®¤çš„ç›®çš„åœ°ã€‚ å› æ­¤ï¼Œç¬¬äºŒæ¡è§„åˆ™ æ²¡æœ‰åŒ¹é…æ¡ä»¶ï¼Œåªæ˜¯å°†æµé‡å®šå‘åˆ°v3å­é›†ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯"}},[s._v("#")]),s._v(" æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯")]),s._v(" "),a("p",[s._v("è·¯ç”±è§„åˆ™æ˜¯å°†ç‰¹å®šæµé‡å­é›†è·¯ç”±åˆ°ç‰¹å®šç›®çš„åœ°çš„å¼ºå¤§å·¥å…·ã€‚"),a("code",[s._v("æ‚¨å¯ä»¥å¯¹æµé‡ç«¯å£ã€æ ‡å¤´å­—æ®µã€URLç­‰è®¾ç½®åŒ¹ é…æ¡ä»¶")]),s._v("ï¼Œä¾‹å¦‚ï¼šæ­¤è™šæ‹ŸæœåŠ¡å…è®¸ç”¨æˆ·å°†æµé‡å‘é€åˆ°ä¸¤ä¸ªå•ç‹¬çš„æœåŠ¡ï¼Œè¯„åˆ†å’Œè¯„è®ºï¼Œå°±å¥½åƒå®ƒä»¬æ˜¯æ›´å¤§çš„è™šæ‹ŸæœåŠ¡çš„ä¸€éƒ¨åˆ†ä¸€æ ·ã€‚è™šæ‹ŸæœåŠ¡è§„åˆ™æ ¹æ®è¯·æ±‚çš„URLåŒ¹é…æµé‡ï¼Œå¹¶å°†æµé‡è¯·æ±‚å®šå‘åˆ°åˆé€‚çš„æœåŠ¡ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bookinfo\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" bookinfo.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /reviews\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /ratings\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("p",[s._v('é™¤äº†ä½¿ç”¨åŒ¹é…æ¡ä»¶å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æŒ‰"æƒé‡"ç™¾åˆ†æ¯”åˆ†é…æµé‡ã€‚è¿™å¯¹äºA/Bæµ‹è¯•å’Œé‡‘ä¸é›€å‘å¸ƒå¾ˆæœ‰ç”¨ã€‚')]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" route\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subnet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("æ‚¨è¿˜å¯ä»¥ä½¿ç”¨è·¯ç”±è§„åˆ™å¯¹æµé‡æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("é™„åŠ æˆ–åˆ é™¤æ ‡é¢˜")])]),s._v(" "),a("li",[a("code",[s._v("é‡å†™ç½‘å€")])]),s._v(" "),a("li",[a("code",[s._v("ä¸ºå¯¹è¯¥ç›®çš„åœ°çš„è°ƒç”¨è®¾ç½®é‡è¯•ç­–ç•¥")])])]),s._v(" "),a("h4",{attrs:{id:"ç›®çš„åœ°è§„åˆ™"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›®çš„åœ°è§„åˆ™"}},[s._v("#")]),s._v(" ç›®çš„åœ°è§„åˆ™")]),s._v(" "),a("p",[s._v('1.ç›®æ ‡è§„åˆ™æ˜¯Istioæµé‡è·¯ç”±åŠŸèƒ½çš„å…³é”®éƒ¨åˆ†ã€‚å¯ä»¥å°†è™šæ‹ŸæœåŠ¡è§†ä¸ºæµé‡å°†è·¯ç”±ç»™å®šç›® çš„åœ°çš„æ–¹å¼ï¼Œç›®æ ‡è§„åˆ™åœ¨è¯„ä¼°è™šæ‹ŸæœåŠ¡è·¯ç”±è§„åˆ™ååº”ç”¨ï¼Œå› æ­¤å®ƒä»¬é€‚ç”¨äºæµé‡çš„"çœŸå®"ç›®æ ‡ã€‚\n2.ç‰¹åˆ«æ˜¯ï¼Œæ‚¨ä½¿ç”¨ç›®æ ‡è§„åˆ™æ¥æŒ‡å®šå‘½åçš„æœåŠ¡å­é›†ï¼Œä¾‹å¦‚æŒ‰ç‰ˆæœ¬å¯¹æ‰€æœ‰ç»™å®šæœåŠ¡çš„å®ä¾‹è¿›è¡Œåˆ†ç»„ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥åœ¨è™šæ‹ŸæœåŠ¡çš„è·¯ç”±è§„åˆ™ä¸­ä½¿ç”¨è¿™äº›æœåŠ¡å­é›†æ¥æ§åˆ¶åˆ°ä¸åŒæœåŠ¡å®ä¾‹çš„æµé‡ã€‚\n3.ç›®æ ‡è§„åˆ™è¿˜å…è®¸æ‚¨åœ¨è°ƒç”¨æ•´ä¸ªç›®æ ‡æœåŠ¡æˆ–ç‰¹å®šæœåŠ¡å­é›†æ—¶è‡ªå®šä¹‰ Envoy çš„æµé‡ç­–ç•¥ï¼Œä¾‹å¦‚æ‚¨é¦–é€‰çš„è´Ÿ è½½å¹³è¡¡æ¨¡å‹ã€TLS å®‰å…¨æ¨¡å¼æˆ–æ–­è·¯å™¨è®¾ç½®ã€‚')]),s._v(" "),a("h4",{attrs:{id:"è´Ÿè½½å¹³è¡¡é€‰é¡¹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è´Ÿè½½å¹³è¡¡é€‰é¡¹"}},[s._v("#")]),s._v(" è´Ÿè½½å¹³è¡¡é€‰é¡¹")]),s._v(" "),a("p",[s._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä½¿ç”¨å¾ªç¯è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ä¾‹æ± ä¸­çš„æ¯ä¸ªæœåŠ¡å®ä¾‹ä¾æ¬¡æ”¶åˆ°è¯·æ±‚ã€‚Istio è¿˜æ”¯æŒä»¥ä¸‹æ¨¡å‹ï¼Œæ‚¨å¯ä»¥åœ¨ç›®æ ‡è§„åˆ™ä¸­ä¸ºå¯¹ç‰¹å®šæœåŠ¡æˆ–æœåŠ¡å­é›†çš„è¯·æ±‚æŒ‡å®šè¿™äº›æ¨¡å‹ã€‚")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("éšæœºï¼š")]),s._v("è¯·æ±‚éšæœºè½¬å‘åˆ°æ± ä¸­çš„å®ä¾‹ã€‚")]),s._v(" "),a("li",[a("code",[s._v("åŠ æƒï¼š")]),s._v("æ ¹æ®ç‰¹å®šç™¾åˆ†æ¯”å°†è¯·æ±‚è½¬å‘åˆ°æ± ä¸­çš„å®ä¾‹ã€‚")]),s._v(" "),a("li",[a("code",[s._v("æœ€å°‘è¯·æ±‚ï¼š")]),s._v("è¯·æ±‚è¢«è½¬å‘åˆ°è¯·æ±‚æ•°é‡æœ€å°‘çš„å®ä¾‹ã€‚")])]),s._v(" "),a("h4",{attrs:{id:"ç›®æ ‡è§„åˆ™ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç›®æ ‡è§„åˆ™ç¤ºä¾‹"}},[s._v("#")]),s._v(" ç›®æ ‡è§„åˆ™ç¤ºä¾‹")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹ç¤ºä¾‹ç›®æ ‡è§„åˆ™ä¸ºmy-svcç›®æ ‡æœåŠ¡é…ç½®äº†ä¸‰ä¸ªä¸åŒçš„å­é›†ï¼Œå…·æœ‰ä¸åŒçš„è´Ÿè½½å¹³è¡¡ç­–ç•¥ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("destination"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("rule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("svc\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("loadBalancer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("simple")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RANDOM\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("loadBalancer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("simple")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ROUND_ROBIN\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("p",[s._v("æ¯ä¸ªå­é›†éƒ½æ˜¯åŸºäºä¸€ä¸ªæˆ–å¤šä¸ªå®šä¹‰çš„labelsï¼Œåœ¨Kubernetesä¸­ï¼Œå®ƒä»¬æ˜¯é™„åŠ åˆ°Podç­‰å¯¹è±¡çš„é”®/å€¼å¯¹ã€‚è¿™äº›æ ‡ç­¾åº”ç”¨äºKubernetesæœåŠ¡çš„éƒ¨ç½²ï¼Œmetadataä»¥è¯†åˆ«ä¸åŒçš„ç‰ˆæœ¬ã€‚")]),s._v(" "),a("p",[s._v("é™¤äº†å®šä¹‰å­é›†ä¹‹å¤–ï¼Œæ­¤ç›®æ ‡è§„åˆ™è¿˜å…·æœ‰é’ˆå¯¹æ­¤ç›®æ ‡ä¸­æ‰€æœ‰å­é›†çš„é»˜è®¤æµé‡ç­–ç•¥å’Œä»…é’ˆå¯¹è¯¥å­é›†è¦†ç›–å®ƒçš„å­é›†ç‰¹å®šç­–ç•¥ã€‚åœ¨è¯¥å­—æ®µä¸Šæ–¹å®šä¹‰çš„é»˜è®¤ç­–ç•¥ä¸ºå’Œå­é›†subsets è®¾ç½®ç®€å•çš„éšæœºè´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨ ç­–ç•¥ä¸­ï¼Œ åœ¨ç›¸åº”å­é›†çš„å­—æ®µä¸­æŒ‡å®šäº†å¾ªç¯è´Ÿè½½å‡è¡¡å™¨ã€‚v1v3v2")]),s._v(" "),a("h4",{attrs:{id:"ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘å…³"}},[s._v("#")]),s._v(" ç½‘å…³")]),s._v(" "),a("p",[s._v("1.æ‚¨ä½¿ç”¨ç½‘å…³æ¥ç®¡ç†ç½‘æ ¼çš„å…¥ç«™å’Œå‡ºç«™æµé‡ï¼Œè®©æ‚¨"),a("code",[s._v("æŒ‡å®šè¦è¿›å…¥æˆ–ç¦»å¼€ç½‘æ ¼çš„æµé‡")]),s._v("ã€‚ç½‘å…³é…ç½®åº”ç”¨äºåœ¨ç½‘æ ¼è¾¹ç¼˜è¿è¡Œçš„ç‹¬ç«‹ Envoy ä»£ç†ï¼Œè€Œä¸æ˜¯ä¸æœåŠ¡å·¥ä½œè´Ÿè½½ä¸€èµ·è¿è¡Œçš„ Sidecar Envoy ä»£ç†ã€‚\n2.ä¸æ§åˆ¶è¿›å…¥ç³»ç»Ÿçš„æµé‡çš„å…¶ä»–æœºåˆ¶ï¼ˆä¾‹å¦‚ Kubernetes Ingress APIï¼‰ä¸åŒï¼Œ"),a("code",[s._v("Istio ç½‘å…³è®©æ‚¨å¯ä»¥ä½¿ç”¨ Istio æµé‡è·¯ç”±çš„å…¨éƒ¨åŠŸèƒ½å’Œçµæ´»æ€§")]),s._v("ã€‚æ‚¨å¯ä»¥è¿™æ ·åšï¼Œå› ä¸º Istio çš„ç½‘å…³èµ„æºåªå…è®¸æ‚¨é…ç½® 4-6 å±‚è´Ÿè½½å¹³è¡¡å±æ€§ï¼Œä¾‹å¦‚è¦å…¬å¼€çš„ç«¯å£ã€TLS è®¾ç½®ç­‰ã€‚ç„¶åï¼Œæ‚¨æ— éœ€å°†åº”ç”¨å±‚æµé‡è·¯ç”± (L7) æ·»åŠ åˆ°åŒä¸€ API èµ„ æºï¼Œè€Œæ˜¯å°†å¸¸è§„ Istioè™šæ‹ŸæœåŠ¡ç»‘å®šåˆ°ç½‘å…³ã€‚è¿™ä½¿æ‚¨å¯ä»¥åƒç®¡ç† Istio ç½‘æ ¼ä¸­çš„ä»»ä½•å…¶ä»–æ•°æ®å¹³é¢æµé‡ ä¸€æ ·ç®¡ç†ç½‘å…³æµé‡ã€‚\n3."),a("code",[s._v("ç½‘å…³ä¸»è¦ç”¨äºç®¡ç†å…¥å£æµé‡ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥é…ç½®å‡ºå£ç½‘å…³")]),s._v("ã€‚ä¾‹å¦‚ï¼Œå‡ºå£ç½‘å…³å…è®¸æ‚¨ä¸ºç¦»å¼€ç½‘æ ¼çš„æµé‡é…ç½®ä¸“ç”¨å‡ºå£èŠ‚ç‚¹ï¼Œè®©æ‚¨é™åˆ¶å“ªäº›æœåŠ¡å¯ä»¥æˆ–åº”è¯¥è®¿é—®å¤–éƒ¨ç½‘ç»œï¼Œæˆ–è€…å¯ç”¨ å¯¹å‡ºå£æµé‡çš„å®‰å…¨æ§åˆ¶ ä»¥å¢åŠ ç½‘æ ¼çš„å®‰å…¨æ€§ã€‚æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ç½‘å…³æ¥é…ç½®çº¯å†…éƒ¨ä»£ç†ã€‚\n4.Istio æä¾›äº†ä¸€äº›æ‚¨å¯ä»¥ä½¿ç”¨çš„é¢„é…ç½®ç½‘å…³ä»£ç†éƒ¨ç½² (istio-ingressgatewayå’Œistio-egressgateway)å¦‚æœæ‚¨ä½¿ç”¨æˆ‘ä»¬çš„æ¼”ç¤ºå®‰è£…ï¼Œåˆ™ä¼šéƒ¨ç½²ä¸¤è€…ï¼Œè€Œä»…ä½¿ç”¨æˆ‘ä»¬çš„é»˜è®¤é…ç½®æ–‡ä»¶éƒ¨ç½²å…¥å£ç½‘å…³ ã€‚æ‚¨å¯ä»¥å°†è‡ª å·±çš„ç½‘å…³é…ç½®åº”ç”¨äºè¿™äº›éƒ¨ç½²ï¼Œæˆ–è€…éƒ¨ç½²å’Œé…ç½®è‡ªå·±çš„ç½‘å…³ä»£ç†ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç½‘å…³ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘å…³ç¤ºä¾‹"}},[s._v("#")]),s._v(" ç½‘å…³ç¤ºä¾‹")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹ç¤ºä¾‹æ˜¾ç¤ºäº†å¤–éƒ¨ HTTPS å…¥å£æµé‡çš„å¯èƒ½ç½‘å…³é…ç½®ï¼š\næ­¤ç½‘å…³é…ç½®"),a("code",[s._v("å…è®¸ HTTPS æµé‡")]),s._v("ä»"),a("code",[s._v("ext-host.example.comç«¯å£ 443 è¿›å…¥ç½‘æ ¼")]),s._v("ï¼Œä½†æ²¡æœ‰ä¸ºæµé‡æŒ‡å®šä»»ä½•è·¯ç”±ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gwy\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("controller\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host.example.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SIMPLE\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentialName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cert\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("p",[s._v("è¦æŒ‡å®šè·¯ç”±å¹¶ä½¿ç½‘å…³æŒ‰é¢„æœŸå·¥ä½œï¼Œæ‚¨è¿˜å¿…é¡»å°†ç½‘å…³ç»‘å®šåˆ°è™šæ‹ŸæœåŠ¡ã€‚æ‚¨å¯ä»¥ä½¿ç”¨è™šæ‹ŸæœåŠ¡çš„gatewayså­— æ®µæ‰§è¡Œæ­¤æ“ä½œï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" virtual"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("svc\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gwy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("ç„¶åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å¤–éƒ¨æµé‡çš„è·¯ç”±è§„åˆ™é…ç½®è™šæ‹ŸæœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æœåŠ¡æ¡ç›®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡æ¡ç›®"}},[s._v("#")]),s._v(" æœåŠ¡æ¡ç›®")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡æ¡ç›®å‘Istioå†…éƒ¨ç»´æŠ¤çš„æœåŠ¡æ³¨å†Œè¡¨æ·»åŠ ä¸€ä¸ªæ¡ç›®ã€‚æ·»åŠ æœåŠ¡æ¡ç›®ä¹‹åï¼ŒEnvoyä»£ç†å¯ä»¥å°†æµé‡å‘é€åˆ°æœåŠ¡ï¼Œå°±å¥½åƒå®ƒæ˜¯ç½‘æ ¼ä¸­çš„æœåŠ¡ä¸€æ ·ã€‚é…ç½®æœåŠ¡æ¡ç›®å…è®¸æ‚¨ç®¡ç†åœ¨ç½‘æ ¼ä¹‹å¤–å…è®¸çš„æœåŠ¡æµé‡ï¼ŒåŒ…æ‹¬ä»¥ä¸‹ä»»åŠ¡ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("é‡å®šå‘å’Œè½¬å‘å¤–éƒ¨ç›®çš„åœ°çš„æµé‡")]),s._v("ï¼Œä¾‹å¦‚ä»webä½¿ç”¨çš„APIï¼Œæˆ–åˆ°æ—§åŸºç¡€è®¾æ–½ä¸­çš„æœåŠ¡æµé‡ã€‚")]),s._v(" "),a("li",[a("code",[s._v("ä¸ºå¤–éƒ¨ç›®æ ‡å®šä¹‰é‡è¯•ã€è¶…æ—¶å’Œæ•…éšœæ³¨å…¥ç­–ç•¥ã€‚")])]),s._v(" "),a("li",[a("code",[s._v("é€šè¿‡è™šæ‹Ÿæœºæ·»åŠ ç½‘æ ¼ä¸­ï¼Œåœ¨è™šæ‹Ÿæœºä¸­å…è®¸ç½‘æ ¼æœåŠ¡ã€‚")])])]),s._v(" "),a("p",[s._v("æ‚¨æ— éœ€å¸Œæœ›ç½‘æ ¼æœåŠ¡ä½¿ç”¨çš„æ¯ä¸ªå¤–éƒ¨æœåŠ¡æ·»åŠ æœåŠ¡æ¡ç›®ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioå°†Envoyä»£ç†è®¾ç½®ä¸ºå°†è¯·æ±‚ä¼ é€’ç»™æœªçŸ¥æœåŠ¡ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨IstioåŠŸèƒ½æ¥æ§åˆ¶åˆ°æœªæ¥åœ¨ç½‘æ ¼ä¸­æ³¨å†Œçš„ç›®çš„åœ°æµé‡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æœåŠ¡å…¥å£ç¤ºä¾‹"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æœåŠ¡å…¥å£ç¤ºä¾‹"}},[s._v("#")]),s._v(" æœåŠ¡å…¥å£ç¤ºä¾‹")]),s._v(" "),a("p",[s._v("ä»¥ä¸‹ç¤ºä¾‹ç½‘æ ¼å¤–éƒ¨æœåŠ¡æ¡ç›®"),a("code",[s._v("å°†ext-svc.example.com å¤–éƒ¨ä¾èµ–é¡¹æ·»åŠ åˆ° Istio çš„æœåŠ¡æ³¨å†Œè¡¨")]),s._v("ï¼š\næ‚¨ä½¿ç”¨è¯¥hostså­—æ®µæŒ‡å®šå¤–éƒ¨èµ„æºã€‚æ‚¨å¯ä»¥å®Œå…¨é™å®šå®ƒæˆ–ä½¿ç”¨é€šé…ç¬¦å‰ç¼€çš„åŸŸåã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceEntry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" svc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("entry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("svc.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MESH_EXTERNAL\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resolution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DNS\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("æ‚¨å¯ä»¥é…ç½®è™šæ‹ŸæœåŠ¡å’Œç›®æ ‡è§„åˆ™ï¼Œä»¥æ›´ç²¾ç»†çš„æ–¹å¼æ§åˆ¶æœåŠ¡æ¡ç›®çš„æµé‡ï¼Œå°±åƒä¸ºç½‘æ ¼ä¸­çš„ä»»ä½•å…¶ä»–æœåŠ¡é…ç½®æµé‡ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹ç›®æ ‡è§„åˆ™å°†æµé‡è·¯ç”±é…ç½®ä¸ºä½¿ç”¨"),a("code",[s._v("åŒå‘ TLS æ¥ä¿æŠ¤ä¸ ext-svc.example.comæˆ‘ä»¬ ä½¿ç”¨æœåŠ¡æ¡ç›®é…ç½®çš„å¤–éƒ¨æœåŠ¡çš„è¿æ¥")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("res"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dr\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ext"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("svc.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" MUTUAL\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("clientCertificate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/certs/myclientcert.pem\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("privateKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/certs/client_private_key.pem\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("caCertificates")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /etc/certs/rootcacerts.pem\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("h4",{attrs:{id:"è¾¹è½¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¾¹è½¦"}},[s._v("#")]),s._v(" è¾¹è½¦")]),s._v(" "),a("p",[s._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstioå°†æ¯ä¸ªEnvoä»£ç†é…ç½®ä¸ºæ¥å—å…¶ç›¸å…³å·¥ä½œè´Ÿè½½çš„æ‰€æœ‰ç«¯å£ä¸Šçš„æµé‡ï¼Œå¹¶åœ¨è½¬å‘æµé‡æ—¶åˆ° è¾¾ç½‘æ ¼ä¸­çš„æ¯ä¸ªå·¥ä½œè´Ÿè½½ã€‚æ‚¨å¯ä»¥ä½¿ç”¨sidecaré…ç½®æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("å¾®è°ƒEnvoyä»£ç†æ¥å—çš„ç«¯å£å’Œåè®®é›†")])]),s._v(" "),a("li",[a("code",[s._v("é™åˆ¶Envoyä»£ç†å¯ä»¥è®¿é—®çš„æœåŠ¡é›†")])])]),s._v(" "),a("p",[s._v("æ‚¨å¯èƒ½å¸Œæœ›åœ¨å¤§å‹çš„åº”ç”¨ç¨‹åºåƒè¿™æ ·é™åˆ¶sidecarçš„å¯è®¿é—®æ€§ï¼Œå…¶ä¸­å°†æ¯ä¸ªä»£ç†é…ç½®ä¸ºè®¿é—®ç½‘æ ¼ä¸­çš„æ‰€æœ‰ å…¶ä»–æœåŠ¡å¯èƒ½ä¼šç”±äºé«˜å†…å­˜çš„ä½¿ç”¨ç‡è€Œå½±å“ç½‘æ ¼çš„æ€§èƒ½ã€‚")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥æŒ‡å®šå¸Œæœ›å°† sidecar é…ç½®åº”ç”¨äºç‰¹å®šå‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å·¥ä½œè´Ÿè½½ï¼Œæˆ–è€…ä½¿ç”¨ workloadSelector. ä¾‹å¦‚ï¼Œä»¥ä¸‹ sidecar é…ç½®å°†å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰æœåŠ¡é…ç½®bookinfoä¸ºä»…è®¿é—®åœ¨åŒä¸€å‘½åç©ºé—´å’Œ Istio æ§åˆ¶å¹³é¢ä¸­è¿è¡Œçš„æœåŠ¡ï¼ˆIstio çš„å‡ºå£å’Œé¥æµ‹åŠŸèƒ½éœ€è¦ï¼‰ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Sidecar\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" bookinfo\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("egress")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./*"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"istio-system/*"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("h4",{attrs:{id:"ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•"}},[s._v("#")]),s._v(" ç½‘ç»œå¼¹æ€§å’Œæµ‹è¯•")]),s._v(" "),a("p",[s._v("é™¤äº†å¸®åŠ©æ‚¨å¼•å¯¼ç½‘æ ¼å‘¨å›´çš„æµé‡å¤–ï¼ŒIstio è¿˜æä¾›äº†å¯é€‰çš„æ•…éšœæ¢å¤å’Œæ•…éšœæ³¨å…¥åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é…ç½®è¿™äº›åŠŸèƒ½ã€‚ä½¿ç”¨è¿™äº›åŠŸèƒ½å¯ä»¥å¸®åŠ©æ‚¨çš„åº”ç”¨ç¨‹åºå¯é åœ°è¿è¡Œï¼Œç¡®ä¿æœåŠ¡ç½‘æ ¼å¯ä»¥å®¹å¿æ•…éšœèŠ‚ç‚¹å¹¶é˜²æ­¢å±€éƒ¨æ•…éšœçº§è”åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚")]),s._v(" "),a("h4",{attrs:{id:"è¶…æ—¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¶…æ—¶"}},[s._v("#")]),s._v(" è¶…æ—¶")]),s._v(" "),a("p",[a("code",[s._v("è¶…æ—¶æ˜¯ Envoy ä»£ç†åº”è¯¥ç­‰å¾…æ¥è‡ªç»™å®šæœåŠ¡çš„å›å¤çš„æ—¶é—´é‡ï¼Œç¡®ä¿æœåŠ¡ä¸ä¼šæ— é™æœŸåœ°ç­‰å¾…å›å¤ï¼Œå¹¶ä¸”è°ƒç”¨ åœ¨å¯é¢„æµ‹çš„æ—¶é—´èŒƒå›´å†…æˆåŠŸæˆ–å¤±è´¥ã€‚")]),s._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒIstio ä¸­ç¦ç”¨äº† HTTP è¯·æ±‚çš„ Envoy è¶…æ—¶.")]),s._v(" "),a("p",[s._v("å¯¹äºæŸäº›åº”ç”¨ç¨‹åºå’ŒæœåŠ¡ï¼ŒIstio çš„é»˜è®¤è¶…æ—¶å¯èƒ½ä¸åˆé€‚ã€‚ä¾‹å¦‚ï¼Œè¿‡é•¿çš„è¶…æ—¶å¯èƒ½ä¼šå¯¼è‡´ç­‰å¾…æ¥è‡ªå¤±è´¥æœåŠ¡çš„å›å¤çš„å»¶è¿Ÿè¿‡é•¿ï¼Œè€Œè¿‡çŸ­çš„è¶…æ—¶å¯èƒ½ä¼šå¯¼è‡´è°ƒç”¨åœ¨ç­‰å¾…æ¶‰åŠå¤šä¸ªæœåŠ¡çš„æ“ä½œè¿”å›æ—¶ä¸å¿…è¦åœ°å¤±è´¥ã€‚ä¸ºäº†æ‰¾åˆ°å¹¶ä½¿ç”¨æ‚¨çš„æœ€ä½³è¶…æ—¶è®¾ç½®ï¼ŒIstio å…è®¸æ‚¨ä½¿ç”¨è™šæ‹ŸæœåŠ¡è½»æ¾åœ°åœ¨æ¯ä¸ªæœåŠ¡çš„åŸºç¡€ä¸ŠåŠ¨æ€è°ƒæ•´è¶…æ—¶ï¼Œè€Œæ— éœ€ç¼–è¾‘æ‚¨çš„æœåŠ¡ä»£ç ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼Œå®ƒä¸ºè°ƒç”¨ rating æœåŠ¡çš„ v1 å­é›†æŒ‡å®šäº† 10 ç§’çš„è¶…æ—¶æ—¶é—´ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 10s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("h4",{attrs:{id:"é‡è¯•"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é‡è¯•"}},[s._v("#")]),s._v(" é‡è¯•")]),s._v(" "),a("p",[a("code",[s._v("é‡è¯•è®¾ç½®æŒ‡å®š Envoy ä»£ç†åœ¨åˆå§‹è°ƒç”¨å¤±è´¥æ—¶å°è¯•è¿æ¥æœåŠ¡çš„æœ€å¤§æ¬¡æ•°ã€‚")]),s._v("é‡è¯•å¯ä»¥é€šè¿‡ç¡®ä¿è°ƒç”¨ä¸ä¼šå› ä¸º ä¸´æ—¶æ€§é—®é¢˜ï¼ˆä¾‹å¦‚ä¸´æ—¶è¿‡è½½çš„æœåŠ¡æˆ–ç½‘ç»œï¼‰è€Œæ°¸ä¹…å¤±è´¥ï¼Œä»è€Œæé«˜æœåŠ¡å¯ç”¨æ€§å’Œåº”ç”¨ç¨‹åºæ€§èƒ½ã€‚é‡è¯•é—´éš”ï¼ˆ25ms+ï¼‰æ˜¯å¯å˜çš„ï¼Œç”± Istio è‡ªåŠ¨ç¡®å®šï¼Œé˜²æ­¢è¢«è°ƒç”¨çš„æœåŠ¡è¢«è¯·æ±‚æ·¹æ²¡ã€‚HTTP è¯·æ±‚çš„é»˜è®¤é‡è¯•è¡Œä¸ºæ˜¯ åœ¨è¿”å›é”™è¯¯ä¹‹å‰é‡è¯•ä¸¤æ¬¡ã€‚")]),s._v(" "),a("p",[s._v("ä¸è¶…æ—¶ä¸€æ ·ï¼ŒIstio çš„é»˜è®¤é‡è¯•è¡Œä¸ºå¯èƒ½ä¸é€‚åˆæ‚¨çš„åº”ç”¨ç¨‹åºåœ¨å»¶è¿Ÿï¼ˆå¤±è´¥çš„æœåŠ¡é‡è¯•æ¬¡æ•°è¿‡å¤šå¯èƒ½ä¼šå‡æ…¢é€Ÿåº¦ï¼‰æˆ–å¯ç”¨æ€§æ–¹é¢çš„éœ€æ±‚ã€‚ä¹Ÿåƒè¶…æ—¶ä¸€æ ·ï¼Œæ‚¨å¯ä»¥åœ¨è™šæ‹ŸæœåŠ¡ä¸­åŸºäºæ¯ä¸ªæœåŠ¡è°ƒæ•´é‡è¯•è®¾ç½®ï¼Œè€Œæ— éœ€æ¥è§¦æ‚¨çš„æœåŠ¡ä»£ç ã€‚æ‚¨è¿˜å¯ä»¥é€šè¿‡æ·»åŠ æ¯æ¬¡é‡è¯•è¶…æ—¶æ¥è¿›ä¸€æ­¥ä¼˜åŒ–æ‚¨çš„é‡è¯•è¡Œä¸ºï¼ŒæŒ‡å®šæ‚¨å¸Œæœ›ç­‰å¾…æ¯æ¬¡é‡è¯•å°è¯•æˆåŠŸè¿æ¥åˆ°æœåŠ¡çš„æ—¶é—´é‡ã€‚ä»¥ä¸‹ç¤ºä¾‹åœ¨åˆå§‹è°ƒç”¨å¤±è´¥åé…ç½®æœ€å¤š 3 æ¬¡é‡è¯•ä»¥è¿æ¥åˆ°æ­¤æœåŠ¡å­é›†ï¼Œ æ¯æ¬¡é‡è¯•æ—¶é—´ä¸º 2 ç§’ã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("retries")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("attempts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("perTryTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2s\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"ç†”æ–­"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­"}},[s._v("#")]),s._v(" ç†”æ–­")]),s._v(" "),a("p",[a("code",[s._v("ç†”æ–­æ˜¯ Istio æä¾›çš„å¦ä¸€ç§æœ‰ç”¨çš„æœºåˆ¶ï¼Œç”¨äºåˆ›å»ºåŸºäºå¾®æœåŠ¡çš„å¼¹æ€§åº”ç”¨ç¨‹åºã€‚")]),s._v("åœ¨æ–­è·¯å™¨ä¸­ï¼Œæ‚¨å¯ä»¥ è®¾ç½®å¯¹æœåŠ¡ä¸­å„ä¸ªä¸»æœºçš„è°ƒç”¨é™åˆ¶ï¼Œä¾‹å¦‚å¹¶å‘è¿æ¥æ•°æˆ–å¯¹è¯¥ä¸»æœºçš„è°ƒç”¨å¤±è´¥çš„æ¬¡æ•°ã€‚ä¸€æ—¦è¾¾åˆ°è¯¥é™åˆ¶ï¼Œæ–­è·¯å™¨å°±ä¼šâ€œè·³é—¸â€å¹¶åœæ­¢ä¸è¯¥ä¸»æœºçš„è¿›ä¸€æ­¥è¿æ¥ã€‚ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼å¯ä»¥å®ç°å¿«é€Ÿæ•…éšœï¼Œè€Œä¸æ˜¯å®¢æˆ·ç«¯å°è¯•è¿æ¥åˆ°è¿‡è½½æˆ–æ•…éšœä¸»æœºã€‚")]),s._v(" "),a("p",[s._v("ç”±äºæ–­è·¯å™¨é€‚ç”¨äºè´Ÿè½½å¹³è¡¡æ± ä¸­çš„â€œçœŸå®â€ç½‘æ ¼ç›®æ ‡ï¼Œæ‚¨å¯ä»¥åœ¨ç›®æ ‡è§„åˆ™ä¸­é…ç½®æ–­è·¯å™¨é˜ˆå€¼ ï¼Œå¹¶å°†è®¾ç½®åº” ç”¨äºæœåŠ¡ä¸­çš„æ¯ä¸ªå•ç‹¬çš„ä¸»æœºã€‚ä»¥ä¸‹ç¤ºä¾‹reviewså°† v1 å­é›†çš„æœåŠ¡å·¥ä½œè´Ÿè½½çš„å¹¶å‘è¿æ¥æ•°é™åˆ¶ä¸º 100ï¼š")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("connectionPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tcp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxConnections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h4",{attrs:{id:"æ•…éšœæ³¨å…¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•…éšœæ³¨å…¥"}},[s._v("#")]),s._v(" æ•…éšœæ³¨å…¥")]),s._v(" "),a("p",[a("code",[s._v("é…ç½®å¥½ç½‘ç»œï¼ˆåŒ…æ‹¬æ•…éšœæ¢å¤ç­–ç•¥ï¼‰åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ Istio çš„æ•…éšœæ³¨å…¥æœºåˆ¶æ¥æµ‹è¯•æ•´ä¸ªåº”ç”¨ç¨‹åºçš„æ•…éšœæ¢å¤èƒ½åŠ›ã€‚")]),s._v("æ•…éšœæ³¨å…¥æ˜¯ä¸€ç§å°†é”™è¯¯å¼•å…¥ç³»ç»Ÿä»¥ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ‰¿å—å¹¶ä»é”™è¯¯æ¡ä»¶ä¸­æ¢å¤çš„æµ‹è¯•æ–¹æ³•ã€‚ä½¿ç”¨æ•…éšœæ³¨å…¥å¯¹äºç¡®ä¿æ‚¨çš„æ•…éšœæ¢å¤ç­–ç•¥ä¸ä¼šä¸å…¼å®¹æˆ–é™åˆ¶è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´å…³é”®æœåŠ¡ä¸å¯ç”¨ç‰¹åˆ«æœ‰ç”¨ã€‚")]),s._v(" "),a("p",[s._v("ä¸å…¶ä»–å¼•å…¥é”™è¯¯çš„æœºåˆ¶ï¼ˆä¾‹å¦‚å»¶è¿Ÿæ•°æ®åŒ…æˆ–åœ¨ç½‘ç»œå±‚æ€æ­» podï¼‰ä¸åŒï¼ŒIstio å…è®¸æ‚¨åœ¨åº”ç”¨ç¨‹åºå±‚æ³¨å…¥æ•…éšœã€‚è¿™ä½¿æ‚¨å¯ä»¥æ³¨å…¥æ›´å¤šç›¸å…³æ•…éšœï¼Œä¾‹å¦‚ HTTP é”™è¯¯ä»£ç ï¼Œä»¥è·å¾—æ›´å¤šç›¸å…³ç»“æœã€‚")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥æ³¨å…¥ä¸¤ç§ç±»å‹çš„æ•…éšœï¼Œå‡ä½¿ç”¨ è™šæ‹ŸæœåŠ¡è¿›è¡Œé…ç½®ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("å»¶è¿Ÿï¼š")]),s._v("å»¶è¿Ÿæ˜¯è®¡æ—¶å¤±è´¥ã€‚å®ƒä»¬æ¨¡ä»¿å¢åŠ çš„ç½‘ç»œå»¶è¿Ÿæˆ–è¿‡è½½çš„ä¸Šæ¸¸æœåŠ¡ã€‚")]),s._v(" "),a("li",[a("code",[s._v("ä¸­æ­¢ï¼š")]),s._v("ä¸­æ­¢æ˜¯å´©æºƒå¤±è´¥ã€‚å®ƒä»¬æ¨¡ä»¿ä¸Šæ¸¸æœåŠ¡ä¸­çš„æ•…éšœã€‚ä¸­æ­¢é€šå¸¸ä»¥ HTTP é”™è¯¯ä»£ç æˆ– TCP è¿æ¥å¤±è´¥çš„ å½¢å¼å‡ºç°ã€‚")])]),s._v(" "),a("p",[s._v("ä¾‹å¦‚ï¼Œæ­¤è™šæ‹ŸæœåŠ¡å¯¹ratingsæœåŠ¡çš„æ¯ 1000 ä¸ªè¯·æ±‚ä¸­çš„ 1 ä¸ªå¼•å…¥äº† 5 ç§’çš„å»¶è¿Ÿã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percentage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fixedDelay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("h2",{attrs:{id:"sidecaræ³¨å…¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sidecaræ³¨å…¥"}},[s._v("#")]),s._v(" Sidecaræ³¨å…¥")]),s._v(" "),a("h4",{attrs:{id:"å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚"}},[s._v("#")]),s._v(" å¯¹å·¥ä½œè´Ÿè½½çš„ä¸€äº›è¦æ±‚")]),s._v(" "),a("p",[s._v("æ”¯æŒçš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Job")])]),s._v(" "),a("li",[a("code",[s._v("DaemonSet")])]),s._v(" "),a("li",[a("code",[s._v("ReplicaSet")])]),s._v(" "),a("li",[a("code",[s._v("Pod")])]),s._v(" "),a("li",[a("code",[s._v("Deployment")])])]),s._v(" "),a("p",[s._v("ç­‰ï¼Œå¯¹è¿™äº›å·¥ä½œè´Ÿè½½çš„è¦æ±‚å¦‚ä¸‹ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("è¦æ­£ç¡®å‘½åæœåŠ¡ç«¯å£ï¼š\n"),a("ul",[a("li",[a("code",[s._v("Service")]),s._v(" å¯¹è±¡ä¸­çš„ "),a("code",[s._v("Port")]),s._v(' éƒ¨åˆ†å¿…é¡»ä»¥ "åè®®å" ä¸ºå‰ç¼€ï¼Œç›®å‰æ”¯æŒçš„åè®®ååŒ…æ‹¬ '),a("code",[s._v("http")]),s._v("ï¼Œ"),a("code",[s._v("http2")]),s._v("ï¼Œ"),a("code",[s._v("mongo")]),s._v("ï¼Œ"),a("code",[s._v("redis")]),s._v(" ä¸ "),a("code",[s._v("grpc")]),s._v("ï¼›")]),s._v(" "),a("li",[s._v("istio ä¼šå‘½åæ¥ç¡®å®šä¸ºç«¯å£æä¾›ä»€ä¹ˆæ ·çš„æœåŠ¡ï¼Œä¸ç¬¦åˆå‘½åè§„èŒƒçš„ç«¯å£ä¼šè¢«å½“åš TCP æœåŠ¡å™¨ï¼Œå…¶åŠŸèƒ½æ”¯æŒèŒƒå›´ä¼šå¤§å¹…ç¼©å°ã€‚")])])]),s._v(" "),a("li",[s._v("å·¥ä½œè´Ÿè½½çš„ Pod å¿…é¡»æœ‰å…³è”çš„ Serviceï¼š\n"),a("ul",[a("li",[s._v("ä¸ºæ»¡è¶³æœåŠ¡å‘ç°çš„éœ€è¦ï¼Œæ‰€æœ‰ Pod éƒ½å¿…é¡»æœ‰å…³è”çš„æœåŠ¡ï¼›")]),s._v(" "),a("li",[s._v("å®˜æ–¹å»ºè®®ä¸º Pod æ¨¡æ¿åŠ å…¥ä¸¤ä¸ªæ ‡ç­¾ï¼š"),a("code",[s._v("app")]),s._v(" ä¸ "),a("code",[s._v("version")]),s._v("ï¼Œåˆ†åˆ«æ ‡æ³¨åº”ç”¨åç§°ä¸ç‰ˆæœ¬ï¼Œè™½ä»…æ˜¯ä¸ªå»ºè®®ï¼Œä½† istio å¾ˆå¤šé»˜è®¤ç­–ç•¥ä¼šå¼•ç”¨è¿™ä¸¤ä¸ªæ ‡ç­¾ï¼Œå¦‚æœæ²¡æœ‰ä¼šå¼•å‘å¾ˆå¤šä¸å¿…è¦çš„éº»çƒ¦ã€‚")])])])]),s._v(" "),a("h4",{attrs:{id:"æ‰‹å·¥æ³¨å…¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ‰‹å·¥æ³¨å…¥"}},[s._v("#")]),s._v(" æ‰‹å·¥æ³¨å…¥")]),s._v(" "),a("p",[s._v("åˆ›å»ºä¸€ä¸ªdeploymentåšnginxçš„podæ§åˆ¶å™¨ï¼Œå‰¯æœ¬ç»´æŒåœ¨2ä¸ªã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat deploymen.yaml  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test \n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n        \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f deploymen.yaml  ")]),s._v("\ndeployment.apps/test created\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[s._v('istioctl kube-inject ä¼šå°† istio ç›¸å…³å®¹å™¨æ³¨å…¥åº”ç”¨ï¼Œ"-o" å‚æ•°å°†æ³¨å…¥ç»“æœç”Ÿæˆ yaml æ–‡ä»¶ ï¼Œæ–¹ä¾¿è§‚å¯Ÿä½¿ç”¨æ­¤å‘½ä»¤ä¸ "kubectl apply -f" çš„åŒºåˆ«ï¼›')]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl kube-inject -f deployment.yaml -o deployment-inject.yaml  ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('æ–°çš„ yaml æ–‡ä»¶ä¸­å¤šå‡ºäº† "Sidecar" å®¹å™¨ï¼Œ å¹¶ä¸”å‡ºç°äº†1ä¸ªåˆå§‹åŒ–å®¹å™¨ (initContainers) "istio-init" ï¼Œåˆå§‹åŒ–å®¹å™¨å³ç”¨æ¥åŠ«æŒåº”ç”¨é€šä¿¡åˆ° "Sidecar" å®¹å™¨çš„å·¥å…·ï¼›')]),s._v(" "),a("p",[s._v('å¯ç›´æ¥ "kubectl apply -f" ç”Ÿæˆçš„ yaml æ–‡ä»¶ï¼Œ'),a("code",[s._v("æ³¨å…¥å Nginx åº”ç”¨ ä¸ Istio-Proxy å…±äº«ç½‘ç»œå‘½åç©ºé—´")]),s._v(" ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# istioctl kube-inject  -f /root/deploymen.yaml | kubectl apply -f - -n test ")]),s._v("\ndeployment.apps/test configured\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n test ")]),s._v("\nNAME                    READY   STATUS    RESTARTS   AGE\ntest-67b6d4d78c-jzzml   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          20s\ntest-67b6d4d78c-sfxk8   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/2     Running   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          20s\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl exec -it  -n test test-67b6d4d78c-jzzml -c istio-proxy -- netstat -ntlp")]),s._v("\nActive Internet connections "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("only servers"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15021           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15021           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:80              "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      -                   \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15090           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15090           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:15000         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15001           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15001           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:15004         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/pilot-agent       \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15006           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:15006           "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("/envoy            \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::15020                :::*                    LISTEN      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/pilot-agent       \ntcp6       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" :::80                   :::*                    LISTEN      -                   \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h2",{attrs:{id:"è¯·æ±‚è·¯ç”±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è·¯ç”±"}},[s._v("#")]),s._v(" è¯·æ±‚è·¯ç”±")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚")]),s._v(" "),a("li",[s._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("Istio "),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ç”±å››ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ç»„æˆï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½æœ‰å¤šä¸ªç‰ˆæœ¬ã€‚å…¶ä¸­ä¸€ä¸ªå¾®æœåŠ¡çš„ä¸‰ä¸ªä¸åŒç‰ˆæœ¬"),a("code",[s._v("reviews")]),s._v("å·²éƒ¨ç½²å¹¶åŒæ—¶è¿è¡Œã€‚ä¸ºäº†è¯´æ˜è¿™å¯¼è‡´çš„é—®é¢˜ï¼Œè¯·"),a("code",[s._v("/productpage")]),s._v("åœ¨æµè§ˆå™¨ä¸­è®¿é—® Bookinfo åº”ç”¨ç¨‹åºå¹¶åˆ·æ–°å‡ æ¬¡ã€‚æ‚¨ä¼šæ³¨æ„åˆ°ï¼Œæœ‰æ—¶ä¹¦è¯„è¾“å‡ºåŒ…å«æ˜Ÿçº§ï¼Œæœ‰æ—¶åˆ™ä¸åŒ…å«ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ²¡æœ‰æ˜ç¡®çš„é»˜è®¤æœåŠ¡ç‰ˆæœ¬æ¥è·¯ç”±ï¼ŒIstio ä¼šä»¥å¾ªç¯æ–¹å¼å°†è¯·æ±‚è·¯ç”±åˆ°æ‰€æœ‰å¯ç”¨ç‰ˆæœ¬ã€‚")])]),s._v(" "),a("h4",{attrs:{id:"åº”ç”¨è™šæ‹ŸæœåŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨è™šæ‹ŸæœåŠ¡"}},[s._v("#")]),s._v(" åº”ç”¨è™šæ‹ŸæœåŠ¡")]),s._v(" "),a("p",[s._v("è¦ä»…è·¯ç”±åˆ°ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥åº”ç”¨ä¸ºå¾®æœåŠ¡è®¾ç½®é»˜è®¤ç‰ˆæœ¬çš„è™šæ‹ŸæœåŠ¡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè™šæ‹ŸæœåŠ¡ä¼šå°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),a("code",[s._v("v1")]),s._v("æ¯ä¸ªå¾®æœåŠ¡ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åº”ç”¨è™šæ‹ŸæœåŠ¡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å› ä¸ºé…ç½®ä¼ æ’­æœ€ç»ˆæ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥ç­‰å¾…å‡ ç§’é’Ÿè®©è™šæ‹ŸæœåŠ¡ç”Ÿæ•ˆã€‚")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºå®šä¹‰çš„è·¯ç”±ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.9.5/samples/bookinfo/networking/virtual"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("all"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1.yaml \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" productpage\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" productpage\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" productpage\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" details\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" details\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" details\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("æ‚¨è¿˜å¯ä»¥"),a("code",[s._v("subset")]),s._v("ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºç›¸åº”çš„å®šä¹‰ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get destinationrules -o yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("æ‚¨å·²å°† Istio é…ç½®ä¸ºè·¯ç”±åˆ°"),a("code",[s._v("v1")]),s._v("Bookinfo å¾®æœåŠ¡çš„ç‰ˆæœ¬ï¼Œæœ€é‡è¦çš„æ˜¯"),a("code",[s._v("reviews")]),s._v("æœåŠ¡ç‰ˆæœ¬ 1ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®"}},[s._v("#")]),s._v(" æµ‹è¯•æ–°çš„è·¯ç”±é…ç½®")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥é€šè¿‡å†æ¬¡åˆ·æ–°"),a("code",[s._v("/productpage")]),s._v(" Bookinfo åº”ç”¨ç¨‹åºè½»æ¾æµ‹è¯•æ–°é…ç½®ã€‚")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Bookinfo ç«™ç‚¹ã€‚URL æ˜¯"),a("code",[s._v("http://$GATEWAY_URL/productpage")]),s._v("ï¼Œå…¶ä¸­"),a("code",[s._v("$GATEWAY_URL")]),s._v("æ˜¯å…¥å£çš„å¤–éƒ¨ IP åœ°å€ï¼Œå¦‚"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/#determine-the-ingress-ip-and-port",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("æ–‡æ¡£ä¸­æ‰€è¿°ã€‚")]),s._v(" "),a("p",[s._v("è¯·æ³¨æ„ï¼Œæ— è®ºæ‚¨åˆ·æ–°å¤šå°‘æ¬¡ï¼Œé¡µé¢çš„è¯„è®ºéƒ¨åˆ†éƒ½ä¸ä¼šæ˜¾ç¤ºè¯„åˆ†æ˜Ÿã€‚è¿™æ˜¯å› ä¸ºæ‚¨å°† Istio é…ç½®ä¸ºå°†è¯„è®ºæœåŠ¡çš„æ‰€æœ‰æµé‡è·¯ç”±åˆ°è¯¥ç‰ˆæœ¬"),a("code",[s._v("reviews:v1")]),s._v("ï¼Œå¹¶ä¸”è¯¥ç‰ˆæœ¬çš„æœåŠ¡ä¸è®¿é—®æ˜Ÿçº§è¯„åˆ†æœåŠ¡ã€‚")])])]),s._v(" "),a("p",[s._v("æ‚¨å·²æˆåŠŸå®Œæˆæ­¤ä»»åŠ¡çš„ç¬¬ä¸€éƒ¨åˆ†ï¼šå°†æµé‡è·¯ç”±åˆ°æœåŠ¡çš„ä¸€ä¸ªç‰ˆæœ¬")]),s._v(" "),a("h4",{attrs:{id:"åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±"}},[s._v("#")]),s._v(" åŸºäºç”¨æˆ·èº«ä»½çš„è·¯ç”±")]),s._v(" "),a("p",[s._v("æ¥ä¸‹æ¥ï¼Œæ‚¨å°†æ›´æ”¹è·¯ç”±é…ç½®ï¼Œä»¥ä¾¿å°†æ¥è‡ªç‰¹å®šç”¨æˆ·çš„æ‰€æœ‰æµé‡è·¯ç”±åˆ°ç‰¹å®šæœåŠ¡ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¥è‡ªåä¸º Jason çš„ç”¨æˆ·çš„æ‰€æœ‰æµé‡éƒ½å°†è·¯ç”±åˆ°æœåŠ¡"),a("code",[s._v("reviews:v2")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("è¯¥ç¤ºä¾‹çš„å¯ç”¨æ˜¯å› ä¸ºè¯¥"),a("code",[s._v("productpage")]),s._v("æœåŠ¡å°†è‡ªå®šä¹‰"),a("code",[s._v("end-user")]),s._v("æ ‡å¤´æ·»åŠ åˆ°æ‰€æœ‰åˆ°è¯„è®ºæœåŠ¡çš„å‡ºç«™ HTTP è¯·æ±‚ã€‚")]),s._v(" "),a("p",[s._v("Istio è¿˜æ”¯æŒåœ¨å…¥å£ç½‘å…³ä¸ŠåŸºäºå¼ºè®¤è¯ JWT çš„è·¯ç”±ï¼Œæœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… "),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/security/authentication/jwt-route",target:"_blank",rel:"noopener noreferrer"}},[s._v("åŸºäº JWT å£°æ˜çš„è·¯ç”±"),a("OutboundLink")],1),s._v("ã€‚")]),s._v(" "),a("p",[s._v("è¯·è®°ä½ï¼Œ"),a("code",[s._v("reviews:v2")]),s._v("æ˜¯åŒ…å«æ˜Ÿçº§è¯„åˆ†åŠŸèƒ½çš„ç‰ˆæœ¬ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("è¿è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯ç”¨åŸºäºç”¨æˆ·çš„è·¯ç”±ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š")])]),s._v(" "),a("p",[s._v("åˆ›å»ºè§„åˆ™å…è®¸ç”¨æˆ·jasone")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 networking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat virtual-service-reviews-test-v2.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end-user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jason\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("åœ¨"),a("code",[s._v("/productpage")]),s._v("Bookinfo åº”ç”¨ç¨‹åºä¸Šï¼Œä»¥ user èº«ä»½ç™»å½•"),a("code",[s._v("jason")]),s._v("ã€‚åˆ·æ–°æµè§ˆå™¨ã€‚ä½ çœ‹åˆ°äº†ä»€ä¹ˆï¼Ÿæ˜Ÿçº§è¯„åˆ†æ˜¾ç¤ºåœ¨æ¯æ¡è¯„è®ºæ—è¾¹ã€‚")])]),s._v(" "),a("li",[a("p",[s._v("ä»¥å…¶ä»–ç”¨æˆ·èº«ä»½ç™»å½•ï¼ˆé€‰æ‹©æ‚¨æƒ³è¦çš„ä»»ä½•åç§°ï¼‰ã€‚åˆ·æ–°æµè§ˆå™¨ã€‚ç°åœ¨æ˜Ÿæ˜Ÿä¸è§äº†ã€‚è¿™æ˜¯å› ä¸ºæµé‡è¢«è·¯ç”±åˆ°"),a("code",[s._v("reviews:v1")]),s._v("é™¤äº† Jason ä¹‹å¤–çš„æ‰€æœ‰ç”¨æˆ·ã€‚æ‚¨å·²æˆåŠŸé…ç½® Istio ä»¥æ ¹æ®ç”¨æˆ·èº«ä»½è·¯ç”±æµé‡ã€‚")])])]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"æ•…éšœæ³¨å…¥-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ•…éšœæ³¨å…¥-2"}},[s._v("#")]),s._v(" æ•…éšœæ³¨å…¥")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-2"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),s._v(" "),a("li",[s._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("é€šè¿‡æ‰§è¡Œ "),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/request-routing/",target:"_blank",rel:"noopener noreferrer"}},[s._v("è¯·æ±‚è·¯ç”±"),a("OutboundLink")],1),s._v("ä»»åŠ¡æˆ–è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥åº”ç”¨åº”ç”¨ç¨‹åºç‰ˆæœ¬è·¯ç”±ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-test-v2.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])])]),s._v(" "),a("h4",{attrs:{id:"æ³¨å…¥httpå»¶è¿Ÿé”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å…¥httpå»¶è¿Ÿé”™è¯¯"}},[s._v("#")]),s._v(" æ³¨å…¥HTTPå»¶è¿Ÿé”™è¯¯")]),s._v(" "),a("p",[s._v("è¦æµ‹è¯• Bookinfo åº”ç”¨ç¨‹åºå¾®æœåŠ¡çš„å¼¹æ€§ï¼Œè¯·åœ¨user"),a("code",[s._v("reviews:v2")]),s._v("å’Œå¾®æœåŠ¡ä¹‹é—´æ³¨å…¥ 7s å»¶è¿Ÿã€‚æ­¤æµ‹è¯•å°†å‘ç°ä¸€ä¸ªæœ‰æ„å¼•å…¥ Bookinfo åº”ç”¨ç¨‹åºçš„é”™è¯¯ã€‚"),a("code",[s._v("ratings jason")])]),s._v(" "),a("p",[s._v("è¯·æ³¨æ„ï¼Œè¯¥"),a("code",[s._v("reviews:v2")]),s._v("æœåŠ¡å¯¹æœåŠ¡çš„è°ƒç”¨æœ‰ 10 ç§’çš„ç¡¬ç¼–ç è¿æ¥è¶…æ—¶"),a("code",[s._v("ratings")]),s._v("ã€‚å³ä½¿æ‚¨å¼•å…¥äº† 7 ç§’å»¶è¿Ÿï¼Œæ‚¨ä»ç„¶å¸Œæœ›ç«¯åˆ°ç«¯æµç¨‹ç»§ç»­è¿›è¡Œè€Œä¸ä¼šå‡ºç°ä»»ä½•é”™è¯¯ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºæ•…éšœæ³¨å…¥è§„åˆ™ä»¥å»¶è¿Ÿæ¥è‡ªæµ‹è¯•ç”¨æˆ·çš„æµé‡ "),a("code",[s._v("jason")]),s._v("ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-delay.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š\n"),a("ul",[a("li",[a("code",[s._v("åˆ›å»ºè§„åˆ™é€šè¿‡jasonç”¨æˆ·ç™»å½•")])]),s._v(" "),a("li",[a("code",[s._v("åœ¨å¾®æœåŠ¡ä¹‹é—´æ³¨å…¥7sçš„å»¶è¿Ÿ")])])])])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("å‚æ•°è¯¦è§£ï¼š")])]),s._v(" "),a("p",[a("strong",[s._v("fault:")]),s._v("\t\t\t\t\t\t\t# è¦åº”ç”¨äºå®¢æˆ·ç«¯HTTPæµé‡çš„æ•…éšœæ³¨å…¥ç­–ç•¥ã€‚\n"),a("strong",[s._v("delay:")]),s._v("\t\t\t\t\t\t# å»¶è¿Ÿ\n"),a("strong",[s._v("percentage:")]),s._v("\t\t\t# ç™¾åˆ†ç‡\n"),a("strong",[s._v("value: 100.0")]),s._v("\t\t # é”®å€¼ä¸ºç™¾åˆ†ä¹‹ä¸€ç™¾\n"),a("strong",[s._v("fixedDelay: 7s")]),s._v("\t\t# å›ºå®šæ—¶é—´ä¸º7s")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 networking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat virtual-service-ratings-test-delay.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end-user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jason\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\t\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percentage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fixedDelay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 7s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("p",[s._v("ç­‰å¾…å‡ ç§’é’Ÿï¼Œè®©æ–°è§„åˆ™ä¼ æ’­åˆ°æ‰€æœ‰ podã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327994.png",alt:"image-20220316153536186"}})]),s._v(" "),a("h4",{attrs:{id:"æµ‹è¯•å»¶è¿Ÿé…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•å»¶è¿Ÿé…ç½®"}},[s._v("#")]),s._v(" æµ‹è¯•å»¶è¿Ÿé…ç½®")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo Web åº”ç”¨ç¨‹åºã€‚"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("åœ¨"),a("code",[s._v("/productpage")]),s._v("ç½‘é¡µä¸Šï¼Œä»¥ user èº«ä»½ç™»å½•"),a("code",[s._v("jason")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("æ‚¨å¸Œæœ› Bookinfo ä¸»é¡µåœ¨å¤§çº¦ 7 ç§’å†…åŠ è½½è€Œä¸ä¼šå‡ºç°é”™è¯¯ã€‚ä½†æ˜¯ï¼Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼šReviews éƒ¨åˆ†æ˜¾ç¤ºä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼š")]),s._v(" "),a("p",[a("code",[s._v("Sorry, product reviews are currently unavailable for this book.")])])]),s._v(" "),a("li",[a("p",[s._v("æŸ¥çœ‹ç½‘é¡µå“åº”æ—¶é—´ï¼š")]),s._v(" "),a("ol",[a("li",[s._v("åœ¨ Web æµè§ˆå™¨ä¸­æ‰“å¼€"),a("em",[s._v("å¼€å‘è€…å·¥å…·")]),s._v("èœå•ã€‚")]),s._v(" "),a("li",[s._v("æ‰“å¼€ç½‘ç»œé€‰é¡¹å¡")]),s._v(" "),a("li",[s._v("é‡æ–°åŠ è½½"),a("code",[s._v("/productpage")]),s._v("ç½‘é¡µã€‚æ‚¨å°†çœ‹åˆ°é¡µé¢å®é™…åŠ è½½å¤§çº¦éœ€è¦ 6 ç§’ã€‚")])])])]),s._v(" "),a("h4",{attrs:{id:"ä¿®å¤é”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¿®å¤é”™è¯¯"}},[s._v("#")]),s._v(" ä¿®å¤é”™è¯¯")]),s._v(" "),a("p",[s._v("æ‚¨é€šå¸¸ä¼šé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³é—®é¢˜ï¼š")]),s._v(" "),a("ol",[a("li",[s._v("å¢åŠ æœåŠ¡è¶…æ—¶æˆ–å‡å°‘"),a("code",[s._v("productpage")]),s._v("æœåŠ¡è¶…æ—¶"),a("code",[s._v("reviews reviews ratings")])]),s._v(" "),a("li",[s._v("åœæ­¢å’Œé‡å¯å›ºå®šçš„å¾®æœåŠ¡")]),s._v(" "),a("li",[s._v("ç¡®è®¤"),a("code",[s._v("/productpage")]),s._v("ç½‘é¡µè¿”å›å…¶å“åº”æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚")])]),s._v(" "),a("p",[s._v("ä½†æ˜¯ï¼Œæ‚¨å·²ç»åœ¨"),a("code",[s._v("reviews")]),s._v("æœåŠ¡çš„ v3 ä¸­è¿è¡Œäº†ä¸€ä¸ªä¿®å¤ç¨‹åºã€‚è¯¥"),a("code",[s._v("reviews:v3")]),s._v("æœåŠ¡å°†è¶…æ—¶æ—¶é—´ä» 10s å‡å°‘"),a("code",[s._v("reviews")]),s._v("åˆ°2.5sï¼Œä»¥ä¾¿ä¸ä¸‹æ¸¸è¯·æ±‚"),a("code",[s._v("ratings")]),s._v("çš„è¶…æ—¶æ—¶é—´å…¼å®¹ï¼ˆå°äºï¼‰ "),a("code",[s._v("productpage")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("å¦‚æœæ‚¨æŒ‰ç…§"),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/traffic-shifting/",target:"_blank",rel:"noopener noreferrer"}},[s._v("æµé‡è½¬ç§»"),a("OutboundLink")],1),a("code",[s._v("reviews:v3")]),s._v("ä»»åŠ¡ä¸­çš„æè¿° å°†æ‰€æœ‰æµé‡è¿ç§»åˆ°ï¼Œæ‚¨å¯ä»¥å°è¯•å°†å»¶è¿Ÿè§„åˆ™æ›´æ”¹ä¸ºå°äº 2.5s çš„ä»»æ„é‡ï¼Œä¾‹å¦‚ 2sï¼Œå¹¶ç¡®è®¤ç«¯åˆ°ç«¯æµç¨‹ç»§ç»­æ²¡æœ‰ä»»ä½•é”™è¯¯ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æ³¨å…¥httpä¸­æ­¢é”™è¯¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ³¨å…¥httpä¸­æ­¢é”™è¯¯"}},[s._v("#")]),s._v(" æ³¨å…¥HTTPä¸­æ­¢é”™è¯¯")]),s._v(" "),a("p",[s._v("æµ‹è¯•å¾®æœåŠ¡å¼¹æ€§çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å¼•å…¥ HTTP ä¸­æ­¢æ•…éšœã€‚"),a("code",[s._v("ratings")]),s._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä¸ºæµ‹è¯•ç”¨æˆ·çš„å¾®æœåŠ¡å¼•å…¥ HTTP ä¸­æ­¢"),a("code",[s._v("jason")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¸Œæœ›é¡µé¢ç«‹å³åŠ è½½å¹¶æ˜¾ç¤º"),a("code",[s._v("Ratings service is currently unavailable")]),s._v("æ¶ˆæ¯ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºä¸€ä¸ªæ•…éšœæ³¨å…¥è§„åˆ™ï¼Œä¸ºç”¨æˆ·å‘é€ HTTP ä¸­æ­¢"),a("code",[s._v("jason")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-ratings-test-abort.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ç¡®è®¤è§„åˆ™å·²åˆ›å»ºï¼š\n"),a("ul",[a("li",[a("code",[s._v("åˆ›å»ºè§„åˆ™é€šè¿‡jasonç”¨æˆ·æµé‡")])]),s._v(" "),a("li",[a("code",[s._v("åœ¨å¾®æœåŠ¡ä¹‹é—´ä¸­æ­¢jasonç”¨æˆ·ï¼Œhttpstatusæ˜¯500çŠ¶æ€ï¼Œç™¾åˆ†ç‡è®¾ç½®ä¸º100")])])])])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("å‚æ•°è¯¦è§£ï¼š")])]),s._v(" "),a("p",[a("strong",[s._v("fault:")]),s._v("\t\t\t\t\t\t\t# è¦åº”ç”¨äºå®¢æˆ·ç«¯HTTPæµé‡çš„æ•…éšœæ³¨å…¥ç­–ç•¥ã€‚\n"),a("strong",[s._v("abort:")]),s._v("\t\t\t\t\t\t# ä¸­æ­¢ç­–ç•¥\n"),a("strong",[s._v("percentage:")]),s._v("\t\t\t# ç™¾åˆ†ç‡\n"),a("strong",[s._v("value: 100.0")]),s._v("\t\t # é”®å€¼ä¸ºç™¾åˆ†ä¹‹ä¸€ç™¾\n"),a("strong",[s._v("httpStatus: 500")]),s._v("\t  # httpstatusè®¾ç½®ä¸º500æŠ¥é”™")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 networking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat virtual-service-ratings-test-abort.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("headers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("end-user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" jason\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("abort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percentage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("httpStatus")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"æµ‹è¯•ä¸­æ­¢é…ç½®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµ‹è¯•ä¸­æ­¢é…ç½®"}},[s._v("#")]),s._v(" æµ‹è¯•ä¸­æ­¢é…ç½®")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo Web åº”ç”¨ç¨‹åºã€‚"),a("OutboundLink")],1)])]),s._v(" "),a("li",[a("p",[s._v("åœ¨ ä¸Š"),a("code",[s._v("/productpage")]),s._v("ï¼Œä»¥ç”¨æˆ·èº«ä»½ç™»å½•"),a("code",[s._v("jason")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("å¦‚æœè§„åˆ™æˆåŠŸä¼ æ’­åˆ°æ‰€æœ‰ podï¼Œé¡µé¢ä¼šç«‹å³åŠ è½½å¹¶æ˜¾ç¤º"),a("code",[s._v("Ratings service is currently unavailable")]),s._v("æ¶ˆæ¯ã€‚")])]),s._v(" "),a("li",[a("p",[s._v("å¦‚æœæ‚¨ä»ç”¨æˆ·æ³¨é”€"),a("code",[s._v("jason")]),s._v("æˆ–åœ¨åŒ¿åçª—å£ï¼ˆæˆ–å…¶ä»–æµè§ˆå™¨ï¼‰ä¸­æ‰“å¼€ Bookinfo åº”ç”¨ç¨‹åºï¼Œæ‚¨ å°†"),a("code",[s._v("/productpage")]),s._v("çœ‹åˆ°é™¤äº†. å› æ­¤ï¼Œæ‚¨ä¸ä¼šçœ‹åˆ°ä»»ä½•é”™è¯¯æ¶ˆæ¯ã€‚"),a("code",[s._v("reviews:v1 ratings jason")])])])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327813.png",alt:"image-20220316155324788"}})]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-2"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"æµé‡è½¬ç§»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡è½¬ç§»"}},[s._v("#")]),s._v(" æµé‡è½¬ç§»")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯æµé‡è½¬ç§»ï¼Ÿ")]),s._v(" "),a("p",[s._v("æ­¤ä»»åŠ¡å‘æ‚¨å±•ç¤ºå¦‚ä½•å°†æµé‡ä»ä¸€ä¸ªå¾®æœåŠ¡ç‰ˆæœ¬è½¬ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ã€‚")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å°†æµé‡ä»æ—§ç‰ˆæœ¬çš„å¾®æœåŠ¡é€æ¸è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚åœ¨ Istio ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½®ä¸€ç³»åˆ—è·¯ç”±è§„åˆ™æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™äº›è§„åˆ™å°†ä¸€å®šæ¯”ä¾‹çš„æµé‡ä»ä¸€ä¸ªç›®çš„åœ°é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚")]),s._v(" "),a("p",[s._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†ä½¿ç”¨å°† 50% çš„æµé‡å‘é€åˆ°"),a("code",[s._v("reviews:v1")]),s._v("å’Œ 50% åˆ°"),a("code",[s._v("reviews:v3")]),s._v("ã€‚ç„¶åï¼Œæ‚¨å°†é€šè¿‡å°† 100% çš„æµé‡å‘é€åˆ° æ¥å®Œæˆè¿ç§»"),a("code",[s._v("reviews:v3")]),s._v("ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-3"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),s._v(" "),a("li",[s._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("é¦–å…ˆï¼Œè¿è¡Œæ­¤å‘½ä»¤å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),a("code",[s._v("v1")]),s._v("æ¯ä¸ªå¾®æœåŠ¡çš„ç‰ˆæœ¬ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("h4",{attrs:{id:"åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±"}},[s._v("#")]),s._v(" åº”ç”¨åŸºäºæƒé‡çš„è·¯ç”±")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("reviews:v1")]),s._v("ä½¿ç”¨"),a("code",[s._v("reviews:v3")]),s._v("ä»¥ä¸‹å‘½ä»¤ä¼ è¾“ 50% çš„æµé‡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-reviews-50-v3.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ç¡®è®¤è§„åˆ™å·²è¢«æ›¿æ¢ï¼š\n"),a("ul",[a("li",[a("code",[s._v("åˆ›å»ºv1ç‰ˆæœ¬çš„æƒé‡ä¸º50")])]),s._v(" "),a("li",[a("code",[s._v("åˆ›å»ºv3ç‰ˆæœ¬çš„æƒé‡ä¸º50")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 networking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat virtual-service-reviews-50-v3.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("åœ¨æ‚¨çš„æµè§ˆå™¨ä¸­åˆ·æ–°"),a("code",[s._v("/productpage")]),s._v("ï¼Œæ‚¨ç°åœ¨å¤§çº¦æœ‰ 50% çš„æ—¶é—´ä¼šçœ‹åˆ°"),a("code",[s._v("çº¢è‰²")]),s._v("çš„æ˜Ÿçº§ã€‚è¿™æ˜¯å› ä¸º"),a("code",[s._v("v3")]),s._v("ç‰ˆæœ¬"),a("code",[s._v("reviews")]),s._v("è®¿é—®äº†æ˜Ÿçº§æœåŠ¡ï¼Œè€Œ"),a("code",[s._v("v1")]),s._v("ç‰ˆæœ¬æ²¡æœ‰ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("ä½¿ç”¨å½“å‰çš„ Envoy sidecar å®ç°ï¼Œæ‚¨å¯èƒ½éœ€è¦ "),a("code",[s._v("/productpage")]),s._v("å¤šæ¬¡åˆ·æ–°ï¼ˆå¯èƒ½ 15 æ¬¡æˆ–æ›´å¤šï¼‰æ‰èƒ½çœ‹åˆ°æ­£ç¡®çš„åˆ†å¸ƒã€‚æ‚¨å¯ä»¥ä¿®æ”¹è§„åˆ™ä»¥å°† 90% çš„æµé‡è·¯ç”±åˆ°"),a("code",[s._v("v3")]),s._v("æ›´é¢‘ç¹åœ°çœ‹åˆ°çº¢æ˜Ÿã€‚")])]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327265.png",alt:"image-20220316160723199"}})]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327027.png",alt:"image-20220316160736887"}})]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("å‡è®¾æ‚¨ç¡®å®š"),a("code",[s._v("reviews:v3")]),s._v("å¾®æœåŠ¡æ˜¯ç¨³å®šçš„ï¼Œæ‚¨å¯ä»¥"),a("code",[s._v("reviews:v3")]),s._v("é€šè¿‡åº”ç”¨æ­¤è™šæ‹ŸæœåŠ¡å°† 100% çš„æµé‡è·¯ç”±åˆ°ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 networking"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat virtual-service-reviews-v3.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v3\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[s._v("ç°åœ¨ï¼Œå½“æ‚¨åˆ·æ–°æ—¶ï¼Œ"),a("code",[s._v("/productpage")]),s._v("æ‚¨æ€»æ˜¯ä¼šçœ‹åˆ°æ¯æ¡è¯„è®ºå¸¦æœ‰"),a("code",[s._v("çº¢è‰²")]),s._v("æ˜Ÿçº§çš„ä¹¦è¯„ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-3"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"tcp-æµé‡è½¬ç§»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp-æµé‡è½¬ç§»"}},[s._v("#")]),s._v(" TCP æµé‡è½¬ç§»")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯tcpæµé‡è½¬ç§»"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯tcpæµé‡è½¬ç§»"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯TCPæµé‡è½¬ç§»ï¼Ÿ")]),s._v(" "),a("p",[s._v("å°† TCP æµé‡ä»ä¸€ä¸ªå¾®æœåŠ¡ç‰ˆæœ¬è½¬ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬ã€‚")]),s._v(" "),a("p",[s._v("ä¸€ä¸ªå¸¸è§çš„ç”¨ä¾‹æ˜¯å°† TCP æµé‡ä»æ—§ç‰ˆæœ¬çš„å¾®æœåŠ¡é€æ¸è¿ç§»åˆ°æ–°ç‰ˆæœ¬ã€‚åœ¨ Istio ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡é…ç½®ä¸€ç³»åˆ—è·¯ç”±è§„åˆ™æ¥å®ç°è¿™ä¸€ç›®æ ‡ï¼Œè¿™äº›è§„åˆ™å°†ä¸€å®šç™¾åˆ†æ¯”çš„ TCP æµé‡ä»ä¸€ä¸ªç›®çš„åœ°é‡å®šå‘åˆ°å¦ä¸€ä¸ªç›®çš„åœ°ã€‚åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°† 100% çš„ TCP æµé‡å‘é€åˆ°"),a("code",[s._v("tcp-echo:v1")]),s._v(". ç„¶åï¼Œæ‚¨å°†"),a("code",[s._v("tcp-echo:v2")]),s._v("ä½¿ç”¨ Istio çš„åŠ æƒè·¯ç”±åŠŸèƒ½è·¯ç”± 20% çš„ TCP æµé‡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ"}},[s._v("#")]),s._v(" åŸºç¡€ç¯å¢ƒ")]),s._v(" "),a("blockquote",[a("ol",[a("li",[s._v("é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯• TCP æµé‡è½¬ç§»çš„å‘½åç©ºé—´å¹¶å°†å…¶æ ‡è®°ä¸ºå¯ç”¨è‡ªåŠ¨è¾¹è½¦æ³¨å…¥ã€‚")]),s._v(" "),a("li",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[s._v("sleep"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºä»¥ç”¨ä½œå‘é€è¯·æ±‚çš„æµ‹è¯•æºã€‚")]),s._v(" "),a("li",[s._v("éƒ¨ç½²å¾®æœåŠ¡çš„"),a("code",[s._v("v1")]),s._v("å’Œ"),a("code",[s._v("v2")]),s._v("ç‰ˆæœ¬"),a("code",[s._v("tcp-echo")]),s._v("ã€‚")]),s._v(" "),a("li",[s._v("æŒ‰ç…§ "),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control/#determining-the-ingress-ip-and-ports",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç¡®å®šå…¥å£ IP å’Œç«¯å£"),a("OutboundLink")],1),a("code",[s._v("TCP_INGRESS_PORT")]),s._v("ä¸­ çš„è¯´æ˜å®šä¹‰"),a("code",[s._v("INGRESS_HOST")]),s._v("ç¯å¢ƒå˜é‡ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl create namespace istio-io-tcp-traffic-shifting\n$ kubectl label namespace istio-io-tcp-traffic-shifting istio-injection"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enabled\n$ kubectl apply -f samples/sleep/sleep.yaml -n istio-io-tcp-traffic-shifting\n$ kubectl apply -f samples/tcp-echo/tcp-echo-services.yaml -n istio-io-tcp-traffic-shifting\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("h4",{attrs:{id:"åº”ç”¨åŸºäºæƒé‡çš„tcpè·¯ç”±"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åº”ç”¨åŸºäºæƒé‡çš„tcpè·¯ç”±"}},[s._v("#")]),s._v(" åº”ç”¨åŸºäºæƒé‡çš„TCPè·¯ç”±")]),s._v(" "),a("ol",[a("li",[s._v("å°†æ‰€æœ‰ TCP æµé‡è·¯ç”±åˆ°å¾®æœåŠ¡çš„"),a("code",[s._v("v1")]),s._v("ç‰ˆæœ¬"),a("code",[s._v("tcp-echo")]),s._v("ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 samples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f samples/tcp-echo/tcp-echo-all-v1.yaml -n istio-io-tcp-traffic-shifting")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 samples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat tcp-echo/tcp-echo-all-v1.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingressgateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31400")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("destination\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tcp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31400")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# è¿™é‡Œä¿®æ”¹æˆä½¿ç”¨ç«¯å£çš„æ–¹å¼")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\t\t "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç«¯å£å·æ˜¯9000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ç‰ˆæœ¬ä½¿ç”¨V1ç‰ˆæœ¬")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("code",[s._v("tcp-echo")]),s._v("é€šè¿‡ä»å®¢æˆ·ç«¯å‘é€ä¸€äº› TCP æµé‡æ¥ç¡®è®¤æœåŠ¡å·²å¯åŠ¨å¹¶æ­£åœ¨è¿è¡Œ"),a("code",[s._v("sleep")]),s._v("ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("ä¸‹é¢çš„ "),a("code",[s._v("$INGRESS_HOST")]),s._v(" å˜é‡æ˜¯ ingress çš„å¤–éƒ¨ IP åœ°å€ï¼Œ"),a("code",[s._v("$TCP_INGRESS_PORT")]),s._v("æ˜¯ingressçš„ç«¯å£")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SECURE_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TCP_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("worker-node-address\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 samples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for i in {1..20}; do \\")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sleep -n istio-io-tcp-traffic-shifting -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -n istio-io-tcp-traffic-shifting -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(date; sleep 1) | nc '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TCP_INGRESS_PORT")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":24:57 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:00 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:02 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:05 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:07 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:10 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:12 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:15 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:17 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":25:19 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("æ‚¨åº”è¯¥æ³¨æ„åˆ°æ‰€æœ‰æ—¶é—´æˆ³çš„å‰ç¼€éƒ½æ˜¯"),a("em",[s._v("one")]),s._v("ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰æµé‡éƒ½è¢«è·¯ç”±åˆ°æœåŠ¡çš„"),a("code",[s._v("v1")]),s._v("ç‰ˆæœ¬"),a("code",[s._v("tcp-echo")]),s._v("ã€‚")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[s._v("tcp-echo:v1")]),s._v("ä½¿ç”¨"),a("code",[s._v("tcp-echo:v2")]),s._v("ä»¥ä¸‹å‘½ä»¤ä¼ è¾“ 20% çš„æµé‡ï¼š")])]),s._v(" "),a("blockquote",[a("p",[s._v("é€šè¿‡ä¿®æ”¹"),a("code",[s._v("weightçš„å€¼")]),s._v("æ¥ç¡®å®šæµé‡çš„åˆ†å¸ƒæ§åˆ¶ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f samples/tcp-echo/tcp-echo-20-v2.yaml")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("master"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("node1 istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat samples/tcp-echo/tcp-echo-20-v2.yaml")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tcp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31400")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tcp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("echo\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[a("p",[s._v("å‘å¾®æœåŠ¡å‘é€æ›´å¤š TCP æµé‡"),a("code",[s._v("tcp-echo")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("æ‚¨ç°åœ¨åº”è¯¥æ³¨æ„åˆ°å¤§çº¦ 20% çš„æ—¶é—´æˆ³å…·æœ‰å‰ç¼€"),a("em",[s._v("2")]),s._v("ï¼Œè¿™æ„å‘³ç€ 80% çš„ TCP æµé‡è¢«è·¯ç”±åˆ°æœåŠ¡"),a("code",[s._v("v1")]),s._v("ç‰ˆæœ¬"),a("code",[s._v("tcp-echo")]),s._v("ï¼Œè€Œ 20% è¢«è·¯ç”±åˆ°"),a("code",[s._v("v2")]),s._v(".")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  for i in {1..20}; do \\")]),s._v("\nkubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sleep -n istio-io-tcp-traffic-shifting -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -n istio-io-tcp-traffic-shifting -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"(date; sleep 1) | nc '),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TCP_INGRESS_PORT")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:45 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\ntwo Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:47 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:50 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:52 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:55 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\ntwo Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":38:57 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":39:00 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":39:02 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":39:05 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\none Mon Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(":39:07 UTC "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-4"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤"),a("code",[s._v("sleep")]),s._v("ç¤ºä¾‹ã€"),a("code",[s._v("tcp-echo")]),s._v("åº”ç”¨ç¨‹åºå’Œè·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete -f samples/tcp-echo/tcp-echo-all-v1.yaml -n istio-io-tcp-traffic-shifting\n$ kubectl delete -f samples/tcp-echo/tcp-echo-services.yaml -n istio-io-tcp-traffic-shifting\n$ kubectl delete -f samples/sleep/sleep.yaml -n istio-io-tcp-traffic-shifting\n$ kubectl delete namespace istio-io-tcp-traffic-shifting\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h2",{attrs:{id:"è¯·æ±‚è¶…æ—¶"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è¶…æ—¶"}},[s._v("#")]),s._v(" è¯·æ±‚è¶…æ—¶")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-4"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://istio.io/latest/docs/examples/bookinfo/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Bookinfo"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œåº”ç”¨ç›®æ ‡è§„åˆ™ã€‚")]),s._v(" "),a("li",[s._v("äº†è§£äº†æµé‡ç®¡ç†çš„åŸºç¡€æ¦‚å¿µï¼Œä»¥åŠä¸“ä¸šè¯­æœ¯ã€‚")])]),s._v(" "),a("blockquote",[a("p",[s._v("é¦–å…ˆï¼Œè¿è¡Œæ­¤å‘½ä»¤å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),a("code",[s._v("v1")]),s._v("æ¯ä¸ªå¾®æœåŠ¡çš„ç‰ˆæœ¬ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("h4",{attrs:{id:"è¯·æ±‚è¶…æ—¶-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#è¯·æ±‚è¶…æ—¶-2"}},[s._v("#")]),s._v(" è¯·æ±‚è¶…æ—¶")]),s._v(" "),a("p",[s._v("å¯ä»¥ä½¿ç”¨"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/virtual-service/#HTTPRoute",target:"_blank",rel:"noopener noreferrer"}},[s._v("è·¯ç”±è§„åˆ™çš„"),a("OutboundLink")],1),a("em",[s._v("timeout")]),s._v("å­—æ®µæŒ‡å®š HTTP è¯·æ±‚çš„è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯·æ±‚è¶…æ—¶è¢«ç¦ç”¨ï¼Œä½†åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†æœåŠ¡è¶…æ—¶è¦†ç›–ä¸º 1 ç§’ã€‚ä½†æ˜¯ï¼Œè¦æŸ¥çœ‹å…¶æ•ˆæœï¼Œæ‚¨è¿˜å¯ä»¥åœ¨è°ƒç”¨æœåŠ¡æ—¶äººä¸ºåœ°å¼•å…¥ 2 ç§’å»¶è¿Ÿã€‚")]),s._v(" "),a("ol",[a("li",[s._v("å°†è¯·æ±‚è·¯ç”±åˆ°"),a("code",[s._v("reviews")]),s._v("æœåŠ¡çš„ v2ï¼Œå³è°ƒç”¨"),a("code",[s._v("ratings")]),s._v("æœåŠ¡çš„ç‰ˆæœ¬ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å¯¹æœåŠ¡çš„è°ƒç”¨æ·»åŠ  2 ç§’å»¶è¿Ÿ"),a("code",[s._v("ratings")]),s._v("ï¼š\n"),a("ul",[a("li",[a("code",[s._v("ä½¿ç”¨httpè§„åˆ™é…ç½®ç›®çš„åœ°ç‰ˆæœ¬ä¸ºv1ä¸»æœºæ˜¯ratings")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ç™¾åˆ†æ¯”ä¸º100çš„2ç§’å›ºå®šæ—¶é—´å»¶è¿Ÿ")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ratings\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fault")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("delay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("percent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("fixedDelay")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 2s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ratings\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[s._v("http://$GATEWAY_URL/productpage")]),s._v("åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ Bookinfo URL ã€‚")])]),s._v(" "),a("p",[s._v("æ‚¨åº”è¯¥ä¼šçœ‹åˆ° Bookinfo åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œï¼ˆæ˜¾ç¤ºè¯„çº§æ˜Ÿï¼‰ï¼Œä½†æ˜¯æ¯å½“æ‚¨åˆ·æ–°é¡µé¢æ—¶éƒ½ä¼šæœ‰ 2 ç§’çš„å»¶è¿Ÿã€‚")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("ç°åœ¨ä¸ºå¯¹æœåŠ¡çš„è°ƒç”¨æ·»åŠ åŠç§’è¯·æ±‚è¶…æ—¶"),a("code",[s._v("reviews")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" reviews\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" reviews\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 0.5s\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("åˆ·æ–° Bookinfo ç½‘é¡µã€‚")])]),s._v(" "),a("p",[s._v("æ‚¨ç°åœ¨åº”è¯¥çœ‹åˆ°å®ƒåœ¨å¤§çº¦ 1 ç§’å†…è¿”å›ï¼Œè€Œä¸æ˜¯ 2 ç§’ï¼Œå¹¶ä¸”è¯„è®ºä¸å¯ç”¨ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062327037.png",alt:"image-20220318111010285"}})]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("å“åº”éœ€è¦1ç§’çš„åŸå› ï¼Œå³ä½¿è¶…æ—¶é…ç½®ä¸ºåŠç§’ï¼Œä¹Ÿæ˜¯å› ä¸ºæœåŠ¡ä¸­æœ‰ç¡¬ç¼–ç çš„é‡è¯•ï¼Œæ‰€ä»¥å®ƒåœ¨è¿”å›ä¹‹å‰è°ƒç”¨äº†ä¸¤æ¬¡"),a("code",[s._v("productpage")]),s._v("è¶…æ—¶æœåŠ¡ã€‚"),a("code",[s._v("reviews")])])]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-5"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤åº”ç”¨ç¨‹åºè·¯ç”±è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete -f samples/bookinfo/networking/virtual-service-all-v1.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"ç†”æ–­-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­-2"}},[s._v("#")]),s._v(" ç†”æ–­")]),s._v(" "),a("h4",{attrs:{id:"ç†”æ–­çš„æ–¹å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç†”æ–­çš„æ–¹å¼"}},[s._v("#")]),s._v(" ç†”æ–­çš„æ–¹å¼")]),s._v(" "),a("p",[s._v("æ­¤ä»»åŠ¡å‘æ‚¨å±•ç¤ºå¦‚ä½•ä¸ºè¿æ¥ã€è¯·æ±‚å’Œå¼‚å¸¸å€¼æ£€æµ‹é…ç½®æ–­è·¯ã€‚")]),s._v(" "),a("p",[s._v("æ–­è·¯æ˜¯åˆ›å»ºå¼¹æ€§å¾®æœåŠ¡åº”ç”¨ç¨‹åºçš„é‡è¦æ¨¡å¼ã€‚æ–­è·¯å…è®¸æ‚¨ç¼–å†™é™åˆ¶æ•…éšœã€å»¶è¿Ÿå³°å€¼å’Œç½‘ç»œç‰¹æ€§çš„å…¶ä»–ä¸è‰¯å½±å“çš„å½±å“çš„åº”ç”¨ç¨‹åºã€‚")]),s._v(" "),a("p",[s._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†é…ç½®æ–­è·¯å™¨è§„åˆ™ï¼Œç„¶åé€šè¿‡æœ‰æ„â€œè·³é—¸â€æ–­è·¯å™¨æ¥æµ‹è¯•é…ç½®ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-5"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("p",[s._v("å¯åŠ¨"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ã€‚")]),s._v(" "),a("p",[s._v("å¦‚æœæ‚¨å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("p",[s._v("å¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),a("code",[s._v("httpbin")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/httpbin/httpbin.yaml\n$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/httpbin/httpbin.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"é…ç½®æ–­è·¯å™¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®æ–­è·¯å™¨"}},[s._v("#")]),s._v(" é…ç½®æ–­è·¯å™¨")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»º"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/destination-rule/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç›®æ ‡è§„åˆ™"),a("OutboundLink")],1),s._v("ä»¥åœ¨è°ƒç”¨æœåŠ¡æ—¶åº”ç”¨æ–­è·¯è®¾ç½®"),a("code",[s._v("httpbin")]),s._v("ï¼š\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®äº¤é€šæ”¿ç­–çš„è¿æ¥æ± å’Œå¼‚å¸¸æ£€æµ‹")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è¿æ¥æ± çš„tcpè§„åˆ™åˆ°ç›®æ ‡ä¸»æœºçš„æœ€å¤§HTTP1/TCPè¿æ¥æ•°ä¸º 1")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è¿æ¥æ± çš„httpè§„åˆ™å¯¹ç›®æ ‡çš„æœ€å¤§æŒ‚èµ·HTTPè¯·æ±‚æ•°ä¸º 1")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è¿æ¥æ± çš„httpè§„åˆ™æ¯ä¸ªåç«¯è¿æ¥çš„æœ€å¤§è¯·æ±‚æ•°ä¸º 1")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®å¼‚å¸¸æ£€æµ‹ä»è¿æ¥æ± ä¸­å¼¹å‡ºä¸»æœºä¹‹å‰çš„5xxé”™è¯¯æ•°ä¸º 1")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®å¼‚å¸¸æ£€æµ‹å¼¹å°„æ‰«æåˆ†æä¹‹é—´çš„æ—¶é—´é—´éš”ä¸º 1ç§’")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®å¼‚å¸¸æ£€æµ‹æœ€çŸ­å¼¹å°„æ—¶é—´ä¸º 3åˆ†é’Ÿ")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®å¼‚å¸¸æ£€æµ‹æœ€å¤§å¼¹å°„ç™¾åˆ†æ¯”ä¸º 100")])])])])]),s._v(" "),a("blockquote",[a("p",[s._v("å¦‚æœæ‚¨å®‰è£…/é…ç½®äº†å¯ç”¨åŒå‘ TLS èº«ä»½éªŒè¯çš„ Istioï¼Œåˆ™å¿…é¡»åœ¨åº”ç”¨ä¹‹å‰æ·»åŠ  TLS æµé‡"),a("code",[s._v("mode: ISTIO_MUTUAL")]),s._v("ç­–ç•¥"),a("code",[s._v("DestinationRule")]),s._v("ã€‚å¦åˆ™è¯·æ±‚å°†äº§ç”Ÿ 503 é”™è¯¯ï¼Œå¦‚æ­¤"),a("a",{attrs:{href:"https://istio.io/latest/docs/ops/common-problems/network-issues/#503-errors-after-setting-destination-rule",target:"_blank",rel:"noopener noreferrer"}},[s._v("å¤„"),a("OutboundLink")],1),s._v("æ‰€è¿°ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("connectionPool")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tcp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxConnections")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http1MaxPendingRequests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxRequestsPerConnection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("outlierDetection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("consecutive5xxErrors")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("interval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1s\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("baseEjectionTime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 3m\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("maxEjectionPercent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("éªŒè¯ç›®æ ‡è§„åˆ™æ˜¯å¦å·²æ­£ç¡®åˆ›å»ºï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get destinationrules")]),s._v("\nNAME                   HOST          AGE\ndetails                details       4h41m\nhttpbin                httpbin       64m\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"æ·»åŠ å®¢æˆ·ç«¯"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·»åŠ å®¢æˆ·ç«¯"}},[s._v("#")]),s._v(" æ·»åŠ å®¢æˆ·ç«¯")]),s._v(" "),a("p",[s._v("åˆ›å»ºå®¢æˆ·ç«¯ä»¥å°†æµé‡å‘é€åˆ°"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ã€‚"),a("a",{attrs:{href:"https://github.com/istio/fortio",target:"_blank",rel:"noopener noreferrer"}},[s._v("è¯¥å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªåä¸ºfortio"),a("OutboundLink")],1),s._v("çš„ç®€å•è´Ÿè½½æµ‹è¯•å®¢æˆ·ç«¯ã€‚Fortio å…è®¸æ‚¨æ§åˆ¶ä¼ å‡º HTTP è°ƒç”¨çš„è¿æ¥æ•°ã€å¹¶å‘æ€§å’Œå»¶è¿Ÿã€‚æ‚¨å°†ä½¿ç”¨æ­¤å®¢æˆ·ç«¯â€œè·³é—¸â€æ‚¨åœ¨"),a("code",[s._v("DestinationRule")]),s._v(".")]),s._v(" "),a("ol",[a("li",[s._v("ä½¿ç”¨ Istio sidecar ä»£ç†æ³¨å…¥å®¢æˆ·ç«¯ï¼Œä»¥ä¾¿ç½‘ç»œäº¤äº’ç”± Istio ç®¡ç†ã€‚å¦‚æœæ‚¨å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),a("code",[s._v("fortio")]),s._v("æœåŠ¡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/httpbin/sample-client/fortio-deploy.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),a("code",[s._v("fortio")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/httpbin/sample-client/fortio-deploy.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ç™»å½•å®¢æˆ·ç«¯podï¼Œä½¿ç”¨fortioå·¥å…·è°ƒç”¨"),a("code",[s._v("httpbin")]),s._v(". ä¼ å…¥"),a("code",[s._v("curl")]),s._v("è¡¨ç¤ºä½ åªæƒ³æ‰“ä¸€ä¸ªç”µè¯ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FORTIO_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("fortio -o "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'jsonpath={.items[0].metadata.name}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$FORTIO_POD")]),s._v('"')]),s._v(" -c fortio -- /usr/bin/fortio "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -quiet http://httpbin:8000/get\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nserver: envoy\ndate: Tue, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" Feb "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(":25:52 GMT\ncontent-type: application/json\ncontent-length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("586")]),s._v("\naccess-control-allow-origin: *\naccess-control-allow-credentials: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nx-envoy-upstream-service-time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("36")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"args"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Length"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin:8000"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User-Agent"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fortio.org/fortio-1.3.1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Parentspanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"8fc453fb1dec2c22"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Sampled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Spanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"071d7f06bc94943c"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Traceid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"86a929a0e76cda378fc453fb1dec2c22"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Forwarded-Client-Cert"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"By=spiffe://cluster.local/ns/default/sa/httpbin;Hash=68bbaedefe01ef4cb99e17358ff63e92d04a4ce831a35ab9a31d3c8e06adb038;Subject='),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"origin"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"127.0.0.1"')]),s._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://httpbin:8000/get"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br")])]),a("h4",{attrs:{id:"ä½¿æ–­è·¯å™¨è·³é—¸"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿æ–­è·¯å™¨è·³é—¸"}},[s._v("#")]),s._v(" ä½¿æ–­è·¯å™¨è·³é—¸")]),s._v(" "),a("p",[s._v("åœ¨"),a("code",[s._v("DestinationRule")]),s._v("è®¾ç½®ä¸­ï¼Œæ‚¨æŒ‡å®šäº†"),a("code",[s._v("maxConnections: 1")]),s._v("å’Œ "),a("code",[s._v("http1MaxPendingRequests: 1")]),s._v("ã€‚è¿™äº›è§„åˆ™è¡¨æ˜ï¼Œå¦‚æœæ‚¨è¶…è¿‡ä¸€ä¸ªè¿æ¥å¹¶åŒæ—¶è¯·æ±‚ï¼Œåˆ™å½“ "),a("code",[s._v("istio-proxy")]),s._v("æ‰“å¼€æ›´å¤šè¯·æ±‚å’Œè¿æ¥çš„ç”µè·¯æ—¶ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›å¤±è´¥ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("ä½¿ç”¨ä¸¤ä¸ªå¹¶å‘è¿æ¥ ( "),a("code",[s._v("-c 2")]),s._v(") è°ƒç”¨æœåŠ¡å¹¶å‘é€ 20 ä¸ªè¯·æ±‚ ( "),a("code",[s._v("-n 20")]),s._v(")ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "$FORTIO_POD" -c fortio -- /usr/bin/fortio load -c 2 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 I logger.go:12"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("7")]),s._v(">")]),s._v(" Log level is now "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" Warning "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("was "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFortio "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.17")]),s._v(".1 running at "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" queries per second, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" procs, "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls: http://httpbin:8000/get\nStarting at max qps with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gomax "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" exactly "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" per thread + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":42:53 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEnded after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90")]),s._v(".508623ms "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls. "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("qps")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.97")]),s._v("\nAggregated Function Time "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0081634006")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006652")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000929244")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.027135759")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.163268012")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# range, mid point, percentile, count")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000929244")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000964622")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0015")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0025")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.005")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0055")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0065")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0075")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0085")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0095")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.015")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("85.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.018")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.02")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.019")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.025")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0271358")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0260679")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 50% 0.007")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 75% 0.00966667")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 90% 0.019")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 99% 0.0267086")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 99.9% 0.027093")]),s._v("\nSockets used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("for perfect keepalive, would be "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJitter: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nCode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70.0")]),s._v(" %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.0")]),s._v(" %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nResponse Header Sizes "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("161.15")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("105.5")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("231")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3223")]),s._v("\nResponse Body/Total Sizes "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("649.25")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("267.3")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("241")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("825")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12985")]),s._v("\nAll "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plus "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" warmup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8.163")]),s._v(" ms avg, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("221.0")]),s._v(" qps\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("p",[s._v("æœ‰è¶£çš„æ˜¯ï¼Œå‡ ä¹æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡äº†ï¼"),a("code",[s._v("istio-proxy")]),s._v(" ç¡®å®ç•™æœ‰ä½™åœ°ã€‚")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Code 200 : 14 (70.0 %)\nCode 503 : 6 (30.0 %)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å°†å¹¶å‘è¿æ¥æ•°å¢åŠ åˆ° 3ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "$FORTIO_POD" -c fortio -- /usr/bin/fortio load -c 3 -qps 0 -n 20 -loglevel Warning http://httpbin:8000/get')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 I logger.go:12"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("7")]),s._v(">")]),s._v(" Log level is now "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" Warning "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("was "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Info"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nFortio "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.17")]),s._v(".1 running at "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" queries per second, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" procs, "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls: http://httpbin:8000/get\nStarting at max qps with "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("gomax "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" exactly "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" per thread + "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":44:49 W http_client.go:80"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("6")]),s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Non ok http code "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEnded after "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v(".522699ms "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls. "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("qps")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("614.96")]),s._v("\nAggregated Function Time "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0029114787")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003681")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000447652")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016532305")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.058229575")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# range, mid point, percentile, count")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000447652")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000723826")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("30.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.001")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0015")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("60.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.002")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.003")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0025")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("70.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.005")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0045")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("90.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0085")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("95.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0165323")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0162662")]),s._v(" , "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.00")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 50% 0.00166667")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 75% 0.00425")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 90% 0.005")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 99% 0.0164258")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# target 99.9% 0.0165217")]),s._v("\nSockets used: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("for perfect keepalive, would be "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nJitter: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\nCode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("25.0")]),s._v(" %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCode "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.0")]),s._v(" %"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nResponse Header Sizes "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("57.55")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.68")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("231")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1151")]),s._v("\nResponse Body/Total Sizes "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" count "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" avg "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("386.8")]),s._v(" +/- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("252.5")]),s._v(" min "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("241")]),s._v(" max "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("825")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sum")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7736")]),s._v("\nAll "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" calls "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("plus "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" warmup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.911")]),s._v(" ms avg, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("615.0")]),s._v(" qps\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("ç°åœ¨æ‚¨å¼€å§‹çœ‹åˆ°é¢„æœŸçš„æ–­è·¯è¡Œä¸ºã€‚åªæœ‰ 36.7% çš„è¯·æ±‚æˆåŠŸï¼Œå…¶ä½™çš„åˆ™è¢«ç†”æ–­æœºåˆ¶å›°ä½ï¼š")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("Code 200 : 5 (25.0 %)\nCode 503 : 15 (75.0 %)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("p",[s._v("æŸ¥è¯¢"),a("code",[s._v("istio-proxy")]),s._v("ç»Ÿè®¡ä¿¡æ¯ä»¥æŸ¥çœ‹æ›´å¤šä¿¡æ¯ï¼š")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥æŸ¥çœ‹"),a("code",[s._v("21")]),s._v("è¯¥"),a("code",[s._v("upstream_rq_pending_overflow")]),s._v("å€¼ï¼Œè¿™æ„å‘³ç€"),a("code",[s._v("21")]),s._v(" åˆ°ç›®å‰ä¸ºæ­¢çš„è°ƒç”¨å·²è¢«æ ‡è®°ä¸ºæ–­è·¯ã€‚")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-1.9.5"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "$FORTIO_POD" -c istio-proxy -- pilot-agent request GET stats | grep httpbin | grep pending')]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.circuit_breakers.default.remaining_pending: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.circuit_breakers.default.rq_pending_open: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.circuit_breakers.high.rq_pending_open: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.upstream_rq_pending_active: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.upstream_rq_pending_failure_eject: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.upstream_rq_pending_overflow: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("\ncluster.outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("httpbin.default.svc.cluster.local.upstream_rq_pending_total: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-6"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete destinationrule httpbin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å…³é—­"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("æœåŠ¡å’Œå®¢æˆ·ç«¯ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete deploy httpbin fortio-deploy\n$ kubectl delete svc httpbin fortio\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"é•œåƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é•œåƒ"}},[s._v("#")]),s._v(" é•œåƒ")]),s._v(" "),a("h4",{attrs:{id:"æµé‡é•œåƒ"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æµé‡é•œåƒ"}},[s._v("#")]),s._v(" æµé‡é•œåƒ")]),s._v(" "),a("p",[s._v("æ­¤ä»»åŠ¡æ¼”ç¤ºäº† Istio çš„æµé‡é•œåƒåŠŸèƒ½ã€‚")]),s._v(" "),a("p",[s._v("æµé‡é•œåƒï¼Œä¹Ÿç§°ä¸ºé˜´å½±ï¼Œæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ¦‚å¿µï¼Œå®ƒå…è®¸åŠŸèƒ½å›¢é˜Ÿä»¥å°½å¯èƒ½å°çš„é£é™©å°†æ›´æ”¹å¸¦å…¥ç”Ÿäº§ç¯å¢ƒã€‚é•œåƒå°†å®æ—¶æµé‡çš„å‰¯æœ¬å‘é€åˆ°é•œåƒæœåŠ¡ã€‚é•œåƒæµé‡å‘ç”Ÿåœ¨ä¸»æœåŠ¡çš„å…³é”®è¯·æ±‚è·¯å¾„çš„å¸¦å¤–ã€‚")]),s._v(" "),a("p",[s._v("åœ¨æ­¤ä»»åŠ¡ä¸­ï¼Œæ‚¨å°†é¦–å…ˆå¼ºåˆ¶æ‰€æœ‰æµé‡æµå‘"),a("code",[s._v("v1")]),s._v("æµ‹è¯•æœåŠ¡ã€‚ç„¶åï¼Œæ‚¨å°†åº”ç”¨è§„åˆ™å°†ä¸€éƒ¨åˆ†æµé‡é•œåƒåˆ°"),a("code",[s._v("v2")]),s._v(".")]),s._v(" "),a("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ-2"}},[s._v("#")]),s._v(" åŸºç¡€ç¯å¢ƒ")]),s._v(" "),a("p",[s._v("é¦–å…ˆéƒ¨ç½²ä¸¤ä¸ªå¯ç”¨äº†è®¿é—®æ—¥å¿—è®°å½•çš„"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbinæœåŠ¡ç‰ˆæœ¬ï¼š"),a("OutboundLink")],1)]),s._v(" "),a("p",[a("strong",[s._v("httpbin-v1ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" istioctl kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("inject "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker.io/kennethreitz/httpbin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"gunicorn"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--access-logfile"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-b"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:80"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin:app"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[a("strong",[s._v("httpbin-v2ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" istioctl kube-inject -f - "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" kubectl create -f -")]),s._v('\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: httpbin-v2\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: httpbin\n      version: v2\n  template:\n    metadata:\n      labels:\n        app: httpbin\n        version: v2\n    spec:\n      containers:\n      - image: docker.io/kennethreitz/httpbin\n        imagePullPolicy: IfNotPresent\n        name: httpbin\n        command: ["gunicorn", "--access-logfile", "-", "-b", "0.0.0.0:80", "httpbin:app"]\n        ports:\n        - containerPort: 80\nEOF')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("p",[a("strong",[s._v("httpbin Kubernetes æœåŠ¡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("å¯åŠ¨"),a("code",[s._v("sleep")]),s._v("æœåŠ¡ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨å®ƒ"),a("code",[s._v("curl")]),s._v("æ¥æä¾›è´Ÿè½½ï¼š")]),s._v(" "),a("p",[a("strong",[s._v("ç¡çœ æœåŠ¡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" istioctl kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("inject "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl create "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sleep\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sleep\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sleep\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" sleep\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" curlimages/curl\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/bin/sleep"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3650d"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h4",{attrs:{id:"åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥"}},[s._v("#")]),s._v(" åˆ›å»ºé»˜è®¤è·¯ç”±ç­–ç•¥")]),s._v(" "),a("p",[s._v("é»˜è®¤æƒ…å†µä¸‹ï¼ŒKubernetes ä¼šåœ¨"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡çš„ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´è¿›è¡Œè´Ÿè½½å¹³è¡¡ã€‚åœ¨æ­¤æ­¥éª¤ä¸­ï¼Œæ‚¨å°†æ›´æ”¹è¯¥è¡Œä¸ºï¼Œä»¥ä¾¿æ‰€æœ‰æµé‡éƒ½è½¬åˆ°"),a("code",[s._v("v1")]),s._v(".")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºé»˜è®¤è·¯ç”±è§„åˆ™ä»¥å°†æ‰€æœ‰æµé‡è·¯ç”±åˆ°"),a("code",[s._v("v1")]),s._v("æœåŠ¡ï¼Œç°åœ¨æ‰€æœ‰æµé‡éƒ½æµå‘"),a("code",[s._v("httpbin:v1")]),s._v("æœåŠ¡ã€‚ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å‘æœåŠ¡å‘é€ä¸€äº›æµé‡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SLEEP_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sleep -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SLEEP_POD}")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sS http://httpbin:8000/headers\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*/*"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Length"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin:8000"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User-Agent"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.35.0"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Parentspanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"57784f8bff90ae0b"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Sampled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Spanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3289ae7257c3f159"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Traceid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"b56eebd279a76f0b57784f8bff90ae0b"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Envoy-Attempt-Count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Forwarded-Client-Cert"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"By=spiffe://cluster.local/ns/default/sa/default;Hash=20afebed6da091c850264cc751b8c9306abac02993f80bdb76282237422bd098;Subject='),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("æ£€æŸ¥pod"),a("code",[s._v("v1")]),s._v("çš„æ—¥å¿—"),a("code",[s._v("v2")]),s._v("ã€‚"),a("code",[s._v("httpbin")]),s._v("æ‚¨åº”è¯¥çœ‹åˆ°ä»¥ä¸‹çš„è®¿é—®æ—¥å¿—æ¡ç›®ï¼Œ"),a("code",[s._v("v1")]),s._v("å¹¶ä¸”æ²¡æœ‰"),a("code",[s._v("v2")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("V1_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin,version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v1 -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ kubectl logs "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$V1_POD")]),s._v('"')]),s._v(" -c httpbin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.9")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://0.0.0.0:80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:30:43 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n\n\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("V2_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin,version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("v2 -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ kubectl logs "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$V2_POD")]),s._v('"')]),s._v(" -c httpbin\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.9")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://0.0.0.0:80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("h4",{attrs:{id:"å°†æµé‡é•œåƒåˆ°v2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å°†æµé‡é•œåƒåˆ°v2"}},[s._v("#")]),s._v(" å°†æµé‡é•œåƒåˆ°v2")]),s._v(" "),a("p",[a("strong",[s._v("æ›´æ”¹è·¯ç”±è§„åˆ™ä»¥å°†æµé‡é•œåƒåˆ° v2ï¼š")])]),s._v(" "),a("p",[s._v("æ­¤è·¯ç”±è§„åˆ™å°† 100% çš„æµé‡å‘é€åˆ°"),a("code",[s._v("v1")]),s._v(". æœ€åä¸€èŠ‚æŒ‡å®šæ‚¨å¸Œæœ›å°† 100% çš„ç›¸åŒæµé‡é•œåƒï¼ˆå³ï¼Œä¹Ÿå‘é€ï¼‰åˆ° "),a("code",[s._v("httpbin:v2")]),s._v("æœåŠ¡ã€‚")]),s._v(" "),a("p",[s._v("å½“æµé‡è¢«é•œåƒæ—¶ï¼Œè¯·æ±‚è¢«å‘é€åˆ°é•œåƒæœåŠ¡ï¼Œå…¶ Host/Authority æ ‡å¤´é™„åŠ "),a("code",[s._v("-shadow")]),s._v(". ä¾‹å¦‚ï¼Œ"),a("code",[s._v("cluster-1")]),s._v("å˜æˆ"),a("code",[s._v("cluster-1-shadow")]),s._v("ã€‚")]),s._v(" "),a("p",[s._v("æ­¤å¤–ï¼Œé‡è¦çš„æ˜¯è¦æ³¨æ„è¿™äº›è¯·æ±‚è¢«é•œåƒä¸ºâ€œå³å‘å³å¼ƒâ€ï¼Œè¿™æ„å‘³ç€å“åº”è¢«ä¸¢å¼ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨è¯¥"),a("code",[s._v("value")]),s._v("å­—æ®µä¸‹çš„"),a("code",[s._v("mirrorPercentage")]),s._v("å­—æ®µæ¥é•œåƒä¸€éƒ¨åˆ†æµé‡ï¼Œè€Œä¸æ˜¯é•œåƒæ‰€æœ‰è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªå­—æ®µï¼Œæ‰€æœ‰çš„æµé‡éƒ½ä¼šè¢«é•œåƒã€‚")]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mirror")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mirrorPercentage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100.0")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h4",{attrs:{id:"å‘é€æµé‡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‘é€æµé‡"}},[s._v("#")]),s._v(" å‘é€æµé‡")]),s._v(" "),a("p",[s._v("é€šè¿‡å‘é€æµé‡å†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œæƒ…å†µå¦‚ä¸‹ï¼š")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("v1")]),s._v("ç°åœ¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å’Œçš„è®¿é—®è®°å½•")]),s._v(" "),a("li",[a("code",[s._v("v2")]),s._v("ä¸­åˆ›å»ºçš„è®¿é—®æ—¥å¿—"),a("code",[s._v("v2")]),s._v("æ˜¯å®é™…å°†è¦è®¿é—®çš„é•œåƒè¯·æ±‚"),a("code",[s._v("v1")]),s._v("ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl exec "${SLEEP_POD}" -c sleep -- curl -sS http://httpbin:8000/headers')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"headers"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Accept"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*/*"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Host"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin:8000"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"User-Agent"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Parentspanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"a422ba4aefe02440"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Sampled"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Spanid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"acd7163f70c9aa89"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-B3-Traceid"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"f7ca9fb1e0581d6ba422ba4aefe02440"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Envoy-Attempt-Count"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),s._v(",\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"X-Forwarded-Client-Cert"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"By=spiffe://cluster.local/ns/default/sa/default;Hash=ab53dec650eb79f2aa9dc051ed27a2b4b698ee40ffd557cd885495105916a139;Subject='),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),a("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v(';URI=spiffe://cluster.local/ns/default/sa/default"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl logs "$V1_POD" -c httpbin')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.9")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://0.0.0.0:80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:47 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:30:43 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:03 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:48 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:52 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:34:05 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("529")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 istio-work"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# kubectl logs "$V2_POD" -c httpbin')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Starting gunicorn "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.9")]),s._v(".0\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening at: http://0.0.0.0:80 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Using worker: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-18 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":20:53 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Booting worker with pid: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:03 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("569")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:48 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("569")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:33:52 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("569")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.6 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("/Mar/2022:16:34:05 +0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /headers HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("569")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-7"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤è§„åˆ™ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete virtualservice httpbin\n$ kubectl delete destinationrule httpbin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å…³é—­"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("æœåŠ¡å’Œå®¢æˆ·ç«¯ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete deploy httpbin-v1 httpbin-v2 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v("\n$ kubectl delete svc httpbin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"å…¥å£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…¥å£ç½‘å…³"}},[s._v("#")]),s._v(" å…¥å£ç½‘å…³")]),s._v(" "),a("h4",{attrs:{id:"å…¥å£ç½‘å…³ç®€è¦"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å…¥å£ç½‘å…³ç®€è¦"}},[s._v("#")]),s._v(" å…¥å£ç½‘å…³ç®€è¦")]),s._v(" "),a("p",[s._v("é™¤äº†æ”¯æŒ Kubernetes "),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/kubernetes-ingress/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Ingress"),a("OutboundLink")],1),s._v("ï¼ŒIstio è¿˜æä¾›äº†å¦ä¸€ç§é…ç½®æ¨¡å‹ï¼Œ"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[s._v("å³ Istio Gateway"),a("OutboundLink")],1),s._v("ã€‚A"),a("code",[s._v("Gateway")]),s._v("æä¾›äº†æ¯” æ›´å¹¿æ³›çš„è‡ªå®šä¹‰å’Œçµæ´»æ€§"),a("code",[s._v("Ingress")]),s._v("ï¼Œå¹¶å…è®¸å°†ç›‘æ§å’Œè·¯ç”±è§„åˆ™ç­‰ Istio åŠŸèƒ½åº”ç”¨äºè¿›å…¥é›†ç¾¤çš„æµé‡ã€‚")]),s._v(" "),a("p",[s._v("æ­¤ä»»åŠ¡æè¿°äº†å¦‚ä½•é…ç½® Istio ä»¥ä½¿ç”¨ Istio åœ¨æœåŠ¡ç½‘æ ¼ä¹‹å¤–å…¬å¼€æœåŠ¡"),a("code",[s._v("Gateway")]),s._v("ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-6"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("ç¡®ä¿æ‚¨çš„å½“å‰ç›®å½•æ˜¯è¯¥"),a("code",[s._v("istio")]),s._v("ç›®å½•ã€‚")]),s._v(" "),a("li",[s._v("å¯åŠ¨"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ã€‚")])]),s._v(" "),a("p",[s._v("â€‹\t\tå¦‚æœæ‚¨å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("p",[s._v("â€‹\t\tå¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),a("code",[s._v("httpbin")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/httpbin/httpbin.yaml\n$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/httpbin/httpbin.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"ç¡®å®šå…¥å£ipå’Œç«¯å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¡®å®šå…¥å£ipå’Œç«¯å£"}},[s._v("#")]),s._v(" ç¡®å®šå…¥å£IPå’Œç«¯å£")]),s._v(" "),a("p",[s._v("æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç¡®å®šæ‚¨çš„ Kubernetes é›†ç¾¤æ˜¯å¦åœ¨æ”¯æŒå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨çš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆ"),a("code",[s._v("è¿™é‡Œæ²¡æœ‰è´Ÿè½½å‡è¡¡å™¨æ”¹ä¸ºNodePortæ¨¡å¼")]),s._v("ï¼‰ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n istio-system istio-ingressgateway")]),s._v("\nNAME                   TYPE       CLUSTER-IP     EXTERNAL-IP   PORT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("                                                                    AGE\nistio-ingressgateway   NodePort   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".88.217   "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15021")]),s._v(":28214/TCP,80:27007/TCP,443:9673/TCP,31400:3938/TCP,15443:41053/TCP   4d2h\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("å¦‚æœ"),a("code",[s._v("EXTERNAL-IP")]),s._v("è®¾ç½®äº†è¯¥å€¼ï¼Œåˆ™æ‚¨çš„ç¯å¢ƒå…·æœ‰å¯ç”¨äºå…¥å£ç½‘å…³çš„å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚å¦‚æœ"),a("code",[s._v("EXTERNAL-IP")]),s._v("å€¼ä¸º"),a("code",[s._v("<none>")]),s._v("æˆ–æ°¸ä¹…"),a("code",[s._v("<pending>")]),s._v("ï¼Œåˆ™æ‚¨çš„ç¯å¢ƒä¸ä¸ºå…¥å£ç½‘å…³æä¾›å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ã€‚"),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/service/#nodeport",target:"_blank",rel:"noopener noreferrer"}},[s._v("åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æœåŠ¡çš„èŠ‚ç‚¹ç«¯å£"),a("OutboundLink")],1),s._v("è®¿é—®ç½‘å…³ã€‚")]),s._v(" "),a("h4",{attrs:{id:"æ·»åŠ ç¯å¢ƒè¯´æ˜"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ·»åŠ ç¯å¢ƒè¯´æ˜"}},[s._v("#")]),s._v(" æ·»åŠ ç¯å¢ƒè¯´æ˜")]),s._v(" "),a("p",[s._v("å¦‚æœæ‚¨ç¡®å®šæ‚¨çš„ç¯å¢ƒæ²¡æœ‰å¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼Œè¯·æŒ‰ç…§è¿™äº›è¯´æ˜è¿›è¡Œæ“ä½œï¼Œå› æ­¤æ‚¨éœ€è¦æ”¹ç”¨èŠ‚ç‚¹ç«¯å£ã€‚")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"http2\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SECURE_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"https\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TCP_INGRESS_PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl -n istio-system get "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" istio-ingressgateway -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{.spec.ports[?(@.name==\"tcp\")].nodePort}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062328622.png",alt:"image-20220318172145022"}})]),s._v(" "),a("h4",{attrs:{id:"ä½¿ç”¨istioç½‘å…³é…ç½®å…¥å£"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨istioç½‘å…³é…ç½®å…¥å£"}},[s._v("#")]),s._v(" ä½¿ç”¨Istioç½‘å…³é…ç½®å…¥å£")]),s._v(" "),a("p",[s._v("å…¥å£"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç½‘å…³"),a("OutboundLink")],1),s._v("æè¿°äº†åœ¨ç½‘æ ¼è¾¹ç¼˜è¿è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ï¼Œç”¨äºæ¥æ”¶ä¼ å…¥çš„ HTTP/TCP è¿æ¥ã€‚å®ƒé…ç½®æš´éœ²çš„ç«¯å£ã€åè®®ç­‰ï¼Œä½†ä¸"),a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/",target:"_blank",rel:"noopener noreferrer"}},[s._v("Kubernetes Ingress Resources"),a("OutboundLink")],1),s._v("ä¸åŒï¼Œå®ƒä¸åŒ…æ‹¬ä»»ä½•æµé‡è·¯ç”±é…ç½®ã€‚å…¥å£æµé‡çš„æµé‡è·¯ç”±æ˜¯ä½¿ç”¨ Istio è·¯ç”±è§„åˆ™é…ç½®çš„ï¼Œä¸å†…éƒ¨æœåŠ¡è¯·æ±‚çš„æ–¹å¼å®Œå…¨ç›¸åŒã€‚")]),s._v(" "),a("p",[s._v("è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•"),a("code",[s._v("Gateway")]),s._v("ä¸º HTTP æµé‡é…ç½®ç«¯å£ 80ã€‚")]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºä¸€ä¸ª Istio "),a("code",[s._v("Gateway")]),s._v("ï¼š\n"),a("ul",[a("li",[a("code",[s._v("ä½¿ç”¨é»˜è®¤çš„ingressgatewayç½‘å…³")])]),s._v(" "),a("li",[a("code",[s._v("åˆ›å»ºä¸€ä¸ªæœåŠ¡å™¨è§„èŒƒåˆ—è¡¨ï¼Œåˆ†åˆ«æ˜¯ä¸»æœºå’Œç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®httpæœåŠ¡çš„80ç«¯å£ä»¥åŠä¸»æœºhttpbin.example.com")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingressgateway "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use Istio default gateway implementation")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com"')]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ä¸ºé€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›å…¥çš„æµé‡é…ç½®è·¯ç”±"),a("code",[s._v("Gateway")]),s._v("ï¼š\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡å…è®¸ä¸»æœºhttpbin.example.com")])]),s._v(" "),a("li",[a("code",[s._v("é…è¿½httpçš„è§„åˆ™ä¸ºä¸¤ä¸ªuriçš„ä¸¤ä¸ªå…è®¸è·¯å¾„ã€åˆ†åˆ«æ˜¯statuså’Œdelay")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ç›®çš„åœ°è§„åˆ™ä¸ºä¸»æœºæ˜¯httpbinç«¯å£ä¸º8080çš„")])]),s._v(" "),a("li",[a("code",[s._v("ç½‘å…³åˆ—è¡¨æŒ‡å®šåªå…è®¸é€šè¿‡æ‚¨çš„è¯·æ±‚httpbin-gatewayã€‚æ‰€æœ‰å…¶ä»–å¤–éƒ¨è¯·æ±‚éƒ½å°†è¢« 404 å“åº”æ‹’ç»ã€‚")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /status\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /delay\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("blockquote",[a("p",[s._v("æ³¨æ„ï¼š")]),s._v(" "),a("p",[s._v("ç½‘æ ¼ä¸­å…¶ä»–æœåŠ¡çš„å†…éƒ¨è¯·æ±‚ä¸å—è¿™äº›è§„åˆ™çš„çº¦æŸï¼Œè€Œæ˜¯é»˜è®¤ä½¿ç”¨å¾ªç¯è·¯ç”±ã€‚è¦å°†è¿™äº›è§„åˆ™ä¹Ÿåº”ç”¨äºå†…éƒ¨è°ƒç”¨ï¼Œæ‚¨å¯ä»¥å°†ç‰¹æ®Šå€¼æ·»åŠ "),a("code",[s._v("mesh")]),s._v("åˆ°"),a("code",[s._v("gateways")]),s._v(". ç”±äºæœåŠ¡çš„å†…éƒ¨ä¸»æœºåå¯èƒ½ä¸å¤–éƒ¨ä¸»æœºåä¸åŒï¼ˆä¾‹å¦‚ï¼Œ"),a("code",[s._v("httpbin.default.svc.cluster.local")]),s._v("ï¼‰ï¼Œå› æ­¤æ‚¨è¿˜éœ€è¦å°†å…¶æ·»åŠ åˆ°"),a("code",[s._v("hosts")]),s._v("åˆ—è¡¨ä¸­ã€‚")])]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[a("em",[s._v("ä½¿ç”¨curl")]),s._v("è®¿é—®"),a("em",[s._v("httpbin")]),s._v("æœåŠ¡ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -s -I -HHost:httpbin.example.com "http://$INGRESS_HOST:$INGRESS_PORT/status/200"')]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nserver: istio-envoy\ndate: Sun, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":05:09 GMT\ncontent-type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\naccess-control-allow-origin: *\naccess-control-allow-credentials: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ncontent-length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nx-envoy-upstream-service-time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br")])]),a("p",[s._v("è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨è¯¥"),a("code",[s._v("-H")]),s._v("æ ‡å¿—å°†"),a("em",[s._v("Host")]),s._v(" HTTP æ ‡å¤´è®¾ç½®ä¸ºâ€œhttpbin.example.comâ€ã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæ‚¨çš„å…¥å£"),a("code",[s._v("Gateway")]),s._v("é…ç½®ä¸ºå¤„ç†â€œhttpbin.example.comâ€ï¼Œä½†åœ¨æ‚¨çš„æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ‚¨æ²¡æœ‰è¯¥ä¸»æœºçš„ DNS ç»‘å®šï¼Œåªæ˜¯å°†æ‚¨çš„è¯·æ±‚å‘é€åˆ°å…¥å£ IPã€‚")]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("è®¿é—®å°šæœªæ˜ç¡®å…¬å¼€çš„ä»»ä½•å…¶ä»– URLã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ° HTTP 404 é”™è¯¯ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -s -I -HHost:httpbin.example.com "http://$INGRESS_HOST:$INGRESS_PORT/headers"')]),s._v("\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("404")]),s._v(" Not Found\ndate: Sun, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":29:26 GMT\nserver: istio-envoy\ntransfer-encoding: chunked\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("h4",{attrs:{id:"ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡"}},[s._v("#")]),s._v(" ä½¿ç”¨æµè§ˆå™¨è®¿é—®å…¥å£æœåŠ¡")]),s._v(" "),a("p",[s._v("åœ¨æµè§ˆå™¨ä¸­è¾“å…¥"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ URL å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºæ‚¨æ— æ³•å°†"),a("em",[s._v("Host")]),s._v("æ ‡å¤´ä¼ é€’ç»™æµè§ˆå™¨ï¼Œå°±åƒä½¿ç”¨"),a("code",[s._v("curl")]),s._v(". åœ¨ç°å®ä¸–ç•Œçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸æ˜¯é—®é¢˜ï¼Œå› ä¸ºæ‚¨æ­£ç¡®é…ç½®äº†è¯·æ±‚çš„ä¸»æœºå¹¶ä¸” DNS å¯è§£æã€‚å› æ­¤ï¼Œæ‚¨åœ¨ URL ä¸­ä½¿ç”¨ä¸»æœºçš„åŸŸåï¼Œä¾‹å¦‚"),a("code",[s._v("https://httpbin.example.com/status/200")]),s._v(".")]),s._v(" "),a("p",[s._v("è¦ä¸ºç®€å•çš„æµ‹è¯•å’Œæ¼”ç¤ºè§£å†³æ­¤é—®é¢˜ï¼Œè¯·åœ¨ å’Œé…ç½®"),a("code",[s._v("*")]),s._v("ä¸­ä¸ºä¸»æœºä½¿ç”¨é€šé…ç¬¦å€¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å°†å…¥å£é…ç½®æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼š"),a("code",[s._v("Gateway VirtualService")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingressgateway "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use Istio default gateway implementation")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /headers\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[s._v("åœ¨æœ¬æœºçš„hosts"),a("code",[s._v("é…ç½®192.168.1.6:44526/headers httpbin.example.com")]),s._v("æ˜ å°„ï¼Œç„¶åé€šè¿‡æµè§ˆå™¨è®¿é—®ã€‚")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://raw.githubusercontent.com/2756864799zhang/image/main/img/202205062328976.png",alt:"image-20220320230630481"}})]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-8"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤"),a("code",[s._v("Gateway")]),s._v("and"),a("code",[s._v("VirtualService")]),s._v("é…ç½®ï¼Œå…³é—­"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete gateway httpbin-gateway\n$ kubectl delete virtualservice httpbin\n$ kubectl delete --ignore-not-found"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -f samples/httpbin/httpbin.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"å®‰å…¨ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨ç½‘å…³"}},[s._v("#")]),s._v(" å®‰å…¨ç½‘å…³")]),s._v(" "),a("h4",{attrs:{id:"å®‰å…¨ç½‘å…³çš„ä½œç”¨"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å®‰å…¨ç½‘å…³çš„ä½œç”¨"}},[s._v("#")]),s._v(" å®‰å…¨ç½‘å…³çš„ä½œç”¨")]),s._v(" "),a("p",[s._v("æ§åˆ¶å…¥å£"),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/ingress/ingress-control",target:"_blank",rel:"noopener noreferrer"}},[s._v("æµé‡ä»»åŠ¡"),a("OutboundLink")],1),s._v(" æè¿°äº†å¦‚ä½•é…ç½®å…¥å£ç½‘å…³ä»¥å°† HTTP æœåŠ¡å…¬å¼€ç»™å¤–éƒ¨æµé‡ã€‚æ­¤ä»»åŠ¡æ˜¾ç¤ºå¦‚ä½•ä½¿ç”¨ç®€å•æˆ–åŒå‘ TLS å…¬å¼€å®‰å…¨çš„ HTTPS æœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-7"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("ul",[a("li",[s._v("ç¡®ä¿æ‚¨çš„å½“å‰ç›®å½•æ˜¯è¯¥"),a("code",[s._v("istio")]),s._v("ç›®å½•ã€‚")]),s._v(" "),a("li",[s._v("å¯åŠ¨"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/httpbin",target:"_blank",rel:"noopener noreferrer"}},[s._v("httpbin"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ã€‚")])]),s._v(" "),a("p",[s._v("â€‹\t\tå¦‚æœæ‚¨å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ï¼Œè¯·éƒ¨ç½²è¯¥"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("p",[s._v("â€‹\t\tå¦åˆ™ï¼Œæ‚¨å¿…é¡»åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰æ‰‹åŠ¨æ³¨å…¥ sidecar "),a("code",[s._v("httpbin")]),s._v("ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/httpbin/httpbin.yaml\n$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/httpbin/httpbin.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥"}},[s._v("#")]),s._v(" ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥")]),s._v(" "),a("p",[s._v("å¯¹äºæ­¤ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‚¨å–œæ¬¢çš„å·¥å…·æ¥ç”Ÿæˆè¯ä¹¦å’Œå¯†é’¥ã€‚ä¸‹é¢çš„å‘½ä»¤ä½¿ç”¨ "),a("a",{attrs:{href:"https://man.openbsd.org/openssl.1",target:"_blank",rel:"noopener noreferrer"}},[s._v("openssl"),a("OutboundLink")],1)]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºæ ¹è¯ä¹¦å’Œç§é’¥æ¥ä¸ºæ‚¨çš„æœåŠ¡ç­¾ç½²è¯ä¹¦ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ openssl req -x509 -sha256 -nodes -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -newkey rsa:2048 -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/O=example Inc./CN=example.com'")]),s._v(" -keyout example.com.key -out example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("åˆ›å»ºè¯ä¹¦å’Œç§é’¥"),a("code",[s._v("httpbin.example.com")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ openssl req -out httpbin.example.com.csr -newkey rsa:2048 -nodes -keyout httpbin.example.com.key -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/CN=httpbin.example.com/O=httpbin organization"')]),s._v("\n$ openssl x509 -req -sha256 -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -CA example.com.crt -CAkey example.com.key -set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -in httpbin.example.com.csr -out httpbin.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h4",{attrs:{id:"ä¸ºå•ä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºå•ä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[s._v("#")]),s._v(" ä¸ºå•ä¸ªä¸»æœºé…ç½®TLSå…¥å£ç½‘å…³")]),s._v(" "),a("ol",[a("li",[s._v("ä¸ºå…¥å£ç½‘å…³åˆ›å»ºä¸€ä¸ªå¯†é’¥ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl create -n istio-system secret tls httpbin-credential --key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com.key --cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("ä½¿ç”¨ç«¯å£ 443çš„éƒ¨åˆ†å®šä¹‰ç½‘å…³"),a("code",[s._v("servers:")]),s._v("ï¼Œå¹¶æŒ‡å®š "),a("code",[s._v("credentialName")]),s._v("to beçš„å€¼"),a("code",[s._v("httpbin-credential")]),s._v("ã€‚è¿™äº›å€¼ä¸å¯†é’¥çš„åç§°ç›¸åŒã€‚TLS æ¨¡å¼çš„å€¼åº”ä¸º"),a("code",[s._v("SIMPLE")]),s._v(".")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mygateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingressgateway "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use istio default ingress gateway")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SIMPLE\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentialName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("credential "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# must be the same as secret")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin.example.com\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("é…ç½®ç½‘å…³çš„å…¥å£æµé‡è·¯ç”±ã€‚å®šä¹‰ç›¸åº”çš„è™šæ‹ŸæœåŠ¡ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mygateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /status\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /delay\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("å‘é€ HTTPS è¯·æ±‚ä»¥"),a("code",[s._v("httpbin")]),s._v("é€šè¿‡ HTTPS è®¿é—®æœåŠ¡ï¼Œè¯¥"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡å°†è¿”å› "),a("a",{attrs:{href:"https://tools.ietf.org/html/rfc7168#section-2.3.3",target:"_blank",rel:"noopener noreferrer"}},[s._v("418 I'm a Teapot"),a("OutboundLink")],1),s._v("ä»£ç ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v -HHost:httpbin.example.com --resolve "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v('"')]),s._v(" --cacert example.com.crt "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v('/status/418"')]),s._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to httpbin.example.com port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n*   Trying "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Connected to httpbin.example.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("O")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin organization,CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com\n*       start date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" GMT\n*       expire date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example.com,O"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example Inc.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" GET /status/418 HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" User-Agent: curl/7.29.0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Accept: */*\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Host:httpbin.example.com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("418")]),s._v(" Unknown\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" server: istio-envoy\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" date: Sun, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":41:25 GMT\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-origin: *\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-credentials: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" content-length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-envoy-upstream-service-time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n\n    -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" teapot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-\n\n       _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("_\n     .'  _ _ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(' ."'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" ^ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v('". _,\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("//\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_     _/\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"`\n* Connection '),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 to host httpbin.example.com left intact")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("åˆ é™¤ç½‘å…³çš„å¯†ç å¹¶åˆ›å»ºä¸€ä¸ªæ–°å¯†ç ä»¥æ›´æ”¹å…¥å£ç½‘å…³çš„å‡­æ®ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl -n istio-system delete secret httpbin-credential\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" new_certificates\n$ openssl req -x509 -sha256 -nodes -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -newkey rsa:2048 -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/O=example Inc./CN=example.com'")]),s._v(" -keyout new_certificates/example.com.key -out new_certificates/example.com.crt\n$ openssl req -out new_certificates/httpbin.example.com.csr -newkey rsa:2048 -nodes -keyout new_certificates/httpbin.example.com.key -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/CN=httpbin.example.com/O=httpbin organization"')]),s._v("\n$ openssl x509 -req -sha256 -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -CA new_certificates/example.com.crt -CAkey new_certificates/example.com.key -set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -in new_certificates/httpbin.example.com.csr -out new_certificates/httpbin.example.com.crt\n$ kubectl create -n istio-system secret tls httpbin-credential "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new_certificates/httpbin.example.com.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("new_certificates/httpbin.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("ä½¿ç”¨æ–°çš„è¯ä¹¦é“¾è®¿é—®"),a("code",[s._v("httpbin")]),s._v("æœåŠ¡ï¼š"),a("code",[s._v("curl")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v -HHost:httpbin.example.com --resolve "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cacert new_certificates/example.com.crt "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v('/status/418"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("418")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" teapot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-\n\n       _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("_\n     .'  _ _ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(' ."'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" ^ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v('". _,\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("//\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_     _/\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"`\n        \n')])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("å¦‚æœæ‚¨å°è¯•ä½¿ç”¨"),a("code",[s._v("httpbin")]),s._v("ä»¥å‰çš„è¯ä¹¦é“¾è¿›è¡Œè®¿é—®ï¼Œåˆ™ç°åœ¨å°è¯•å¤±è´¥ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v -HHost:httpbin.example.com --resolve "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cacert example.com.crt "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v('/status/418"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* TLSv1.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OUT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", TLS handshake, Client hello "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n* TLSv1.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", TLS handshake, Server hello "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n* TLSv1.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", TLS handshake, Certificate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n* TLSv1.2 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("OUT"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", TLS alert, Server hello "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n* curl: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" error:04FFF06A:rsa routines:CRYPTO_internal:block "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" is not 01\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"ä¸ºå¤šä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä¸ºå¤šä¸ªä¸»æœºé…ç½®tlså…¥å£ç½‘å…³"}},[s._v("#")]),s._v(" ä¸ºå¤šä¸ªä¸»æœºé…ç½®TLSå…¥å£ç½‘å…³")]),s._v(" "),a("p",[s._v("æ‚¨å¯ä»¥ä¸ºå¤šä¸ªä¸»æœºé…ç½®ä¸€ä¸ªå…¥å£ç½‘å…³ "),a("code",[s._v("httpbin.example.com")]),s._v("ï¼Œ"),a("code",[s._v("helloworld-v1.example.com")]),s._v("ä¾‹å¦‚ã€‚å…¥å£ç½‘å…³æ£€ç´¢ä¸ç‰¹å®š"),a("code",[s._v("credentialName")]),s._v(".")]),s._v(" "),a("ol",[a("li",[s._v("è¦æ¢å¤ çš„å‡­æ®"),a("code",[s._v("httpbin")]),s._v("ï¼Œè¯·åˆ é™¤å…¶å¯†é’¥å¹¶é‡æ–°åˆ›å»ºã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl -n istio-system delete secret httpbin-credential\n$ kubectl create -n istio-system secret tls httpbin-credential "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com.key "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å¯åŠ¨"),a("code",[s._v("helloworld-v1")]),s._v("ç¤ºä¾‹")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio/examples"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"100m"')]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" IfNotPresent "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Always")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[s._v("ç”Ÿæˆè¯ä¹¦å’Œç§é’¥"),a("code",[s._v("helloworld-v1.example.com")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ openssl req -out helloworld-v1.example.com.csr -newkey rsa:2048 -nodes -keyout helloworld-v1.example.com.key -subj "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/CN=helloworld-v1.example.com/O=helloworld organization"')]),s._v("\n$ openssl x509 -req -sha256 -days "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -CA example.com.crt -CAkey example.com.key -set_serial "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" -in helloworld-v1.example.com.csr -out helloworld-v1.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("åˆ›å»º"),a("code",[s._v("helloworld-credential")]),s._v("å¯†é’¥ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl create -n istio-system secret tls helloworld-credential --key"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("helloworld-v1.example.com.key --cert"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("helloworld-v1.example.com.crt\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("ä¸ºç«¯å£ 443 å®šä¹‰ä¸€ä¸ªå…·æœ‰ä¸¤ä¸ªæœåŠ¡å™¨éƒ¨åˆ†çš„ç½‘å…³ã€‚å°† "),a("code",[s._v("credentialName")]),s._v("æ¯ä¸ªç«¯å£ä¸Šçš„å€¼åˆ†åˆ«è®¾ç½®ä¸º"),a("code",[s._v("httpbin-credential")]),s._v("å’Œ"),a("code",[s._v("helloworld-credential")]),s._v(" ã€‚\n"),a("ul",[a("li",[s._v("å°† TLS æ¨¡å¼è®¾ç½®ä¸º"),a("code",[s._v("SIMPLE")]),s._v("æ˜¯å•å‘TLSå…¥å£ç½‘å…³.")]),s._v(" "),a("li",[s._v("å°† TLS æ¨¡å¼è®¾ç½®ä¸º"),a("code",[s._v("MUTUAL")]),s._v("æ˜¯åŒå‘TLSå…¥å£ç½‘å…³")])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mygateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ingressgateway "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# use istio default ingress gateway")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("httpbin\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SIMPLE\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentialName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" httpbin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("credential\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" httpbin.example.com\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("helloworld\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SIMPLE\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("credentialName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("credential\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1.example.com\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[s._v("é…ç½®ç½‘å…³çš„æµé‡è·¯ç”±ã€‚å®šä¹‰ç›¸åº”çš„è™šæ‹ŸæœåŠ¡ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("|")]),s._v(" kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1.example.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mygateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("exact")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /hello\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" helloworld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("ol",{attrs:{start:"7"}},[a("li",[s._v("å‘é€ HTTPS è¯·æ±‚åˆ°"),a("code",[s._v("helloworld-v1.example.com")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v -HHost:httpbin.example.com --resolve "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --cacert example.com.crt "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v('/status/418"')]),s._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to httpbin.example.com port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n*   Trying "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Connected to httpbin.example.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("O")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin organization,CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com\n*       start date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" GMT\n*       expire date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example.com,O"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example Inc.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" GET /status/418 HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" User-Agent: curl/7.29.0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Accept: */*\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Host:httpbin.example.com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("418")]),s._v(" Unknown\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" server: istio-envoy\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" date: Mon, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" 00:58:24 GMT\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-origin: *\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-credentials: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" content-length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-envoy-upstream-service-time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n\n    -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" teapot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-\n\n       _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("_\n     .'  _ _ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(' ."'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" ^ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v('". _,\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("//\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_     _/\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"`\n* Connection '),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 to host httpbin.example.com left intact")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("ol",{attrs:{start:"8"}},[a("li",[s._v("å‘é€ä¸€ä¸ª HTTPS è¯·æ±‚"),a("code",[s._v("httpbin.example.com")]),s._v("å¹¶ä»ç„¶å¾—åˆ°ä¸€ä¸ªèŒ¶å£¶ä½œä¸ºå›æŠ¥ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -v -HHost:httpbin.example.com --resolve "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$INGRESS_HOST")]),s._v('"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" --cacert example.com.crt "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://httpbin.example.com:'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SECURE_INGRESS_PORT")]),s._v('/status/418"')]),s._v("\n* Added httpbin.example.com:7339:192.168.1.6 to DNS cache\n* About to connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to httpbin.example.com port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n*   Trying "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n* Connected to httpbin.example.com "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".1.6"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" port "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7339")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0)")]),s._v("\n* Initializing NSS with certpath: sql:/etc/pki/nssdb\n*   CAfile: example.com.crt\n  CApath: none\n* SSL connection using TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256\n* Server certificate:\n*       subject: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("O")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin organization,CN"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("httpbin.example.com\n*       start date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" GMT\n*       expire date: Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":18:42 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2023")]),s._v(" GMT\n*       common name: httpbin.example.com\n*       issuer: "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CN")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example.com,O"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("example Inc.\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" GET /status/418 HTTP/1.1\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" User-Agent: curl/7.29.0\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Accept: */*\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Host:httpbin.example.com\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" HTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("418")]),s._v(" Unknown\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" server: istio-envoy\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" date: Mon, "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" Mar "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v(" 01:13:48 GMT\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-more-info: http://tools.ietf.org/html/rfc2324\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-origin: *\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" access-control-allow-credentials: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" content-length: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("135")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" x-envoy-upstream-service-time: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("\n\n    -"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" teapot "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("-\n\n       _"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("_\n     .'  _ _ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(' ."'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v(" ^ "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v('". _,\n    '),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"---"')]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("//\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("/\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("_     _/\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v('"`\n* Connection '),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#0 to host httpbin.example.com left intact")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br")])]),a("h4",{attrs:{id:"å¯†é’¥æ ¼å¼"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å¯†é’¥æ ¼å¼"}},[s._v("#")]),s._v(" å¯†é’¥æ ¼å¼")]),s._v(" "),a("p",[s._v("Istio æ”¯æŒè¯»å–å‡ ç§ä¸åŒçš„ Secret æ ¼å¼ï¼Œä»¥æ”¯æŒä¸å„ç§å·¥å…·çš„é›†æˆï¼Œä¾‹å¦‚"),a("a",{attrs:{href:"https://istio.io/latest/docs/ops/integrations/certmanager/",target:"_blank",rel:"noopener noreferrer"}},[s._v("cert-manager"),a("OutboundLink")],1),s._v("ï¼š")]),s._v(" "),a("ul",[a("li",[s._v("ä¸€ä¸ª TLS å¯†é’¥ï¼Œå¸¦æœ‰"),a("code",[s._v("tls.key")]),s._v("å’Œ"),a("code",[s._v("tls.crt")]),s._v("ï¼Œå¦‚ä¸Šæ‰€è¿°ã€‚å¯¹äºåŒå‘ TLSï¼Œ"),a("code",[s._v("ca.crt")]),s._v("å¯ä»¥ä½¿ç”¨å¯†é’¥ã€‚")]),s._v(" "),a("li",[s._v("å¸¦æœ‰é”®çš„é€šç”¨ Secret"),a("code",[s._v("key")]),s._v("å’Œ"),a("code",[s._v("cert")]),s._v(". å¯¹äºåŒå‘ TLSï¼Œ"),a("code",[s._v("cacert")]),s._v("å¯ä»¥ä½¿ç”¨å¯†é’¥ã€‚")]),s._v(" "),a("li",[s._v("å¸¦æœ‰é”®çš„é€šç”¨ Secret"),a("code",[s._v("key")]),s._v("å’Œ"),a("code",[s._v("cert")]),s._v(". å¯¹äºåŒå‘ TLSï¼Œä¸€ä¸ªåä¸º çš„å•ç‹¬é€šç”¨ Secret"),a("code",[s._v("<secret>-cacert")]),s._v("å¸¦æœ‰ä¸€ä¸ª"),a("code",[s._v("cacert")]),s._v("å¯†é’¥ã€‚ä¾‹å¦‚ï¼Œ"),a("code",[s._v("httpbin-credential")]),s._v("æœ‰"),a("code",[s._v("key")]),s._v("å’Œ"),a("code",[s._v("cert")]),s._v("ï¼Œå¹¶ä¸”"),a("code",[s._v("httpbin-credential-cacert")]),s._v("æœ‰"),a("code",[s._v("cacert")]),s._v("ã€‚")]),s._v(" "),a("li",[a("code",[s._v("cacert")]),s._v("é”®å€¼å¯ä»¥æ˜¯ä¸€ä¸ª CA æ†ç»‘åŒ…ï¼Œç”±ä¸²è”çš„å„ä¸ª CA è¯ä¹¦ç»„æˆã€‚")])]),s._v(" "),a("h4",{attrs:{id:"æ¸…ç†-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-9"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤ç½‘å…³é…ç½®ã€è™šæ‹ŸæœåŠ¡å®šä¹‰å’Œæœºå¯†ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete gateway mygateway\n$ kubectl delete virtualservice httpbin\n$ kubectl delete --ignore-not-found"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -n istio-system secret httpbin-credential "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\nhelloworld-credential\n$ kubectl delete --ignore-not-found"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true virtualservice helloworld-v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("åˆ é™¤è¯ä¹¦å’Œå¯†é’¥ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf example.com.crt example.com.key httpbin.example.com.crt httpbin.example.com.key httpbin.example.com.csr helloworld-v1.example.com.crt helloworld-v1.example.com.key helloworld-v1.example.com.csr client.example.com.crt client.example.com.csr client.example.com.key ./new_certificates\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å…³é—­"),a("code",[s._v("httpbin")]),s._v("å’Œ"),a("code",[s._v("helloworld-v1")]),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete deployment --ignore-not-found"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true httpbin helloworld-v1\n$ kubectl delete "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" --ignore-not-found"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true httpbin helloworld-v1\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h2",{attrs:{id:"å‡ºå£tlså‘èµ·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£tlså‘èµ·"}},[s._v("#")]),s._v(" å‡ºå£TLSå‘èµ·")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯tlså‘èµ·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯tlså‘èµ·"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯TLSå‘èµ·")]),s._v(" "),a("p",[s._v("ç”¨äºé…ç½® Istio ä»¥å—æ§æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•é…ç½® Istio æ¥æ‰§è¡Œ"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/service-entry/",target:"_blank",rel:"noopener noreferrer"}},[a("code",[s._v("ServiceEntry")]),a("OutboundLink")],1),s._v("TLS å‘èµ· ç”¨äºåˆ°å¤–éƒ¨æœåŠ¡çš„æµé‡ã€‚å½“åŸå§‹æµé‡ä¸º HTTP æ—¶ï¼ŒIstio å°†æ‰“å¼€ä¸å¤–éƒ¨æœåŠ¡çš„ HTTPS è¿æ¥ã€‚")]),s._v(" "),a("p",[s._v("è€ƒè™‘ä¸€ä¸ªå¯¹å¤–éƒ¨ç«™ç‚¹æ‰§è¡Œ HTTP è°ƒç”¨çš„é—ç•™åº”ç”¨ç¨‹åºã€‚å‡è®¾è¿è¡Œåº”ç”¨ç¨‹åºçš„ç»„ç»‡æ”¶åˆ°ä¸€ä¸ªæ–°è¦æ±‚ï¼Œè¦æ±‚æ‰€æœ‰å¤–éƒ¨æµé‡éƒ½å¿…é¡»åŠ å¯†ã€‚ä½¿ç”¨ Istioï¼Œåªéœ€é…ç½®å³å¯å®ç°æ­¤è¦æ±‚ï¼Œæ— éœ€æ›´æ”¹åº”ç”¨ç¨‹åºä¸­çš„ä»»ä½•ä»£ç ã€‚åº”ç”¨ç¨‹åºå¯ä»¥å‘é€æœªåŠ å¯†çš„ HTTP è¯·æ±‚ï¼Œç„¶å Istio å°†ä¸ºåº”ç”¨ç¨‹åºåŠ å¯†å®ƒä»¬ã€‚")]),s._v(" "),a("p",[s._v("ä»æºå‘é€æœªåŠ å¯†çš„ HTTP è¯·æ±‚å¹¶è®© Istio æ‰§è¡Œ TLS å‡çº§çš„å¦ä¸€ä¸ªå¥½å¤„æ˜¯ Istio å¯ä»¥ç”Ÿæˆæ›´å¥½çš„é¥æµ‹æ•°æ®å¹¶ä¸ºæœªåŠ å¯†çš„è¯·æ±‚æä¾›æ›´å¤šçš„è·¯ç”±æ§åˆ¶ã€‚")]),s._v(" "),a("h4",{attrs:{id:"ç¯å¢ƒå‡†å¤‡-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ç¯å¢ƒå‡†å¤‡-8"}},[s._v("#")]),s._v(" ç¯å¢ƒå‡†å¤‡")]),s._v(" "),a("p",[s._v("å¯åŠ¨å°†ç”¨ä½œå¤–éƒ¨è°ƒç”¨æµ‹è¯•æºçš„"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç¡çœ æ ·æœ¬ã€‚"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("å¦‚æœæ‚¨å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨è¾¹è½¦æ³¨å…¥"),a("OutboundLink")],1),s._v("ï¼Œè¯·éƒ¨ç½²"),a("code",[s._v("sleep")]),s._v("åº”ç”¨ç¨‹åºï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/sleep/sleep.yaml\n$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/sleep/sleep.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("è¯·æ³¨æ„ï¼Œæ‚¨å¯ä»¥"),a("code",[s._v("exec")]),s._v("å’Œ"),a("code",[s._v("curl")]),s._v("æ¥è‡ªçš„ä»»ä½• pod éƒ½å°†æ‰§è¡Œä»¥ä¸‹è¿‡ç¨‹ã€‚")]),s._v(" "),a("p",[s._v("åˆ›å»ºä¸€ä¸ª shell å˜é‡æ¥ä¿å­˜ç”¨äºå‘å¤–éƒ¨æœåŠ¡å‘é€è¯·æ±‚çš„æº pod çš„åç§°ã€‚å¦‚æœæ‚¨ä½¿ç”¨äº†"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[s._v("sleep"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ï¼Œè¯·è¿è¡Œï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SOURCE_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sleep -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®"}},[s._v("#")]),s._v(" é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®")]),s._v(" "),a("p",[s._v("é¦–å…ˆä½¿ç”¨"),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/egress/egress-control",target:"_blank",rel:"noopener noreferrer"}},[s._v("è®¿é—®å¤–éƒ¨æœåŠ¡"),a("OutboundLink")],1),s._v("ä»»åŠ¡"),a("code",[s._v("edition.cnn.com")]),s._v("ä¸­æ˜¾ç¤ºçš„ç›¸åŒæŠ€æœ¯é…ç½®å¯¹å¤–éƒ¨æœåŠ¡çš„è®¿é—®ã€‚ä½†æ˜¯ï¼Œè¿™ä¸€æ¬¡ä½¿ç”¨å•ä¸ªæ¥å¯ç”¨å¯¹æœåŠ¡çš„ HTTP å’Œ HTTPS è®¿é—®ã€‚"),a("code",[s._v("ServiceEntry")])]),s._v(" "),a("ol",[a("li",[s._v("åˆ›å»ºä¸€ä¸ª"),a("code",[s._v("ServiceEntry")]),s._v("ä»¥å¯ç”¨å¯¹"),a("code",[s._v("edition.cnn.com")]),s._v("ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceEntry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resolution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DNS\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å‘å¤–éƒ¨ HTTP æœåŠ¡å‘å‡ºè¯·æ±‚ï¼š")])]),s._v(" "),a("blockquote",[a("p",[s._v("æ³¨æ„ curl çš„"),a("em",[s._v("æ ‡å¿—")]),a("code",[s._v("-L")]),s._v("ï¼Œå®ƒæŒ‡ç¤º"),a("em",[s._v("curl")]),s._v("éµå¾ªé‡å®šå‘ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¸º HTTP è¯·æ±‚è¿”å›äº†é‡å®šå‘å“åº”ï¼ˆ"),a("a",{attrs:{href:"https://tools.ietf.org/html/rfc2616#section-10.3.2",target:"_blank",rel:"noopener noreferrer"}},[s._v("301 Moved Permanently"),a("OutboundLink")],1),s._v(" ï¼‰ ã€‚é‡å®šå‘å“åº”æŒ‡ç¤ºå®¢æˆ·ç«¯å‘é€ä¸€ä¸ªé¢å¤–çš„è¯·æ±‚ï¼Œè¿™æ¬¡ä½¿ç”¨ HTTPSï¼Œåˆ°. å¯¹äºç¬¬äºŒä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å›è¯·æ±‚çš„å†…å®¹å’Œ"),a("em",[s._v("200 OK")]),s._v("çŠ¶æ€ç ã€‚"),a("code",[s._v("http://edition.cnn.com/politics``https://edition.cnn.com/politics")])]),s._v(" "),a("p",[s._v("å°½ç®¡"),a("em",[s._v("curl")]),s._v("å‘½ä»¤é€æ˜åœ°å¤„ç†äº†é‡å®šå‘ï¼Œä½†è¿™é‡Œæœ‰ä¸¤ä¸ªé—®é¢˜ã€‚ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å†—ä½™è¯·æ±‚ï¼Œå®ƒä½¿è·å–"),a("code",[s._v("http://edition.cnn.com/politics")]),s._v(". ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ URL çš„è·¯å¾„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯"),a("em",[s._v("æ”¿æ²»")]),s._v("ï¼Œæ˜¯ä»¥æ˜æ–‡å½¢å¼å‘é€çš„ã€‚å¦‚æœæœ‰æ”»å‡»è€…å—…æ¢ä½ çš„åº”ç”¨ç¨‹åºå’Œ ä¹‹é—´çš„é€šä¿¡"),a("code",[s._v("edition.cnn.com")]),s._v("ï¼Œæ”»å‡»è€…å°±ä¼šçŸ¥é“"),a("code",[s._v("edition.cnn.com")]),s._v("åº”ç”¨ç¨‹åºè·å–äº†å“ªäº›ç‰¹å®šä¸»é¢˜ã€‚å‡ºäºéšç§åŸå› ï¼Œæ‚¨å¯èƒ½å¸Œæœ›é˜»æ­¢æ­¤ç±»æŠ«éœ²ã€‚")]),s._v(" "),a("p",[a("strong",[s._v("è¿™ä¸¤ä¸ªé—®é¢˜éƒ½å¯ä»¥é€šè¿‡é…ç½® Istio æ¥æ‰§è¡Œ TLS å‘èµ·æ¥è§£å†³ã€‚")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SOURCE_POD}")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - http://edition.cnn.com/politics\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" Moved Permanently\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlocation: https://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])]),a("h4",{attrs:{id:"å‡ºå£æµé‡çš„tlså‘èµ·"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£æµé‡çš„tlså‘èµ·"}},[s._v("#")]),s._v(" å‡ºå£æµé‡çš„TLSå‘èµ·")]),s._v(" "),a("ol",[a("li",[s._v("é‡æ–°å®šä¹‰"),a("code",[s._v("ServiceEntry")]),s._v("ä¸Šä¸€èŠ‚ä¸­çš„å°† HTTP è¯·æ±‚é‡å®šå‘åˆ°ç«¯å£ 443 å¹¶æ·»åŠ ä¸€ä¸ª"),a("code",[s._v("DestinationRule")]),s._v("ä»¥æ‰§è¡Œ TLS å‘èµ·ï¼š\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®æœåŠ¡å…¥å£çš„httpé‡å®šå‘åˆ°443ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®äº¤é€šç­–ç•¥é’ˆå¯¹80ç«¯å£ä½¿ç”¨æ¨¡å¼ä¸ºSIMPLEçš„tls")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceEntry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resolution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DNS\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("com\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("trafficPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("portLevelSettings")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" SIMPLE "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# initiates HTTPS when accessing edition.cnn.com")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[s._v("ä»¥ä¸Š"),a("code",[s._v("DestinationRule")]),s._v("å°†ä¸ºç«¯å£ 80 ä¸Šçš„ HTTP è¯·æ±‚æ‰§è¡Œ TLS å‘èµ·ï¼Œ"),a("code",[s._v("ServiceEntry")]),s._v(" ç„¶åå°†ç«¯å£ 80 ä¸Šçš„è¯·æ±‚é‡å®šå‘åˆ°ç›®æ ‡ç«¯å£ 443ã€‚")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å‘ å‘é€ HTTP è¯·æ±‚"),a("code",[s._v("http://edition.cnn.com/politics")]),s._v("ï¼Œå¦‚ä¸Šä¸€èŠ‚æ‰€è¿°ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SOURCE_POD}")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - http://edition.cnn.com/politics\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("è¿™æ¬¡æ‚¨æ”¶åˆ°"),a("em",[s._v("200 OK")]),s._v("ä½œä¸ºç¬¬ä¸€ä¸ªä¹Ÿæ˜¯å”¯ä¸€çš„å“åº”ã€‚Istio ä¸º"),a("em",[s._v("curl")]),s._v("æ‰§è¡Œ TLS å‘èµ·ï¼Œå› æ­¤åŸå§‹ HTTP è¯·æ±‚è¢«è½¬å‘"),a("code",[s._v("edition.cnn.com")]),s._v("ä¸º HTTPSã€‚æœåŠ¡å™¨ç›´æ¥è¿”å›å†…å®¹ï¼Œæ— éœ€é‡å®šå‘ã€‚æ‚¨æ¶ˆé™¤äº†å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„åŒé‡å¾€è¿”ï¼Œå¹¶ä¸”è¯·æ±‚ä½¿ç½‘æ ¼åŠ å¯†ï¼Œè€Œæ²¡æœ‰æŠ«éœ²æ‚¨çš„åº”ç”¨ç¨‹åº"),a("em",[s._v("è·å–")]),s._v("."),a("code",[s._v("edition.cnn.com")])]),s._v(" "),a("p",[s._v("è¯·æ³¨æ„ï¼Œæ‚¨ä½¿ç”¨äº†ä¸ä¸Šä¸€èŠ‚ä¸­ç›¸åŒçš„å‘½ä»¤ã€‚å¯¹äºä»¥ç¼–ç¨‹æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡çš„åº”ç”¨ç¨‹åºï¼Œæ— éœ€æ›´æ”¹ä»£ç ã€‚æ‚¨å¯ä»¥é€šè¿‡é…ç½® Istio è·å¾— TLS å‘èµ·çš„å¥½å¤„ï¼Œè€Œæ— éœ€æ›´æ”¹ä¸€è¡Œä»£ç ã€‚")]),s._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[s._v("è¯·æ³¨æ„ï¼Œä½¿ç”¨ HTTPS è®¿é—®å¤–éƒ¨æœåŠ¡çš„åº”ç”¨ç¨‹åºç»§ç»­åƒä»¥å‰ä¸€æ ·å·¥ä½œï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${SOURCE_POD}")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - https://edition.cnn.com/politics\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†-10"}},[s._v("#")]),s._v(" æ¸…ç†")]),s._v(" "),a("p",[s._v("åˆ é™¤æ‚¨åˆ›å»ºçš„ Istio é…ç½®é¡¹ã€å…³é—­"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[s._v("ç¡çœ "),a("OutboundLink")],1),s._v("æœåŠ¡ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete serviceentry edition-cnn-com\n$ kubectl delete destinationrule edition-cnn-com\n$ kubectl delete -f samples/sleep/sleep.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h2",{attrs:{id:"å‡ºå£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#å‡ºå£ç½‘å…³"}},[s._v("#")]),s._v(" å‡ºå£ç½‘å…³")]),s._v(" "),a("h4",{attrs:{id:"ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³"}},[s._v("#")]),s._v(" ä»€ä¹ˆæ˜¯å‡ºå£ç½‘å…³")]),s._v(" "),a("p",[s._v("Istio ä½¿ç”¨"),a("a",{attrs:{href:"https://istio.io/latest/docs/reference/config/networking/gateway/",target:"_blank",rel:"noopener noreferrer"}},[s._v("å…¥å£å’Œå‡ºå£ç½‘å…³"),a("OutboundLink")],1),s._v(" æ¥é…ç½®åœ¨æœåŠ¡ç½‘æ ¼è¾¹ç¼˜æ‰§è¡Œçš„è´Ÿè½½å‡è¡¡å™¨ã€‚å…¥å£ç½‘å…³å…è®¸æ‚¨å®šä¹‰æ‰€æœ‰ä¼ å…¥æµé‡æµè¿‡çš„ç½‘æ ¼çš„å…¥å£ç‚¹ã€‚å‡ºå£ç½‘å…³æ˜¯ä¸€ä¸ªå¯¹ç§°çš„æ¦‚å¿µï¼›å®ƒå®šä¹‰äº†ç½‘æ ¼çš„å‡ºå£ç‚¹ã€‚å‡ºå£ç½‘å…³å…è®¸æ‚¨å°† Istio åŠŸèƒ½ï¼ˆä¾‹å¦‚ç›‘æ§å’Œè·¯ç”±è§„åˆ™ï¼‰åº”ç”¨äºé€€å‡ºç½‘æ ¼çš„æµé‡ã€‚")]),s._v(" "),a("p",[s._v("è€ƒè™‘ä¸€ä¸ªå…·æœ‰ä¸¥æ ¼å®‰å…¨è¦æ±‚çš„ç»„ç»‡ï¼Œå³æ‰€æœ‰ç¦»å¼€æœåŠ¡ç½‘æ ¼çš„æµé‡éƒ½å¿…é¡»æµç»ä¸€ç»„ä¸“ç”¨èŠ‚ç‚¹ã€‚è¿™äº›èŠ‚ç‚¹å°†åœ¨ä¸“ç”¨æœºå™¨ä¸Šè¿è¡Œï¼Œä¸é›†ç¾¤ä¸­è¿è¡Œåº”ç”¨ç¨‹åºçš„å…¶ä½™èŠ‚ç‚¹åˆ†å¼€ã€‚è¿™äº›ç‰¹æ®ŠèŠ‚ç‚¹å°†ç”¨äºå¯¹å‡ºå£æµé‡æ‰§è¡Œç­–ç•¥ï¼Œå¹¶ä¸”å°†æ¯”å…¶ä»–èŠ‚ç‚¹æ›´å½»åº•åœ°ç›‘æ§ã€‚")]),s._v(" "),a("p",[s._v("å¦ä¸€ä¸ªç”¨ä¾‹æ˜¯åº”ç”¨ç¨‹åºèŠ‚ç‚¹æ²¡æœ‰å…¬å…± IP çš„é›†ç¾¤ï¼Œå› æ­¤åœ¨å®ƒä»¬ä¸Šè¿è¡Œçš„ç½‘å†…æœåŠ¡æ— æ³•è®¿é—® Internetã€‚å®šä¹‰ä¸€ä¸ªå‡ºå£ç½‘å…³ï¼Œå¼•å¯¼æ‰€æœ‰å‡ºå£æµé‡é€šè¿‡å®ƒï¼Œå¹¶å°†å…¬å…± IP åˆ†é…ç»™å‡ºå£ç½‘å…³èŠ‚ç‚¹ï¼Œå…è®¸åº”ç”¨ç¨‹åºèŠ‚ç‚¹ä»¥å—æ§æ–¹å¼è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚")]),s._v(" "),a("h4",{attrs:{id:"åŸºç¡€ç¯å¢ƒ-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#åŸºç¡€ç¯å¢ƒ-3"}},[s._v("#")]),s._v(" åŸºç¡€ç¯å¢ƒ")]),s._v(" "),a("p",[s._v("éƒ¨ç½²"),a("a",{attrs:{href:"https://github.com/istio/istio/tree/release-1.13/samples/sleep",target:"_blank",rel:"noopener noreferrer"}},[s._v("sleep"),a("OutboundLink")],1),s._v("ç¤ºä¾‹åº”ç”¨ç¨‹åºä»¥ç”¨ä½œå‘é€è¯·æ±‚çš„æµ‹è¯•æºã€‚å¦‚æœæ‚¨ å¯ç”¨äº†"),a("a",{attrs:{href:"https://istio.io/latest/docs/setup/additional-setup/sidecar-injection/#automatic-sidecar-injection",target:"_blank",rel:"noopener noreferrer"}},[s._v("è‡ªåŠ¨ Sidecar æ³¨å…¥"),a("OutboundLink")],1),s._v(" ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åºï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl apply -f samples/sleep/sleep.yaml\n$ kubectl apply -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("istioctl kube-inject -f samples/sleep/sleep.yaml"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("å°†"),a("code",[s._v("SOURCE_POD")]),s._v("ç¯å¢ƒå˜é‡è®¾ç½®ä¸ºæº pod çš„åç§°ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SOURCE_POD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sleep -o "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("jsonpath")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(".items"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("metadata.name"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h4",{attrs:{id:"éƒ¨ç½²istioå‡ºå£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#éƒ¨ç½²istioå‡ºå£ç½‘å…³"}},[s._v("#")]),s._v(" éƒ¨ç½²Istioå‡ºå£ç½‘å…³")]),s._v(" "),a("ol",[a("li",[s._v("æ£€æŸ¥æ˜¯å¦éƒ¨ç½²äº† Istio å‡ºå£ç½‘å…³ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl get pod -l "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("egressgateway -n istio-system\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("å¦‚æœæ²¡æœ‰è¿”å› podï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤éƒ¨ç½² Istio å‡ºå£ç½‘å…³ã€‚")]),s._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[s._v("å¦‚æœæ‚¨ä½¿ç”¨"),a("code",[s._v("IstioOperator")]),s._v("CR å®‰è£… Istioï¼Œè¯·å°†ä»¥ä¸‹å­—æ®µæ·»åŠ åˆ°æ‚¨çš„é…ç½®ä¸­ï¼š")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("components")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("egressGateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("å¦åˆ™ï¼Œå°†ç­‰æ•ˆè®¾ç½®æ·»åŠ åˆ°æ‚¨çš„åŸå§‹"),a("code",[s._v("istioctl install")]),s._v("å‘½ä»¤ï¼Œä¾‹å¦‚ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ istioctl "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("flags-you-used-to-install-Istio"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                   --set components.egressGateways"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("istio-egressgateway "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n                   --set components.egressGateways"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".enabled"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("h4",{attrs:{id:"httpæµé‡çš„å‡ºå£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#httpæµé‡çš„å‡ºå£ç½‘å…³"}},[s._v("#")]),s._v(" HTTPæµé‡çš„å‡ºå£ç½‘å…³")]),s._v(" "),a("p",[s._v("é¦–å…ˆåˆ›å»ºä¸€ä¸ª"),a("code",[s._v("ServiceEntry")]),s._v("å…è®¸ç›´æ¥æµé‡åˆ°å¤–éƒ¨æœåŠ¡ã€‚")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("ServiceEntry")]),s._v("ä¸ºå®šä¹‰ä¸€ä¸ª"),a("code",[s._v("edition.cnn.com")]),s._v("ã€‚\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®ä¸»æœºä¸ºedition.cnn.com")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ä¸»æœºå‘ç°æ¨¡å¼ä¸ºDNS")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®HTTPå’ŒHTTPSä¸¤ä¸ªåè®®")])])])])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("DNS")]),s._v("å¿…é¡»åœ¨ä¸‹é¢çš„æœåŠ¡æ¡ç›®ä¸­ä½¿ç”¨åˆ†è¾¨ç‡ã€‚å¦‚æœåˆ†è¾¨ç‡ä¸º"),a("code",[s._v("NONE")]),s._v("ï¼Œç½‘å…³å°†åœ¨æ— é™å¾ªç¯ä¸­å°†æµé‡å®šå‘åˆ°è‡ªèº«ã€‚è¿™æ˜¯å› ä¸ºç½‘å…³æ¥æ”¶åˆ°ä¸€ä¸ªè¯·æ±‚ï¼Œå…¶åŸå§‹ç›®æ ‡ IP åœ°å€ç­‰äºç½‘å…³çš„æœåŠ¡ IPï¼ˆå› ä¸ºè¯·æ±‚æ˜¯ç”± Sidecar ä»£ç†å®šå‘åˆ°ç½‘å…³çš„ï¼‰ã€‚é€šè¿‡"),a("code",[s._v("DNS")]),s._v("è§£æï¼Œç½‘å…³æ‰§è¡Œ DNS æŸ¥è¯¢ä»¥è·å–å¤–éƒ¨æœåŠ¡çš„ IP åœ°å€å¹¶å°†æµé‡å®šå‘åˆ°è¯¥ IP åœ°å€ã€‚")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceEntry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("port\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" https\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTPS\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resolution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DNS\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[a("a",{attrs:{href:"http://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[s._v("é€šè¿‡å‘http://edition.cnn.com/politics"),a("OutboundLink")],1),a("code",[s._v("ServiceEntry")]),s._v("å‘é€ HTTP è¯·æ±‚æ¥éªŒè¯æ‚¨çš„åº”ç”¨æ˜¯å¦æ­£ç¡®ã€‚")]),s._v(" "),a("p",[s._v("è¾“å‡ºåº”ä¸ "),a("a",{attrs:{href:"https://istio.io/latest/docs/tasks/traffic-management/egress/egress-tls-origination/",target:"_blank",rel:"noopener noreferrer"}},[s._v("TLS Origination for Egress Traffic"),a("OutboundLink")],1),s._v("ç¤ºä¾‹ä¸­çš„ç›¸åŒï¼Œä½†æ²¡æœ‰ TLS å‘èµ·ã€‚")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SOURCE_POD")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - http://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" Moved Permanently\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlocation: https://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[s._v("Gateway")]),s._v("ä¸º"),a("em",[s._v("edition.cnn.com")]),s._v("åˆ›å»ºä¸€ä¸ªå‡ºå£ï¼Œç«¯å£ 80ï¼Œå¹¶ä¸ºå®šå‘åˆ°å‡ºå£ç½‘å…³çš„æµé‡åˆ›å»ºä¸€ä¸ªç›®æ ‡è§„åˆ™ã€‚\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®å‡ºå£ç½‘å…³ä¸ºegressgateway")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ä¸»æœºedition.cnn.comè§„èŒƒä¸ºå…è®¸80ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("åˆ›å»ºè·¯ç”±è§„åˆ™ä¸»æœºä½¿ç”¨ istio-egressgateway.istio-system.svc.cluster.local")])]),s._v(" "),a("li",[a("code",[s._v("è·¯ç”±è§„åˆ™ä¸‹çš„å­é›†ä½¿ç”¨cnn")])])])])]),s._v(" "),a("blockquote",[a("p",[s._v("è¦é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼å¤šä¸ªä¸»æœºï¼Œæ‚¨å¯ä»¥"),a("code",[s._v("*")]),s._v("åœ¨"),a("code",[s._v("Gateway")]),s._v(". åº”å°† ä¸­çš„"),a("code",[s._v("subset")]),s._v("å­—æ®µé‡æ–°ç”¨äºå…¶ä»–ä¸»æœºã€‚"),a("code",[s._v("DestinationRule")])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" egressgateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" HTTP\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" egressgateway"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway.istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system.svc.cluster.local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[s._v("å®šä¹‰ "),a("code",[s._v("VirtualService")]),s._v("ä»¥å°†æµé‡ä» sidecar å¼•å¯¼åˆ° egress ç½‘å…³ï¼Œå¹¶ä» egress ç½‘å…³å¼•å¯¼åˆ°å¤–éƒ¨æœåŠ¡ï¼š\n"),a("ul",[a("li",[a("code",[s._v("å®šä¹‰ä¸»æœºåœ°å€ä¸ºedition.cnn.com")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡ä½¿ç”¨ä¸¤ä¸ªç½‘å…³ istio-egressgatewayå’Œmesh")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®httpè§„åˆ™åˆ†åˆ«ä½¿ç”¨ä¸¤ä¸ªç½‘å…³éƒ½æ˜¯å…è®¸80ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®meshçš„è·¯ç”±è§„åˆ™å…è®¸ä¸»æœº istio-egressgateway.istio-system.svc.cluster.local ã€å­é›†ä¸ºcnnã€ç«¯å£æ˜¯80 ã€æƒé‡åˆ†é…ä¸º100")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®istio-egressgatewayçš„è·¯ç”±è§„åˆ™å…è®¸ä¸»æœºä¸ºedition.cnn.comã€ç«¯å£æ˜¯80ã€æƒé‡åˆ†é…ä¹Ÿæ˜¯100")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" direct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("through"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mesh\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mesh\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway.istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system.svc.cluster.local\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition.cnn.com\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("å°† HTTP è¯·æ±‚é‡æ–°å‘é€åˆ°"),a("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://edition.cnn.com/politics"),a("OutboundLink")],1),s._v("ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SOURCE_POD")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - http://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHTTP/1.1 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" Moved Permanently\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nlocation: https://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("ol",{attrs:{start:"6"}},[a("li",[a("p",[s._v("æ£€æŸ¥"),a("code",[s._v("istio-egressgateway")]),s._v("pod çš„æ—¥å¿—ä¸­æ˜¯å¦æœ‰ä¸æˆ‘ä»¬çš„è¯·æ±‚ç›¸å¯¹åº”çš„è¡Œã€‚å¦‚æœ Istio éƒ¨ç½²åœ¨"),a("code",[s._v("istio-system")]),s._v("å‘½åç©ºé—´ä¸­ï¼Œæ‰“å°æ—¥å¿—çš„å‘½ä»¤æ˜¯ï¼š")]),s._v(" "),a("p",[s._v("è¯·æ³¨æ„ï¼Œæ‚¨ä»…å°†æµé‡ä»ç«¯å£ 80 é‡å®šå‘åˆ°å‡ºå£ç½‘å…³ã€‚åˆ°ç«¯å£ 443 çš„ HTTPS æµé‡ç›´æ¥è½¬åˆ°"),a("em",[s._v("edition.cnn.com")]),s._v("ã€‚")])])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs -l istio=egressgateway -c istio-proxy -n istio-system | tail")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T09:42:18.336211Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T10:14:36.196020Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T10:47:07.424114Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T11:15:16.460832Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T11:42:49.235363Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T11:52:20.947Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"- - -"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" UF,URX - - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151.101.65.67:443"')]),s._v(" outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("edition.cnn.com - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:8443 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.20:33384 edition.cnn.com -\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T11:52:28.733Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"- - -"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" - - - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("910")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1262165")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45829")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151.101.193.67:443"')]),s._v(" outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("edition.cnn.com "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:49136 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:8443 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.20:33440 edition.cnn.com -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T12:15:16.256967Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T12:45:27.104242Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:06:35.033Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /politics HTTP/2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" - via_upstream - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("356")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("356")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.1.20"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"82a2b1d1-70f0-9907-bfc3-1a86cfd91721"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"edition.cnn.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151.101.129.67:80"')]),s._v(" outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("edition.cnn.com "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:47896 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:8080 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.20:42962 - -\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†httpç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†httpç½‘å…³"}},[s._v("#")]),s._v(" æ¸…ç†HTTPç½‘å…³")]),s._v(" "),a("p",[s._v("åœ¨ç»§ç»­ä¸‹ä¸€æ­¥ä¹‹å‰åˆ é™¤ä»¥å‰çš„å®šä¹‰ï¼š")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete gateway istio-egressgateway\n$ kubectl delete serviceentry cnn\n$ kubectl delete virtualservice direct-cnn-through-egress-gateway\n$ kubectl delete destinationrule egressgateway-for-cnn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h4",{attrs:{id:"httpsæµé‡çš„å‡ºå£ç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#httpsæµé‡çš„å‡ºå£ç½‘å…³"}},[s._v("#")]),s._v(" HTTPSæµé‡çš„å‡ºå£ç½‘å…³")]),s._v(" "),a("p",[s._v("åœ¨æœ¬èŠ‚ä¸­ï¼Œæ‚¨å°†é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼ HTTPS æµé‡ï¼ˆç”±åº”ç”¨ç¨‹åºå‘èµ·çš„ TLSï¼‰ã€‚æ‚¨éœ€è¦"),a("code",[s._v("TLS")]),s._v("åœ¨ä¸€ä¸ªå¯¹åº”"),a("code",[s._v("ServiceEntry")]),s._v("çš„ã€ä¸€ä¸ªå‡ºå£"),a("code",[s._v("Gateway")]),s._v("å’Œä¸€ä¸ª"),a("code",[s._v("VirtualService")]),s._v(".")]),s._v(" "),a("ol",[a("li",[a("code",[s._v("ServiceEntry")]),s._v("ä¸ºå®šä¹‰ä¸€ä¸ª"),a("code",[s._v("edition.cnn.com")]),s._v("ï¼š\n"),a("ul",[a("li",[a("code",[s._v("é…ç½®æœåŠ¡å…¥å£çš„ä¸»æœºåˆ—è¡¨ä¸º edition.cnn.com")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®portsè§„åˆ™ä¸ºTLSæ¨¡å¼ä»¥åŠ443ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ä¸»æœºå‘ç°æ¨¡å¼ä¸ºDNS")])])])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ServiceEntry\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tls\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TLS\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resolution")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DNS\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[a("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[s._v("é€šè¿‡å‘https://edition.cnn.com/politics"),a("OutboundLink")],1),a("code",[s._v("ServiceEntry")]),s._v("å‘é€ HTTPS è¯·æ±‚æ¥éªŒè¯æ‚¨çš„åº”ç”¨æ˜¯å¦æ­£ç¡®ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SOURCE_POD")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - https://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"3"}},[a("li",[a("code",[s._v("Gateway")]),s._v("ä¸º"),a("em",[s._v("edition.cnn.com")]),s._v("åˆ›å»ºä¸€ä¸ªå‡ºå£ã€ä¸€ä¸ªç›®æ ‡è§„åˆ™å’Œä¸€ä¸ªè™šæ‹ŸæœåŠ¡ï¼Œä»¥å¼•å¯¼æµé‡é€šè¿‡å‡ºå£ç½‘å…³å¹¶ä»å‡ºå£ç½‘å…³åˆ°å¤–éƒ¨æœåŠ¡ã€‚\n"),a("ul",[a("li",[a("code",[s._v("åˆ›å»ºæœåŠ¡ç½‘å…³å’Œç›®æ ‡è§„åˆ™ä»¥åŠè™šæ‹ŸæœåŠ¡")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®Gatewayä½¿ç”¨egressgatewayçš„å‡ºå£ç½‘å…³,æœåŠ¡è§„åˆ™ä¸ºå…è®¸443ç«¯å£ä½¿ç”¨TLS")])]),s._v(" "),a("li",[a("code",[s._v("Gatewayå…è®¸çš„ä¸»æœºä¸º edition.cnn.com tlsçš„æ¨¡å¼ä½¿ç”¨PASSTHROUGH")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®ç›®æ ‡è§„åˆ™å…è®¸çš„ä¸»æœºåˆ—è¡¨istio-egressgateway.istio-system.svc.cluster.local å­é›†ä¸ºcnn")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡å…è®¸ä¸»æœºåˆ—è¡¨ä¸ºedition.cnn.com")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡ä½¿ç”¨å‡ºå£ç½‘å…³istio-egressgatewayå’Œmesh")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„meshç½‘å…³è¦åŒ¹é…çš„SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºå™¨ï¼‰edition.cnn.com å…è®¸443ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„meshç½‘å…³ç›®æ ‡è§„åˆ™å…è®¸ä¸»æœºåˆ—è¡¨istio-egressgateway.istio-system.svc.cluster.localå¹¶ä¸”å…è®¸443ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„istio-egressgatewayç½‘å…³è¦åŒ¹é…çš„SNIï¼ˆæœåŠ¡å™¨åç§°æŒ‡ç¤ºå™¨ï¼‰edition.cnn.com å…è®¸443ç«¯å£")])]),s._v(" "),a("li",[a("code",[s._v("é…ç½®è™šæ‹ŸæœåŠ¡çš„istio-egressgatewayç½‘å…³ç›®æ ‡è§„åˆ™å…è®¸ä¸»æœºåˆ—è¡¨edition.cnn.comå¹¶ä¸”å…è®¸443ç«¯å£ã€æƒé‡ä¸º100")])])])])]),s._v(" "),a("blockquote",[a("p",[s._v("è¦é€šè¿‡å‡ºå£ç½‘å…³å¼•å¯¼å¤šä¸ªä¸»æœºï¼Œæ‚¨å¯ä»¥"),a("code",[s._v("*")]),s._v("åœ¨"),a("code",[s._v("Gateway")]),s._v(". åº”å°† ä¸­çš„"),a("code",[s._v("subset")]),s._v("å­—æ®µé‡æ–°ç”¨äºå…¶ä»–ä¸»æœºã€‚"),a("code",[s._v("DestinationRule")])])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[s._v("$ kubectl apply "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("f "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" <<EOF\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("istio")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" egressgateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("servers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" tls\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TLS\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PASSTHROUGH\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" DestinationRule\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" egressgateway"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("for"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway.istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system.svc.cluster.local\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subsets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" networking.istio.io/v1alpha3\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" VirtualService\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" direct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("cnn"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("through"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egress"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mesh\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("tls")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" mesh\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sniHosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway.istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("system.svc.cluster.local\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cnn\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateways")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" istio"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("egressgateway\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("sniHosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" edition.cnn.com\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("route")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("destination")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" edition.cnn.com\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("number")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("weight")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\nEOF\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br")])]),a("ol",{attrs:{start:"4"}},[a("li",[a("a",{attrs:{href:"https://edition.cnn.com/politics",target:"_blank",rel:"noopener noreferrer"}},[s._v("å‘https://edition.cnn.com/politics"),a("OutboundLink")],1),s._v("å‘é€ HTTPS è¯·æ±‚ã€‚è¾“å‡ºåº”è¯¥å’Œä»¥å‰ä¸€æ ·ã€‚")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$SOURCE_POD")]),s._v('"')]),s._v(" -c "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" -- "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -sSL -o /dev/null -D - https://edition.cnn.com/politics\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nHTTP/2 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("\nContent-Type: text/html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("charset")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf-8\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ol",{attrs:{start:"5"}},[a("li",[s._v("æŸ¥çœ‹å‡ºå£ç½‘å…³ä»£ç†çš„æ—¥å¿—ã€‚å¦‚æœ Istio éƒ¨ç½²åœ¨"),a("code",[s._v("istio-system")]),s._v("å‘½åç©ºé—´ä¸­ï¼Œæ‰“å°æ—¥å¿—çš„å‘½ä»¤æ˜¯ï¼š")])]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-master-node1 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl logs -l istio=egressgateway -n istio-system")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T11:52:28.733Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"- - -"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" - - - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("910")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1262165")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("45829")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151.101.193.67:443"')]),s._v(" outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("edition.cnn.com "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:49136 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:8443 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.20:33440 edition.cnn.com -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T12:15:16.256967Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T12:45:27.104242Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:06:35.033Z"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /politics HTTP/2"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" - via_upstream - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("356")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("356")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.244.1.20"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"curl/7.81.0-DEV"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"82a2b1d1-70f0-9907-bfc3-1a86cfd91721"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"edition.cnn.com"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"151.101.129.67:80"')]),s._v(" outbound"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v("edition.cnn.com "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:47896 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.4:8080 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".1.20:42962 - -\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:15:59.020699Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:40:14.303559Z     info    ads     XDS: Incremental Pushing:0 ConnectedEndpoints:2 Version:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:40:14.597921Z     info    cache   generated new workload certificate   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("latency")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("294")]),s._v(".218007ms "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ttl")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("23h59m59.402089572s\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:40:14.598006Z     info    ads     SDS: PUSH "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" node:istio-egressgateway-7f4864f59c-q5cdv.istio-system resources:1 size:4.0kB resource:default\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T13:47:00.985263Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-03-21T14:18:49.713637Z     info    xdsproxy        connected to upstream XDS server: istiod.istio-system.svc:15012\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("h4",{attrs:{id:"æ¸…ç†httpsç½‘å…³"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#æ¸…ç†httpsç½‘å…³"}},[s._v("#")]),s._v(" æ¸…ç†HTTPSç½‘å…³")]),s._v(" "),a("div",{staticClass:"language-shell line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ kubectl delete serviceentry cnn\n$ kubectl delete gateway istio-egressgateway\n$ kubectl delete virtualservice direct-cnn-through-egress-gateway\n$ kubectl delete destinationrule egressgateway-for-cnn\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);